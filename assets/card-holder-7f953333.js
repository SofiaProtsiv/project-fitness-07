import{A as hl}from"./index-a55b2bd8.js";const Ay=document.getElementById("daily-quote"),Ry=document.getElementById("quote-author"),fk=new hl;function OI(){const n=new Date,e=n.getFullYear(),t=(n.getMonth()+1).toString().padStart(2,"0");return`${n.getDate().toString().padStart(2,"0")}/${t}/${e}`}async function pk(){try{const n=await fk.fetchQuote(),e=n.quote,t=n.author,r=OI();return localStorage.setItem("today",r),localStorage.setItem("quote",e),localStorage.setItem("author",t),{quote:e,author:t}}catch(n){console.error("Error fetching quote:",n.message)}}const Sy=localStorage.getItem("today"),gk=OI();if(!Sy||Sy!==gk)pk().then(({quote:n,author:e})=>{Ay.textContent=n,Ry.textContent=e});else{const n=localStorage.getItem("quote");n&&(Ay.textContent=n);const e=localStorage.getItem("author");e&&(Ry.textContent=e)}const dl=document.querySelector(".js-cards"),Ss="/project-fitness-07/";function mk(n){const e=n.map(({filter:t,name:r,imgURL:i})=>`
        <a class="exercise-cards__gallery-link js-card" data-card-name="${r}" href="">
            <div class="exercise-cards__gallery-card">
                
                <img class="exercise-cards__gallery-image"  src="${i}" alt="${t+"-"+r}" loading="lazy" />
                <div class="exercise-cards__gallery-info">
                    <h3 class="exercise-cards__head3-name">${r}</h3>
                    <p class="exercise-cards__parag-filter">${t}</p>
                </div>
            </div>
        </a>
        `).join("");dl.insertAdjacentHTML("beforeend",e)}function _k(n){const e=n.map(({_id:t,bodyPart:r,name:i,target:s,burnedCalories:a,time:l,rating:h})=>`
        <a class="workout-cards__gallery-link js-workout-card" data-id="${t}"  href="">
            <div class="workout-cards__gallery-card" >
                <div class="workout-cards__first-line-wrapper">
                    <p class="workout-cards__parag-workout">Workout</p>
                    <p class="workout-cards__parag-rating">${Math.round(h*10)/10}</p>
                    <svg class="workout-cards__icon-star">
                        <use href="${Ss}images/icons-sprite.svg#icon-star"></use>
                    </svg>
                    <p class="workout-cards__parag-start">Start</p>
                    <svg class="workout-cards__icon-arrow-up">
                        <use href="${Ss}images/icons-sprite.svg#icon-arrow-up"></use>
                    </svg>
                </div>
                <div class="workout-cards__second-line-wrapper">
                    <div class="workout-cards__wrapper-icon-running-stick">
                        <svg class="workout-cards__icon-running-stick">
                            <use href="${Ss}images/icons-sprite.svg#icon-running-stick"></use>
                        </svg>
                    </div>
                    <h3 class="workout-cards__head3-name">${i}</h3>
                </div>
                <div class="workout-cards__third-line-wrapper">
                    <p class="workout-cards__parag-burned-calories">Burned calories:</p>
                    <p class="workout-cards__parag-burned-calories-result">${a} / ${l} min<p>
                    <p class="workout-cards__parag-body-part">Body part:</p>
                    <p class="workout-cards__parag-body-part-result">${r}<p>
                    <p class="workout-cards__parag-target">Target:</p>
                    <p class="workout-cards__parag-target-result">${s}<p>
                </div>
            </div>
        </a>
        `).join("");dl.insertAdjacentHTML("beforeend",e)}function yk(n){const e=n.map(({_id:t,bodyPart:r,name:i,target:s,burnedCalories:a,time:l})=>`
        <a class="favori-cards__gallery-link" href="">
            <div class="favorite-cards__gallery-card" data-id="${t}">
                <div class="favorite-cards__first-line-wrapper">
                    <p class="favorite-cards__parag-workout">favorite</p>
                    <svg class="favorite-cards__icon-trash">
                        <use href="${Ss}images/icons-sprite.svg#icon-trash"></use>
                    </svg>
                    <p class="favorite-cards__parag-start">Start</p>
                    <svg class="favorite-cards__icon-arrow-up">
                        <use href="${Ss}images/icons-sprite.svg#icon-arrow-up"></use>
                    </svg>
                </div>
                <div class="favorite-cards__second-line-wrapper">
                    <svg class="favorite-cards__icon-running-stick">
                        <use href="${Ss}images/icons-sprite.svg#icon-running-stick"></use>
                    </svg>
                    <h3 class="favorite-cards__head3-name">${i}</h3>
                </div>
                <div class="favorite-cards__third-line-wrapper">
                    <p class="favorite-cards__parag-burned-calories">
                    Burned calories: <span class="favorite-cards__span-text">${a} / ${l} min<span></p>
                    <p class="favorite-cards__parag-body-part">
                    Body part: <span class="favorite-cards__span-text">${r} min<span></p>
                    <p class="favorite-cards__parag-target">
                    Target: <span class="favorite-cards__span-text">${s} min<span></p>
                </div>
            </div>
        </a>
        `).join("");dl.insertAdjacentHTML("beforeend",e)}function by(){dl.innerHTML=""}function LI(){return Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)}function Lo(n){let e="";for(let t=0;t<n;t+=1)e+=`
    <li class="exercises__skeleton-loader">
      <div class="card">
        <div class="cover-image-skeleton"></div>
      </div>
    </li>
    `;return e}const Mo=(n,e)=>{n.innerHTML=e},Rn=document.querySelector(".js-cards");function vk(n,e){if(e>=768)return n!=3?(Rn.classList.contains("workout-cards__wrapper")||Mo(Rn,Lo(10)),10):(Rn.classList.contains("workout-cards__wrapper")||Mo(Rn,Lo(12)),12);if(e<768){if(n==1)return Rn.classList.contains("workout-cards__wrapper")||Mo(Rn,Lo(10)),10;if(n==2)return Rn.classList.contains("workout-cards__wrapper")||Mo(Rn,Lo(8)),8}return Rn.classList.contains("workout-cards__wrapper")||Mo(Rn,Lo(9)),9}function MI(n){const e={filter:"Body%20parts",bodypart:"",keyword:"",muscles:"",equipment:""};for(const t in n)if(n.hasOwnProperty(t)&&n[t]!==e[t])return!0;return!1}function Ik(n,e,t,r,i){return MI(r)?(t.bodyPart=r.bodypart,t.searchQuery=r.keyword,t.muscles=r.muscles,t.equipment=r.equipment,i=Lc(n,e,t).fetchFilteredExercises()):i=Lc(n,e,t).fetchExercise(),i}function wk(n,e,t,r,i){return MI(r)&&(t.filter=r.filter),i=Lc(n,e,t).fetchMuscles(),i}function Lc(n,e,t){const r=LI(),i=vk(e,r);return t.pageCounter=n,t.limit=i,t}function Py(n){return n.then(e=>e).catch(e=>{throw console.error("Error in getData:",e),e})}function Ek(n,e){const t=document.querySelector(".filters__list .active");if(t){const r=t.id.includes("-")?(t.id.charAt(0).toUpperCase()+t.id.slice(1)).replace("-","%20"):t.id.charAt(0).toUpperCase()+t.id.slice(1);if(r!=n.filter||n.filter===""){n.filter=r;for(const i in n)i!=="filter"&&(n[i]="");e.currentPage=1,e.endPoint=3}}else e.endPoint!=1&&console.error("No child elements found in filters.")}const fl=document.querySelector(".exercise-cards__wrapper"),pl=document.querySelector(".exercise-cards__parag-empty"),Tk="It appears that you haven't added any exercises to your favorites yet. To get started, you can add exercises that you like to your favorites for easier access in the future.",Ak="Sorry, but we don`t have anything for you with such filter. Please try another search";function Rk(){fl.classList.add("workout-cards__wrapper")}function Cy(){fl.classList.remove("workout-cards__wrapper")}function Sk(){fl.classList.add("favorite-cards__wrapper")}function Dy(){fl.classList.remove("favorite-cards__wrapper")}function bk(){pl.classList.add("visually-hidden")}function Pk(){pl.classList.remove("visually-hidden")}function Ck(){pl.innerHTML=Tk}function Dk(){pl.innerHTML=Ak}const tf=document.querySelector(".js-pages");function ky(n,e){const t=[];if(e>1){for(let i=n-3;i<=n+3;i++)if(i>0&&i<=e){const s=i===n?"exercise-cards__wrapper-page exercise-cards__current-page":"exercise-cards__wrapper-page js-pages";t.push(`
                    <div class="${s}">
                        <a class="exercise-cards__page js-page" data-page="${i}" href="">
                            ${i}
                        </a>
                    </div>
                `)}tf.innerHTML="";for(const i of t)tf.insertAdjacentHTML("beforeend",i)}}function xy(){tf.innerHTML=""}function kk(n){n.preventDefault();const{target:e}=n;return e.classList.contains("js-cards")?void 0:e.closest(".js-card").dataset.cardName}function xk(n){n.preventDefault();const{target:e}=n;return e.classList.contains("js-page")?e.closest(".js-page").dataset.page:void 0}function Nk(n){n.preventDefault();const{target:e}=n;if(e.classList.contains("js-cards"))return;const t=e.closest(".js-workout-card");return console.log(t),t.dataset.id}const FI=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Vk=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],a=n[t++],l=n[t++],h=((i&7)<<18|(s&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},UI={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],a=i+1<n.length,l=a?n[i+1]:0,h=i+2<n.length,f=h?n[i+2]:0,p=s>>2,m=(s&3)<<4|l>>4;let I=(l&15)<<2|f>>6,A=f&63;h||(A=64,a||(I=64)),r.push(t[p],t[m],t[I],t[A])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(FI(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Vk(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const f=i<n.length?t[n.charAt(i)]:64;++i;const m=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||l==null||f==null||m==null)throw new Ok;const I=s<<2|l>>4;if(r.push(I),f!==64){const A=l<<4&240|f>>2;if(r.push(A),m!==64){const L=f<<6&192|m;r.push(L)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Ok extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Lk=function(n){const e=FI(n);return UI.encodeByteArray(e,!0)},Mc=function(n){return Lk(n).replace(/\./g,"")},BI=function(n){try{return UI.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Fc(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Mk(t)||(n[t]=Fc(n[t],e[t]));return n}function Mk(n){return n!=="__proto__"}function Fk(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Uk=()=>Fk().__FIREBASE_DEFAULTS__,Bk=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},qk=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&BI(n[1]);return e&&JSON.parse(e)},Yf=()=>{try{return Uk()||Bk()||qk()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},qI=()=>{var n;return(n=Yf())===null||n===void 0?void 0:n.config},$k=n=>{var e;return(e=Yf())===null||e===void 0?void 0:e[`_${n}`]};class Wk{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Gk(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n),l="";return[Mc(JSON.stringify(t)),Mc(JSON.stringify(a)),l].join(".")}function Fe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function zk(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Fe())}function Jf(){var n;const e=(n=Yf())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Kk(){return typeof self=="object"&&self.self===self}function $I(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Xf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function WI(){const n=Fe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Hk(){return!Jf()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function pa(){try{return typeof indexedDB=="object"}catch{return!1}}function jk(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}const Qk="FirebaseError";class Dt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Qk,Object.setPrototypeOf(this,Dt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$i.prototype.create)}}class $i{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?Yk(s,r):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new Dt(i,l,r)}}function Yk(n,e){return n.replace(Jk,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const Jk=/\{\$([^}]+)}/g;function Ny(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Xk(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function nf(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],a=e[i];if(Vy(s)&&Vy(a)){if(!nf(s,a))return!1}else if(s!==a)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function Vy(n){return n!==null&&typeof n=="object"}function Ys(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function As(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function Jo(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function GI(n,e){const t=new Zk(n,e);return t.subscribe.bind(t)}class Zk{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");ex(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=kd),i.error===void 0&&(i.error=kd),i.complete===void 0&&(i.complete=kd);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ex(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function kd(){}function H(n){return n&&n._delegate?n._delegate:n}class qn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const pi="[DEFAULT]";class tx{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Wk;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(rx(e))try{this.getOrInitializeService({instanceIdentifier:pi})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=pi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=pi){return this.instances.has(e)}getOptions(e=pi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);r===l&&a.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:nx(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=pi){return this.component?this.component.multipleInstances?e:pi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function nx(n){return n===pi?void 0:n}function rx(n){return n.instantiationMode==="EAGER"}class ix{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new tx(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Zf=[];var ce;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ce||(ce={}));const zI={debug:ce.DEBUG,verbose:ce.VERBOSE,info:ce.INFO,warn:ce.WARN,error:ce.ERROR,silent:ce.SILENT},sx=ce.INFO,ox={[ce.DEBUG]:"log",[ce.VERBOSE]:"log",[ce.INFO]:"info",[ce.WARN]:"warn",[ce.ERROR]:"error"},ax=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=ox[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class gl{constructor(e){this.name=e,this._logLevel=sx,this._logHandler=ax,this._userLogHandler=null,Zf.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ce))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?zI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ce.DEBUG,...e),this._logHandler(this,ce.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ce.VERBOSE,...e),this._logHandler(this,ce.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ce.INFO,...e),this._logHandler(this,ce.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ce.WARN,...e),this._logHandler(this,ce.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ce.ERROR,...e),this._logHandler(this,ce.ERROR,...e)}}function ux(n){Zf.forEach(e=>{e.setLogLevel(n)})}function cx(n,e){for(const t of Zf){let r=null;e&&e.level&&(r=zI[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(i,s,...a)=>{const l=a.map(h=>{if(h==null)return null;if(typeof h=="string")return h;if(typeof h=="number"||typeof h=="boolean")return h.toString();if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch{return null}}).filter(h=>h).join(" ");s>=(r??i.logLevel)&&n({level:ce[s].toLowerCase(),message:l,args:a,type:i.name})}}}const lx=(n,e)=>e.some(t=>n instanceof t);let Oy,Ly;function hx(){return Oy||(Oy=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function dx(){return Ly||(Ly=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const KI=new WeakMap,rf=new WeakMap,HI=new WeakMap,xd=new WeakMap,ep=new WeakMap;function fx(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(Or(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&KI.set(t,n)}).catch(()=>{}),ep.set(e,n),e}function px(n){if(rf.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});rf.set(n,e)}let sf={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return rf.get(n);if(e==="objectStoreNames")return n.objectStoreNames||HI.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Or(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function gx(n){sf=n(sf)}function mx(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Nd(this),e,...t);return HI.set(r,e.sort?e.sort():[e]),Or(r)}:dx().includes(n)?function(...e){return n.apply(Nd(this),e),Or(KI.get(this))}:function(...e){return Or(n.apply(Nd(this),e))}}function _x(n){return typeof n=="function"?mx(n):(n instanceof IDBTransaction&&px(n),lx(n,hx())?new Proxy(n,sf):n)}function Or(n){if(n instanceof IDBRequest)return fx(n);if(xd.has(n))return xd.get(n);const e=_x(n);return e!==n&&(xd.set(n,e),ep.set(e,n)),e}const Nd=n=>ep.get(n);function yx(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(n,e),l=Or(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Or(a.result),h.oldVersion,h.newVersion,Or(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),l.then(h=>{s&&h.addEventListener("close",()=>s()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}const vx=["get","getKey","getAll","getAllKeys","count"],Ix=["put","add","delete","clear"],Vd=new Map;function My(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Vd.get(e))return Vd.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=Ix.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||vx.includes(t)))return;const s=async function(a,...l){const h=this.transaction(a,i?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(l.shift())),(await Promise.all([f[t](...l),i&&h.done]))[0]};return Vd.set(e,s),s}gx(n=>({...n,get:(e,t,r)=>My(e,t)||n.get(e,t,r),has:(e,t)=>!!My(e,t)||n.has(e,t)}));class wx{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Ex(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Ex(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const of="@firebase/app",Fy="0.9.25";const Di=new gl("@firebase/app"),Tx="@firebase/app-compat",Ax="@firebase/analytics-compat",Rx="@firebase/analytics",Sx="@firebase/app-check-compat",bx="@firebase/app-check",Px="@firebase/auth",Cx="@firebase/auth-compat",Dx="@firebase/database",kx="@firebase/database-compat",xx="@firebase/functions",Nx="@firebase/functions-compat",Vx="@firebase/installations",Ox="@firebase/installations-compat",Lx="@firebase/messaging",Mx="@firebase/messaging-compat",Fx="@firebase/performance",Ux="@firebase/performance-compat",Bx="@firebase/remote-config",qx="@firebase/remote-config-compat",$x="@firebase/storage",Wx="@firebase/storage-compat",Gx="@firebase/firestore",zx="@firebase/firestore-compat",Kx="firebase",Hx="10.7.1";const Lr="[DEFAULT]",jx={[of]:"fire-core",[Tx]:"fire-core-compat",[Rx]:"fire-analytics",[Ax]:"fire-analytics-compat",[bx]:"fire-app-check",[Sx]:"fire-app-check-compat",[Px]:"fire-auth",[Cx]:"fire-auth-compat",[Dx]:"fire-rtdb",[kx]:"fire-rtdb-compat",[xx]:"fire-fn",[Nx]:"fire-fn-compat",[Vx]:"fire-iid",[Ox]:"fire-iid-compat",[Lx]:"fire-fcm",[Mx]:"fire-fcm-compat",[Fx]:"fire-perf",[Ux]:"fire-perf-compat",[Bx]:"fire-rc",[qx]:"fire-rc-compat",[$x]:"fire-gcs",[Wx]:"fire-gcs-compat",[Gx]:"fire-fst",[zx]:"fire-fst-compat","fire-js":"fire-js",[Kx]:"fire-js-all"};const Mr=new Map,ga=new Map;function Uc(n,e){try{n.container.addComponent(e)}catch(t){Di.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function jI(n,e){n.container.addOrOverwriteComponent(e)}function Fr(n){const e=n.name;if(ga.has(e))return Di.debug(`There were multiple attempts to register component ${e}.`),!1;ga.set(e,n);for(const t of Mr.values())Uc(t,n);return!0}function QI(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Qx(n,e,t=Lr){QI(n,e).clearInstance(t)}function Yx(){ga.clear()}const Jx={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},sr=new $i("app","Firebase",Jx);let Xx=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new qn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw sr.create("app-deleted",{appName:this._name})}};const Qr=Hx;function tp(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Lr,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw sr.create("bad-app-name",{appName:String(i)});if(t||(t=qI()),!t)throw sr.create("no-options");const s=Mr.get(i);if(s){if(nf(t,s.options)&&nf(r,s.config))return s;throw sr.create("duplicate-app",{appName:i})}const a=new ix(i);for(const h of ga.values())a.addComponent(h);const l=new Xx(t,r,a);return Mr.set(i,l),l}function Zx(n=Lr){const e=Mr.get(n);if(!e&&n===Lr&&qI())return tp();if(!e)throw sr.create("no-app",{appName:n});return e}function eN(){return Array.from(Mr.values())}async function YI(n){const e=n.name;Mr.has(e)&&(Mr.delete(e),await Promise.all(n.container.getProviders().map(t=>t.delete())),n.isDeleted=!0)}function Mn(n,e,t){var r;let i=(r=jx[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const l=[`Unable to register library "${i}" with version "${e}":`];s&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Di.warn(l.join(" "));return}Fr(new qn(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function JI(n,e){if(n!==null&&typeof n!="function")throw sr.create("invalid-log-argument");cx(n,e)}function XI(n){ux(n)}const tN="firebase-heartbeat-database",nN=1,ma="firebase-heartbeat-store";let Od=null;function ZI(){return Od||(Od=yx(tN,nN,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ma)}}}).catch(n=>{throw sr.create("idb-open",{originalErrorMessage:n.message})})),Od}async function rN(n){try{return await(await ZI()).transaction(ma).objectStore(ma).get(ew(n))}catch(e){if(e instanceof Dt)Di.warn(e.message);else{const t=sr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Di.warn(t.message)}}}async function Uy(n,e){try{const r=(await ZI()).transaction(ma,"readwrite");await r.objectStore(ma).put(e,ew(n)),await r.done}catch(t){if(t instanceof Dt)Di.warn(t.message);else{const r=sr.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Di.warn(r.message)}}}function ew(n){return`${n.name}!${n.options.appId}`}const iN=1024,sN=30*24*60*60*1e3;class oN{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new uN(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=By();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const l=new Date(a.date).valueOf();return Date.now()-l<=sN}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=By(),{heartbeatsToSend:r,unsentEntries:i}=aN(this._heartbeatsCache.heartbeats),s=Mc(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function By(){return new Date().toISOString().substring(0,10)}function aN(n,e=iN){const t=[];let r=n.slice();for(const i of n){const s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),qy(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),qy(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class uN{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return pa()?jk().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await rN(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Uy(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Uy(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function qy(n){return Mc(JSON.stringify({version:2,heartbeats:n})).length}function cN(n){Fr(new qn("platform-logger",e=>new wx(e),"PRIVATE")),Fr(new qn("heartbeat",e=>new oN(e),"PRIVATE")),Mn(of,Fy,n),Mn(of,Fy,"esm2017"),Mn("fire-js","")}cN("");const lN=Object.freeze(Object.defineProperty({__proto__:null,SDK_VERSION:Qr,_DEFAULT_ENTRY_NAME:Lr,_addComponent:Uc,_addOrOverwriteComponent:jI,_apps:Mr,_clearComponents:Yx,_components:ga,_getProvider:QI,_registerComponent:Fr,_removeServiceInstance:Qx,deleteApp:YI,getApp:Zx,getApps:eN,initializeApp:tp,onLog:JI,registerVersion:Mn,setLogLevel:XI,FirebaseError:Dt},Symbol.toStringTag,{value:"Module"}));class hN{constructor(e,t){this._delegate=e,this.firebase=t,Uc(e,new qn("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),YI(this._delegate)))}_getService(e,t=Lr){var r;this._delegate.checkDestroyed();const i=this._delegate.container.getProvider(e);return!i.isInitialized()&&((r=i.getComponent())===null||r===void 0?void 0:r.instantiationMode)==="EXPLICIT"&&i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=Lr){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Uc(this._delegate,e)}_addOrOverwriteComponent(e){jI(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const dN={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance."},$y=new $i("app-compat","Firebase",dN);function fN(n){const e={},t={__esModule:!0,initializeApp:s,app:i,registerVersion:Mn,setLogLevel:XI,onLog:JI,apps:null,SDK_VERSION:Qr,INTERNAL:{registerComponent:l,removeApp:r,useAsService:h,modularAPIs:lN}};t.default=t,Object.defineProperty(t,"apps",{get:a});function r(f){delete e[f]}function i(f){if(f=f||Lr,!Ny(e,f))throw $y.create("no-app",{appName:f});return e[f]}i.App=n;function s(f,p={}){const m=tp(f,p);if(Ny(e,m.name))return e[m.name];const I=new n(m,t);return e[m.name]=I,I}function a(){return Object.keys(e).map(f=>e[f])}function l(f){const p=f.name,m=p.replace("-compat","");if(Fr(f)&&f.type==="PUBLIC"){const I=(A=i())=>{if(typeof A[m]!="function")throw $y.create("invalid-app-argument",{appName:p});return A[m]()};f.serviceProps!==void 0&&Fc(I,f.serviceProps),t[m]=I,n.prototype[m]=function(...A){return this._getService.bind(this,p).apply(this,f.multipleInstances?A:[])}}return f.type==="PUBLIC"?t[m]:null}function h(f,p){return p==="serverAuth"?null:p}return t}function tw(){const n=fN(hN);n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:tw,extendNamespace:e,createSubscribe:GI,ErrorFactory:$i,deepExtend:Fc});function e(t){Fc(n,t)}return n}const pN=tw();const Wy=new gl("@firebase/app-compat"),gN="@firebase/app-compat",mN="0.2.25";function _N(n){Mn(gN,mN,n)}if(Kk()&&self.firebase!==void 0){Wy.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const n=self.firebase.SDK_VERSION;n&&n.indexOf("LITE")>=0&&Wy.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Ur=pN;_N();var yN="firebase",vN="10.7.1";Ur.registerVersion(yN,vN,"app-compat");function np(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}const Fo={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},fs={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function IN(){return{["admin-restricted-operation"]:"This operation is restricted to administrators only.",["argument-error"]:"",["app-not-authorized"]:"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.",["app-not-installed"]:"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.",["captcha-check-failed"]:"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.",["code-expired"]:"The SMS code has expired. Please re-send the verification code to try again.",["cordova-not-ready"]:"Cordova framework is not ready.",["cors-unsupported"]:"This browser is not supported.",["credential-already-in-use"]:"This credential is already associated with a different user account.",["custom-token-mismatch"]:"The custom token corresponds to a different audience.",["requires-recent-login"]:"This operation is sensitive and requires recent authentication. Log in again before retrying this request.",["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.",["dynamic-link-not-activated"]:"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.",["email-change-needs-verification"]:"Multi-factor users must always have a verified email.",["email-already-in-use"]:"The email address is already in use by another account.",["emulator-config-failed"]:'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',["expired-action-code"]:"The action code has expired.",["cancelled-popup-request"]:"This operation has been cancelled due to another conflicting popup being opened.",["internal-error"]:"An internal AuthError has occurred.",["invalid-app-credential"]:"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.",["invalid-app-id"]:"The mobile app identifier is not registed for the current project.",["invalid-user-token"]:"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.",["invalid-auth-event"]:"An internal AuthError has occurred.",["invalid-verification-code"]:"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.",["invalid-continue-uri"]:"The continue URL provided in the request is invalid.",["invalid-cordova-configuration"]:"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.",["invalid-custom-token"]:"The custom token format is incorrect. Please check the documentation.",["invalid-dynamic-link-domain"]:"The provided dynamic link domain is not configured or authorized for the current project.",["invalid-email"]:"The email address is badly formatted.",["invalid-emulator-scheme"]:"Emulator URL must start with a valid scheme (http:// or https://).",["invalid-api-key"]:"Your API key is invalid, please check you have copied it correctly.",["invalid-cert-hash"]:"The SHA-1 certificate hash provided is invalid.",["invalid-credential"]:"The supplied auth credential is incorrect, malformed or has expired.",["invalid-message-payload"]:"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-multi-factor-session"]:"The request does not contain a valid proof of first factor successful sign-in.",["invalid-oauth-provider"]:"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.",["invalid-oauth-client-id"]:"The OAuth client ID provided is either invalid or does not match the specified API key.",["unauthorized-domain"]:"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.",["invalid-action-code"]:"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.",["wrong-password"]:"The password is invalid or the user does not have a password.",["invalid-persistence-type"]:"The specified persistence type is invalid. It can only be local, session or none.",["invalid-phone-number"]:"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].",["invalid-provider-id"]:"The specified provider ID is invalid.",["invalid-recipient-email"]:"The email corresponding to this action failed to send as the provided recipient email address is invalid.",["invalid-sender"]:"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-verification-id"]:"The verification ID used to create the phone auth credential is invalid.",["invalid-tenant-id"]:"The Auth instance's tenant ID is invalid.",["login-blocked"]:"Login blocked by user-provided method: {$originalMessage}",["missing-android-pkg-name"]:"An Android Package Name must be provided if the Android App is required to be installed.",["auth-domain-config-required"]:"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.",["missing-app-credential"]:"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.",["missing-verification-code"]:"The phone auth credential was created with an empty SMS verification code.",["missing-continue-uri"]:"A continue URL must be provided in the request.",["missing-iframe-start"]:"An internal AuthError has occurred.",["missing-ios-bundle-id"]:"An iOS Bundle ID must be provided if an App Store ID is provided.",["missing-or-invalid-nonce"]:"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.",["missing-password"]:"A non-empty password must be provided",["missing-multi-factor-info"]:"No second factor identifier is provided.",["missing-multi-factor-session"]:"The request is missing proof of first factor successful sign-in.",["missing-phone-number"]:"To send verification codes, provide a phone number for the recipient.",["missing-verification-id"]:"The phone auth credential was created with an empty verification ID.",["app-deleted"]:"This instance of FirebaseApp has been deleted.",["multi-factor-info-not-found"]:"The user does not have a second factor matching the identifier provided.",["multi-factor-auth-required"]:"Proof of ownership of a second factor is required to complete sign-in.",["account-exists-with-different-credential"]:"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.",["network-request-failed"]:"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.",["no-auth-event"]:"An internal AuthError has occurred.",["no-such-provider"]:"User was not linked to an account with the given provider.",["null-user"]:"A null user object was provided as the argument for an operation which requires a non-null user object.",["operation-not-allowed"]:"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.",["operation-not-supported-in-this-environment"]:'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',["popup-blocked"]:"Unable to establish a connection with the popup. It may have been blocked by the browser.",["popup-closed-by-user"]:"The popup has been closed by the user before finalizing the operation.",["provider-already-linked"]:"User can only be linked to one identity for the given provider.",["quota-exceeded"]:"The project's quota for this operation has been exceeded.",["redirect-cancelled-by-user"]:"The redirect operation has been cancelled by the user before finalizing.",["redirect-operation-pending"]:"A redirect sign-in operation is already pending.",["rejected-credential"]:"The request contains malformed or mismatching credentials.",["second-factor-already-in-use"]:"The second factor is already enrolled on this account.",["maximum-second-factor-count-exceeded"]:"The maximum allowed number of second factors on a user has been exceeded.",["tenant-id-mismatch"]:"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.",["user-token-expired"]:"The user's credential is no longer valid. The user must sign in again.",["too-many-requests"]:"We have blocked all requests from this device due to unusual activity. Try again later.",["unauthorized-continue-uri"]:"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.",["unsupported-first-factor"]:"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.",["unsupported-persistence-type"]:"The current environment does not support the specified persistence type.",["unsupported-tenant-operation"]:"This operation is not supported in a multi-tenant context.",["unverified-email"]:"The operation requires a verified email.",["user-cancelled"]:"The user did not grant your application the permissions it requested.",["user-not-found"]:"There is no user record corresponding to this identifier. The user may have been deleted.",["user-disabled"]:"The user account has been disabled by an administrator.",["user-mismatch"]:"The supplied credentials do not correspond to the previously signed in user.",["user-signed-out"]:"",["weak-password"]:"The password must be 6 characters long or more.",["web-storage-unsupported"]:"This browser is not supported or 3rd party cookies and data may be disabled.",["already-initialized"]:"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.",["missing-recaptcha-token"]:"The reCAPTCHA token is missing when sending request to the backend.",["invalid-recaptcha-token"]:"The reCAPTCHA token is invalid when sending request to the backend.",["invalid-recaptcha-action"]:"The reCAPTCHA action is invalid when sending request to the backend.",["recaptcha-not-enabled"]:"reCAPTCHA Enterprise integration is not enabled for this project.",["missing-client-type"]:"The reCAPTCHA client type is missing when sending request to the backend.",["missing-recaptcha-version"]:"The reCAPTCHA version is missing when sending request to the backend.",["invalid-req-type"]:"Invalid request parameters.",["invalid-recaptcha-version"]:"The reCAPTCHA version is invalid when sending request to the backend.",["unsupported-password-policy-schema-version"]:"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.",["password-does-not-meet-requirements"]:"The password does not meet the requirements."}}function nw(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const wN=IN,EN=nw,rw=new $i("auth","Firebase",nw());const Bc=new gl("@firebase/auth");function TN(n,...e){Bc.logLevel<=ce.WARN&&Bc.warn(`Auth (${Qr}): ${n}`,...e)}function Rc(n,...e){Bc.logLevel<=ce.ERROR&&Bc.error(`Auth (${Qr}): ${n}`,...e)}function _t(n,...e){throw rp(n,...e)}function gt(n,...e){return rp(n,...e)}function iw(n,e,t){const r=Object.assign(Object.assign({},EN()),{[e]:t});return new $i("auth","Firebase",r).create(e,{appName:n.name})}function Js(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&_t(n,"argument-error"),iw(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function rp(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return rw.create(n,...e)}function O(n,e,...t){if(!n)throw rp(e,...t)}function xn(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Rc(e),new Error(e)}function yn(n,e){n||xn(e)}function _a(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function ip(){return Gy()==="http:"||Gy()==="https:"}function Gy(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function AN(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(ip()||$I()||"connection"in navigator)?navigator.onLine:!0}function RN(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class ja{constructor(e,t){this.shortDelay=e,this.longDelay=t,yn(t>e,"Short delay should be less than long delay!"),this.isMobile=zk()||Xf()}get(){return AN()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function sp(n,e){yn(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class sw{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;xn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;xn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;xn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const SN={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const bN=new ja(3e4,6e4);function Ge(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function ze(n,e,t,r,i={}){return ow(n,i,async()=>{let s={},a={};r&&(e==="GET"?a=r:s={body:JSON.stringify(r)});const l=Ys(Object.assign({key:n.config.apiKey},a)).slice(1),h=await n._getAdditionalHeaders();return h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode),sw.fetch()(aw(n,n.config.apiHost,t,l),Object.assign({method:e,headers:h,referrerPolicy:"no-referrer"},s))})}async function ow(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},SN),e);try{const i=new CN(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw Xo(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const l=s.ok?a.errorMessage:a.error.message,[h,f]=l.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw Xo(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw Xo(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw Xo(n,"user-disabled",a);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw iw(n,p,f);_t(n,p)}}catch(i){if(i instanceof Dt)throw i;_t(n,"network-request-failed",{message:String(i)})}}async function hr(n,e,t,r,i={}){const s=await ze(n,e,t,r,i);return"mfaPendingCredential"in s&&_t(n,"multi-factor-auth-required",{_serverResponse:s}),s}function aw(n,e,t,r){const i=`${e}${t}?${r}`;return n.config.emulator?sp(n.config,i):`${n.config.apiScheme}://${i}`}function PN(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class CN{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(gt(this.auth,"network-request-failed")),bN.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Xo(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=gt(n,e,r);return i.customData._tokenResponse=t,i}function zy(n){return n!==void 0&&n.getResponse!==void 0}function Ky(n){return n!==void 0&&n.enterprise!==void 0}class DN{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return PN(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function kN(n){return(await ze(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function xN(n,e){return ze(n,"GET","/v2/recaptchaConfig",Ge(n,e))}async function NN(n,e){return ze(n,"POST","/v1/accounts:delete",e)}async function VN(n,e){return ze(n,"POST","/v1/accounts:update",e)}async function ON(n,e){return ze(n,"POST","/v1/accounts:lookup",e)}function ia(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function LN(n,e=!1){const t=H(n),r=await t.getIdToken(e),i=ml(r);O(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,a=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:ia(Ld(i.auth_time)),issuedAtTime:ia(Ld(i.iat)),expirationTime:ia(Ld(i.exp)),signInProvider:a||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function Ld(n){return Number(n)*1e3}function ml(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Rc("JWT malformed, contained fewer than 3 sections"),null;try{const i=BI(t);return i?JSON.parse(i):(Rc("Failed to decode base64 JWT payload"),null)}catch(i){return Rc("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function MN(n){const e=ml(n);return O(e,"internal-error"),O(typeof e.exp<"u","internal-error"),O(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function ur(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Dt&&FN(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function FN({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class UN{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class uw{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=ia(this.lastLoginAt),this.creationTime=ia(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function ya(n){var e;const t=n.auth,r=await n.getIdToken(),i=await ur(n,ON(t,{idToken:r}));O(i==null?void 0:i.users.length,t,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const a=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?$N(s.providerUserInfo):[],l=qN(n.providerData,a),h=n.isAnonymous,f=!(n.email&&s.passwordHash)&&!(l!=null&&l.length),p=h?f:!1,m={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:l,metadata:new uw(s.createdAt,s.lastLoginAt),isAnonymous:p};Object.assign(n,m)}async function BN(n){const e=H(n);await ya(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function qN(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function $N(n){return n.map(e=>{var{providerId:t}=e,r=np(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function WN(n,e){const t=await ow(n,{},async()=>{const r=Ys({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,a=aw(n,i,"/v1/token",`key=${s}`),l=await n._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",sw.fetch()(a,{method:"POST",headers:l,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function GN(n,e){return ze(n,"POST","/v2/accounts:revokeToken",Ge(n,e))}class va{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){O(e.idToken,"internal-error"),O(typeof e.idToken<"u","internal-error"),O(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):MN(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return O(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:s}=await WN(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,a=new va;return r&&(O(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(O(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(O(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new va,this.toJSON())}_performRefresh(){return xn("not implemented")}}function Sr(n,e){O(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Si{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=np(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new UN(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new uw(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await ur(this,this.stsTokenManager.getToken(this.auth,e));return O(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return LN(this,e)}reload(){return BN(this)}_assign(e){this!==e&&(O(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Si(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){O(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await ya(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await ur(this,NN(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,a,l,h,f,p;const m=(r=t.displayName)!==null&&r!==void 0?r:void 0,I=(i=t.email)!==null&&i!==void 0?i:void 0,A=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,L=(a=t.photoURL)!==null&&a!==void 0?a:void 0,M=(l=t.tenantId)!==null&&l!==void 0?l:void 0,V=(h=t._redirectEventId)!==null&&h!==void 0?h:void 0,Y=(f=t.createdAt)!==null&&f!==void 0?f:void 0,ae=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:j,emailVerified:ye,isAnonymous:de,providerData:me,stsTokenManager:we}=t;O(j&&we,e,"internal-error");const Nt=va.fromJSON(this.name,we);O(typeof j=="string",e,"internal-error"),Sr(m,e.name),Sr(I,e.name),O(typeof ye=="boolean",e,"internal-error"),O(typeof de=="boolean",e,"internal-error"),Sr(A,e.name),Sr(L,e.name),Sr(M,e.name),Sr(V,e.name),Sr(Y,e.name),Sr(ae,e.name);const zn=new Si({uid:j,auth:e,email:I,emailVerified:ye,displayName:m,isAnonymous:de,photoURL:L,phoneNumber:A,tenantId:M,stsTokenManager:Nt,createdAt:Y,lastLoginAt:ae});return me&&Array.isArray(me)&&(zn.providerData=me.map(Yi=>Object.assign({},Yi))),V&&(zn._redirectEventId=V),zn}static async _fromIdTokenResponse(e,t,r=!1){const i=new va;i.updateFromServerResponse(t);const s=new Si({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await ya(s),s}}const Hy=new Map;function Yt(n){yn(n instanceof Function,"Expected a class definition");let e=Hy.get(n);return e?(yn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Hy.set(n,e),e)}class cw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}cw.type="NONE";const Os=cw;function bi(n,e,t){return`firebase:${n}:${e}:${t}`}class bs{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=bi(this.userKey,i.apiKey,s),this.fullPersistenceKey=bi("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Si._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new bs(Yt(Os),e,r);const i=(await Promise.all(t.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let s=i[0]||Yt(Os);const a=bi(r,e.config.apiKey,e.name);let l=null;for(const f of t)try{const p=await f._get(a);if(p){const m=Si._fromJSON(e,p);f!==s&&(l=m),s=f;break}}catch{}const h=i.filter(f=>f._shouldAllowMigration);return!s._shouldAllowMigration||!h.length?new bs(s,e,r):(s=h[0],l&&await s._set(a,l.toJSON()),await Promise.all(t.map(async f=>{if(f!==s)try{await f._remove(a)}catch{}})),new bs(s,e,r))}}function jy(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(dw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(lw(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(fw(e))return"Blackberry";if(pw(e))return"Webos";if(op(e))return"Safari";if((e.includes("chrome/")||hw(e))&&!e.includes("edge/"))return"Chrome";if(Qa(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function lw(n=Fe()){return/firefox\//i.test(n)}function op(n=Fe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function hw(n=Fe()){return/crios\//i.test(n)}function dw(n=Fe()){return/iemobile/i.test(n)}function Qa(n=Fe()){return/android/i.test(n)}function fw(n=Fe()){return/blackberry/i.test(n)}function pw(n=Fe()){return/webos/i.test(n)}function Xs(n=Fe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function zN(n=Fe()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function KN(n=Fe()){var e;return Xs(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function HN(){return WI()&&document.documentMode===10}function gw(n=Fe()){return Xs(n)||Qa(n)||pw(n)||fw(n)||/windows phone/i.test(n)||dw(n)}function jN(){try{return!!(window&&window!==window.top)}catch{return!1}}function mw(n,e=[]){let t;switch(n){case"Browser":t=jy(Fe());break;case"Worker":t=`${jy(Fe())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Qr}/${r}`}class QN{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((a,l)=>{try{const h=e(s);a(h)}catch(h){l(h)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}async function YN(n,e={}){return ze(n,"GET","/v2/passwordPolicy",Ge(n,e))}const JN=6;class XN{constructor(e){var t,r,i,s;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:JN,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,a,l;const h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=(t=h.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),h.isValid&&(h.isValid=(r=h.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),h.isValid&&(h.isValid=(i=h.containsLowercaseLetter)!==null&&i!==void 0?i:!0),h.isValid&&(h.isValid=(s=h.containsUppercaseLetter)!==null&&s!==void 0?s:!0),h.isValid&&(h.isValid=(a=h.containsNumericCharacter)!==null&&a!==void 0?a:!0),h.isValid&&(h.isValid=(l=h.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),h}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class ZN{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Qy(this),this.idTokenSubscription=new Qy(this),this.beforeStateQueue=new QN(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=rw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Yt(t)),this._initializationPromise=this.queue(async()=>{var r,i;if(!this._deleted&&(this.persistenceManager=await bs.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;const r=await this.assertedPersistence.getCurrentUser();let i=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,l=i==null?void 0:i._redirectEventId,h=await this.tryRedirectSignIn(e);(!a||a===l)&&(h!=null&&h.user)&&(i=h.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return O(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await ya(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=RN()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?H(e):null;return t&&O(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&O(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(Yt(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await YN(this),t=new XN(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new $i("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await GN(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Yt(e)||this._popupRedirectResolver;O(t,this,"argument-error"),this.redirectPersistenceManager=await bs.create(this,[Yt(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(O(l,this,"internal-error"),l.then(()=>{a||s(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return O(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=mw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&TN(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function qe(n){return H(n)}class Qy{constructor(e){this.auth=e,this.observer=null,this.addObserver=GI(t=>this.observer=t)}get next(){return O(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function eV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function ap(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=gt("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",eV().appendChild(r)})}function _w(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const tV="https://www.google.com/recaptcha/enterprise.js?render=",nV="recaptcha-enterprise",rV="NO_RECAPTCHA";class iV{constructor(e){this.type=nV,this.auth=qe(e)}async verify(e="verify",t=!1){async function r(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(a,l)=>{xN(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const f=new DN(h);return s.tenantId==null?s._agentRecaptchaConfig=f:s._tenantRecaptchaConfigs[s.tenantId]=f,a(f.siteKey)}}).catch(h=>{l(h)})})}function i(s,a,l){const h=window.grecaptcha;Ky(h)?h.enterprise.ready(()=>{h.enterprise.execute(s,{action:e}).then(f=>{a(f)}).catch(()=>{a(rV)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,a)=>{r(this.auth).then(l=>{if(!t&&Ky(window.grecaptcha))i(l,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}ap(tV+l).then(()=>{i(l,s,a)}).catch(h=>{a(h)})}}).catch(l=>{a(l)})})}}async function Yy(n,e,t,r=!1){const i=new iV(n);let s;try{s=await i.verify(t)}catch{s=await i.verify(t,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Ia(n,e,t,r){var i;if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Yy(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await Yy(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(s)})}function sV(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(Yt);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function oV(n,e,t){const r=qe(n);O(r._canInitEmulator,r,"emulator-config-failed"),O(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!!(t!=null&&t.disableWarnings),s=yw(e),{host:a,port:l}=aV(e),h=l===null?"":`:${l}`;r.config.emulator={url:`${s}//${a}${h}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:l,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||uV()}function yw(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function aV(n){const e=yw(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:Jy(r.substr(s.length+1))}}else{const[s,a]=r.split(":");return{host:s,port:Jy(a)}}}function Jy(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function uV(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Zs{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return xn("not implemented")}_getIdTokenResponse(e){return xn("not implemented")}_linkToIdToken(e,t){return xn("not implemented")}_getReauthenticationResolver(e){return xn("not implemented")}}async function vw(n,e){return ze(n,"POST","/v1/accounts:resetPassword",Ge(n,e))}async function cV(n,e){return ze(n,"POST","/v1/accounts:update",e)}async function lV(n,e){return ze(n,"POST","/v1/accounts:signUp",e)}async function hV(n,e){return ze(n,"POST","/v1/accounts:update",Ge(n,e))}async function dV(n,e){return hr(n,"POST","/v1/accounts:signInWithPassword",Ge(n,e))}async function _l(n,e){return ze(n,"POST","/v1/accounts:sendOobCode",Ge(n,e))}async function fV(n,e){return _l(n,e)}async function pV(n,e){return _l(n,e)}async function gV(n,e){return _l(n,e)}async function mV(n,e){return _l(n,e)}async function _V(n,e){return hr(n,"POST","/v1/accounts:signInWithEmailLink",Ge(n,e))}async function yV(n,e){return hr(n,"POST","/v1/accounts:signInWithEmailLink",Ge(n,e))}class wa extends Zs{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new wa(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new wa(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ia(e,t,"signInWithPassword",dV);case"emailLink":return _V(e,{email:this._email,oobCode:this._password});default:_t(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ia(e,r,"signUpPassword",lV);case"emailLink":return yV(e,{idToken:t,email:this._email,oobCode:this._password});default:_t(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function or(n,e){return hr(n,"POST","/v1/accounts:signInWithIdp",Ge(n,e))}const vV="http://localhost";class $n extends Zs{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new $n(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):_t("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=np(t,["providerId","signInMethod"]);if(!r||!i)return null;const a=new $n(r,i);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return or(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,or(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,or(e,t)}buildRequest(){const e={requestUri:vV,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Ys(t)}return e}}async function IV(n,e){return ze(n,"POST","/v1/accounts:sendVerificationCode",Ge(n,e))}async function wV(n,e){return hr(n,"POST","/v1/accounts:signInWithPhoneNumber",Ge(n,e))}async function EV(n,e){const t=await hr(n,"POST","/v1/accounts:signInWithPhoneNumber",Ge(n,e));if(t.temporaryProof)throw Xo(n,"account-exists-with-different-credential",t);return t}const TV={USER_NOT_FOUND:"user-not-found"};async function AV(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return hr(n,"POST","/v1/accounts:signInWithPhoneNumber",Ge(n,t),TV)}class Pi extends Zs{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Pi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Pi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return wV(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return EV(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return AV(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s}=e;return!r&&!t&&!i&&!s?null:new Pi({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s})}}function RV(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function SV(n){const e=As(Jo(n)).link,t=e?As(Jo(e)).deep_link_id:null,r=As(Jo(n)).deep_link_id;return(r?As(Jo(r)).link:null)||r||t||e||n}class yl{constructor(e){var t,r,i,s,a,l;const h=As(Jo(e)),f=(t=h.apiKey)!==null&&t!==void 0?t:null,p=(r=h.oobCode)!==null&&r!==void 0?r:null,m=RV((i=h.mode)!==null&&i!==void 0?i:null);O(f&&p&&m,"argument-error"),this.apiKey=f,this.operation=m,this.code=p,this.continueUrl=(s=h.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(a=h.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(l=h.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const t=SV(e);try{return new yl(t)}catch{return null}}}class Yr{constructor(){this.providerId=Yr.PROVIDER_ID}static credential(e,t){return wa._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=yl.parseLink(t);return O(r,"argument-error"),wa._fromEmailAndCode(e,r.code,r.tenantId)}}Yr.PROVIDER_ID="password";Yr.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Yr.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class dr{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class eo extends dr{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ps extends eo{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return O("providerId"in t&&"signInMethod"in t,"argument-error"),$n._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return O(e.idToken||e.accessToken,"argument-error"),$n._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Ps.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Ps.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:i,pendingToken:s,nonce:a,providerId:l}=e;if(!r&&!i&&!t&&!s||!l)return null;try{return new Ps(l)._credential({idToken:t,accessToken:r,nonce:a,pendingToken:s})}catch{return null}}}class bn extends eo{constructor(){super("facebook.com")}static credential(e){return $n._fromParams({providerId:bn.PROVIDER_ID,signInMethod:bn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bn.credentialFromTaggedObject(e)}static credentialFromError(e){return bn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return bn.credential(e.oauthAccessToken)}catch{return null}}}bn.FACEBOOK_SIGN_IN_METHOD="facebook.com";bn.PROVIDER_ID="facebook.com";class Pn extends eo{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return $n._fromParams({providerId:Pn.PROVIDER_ID,signInMethod:Pn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Pn.credentialFromTaggedObject(e)}static credentialFromError(e){return Pn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Pn.credential(t,r)}catch{return null}}}Pn.GOOGLE_SIGN_IN_METHOD="google.com";Pn.PROVIDER_ID="google.com";class Cn extends eo{constructor(){super("github.com")}static credential(e){return $n._fromParams({providerId:Cn.PROVIDER_ID,signInMethod:Cn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Cn.credentialFromTaggedObject(e)}static credentialFromError(e){return Cn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Cn.credential(e.oauthAccessToken)}catch{return null}}}Cn.GITHUB_SIGN_IN_METHOD="github.com";Cn.PROVIDER_ID="github.com";const bV="http://localhost";class Ls extends Zs{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return or(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,or(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,or(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,pendingToken:s}=t;return!r||!i||!s||r!==i?null:new Ls(r,s)}static _create(e,t){return new Ls(e,t)}buildRequest(){return{requestUri:bV,returnSecureToken:!0,pendingToken:this.pendingToken}}}const PV="saml.";class qc extends dr{constructor(e){O(e.startsWith(PV),"argument-error"),super(e)}static credentialFromResult(e){return qc.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return qc.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Ls.fromJSON(e);return O(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Ls._create(r,t)}catch{return null}}}class Dn extends eo{constructor(){super("twitter.com")}static credential(e,t){return $n._fromParams({providerId:Dn.PROVIDER_ID,signInMethod:Dn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Dn.credentialFromTaggedObject(e)}static credentialFromError(e){return Dn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Dn.credential(t,r)}catch{return null}}}Dn.TWITTER_SIGN_IN_METHOD="twitter.com";Dn.PROVIDER_ID="twitter.com";async function Iw(n,e){return hr(n,"POST","/v1/accounts:signUp",Ge(n,e))}class ln{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const s=await Si._fromIdTokenResponse(e,r,i),a=Xy(r);return new ln({user:s,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=Xy(r);return new ln({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function Xy(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}async function CV(n){var e;const t=qe(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new ln({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await Iw(t,{returnSecureToken:!0}),i=await ln._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(i.user),i}class $c extends Dt{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,$c.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new $c(e,t,r,i)}}function ww(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?$c._fromErrorAndOperation(n,s,e,r):s})}function Ew(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}async function DV(n,e){const t=H(n);await vl(!0,t,e);const{providerUserInfo:r}=await VN(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),i=Ew(r||[]);return t.providerData=t.providerData.filter(s=>i.has(s.providerId)),i.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function up(n,e,t=!1){const r=await ur(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return ln._forOperation(n,"link",r)}async function vl(n,e,t){await ya(e);const r=Ew(e.providerData),i=n===!1?"provider-already-linked":"no-such-provider";O(r.has(t)===n,e.auth,i)}async function Tw(n,e,t=!1){const{auth:r}=n,i="reauthenticate";try{const s=await ur(n,ww(r,i,e,n),t);O(s.idToken,r,"internal-error");const a=ml(s.idToken);O(a,r,"internal-error");const{sub:l}=a;return O(n.uid===l,r,"user-mismatch"),ln._forOperation(n,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&_t(r,"user-mismatch"),s}}async function Aw(n,e,t=!1){const r="signIn",i=await ww(n,r,e),s=await ln._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}async function Il(n,e){return Aw(qe(n),e)}async function Rw(n,e){const t=H(n);return await vl(!1,t,e.providerId),up(t,e)}async function Sw(n,e){return Tw(H(n),e)}async function kV(n,e){return hr(n,"POST","/v1/accounts:signInWithCustomToken",Ge(n,e))}async function xV(n,e){const t=qe(n),r=await kV(t,{token:e,returnSecureToken:!0}),i=await ln._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(i.user),i}class Ya{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?cp._fromServerResponse(e,t):"totpInfo"in t?lp._fromServerResponse(e,t):_t(e,"internal-error")}}class cp extends Ya{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new cp(t)}}class lp extends Ya{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new lp(t)}}function wl(n,e,t){var r;O(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),O(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(O(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(O(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}async function hp(n){const e=qe(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function NV(n,e,t){const r=qe(n),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&wl(r,i,t),await Ia(r,i,"getOobCode",pV)}async function VV(n,e,t){await vw(H(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&hp(n),r})}async function OV(n,e){await hV(H(n),{oobCode:e})}async function bw(n,e){const t=H(n),r=await vw(t,{oobCode:e}),i=r.requestType;switch(O(i,t,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":O(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":O(r.mfaInfo,t,"internal-error");default:O(r.email,t,"internal-error")}let s=null;return r.mfaInfo&&(s=Ya._fromServerResponse(qe(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function LV(n,e){const{data:t}=await bw(H(n),e);return t.email}async function MV(n,e,t){const r=qe(n),a=await Ia(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Iw).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&hp(n),h}),l=await ln._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function FV(n,e,t){return Il(H(n),Yr.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&hp(n),r})}async function UV(n,e,t){const r=qe(n),i={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function s(a,l){O(l.handleCodeInApp,r,"argument-error"),l&&wl(r,a,l)}s(i,t),await Ia(r,i,"getOobCode",gV)}function BV(n,e){const t=yl.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function qV(n,e,t){const r=H(n),i=Yr.credentialWithLink(e,t||_a());return O(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Il(r,i)}async function $V(n,e){return ze(n,"POST","/v1/accounts:createAuthUri",Ge(n,e))}async function WV(n,e){const t=ip()?_a():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:i}=await $V(H(n),r);return i||[]}async function GV(n,e){const t=H(n),i={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&wl(t.auth,i,e);const{email:s}=await fV(t.auth,i);s!==n.email&&await n.reload()}async function zV(n,e,t){const r=H(n),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&wl(r.auth,s,t);const{email:a}=await mV(r.auth,s);a!==n.email&&await n.reload()}async function KV(n,e){return ze(n,"POST","/v1/accounts:update",e)}async function HV(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=H(n),s={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},a=await ur(r,KV(r.auth,s));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;const l=r.providerData.find(({providerId:h})=>h==="password");l&&(l.displayName=r.displayName,l.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}function jV(n,e){return Pw(H(n),e,null)}function QV(n,e){return Pw(H(n),null,e)}async function Pw(n,e,t){const{auth:r}=n,s={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);const a=await ur(n,cV(r,s));await n._updateTokensIfNecessary(a,!0)}function YV(n){var e,t;if(!n)return null;const{providerId:r}=n,i=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},s=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const a=(t=(e=ml(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(a){const l=a!=="anonymous"&&a!=="custom"?a:null;return new Cs(s,l)}}if(!r)return null;switch(r){case"facebook.com":return new JV(s,i);case"github.com":return new XV(s,i);case"google.com":return new ZV(s,i);case"twitter.com":return new eO(s,i,n.screenName||null);case"custom":case"anonymous":return new Cs(s,null);default:return new Cs(s,r,i)}}class Cs{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class Cw extends Cs{constructor(e,t,r,i){super(e,t,r),this.username=i}}class JV extends Cs{constructor(e,t){super(e,"facebook.com",t)}}class XV extends Cw{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class ZV extends Cs{constructor(e,t){super(e,"google.com",t)}}class eO extends Cw{constructor(e,t,r){super(e,"twitter.com",t,r)}}function tO(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:YV(t)}class wi{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new wi("enroll",e,t)}static _fromMfaPendingCredential(e){return new wi("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return wi._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return wi._fromIdtoken(e.multiFactorSession.idToken)}return null}}class dp{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=qe(e),i=t.customData._serverResponse,s=(i.mfaInfo||[]).map(l=>Ya._fromServerResponse(r,l));O(i.mfaPendingCredential,r,"internal-error");const a=wi._fromMfaPendingCredential(i.mfaPendingCredential);return new dp(a,s,async l=>{const h=await l._process(r,a);delete i.mfaInfo,delete i.mfaPendingCredential;const f=Object.assign(Object.assign({},i),{idToken:h.idToken,refreshToken:h.refreshToken});switch(t.operationType){case"signIn":const p=await ln._fromIdTokenResponse(r,t.operationType,f);return await r._updateCurrentUser(p.user),p;case"reauthenticate":return O(t.user,r,"internal-error"),ln._forOperation(t.user,t.operationType,f);default:_t(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function nO(n,e){var t;const r=H(n),i=e;return O(e.customData.operationType,r,"argument-error"),O((t=i.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),dp._fromError(r,i)}function rO(n,e){return ze(n,"POST","/v2/accounts/mfaEnrollment:start",Ge(n,e))}function iO(n,e){return ze(n,"POST","/v2/accounts/mfaEnrollment:finalize",Ge(n,e))}function sO(n,e){return ze(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Ge(n,e))}class fp{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>Ya._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new fp(e)}async getSession(){return wi._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,i=await this.getSession(),s=await ur(this.user,r._process(this.user.auth,i,t));return await this.user._updateTokensIfNecessary(s),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const i=await ur(this.user,sO(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:s})=>s!==t),await this.user._updateTokensIfNecessary(i),await this.user.reload()}catch(i){throw i}}}const Md=new WeakMap;function oO(n){const e=H(n);return Md.has(e)||Md.set(e,fp._fromUser(e)),Md.get(e)}const Wc="__sak";class Dw{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Wc,"1"),this.storage.removeItem(Wc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}function aO(){const n=Fe();return op(n)||Xs(n)}const uO=1e3,cO=10;class kw extends Dw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=aO()&&jN(),this.fallbackToPolling=gw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,h)=>{this.notifyListeners(a,h)});return}const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const a=this.storage.getItem(r);if(e.newValue!==a)e.newValue!==null?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}const i=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},s=this.storage.getItem(r);HN()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,cO):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},uO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}kw.type="LOCAL";const pp=kw;class xw extends Dw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}xw.type="SESSION";const ki=xw;function lO(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class El{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new El(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:s}=t.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const l=Array.from(a).map(async f=>f(t.origin,s)),h=await lO(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}El.receivers=[];function Ja(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class hO{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((l,h)=>{const f=Ja("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(m){const I=m;if(I.data.eventId===f)switch(I.data.status){case"ack":clearTimeout(p),s=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),l(I.data.response);break;default:clearTimeout(p),clearTimeout(s),h(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:f,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function Je(){return window}function dO(n){Je().location.href=n}function gp(){return typeof Je().WorkerGlobalScope<"u"&&typeof Je().importScripts=="function"}async function fO(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function pO(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function gO(){return gp()?self:null}const Nw="firebaseLocalStorageDb",mO=1,Gc="firebaseLocalStorage",Vw="fbase_key";class Xa{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Tl(n,e){return n.transaction([Gc],e?"readwrite":"readonly").objectStore(Gc)}function _O(){const n=indexedDB.deleteDatabase(Nw);return new Xa(n).toPromise()}function af(){const n=indexedDB.open(Nw,mO);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(Gc,{keyPath:Vw})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(Gc)?e(r):(r.close(),await _O(),e(await af()))})})}async function Zy(n,e,t){const r=Tl(n,!0).put({[Vw]:e,value:t});return new Xa(r).toPromise()}async function yO(n,e){const t=Tl(n,!1).get(e),r=await new Xa(t).toPromise();return r===void 0?null:r.value}function ev(n,e){const t=Tl(n,!0).delete(e);return new Xa(t).toPromise()}const vO=800,IO=3;class Ow{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await af(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>IO)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return gp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=El._getInstance(gO()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await fO(),!this.activeServiceWorker)return;this.sender=new hO(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||pO()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await af();return await Zy(e,Wc,"1"),await ev(e,Wc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Zy(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>yO(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ev(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=Tl(i,!1).getAll();return new Xa(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),vO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Ow.type="LOCAL";const Ea=Ow;function wO(n,e){return ze(n,"POST","/v2/accounts/mfaSignIn:start",Ge(n,e))}function EO(n,e){return ze(n,"POST","/v2/accounts/mfaSignIn:finalize",Ge(n,e))}const TO=500,AO=6e4,fc=1e12;class RO{constructor(e){this.auth=e,this.counter=fc,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new SO(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||fc;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||fc;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||fc;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class SO{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const i=typeof e=="string"?document.getElementById(e):e;O(i,"argument-error",{appName:t}),this.container=i,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=bO(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},AO)},TO))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function bO(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const Fd=_w("rcb"),PO=new ja(3e4,6e4),CO="https://www.google.com/recaptcha/api.js?";class DO{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Je().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return O(kO(t),e,"argument-error"),this.shouldResolveImmediately(t)&&zy(Je().grecaptcha)?Promise.resolve(Je().grecaptcha):new Promise((r,i)=>{const s=Je().setTimeout(()=>{i(gt(e,"network-request-failed"))},PO.get());Je()[Fd]=()=>{Je().clearTimeout(s),delete Je()[Fd];const l=Je().grecaptcha;if(!l||!zy(l)){i(gt(e,"internal-error"));return}const h=l.render;l.render=(f,p)=>{const m=h(f,p);return this.counter++,m},this.hostLanguage=t,r(l)};const a=`${CO}?${Ys({onload:Fd,render:"explicit",hl:t})}`;ap(a).catch(()=>{clearTimeout(s),i(gt(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Je().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function kO(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class xO{async load(e){return new RO(e)}clearedOneInstance(){}}const Lw="recaptcha",NO={theme:"light",type:"image"};let VO=class{constructor(e,t,r=Object.assign({},NO)){this.parameters=r,this.type=Lw,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=qe(e),this.isInvisible=this.parameters.size==="invisible",O(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const i=typeof t=="string"?document.getElementById(t):t;O(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new xO:new DO,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(i=>{const s=a=>{a&&(this.tokenChangeListeners.delete(s),i(a))};this.tokenChangeListeners.add(s),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){O(!this.parameters.sitekey,this.auth,"argument-error"),O(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),O(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=Je()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){O(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){O(ip()&&!gp(),this.auth,"internal-error"),await OO(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await kN(this.auth);O(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return O(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function OO(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}class mp{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Pi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function LO(n,e,t){const r=qe(n),i=await Al(r,e,H(t));return new mp(i,s=>Il(r,s))}async function MO(n,e,t){const r=H(n);await vl(!1,r,"phone");const i=await Al(r.auth,e,H(t));return new mp(i,s=>Rw(r,s))}async function FO(n,e,t){const r=H(n),i=await Al(r.auth,e,H(t));return new mp(i,s=>Sw(r,s))}async function Al(n,e,t){var r;const i=await t.verify();try{O(typeof i=="string",n,"argument-error"),O(t.type===Lw,n,"argument-error");let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const a=s.session;if("phoneNumber"in s)return O(a.type==="enroll",n,"internal-error"),(await rO(n,{idToken:a.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}})).phoneSessionInfo.sessionInfo;{O(a.type==="signin",n,"internal-error");const l=((r=s.multiFactorHint)===null||r===void 0?void 0:r.uid)||s.multiFactorUid;return O(l,n,"missing-multi-factor-info"),(await wO(n,{mfaPendingCredential:a.credential,mfaEnrollmentId:l,phoneSignInInfo:{recaptchaToken:i}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:a}=await IV(n,{phoneNumber:s.phoneNumber,recaptchaToken:i});return a}}finally{t._reset()}}async function UO(n,e){await up(H(n),e)}let Fn=class{constructor(e){this.providerId=Fn.PROVIDER_ID,this.auth=qe(e)}verifyPhoneNumber(e,t){return Al(this.auth,e,H(t))}static credential(e,t){return Pi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return Fn.credentialFromTaggedObject(t)}static credentialFromError(e){return Fn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Pi._fromTokenResponse(t,r):null}};Fn.PROVIDER_ID="phone";Fn.PHONE_SIGN_IN_METHOD="phone";function Wi(n,e){return e?Yt(e):(O(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class _p extends Zs{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return or(e,this._buildIdpRequest())}_linkToIdToken(e,t){return or(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return or(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function BO(n){return Aw(n.auth,new _p(n),n.bypassAuthState)}function qO(n){const{auth:e,user:t}=n;return O(t,e,"internal-error"),Tw(t,new _p(n),n.bypassAuthState)}async function $O(n){const{auth:e,user:t}=n;return O(t,e,"internal-error"),up(t,new _p(n),n.bypassAuthState)}class Mw{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:a,type:l}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return BO;case"linkViaPopup":case"linkViaRedirect":return $O;case"reauthViaPopup":case"reauthViaRedirect":return qO;default:_t(this.auth,"internal-error")}}resolve(e){yn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){yn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const WO=new ja(2e3,1e4);async function GO(n,e,t){const r=qe(n);Js(n,e,dr);const i=Wi(r,t);return new nr(r,"signInViaPopup",e,i).executeNotNull()}async function zO(n,e,t){const r=H(n);Js(r.auth,e,dr);const i=Wi(r.auth,t);return new nr(r.auth,"reauthViaPopup",e,i,r).executeNotNull()}async function KO(n,e,t){const r=H(n);Js(r.auth,e,dr);const i=Wi(r.auth,t);return new nr(r.auth,"linkViaPopup",e,i,r).executeNotNull()}class nr extends Mw{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,nr.currentPopupAction&&nr.currentPopupAction.cancel(),nr.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return O(e,this.auth,"internal-error"),e}async onExecution(){yn(this.filter.length===1,"Popup operations only handle one event");const e=Ja();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(gt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(gt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,nr.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(gt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,WO.get())};e()}}nr.currentPopupAction=null;const HO="pendingRedirect",sa=new Map;class jO extends Mw{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=sa.get(this.auth._key());if(!e){try{const r=await QO(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}sa.set(this.auth._key(),e)}return this.bypassAuthState||sa.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function QO(n,e){const t=Uw(e),r=Fw(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}async function yp(n,e){return Fw(n)._set(Uw(e),"true")}function YO(){sa.clear()}function vp(n,e){sa.set(n._key(),e)}function Fw(n){return Yt(n._redirectPersistence)}function Uw(n){return bi(HO,n.config.apiKey,n.name)}function JO(n,e,t){return XO(n,e,t)}async function XO(n,e,t){const r=qe(n);Js(n,e,dr),await r._initializationPromise;const i=Wi(r,t);return await yp(i,r),i._openRedirect(r,e,"signInViaRedirect")}function ZO(n,e,t){return eL(n,e,t)}async function eL(n,e,t){const r=H(n);Js(r.auth,e,dr),await r.auth._initializationPromise;const i=Wi(r.auth,t);await yp(i,r.auth);const s=await Bw(r);return i._openRedirect(r.auth,e,"reauthViaRedirect",s)}function tL(n,e,t){return nL(n,e,t)}async function nL(n,e,t){const r=H(n);Js(r.auth,e,dr),await r.auth._initializationPromise;const i=Wi(r.auth,t);await vl(!1,r,e.providerId),await yp(i,r.auth);const s=await Bw(r);return i._openRedirect(r.auth,e,"linkViaRedirect",s)}async function rL(n,e){return await qe(n)._initializationPromise,Rl(n,e,!1)}async function Rl(n,e,t=!1){const r=qe(n),i=Wi(r,e),a=await new jO(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}async function Bw(n){const e=Ja(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}const iL=10*60*1e3;class qw{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!sL(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!$w(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(gt(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=iL&&this.cachedEventUids.clear(),this.cachedEventUids.has(tv(e))}saveEventToCache(e){this.cachedEventUids.add(tv(e)),this.lastProcessedEventTime=Date.now()}}function tv(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function $w({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function sL(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return $w(n);default:return!1}}async function Ww(n,e={}){return ze(n,"GET","/v1/projects",e)}const oL=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,aL=/^https?/;async function uL(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Ww(n);for(const t of e)try{if(cL(t))return}catch{}_t(n,"unauthorized-domain")}function cL(n){const e=_a(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!aL.test(t))return!1;if(oL.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const lL=new ja(3e4,6e4);function nv(){const n=Je().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function hL(n){return new Promise((e,t)=>{var r,i,s;function a(){nv(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{nv(),t(gt(n,"network-request-failed"))},timeout:lL.get()})}if(!((i=(r=Je().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=Je().gapi)===null||s===void 0)&&s.load)a();else{const l=_w("iframefcb");return Je()[l]=()=>{gapi.load?a():t(gt(n,"network-request-failed"))},ap(`https://apis.google.com/js/api.js?onload=${l}`).catch(h=>t(h))}}).catch(e=>{throw Sc=null,e})}let Sc=null;function dL(n){return Sc=Sc||hL(n),Sc}const fL=new ja(5e3,15e3),pL="__/auth/iframe",gL="emulator/auth/iframe",mL={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},_L=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function yL(n){const e=n.config;O(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?sp(e,gL):`https://${n.config.authDomain}/${pL}`,r={apiKey:e.apiKey,appName:n.name,v:Qr},i=_L.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${Ys(r).slice(1)}`}async function vL(n){const e=await dL(n),t=Je().gapi;return O(t,n,"internal-error"),e.open({where:document.body,url:yL(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:mL,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const a=gt(n,"network-request-failed"),l=Je().setTimeout(()=>{s(a)},fL.get());function h(){Je().clearTimeout(l),i(r)}r.ping(h).then(h,()=>{s(a)})}))}const IL={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},wL=500,EL=600,TL="_blank",AL="http://localhost";class rv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function RL(n,e,t,r=wL,i=EL){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const h=Object.assign(Object.assign({},IL),{width:r.toString(),height:i.toString(),top:s,left:a}),f=Fe().toLowerCase();t&&(l=hw(f)?TL:t),lw(f)&&(e=e||AL,h.scrollbars="yes");const p=Object.entries(h).reduce((I,[A,L])=>`${I}${A}=${L},`,"");if(KN(f)&&l!=="_self")return SL(e||"",l),new rv(null);const m=window.open(e||"",l,p);O(m,n,"popup-blocked");try{m.focus()}catch{}return new rv(m)}function SL(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const bL="__/auth/handler",PL="emulator/auth/handler",CL=encodeURIComponent("fac");async function uf(n,e,t,r,i,s){O(n.config.authDomain,n,"auth-domain-config-required"),O(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Qr,eventId:i};if(e instanceof dr){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Xk(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,m]of Object.entries(s||{}))a[p]=m}if(e instanceof eo){const p=e.getScopes().filter(m=>m!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const p of Object.keys(l))l[p]===void 0&&delete l[p];const h=await n._getAppCheckToken(),f=h?`#${CL}=${encodeURIComponent(h)}`:"";return`${DL(n)}?${Ys(l).slice(1)}${f}`}function DL({config:n}){return n.emulator?sp(n,PL):`https://${n.authDomain}/${bL}`}const Ud="webStorageSupport";class kL{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ki,this._completeRedirectFn=Rl,this._overrideRedirectResult=vp}async _openPopup(e,t,r,i){var s;yn((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const a=await uf(e,t,r,_a(),i);return RL(e,a,Ja())}async _openRedirect(e,t,r,i){await this._originValidation(e);const s=await uf(e,t,r,_a(),i);return dO(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(yn(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await vL(e),r=new qw(e);return t.register("authEvent",i=>(O(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ud,{type:Ud},i=>{var s;const a=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[Ud];a!==void 0&&t(!!a),_t(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=uL(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return gw()||op()||Xs()}}const xL=kL;class NL{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return xn("unexpected MultiFactorSessionType")}}}class Ip extends NL{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Ip(e)}_finalizeEnroll(e,t,r){return iO(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return EO(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Gw{constructor(){}static assertion(e){return Ip._fromCredential(e)}}Gw.FACTOR_ID="phone";var iv="@firebase/auth",sv="1.5.1";class VL{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){O(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function OL(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function LL(n){Fr(new qn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;O(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:mw(n)},f=new ZN(r,i,s,h);return sV(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Fr(new qn("auth-internal",e=>{const t=qe(e.getProvider("auth").getImmediate());return(r=>new VL(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Mn(iv,sv,OL(n)),Mn(iv,sv,"esm2017")}const ML=5*60;$k("authIdTokenMaxAge");LL("Browser");function xi(){return window}const FL=2e3;async function UL(n,e,t){var r;const{BuildInfo:i}=xi();yn(e.sessionId,"AuthEvent did not contain a session ID");const s=await GL(e.sessionId),a={};return Xs()?a.ibi=i.packageName:Qa()?a.apn=i.packageName:_t(n,"operation-not-supported-in-this-environment"),i.displayName&&(a.appDisplayName=i.displayName),a.sessionId=s,uf(n,t,e.type,void 0,(r=e.eventId)!==null&&r!==void 0?r:void 0,a)}async function BL(n){const{BuildInfo:e}=xi(),t={};Xs()?t.iosBundleId=e.packageName:Qa()?t.androidPackageName=e.packageName:_t(n,"operation-not-supported-in-this-environment"),await Ww(n,t)}function qL(n){const{cordova:e}=xi();return new Promise(t=>{e.plugins.browsertab.isAvailable(r=>{let i=null;r?e.plugins.browsertab.openUrl(n):i=e.InAppBrowser.open(n,zN()?"_blank":"_system","location=yes"),t(i)})})}async function $L(n,e,t){const{cordova:r}=xi();let i=()=>{};try{await new Promise((s,a)=>{let l=null;function h(){var m;s();const I=(m=r.plugins.browsertab)===null||m===void 0?void 0:m.close;typeof I=="function"&&I(),typeof(t==null?void 0:t.close)=="function"&&t.close()}function f(){l||(l=window.setTimeout(()=>{a(gt(n,"redirect-cancelled-by-user"))},FL))}function p(){(document==null?void 0:document.visibilityState)==="visible"&&f()}e.addPassiveListener(h),document.addEventListener("resume",f,!1),Qa()&&document.addEventListener("visibilitychange",p,!1),i=()=>{e.removePassiveListener(h),document.removeEventListener("resume",f,!1),document.removeEventListener("visibilitychange",p,!1),l&&window.clearTimeout(l)}})}finally{i()}}function WL(n){var e,t,r,i,s,a,l,h,f,p;const m=xi();O(typeof((e=m==null?void 0:m.universalLinks)===null||e===void 0?void 0:e.subscribe)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),O(typeof((t=m==null?void 0:m.BuildInfo)===null||t===void 0?void 0:t.packageName)<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),O(typeof((s=(i=(r=m==null?void 0:m.cordova)===null||r===void 0?void 0:r.plugins)===null||i===void 0?void 0:i.browsertab)===null||s===void 0?void 0:s.openUrl)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O(typeof((h=(l=(a=m==null?void 0:m.cordova)===null||a===void 0?void 0:a.plugins)===null||l===void 0?void 0:l.browsertab)===null||h===void 0?void 0:h.isAvailable)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O(typeof((p=(f=m==null?void 0:m.cordova)===null||f===void 0?void 0:f.InAppBrowser)===null||p===void 0?void 0:p.open)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function GL(n){const e=zL(n),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")}function zL(n){if(yn(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return new TextEncoder().encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}const KL=20;class HL extends qw{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function jL(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:JL(),postBody:null,tenantId:n.tenantId,error:gt(n,"no-auth-event")}}function QL(n,e){return cf()._set(lf(n),e)}async function ov(n){const e=await cf()._get(lf(n));return e&&await cf()._remove(lf(n)),e}function YL(n,e){var t,r;const i=ZL(e);if(i.includes("/__/auth/callback")){const s=bc(i),a=s.firebaseError?XL(decodeURIComponent(s.firebaseError)):null,l=(r=(t=a==null?void 0:a.code)===null||t===void 0?void 0:t.split("auth/"))===null||r===void 0?void 0:r[1],h=l?gt(l):null;return h?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:h,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:i,postBody:null}}return null}function JL(){const n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<KL;t++){const r=Math.floor(Math.random()*e.length);n.push(e.charAt(r))}return n.join("")}function cf(){return Yt(pp)}function lf(n){return bi("authEvent",n.config.apiKey,n.name)}function XL(n){try{return JSON.parse(n)}catch{return null}}function ZL(n){const e=bc(n),t=e.link?decodeURIComponent(e.link):void 0,r=bc(t).link,i=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return bc(i).link||i||r||t||n}function bc(n){if(!(n!=null&&n.includes("?")))return{};const[e,...t]=n.split("?");return As(t.join("?"))}const eM=500;class tM{constructor(){this._redirectPersistence=ki,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Rl,this._overrideRedirectResult=vp}async _initialize(e){const t=e._key();let r=this.eventManagers.get(t);return r||(r=new HL(e),this.eventManagers.set(t,r),this.attachCallbackListeners(e,r)),r}_openPopup(e){_t(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,r,i){WL(e);const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),YO(),await this._originValidation(e);const a=jL(e,r,i);await QL(e,a);const l=await UL(e,a,t),h=await qL(l);return $L(e,s,h)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=BL(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:r,handleOpenURL:i,BuildInfo:s}=xi(),a=setTimeout(async()=>{await ov(e),t.onEvent(av())},eM),l=async p=>{clearTimeout(a);const m=await ov(e);let I=null;m&&(p!=null&&p.url)&&(I=YL(m,p.url)),t.onEvent(I||av())};typeof r<"u"&&typeof r.subscribe=="function"&&r.subscribe(null,l);const h=i,f=`${s.packageName.toLowerCase()}://`;xi().handleOpenURL=async p=>{if(p.toLowerCase().startsWith(f)&&l({url:p}),typeof h=="function")try{h(p)}catch(m){console.error(m)}}}}const nM=tM;function av(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:gt("no-auth-event")}}function rM(n,e){qe(n)._logFramework(e)}var iM="@firebase/auth-compat",sM="0.5.1";const oM=1e3;function oa(){var n;return((n=self==null?void 0:self.location)===null||n===void 0?void 0:n.protocol)||null}function aM(){return oa()==="http:"||oa()==="https:"}function zw(n=Fe()){return!!((oa()==="file:"||oa()==="ionic:"||oa()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function uM(){return Xf()||Jf()}function cM(){return WI()&&(document==null?void 0:document.documentMode)===11}function lM(n=Fe()){return/Edge\/\d+/.test(n)}function hM(n=Fe()){return cM()||lM(n)}function Kw(){try{const n=self.localStorage,e=Ja();if(n)return n.setItem(e,"1"),n.removeItem(e),hM()?pa():!0}catch{return wp()&&pa()}return!1}function wp(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Bd(){return(aM()||$I()||zw())&&!uM()&&Kw()&&!wp()}function Hw(){return zw()&&typeof document<"u"}async function dM(){return Hw()?new Promise(n=>{const e=setTimeout(()=>{n(!1)},oM);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1}function fM(){return typeof window<"u"?window:null}const Qt={LOCAL:"local",NONE:"none",SESSION:"session"},Uo=O,jw="persistence";function pM(n,e){if(Uo(Object.values(Qt).includes(e),n,"invalid-persistence-type"),Xf()){Uo(e!==Qt.SESSION,n,"unsupported-persistence-type");return}if(Jf()){Uo(e===Qt.NONE,n,"unsupported-persistence-type");return}if(wp()){Uo(e===Qt.NONE||e===Qt.LOCAL&&pa(),n,"unsupported-persistence-type");return}Uo(e===Qt.NONE||Kw(),n,"unsupported-persistence-type")}async function hf(n){await n._initializationPromise;const e=Qw(),t=bi(jw,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistence())}function gM(n,e){const t=Qw();if(!t)return[];const r=bi(jw,n,e);switch(t.getItem(r)){case Qt.NONE:return[Os];case Qt.LOCAL:return[Ea,ki];case Qt.SESSION:return[ki];default:return[]}}function Qw(){var n;try{return((n=fM())===null||n===void 0?void 0:n.sessionStorage)||null}catch{return null}}const mM=O;class xr{constructor(){this.browserResolver=Yt(xL),this.cordovaResolver=Yt(nM),this.underlyingResolver=null,this._redirectPersistence=ki,this._completeRedirectFn=Rl,this._overrideRedirectResult=vp}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,r,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,r,i)}async _openRedirect(e,t,r,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,r,i)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Hw()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return mM(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await dM();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function Yw(n){return n.unwrap()}function _M(n){return n.wrapped()}function yM(n){return Jw(n)}function vM(n,e){var t;const r=(t=e.customData)===null||t===void 0?void 0:t._tokenResponse;if((e==null?void 0:e.code)==="auth/multi-factor-auth-required"){const i=e;i.resolver=new IM(n,nO(n,e))}else if(r){const i=Jw(e),s=e;i&&(s.credential=i,s.tenantId=r.tenantId||void 0,s.email=r.email||void 0,s.phoneNumber=r.phoneNumber||void 0)}}function Jw(n){const{_tokenResponse:e}=n instanceof Dt?n.customData:n;if(!e)return null;if(!(n instanceof Dt)&&"temporaryProof"in e&&"phoneNumber"in e)return Fn.credentialFromResult(n);const t=e.providerId;if(!t||t===Fo.PASSWORD)return null;let r;switch(t){case Fo.GOOGLE:r=Pn;break;case Fo.FACEBOOK:r=bn;break;case Fo.GITHUB:r=Cn;break;case Fo.TWITTER:r=Dn;break;default:const{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:l,nonce:h}=e;return!s&&!a&&!i&&!l?null:l?t.startsWith("saml.")?Ls._create(t,l):$n._fromParams({providerId:t,signInMethod:t,pendingToken:l,idToken:i,accessToken:s}):new Ps(t).credential({idToken:i,accessToken:s,rawNonce:h})}return n instanceof Dt?r.credentialFromError(n):r.credentialFromResult(n)}function Ft(n,e){return e.catch(t=>{throw t instanceof Dt&&vM(n,t),t}).then(t=>{const r=t.operationType,i=t.user;return{operationType:r,credential:yM(t),additionalUserInfo:tO(t),user:Nr.getOrCreate(i)}})}async function df(n,e){const t=await e;return{verificationId:t.verificationId,confirm:r=>Ft(n,t.confirm(r))}}class IM{constructor(e,t){this.resolver=t,this.auth=_M(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Ft(Yw(this.auth),this.resolver.resolveSignIn(e))}}let Nr=class{constructor(e){this._delegate=e,this.multiFactor=oO(e)}static getOrCreate(e){return Nr.USER_MAP.has(e)||Nr.USER_MAP.set(e,new Nr(e)),Nr.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Ft(this.auth,Rw(this._delegate,e))}async linkWithPhoneNumber(e,t){return df(this.auth,MO(this._delegate,e,t))}async linkWithPopup(e){return Ft(this.auth,KO(this._delegate,e,xr))}async linkWithRedirect(e){return await hf(qe(this.auth)),tL(this._delegate,e,xr)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Ft(this.auth,Sw(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return df(this.auth,FO(this._delegate,e,t))}reauthenticateWithPopup(e){return Ft(this.auth,zO(this._delegate,e,xr))}async reauthenticateWithRedirect(e){return await hf(qe(this.auth)),ZO(this._delegate,e,xr)}sendEmailVerification(e){return GV(this._delegate,e)}async unlink(e){return await DV(this._delegate,e),this}updateEmail(e){return jV(this._delegate,e)}updatePassword(e){return QV(this._delegate,e)}updatePhoneNumber(e){return UO(this._delegate,e)}updateProfile(e){return HV(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return zV(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}};Nr.USER_MAP=new WeakMap;const Bo=O;class ff{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:r}=e.options;Bo(r,"invalid-api-key",{appName:e.name}),Bo(r,"invalid-api-key",{appName:e.name});const i=typeof window<"u"?xr:void 0;this._delegate=t.initialize({options:{persistence:wM(r,e.name),popupRedirectResolver:i}}),this._delegate._updateErrorMap(wN),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Nr.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){oV(this._delegate,e,t)}applyActionCode(e){return OV(this._delegate,e)}checkActionCode(e){return bw(this._delegate,e)}confirmPasswordReset(e,t){return VV(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Ft(this._delegate,MV(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return WV(this._delegate,e)}isSignInWithEmailLink(e){return BV(this._delegate,e)}async getRedirectResult(){Bo(Bd(),this._delegate,"operation-not-supported-in-this-environment");const e=await rL(this._delegate,xr);return e?Ft(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){rM(this._delegate,e)}onAuthStateChanged(e,t,r){const{next:i,error:s,complete:a}=uv(e,t,r);return this._delegate.onAuthStateChanged(i,s,a)}onIdTokenChanged(e,t,r){const{next:i,error:s,complete:a}=uv(e,t,r);return this._delegate.onIdTokenChanged(i,s,a)}sendSignInLinkToEmail(e,t){return UV(this._delegate,e,t)}sendPasswordResetEmail(e,t){return NV(this._delegate,e,t||void 0)}async setPersistence(e){pM(this._delegate,e);let t;switch(e){case Qt.SESSION:t=ki;break;case Qt.LOCAL:t=await Yt(Ea)._isAvailable()?Ea:pp;break;case Qt.NONE:t=Os;break;default:return _t("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Ft(this._delegate,CV(this._delegate))}signInWithCredential(e){return Ft(this._delegate,Il(this._delegate,e))}signInWithCustomToken(e){return Ft(this._delegate,xV(this._delegate,e))}signInWithEmailAndPassword(e,t){return Ft(this._delegate,FV(this._delegate,e,t))}signInWithEmailLink(e,t){return Ft(this._delegate,qV(this._delegate,e,t))}signInWithPhoneNumber(e,t){return df(this._delegate,LO(this._delegate,e,t))}async signInWithPopup(e){return Bo(Bd(),this._delegate,"operation-not-supported-in-this-environment"),Ft(this._delegate,GO(this._delegate,e,xr))}async signInWithRedirect(e){return Bo(Bd(),this._delegate,"operation-not-supported-in-this-environment"),await hf(this._delegate),JO(this._delegate,e,xr)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return LV(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}ff.Persistence=Qt;function uv(n,e,t){let r=n;typeof n!="function"&&({next:r,error:e,complete:t}=n);const i=r;return{next:a=>i(a&&Nr.getOrCreate(a)),error:e,complete:t}}function wM(n,e){const t=gM(n,e);if(typeof self<"u"&&!t.includes(Ea)&&t.push(Ea),typeof window<"u")for(const r of[pp,ki])t.includes(r)||t.push(r);return t.includes(Os)||t.push(Os),t}class Ep{constructor(){this.providerId="phone",this._delegate=new Fn(Yw(Ur.auth()))}static credential(e,t){return Fn.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Ep.PHONE_SIGN_IN_METHOD=Fn.PHONE_SIGN_IN_METHOD;Ep.PROVIDER_ID=Fn.PROVIDER_ID;const EM=O;class TM{constructor(e,t,r=Ur.app()){var i;EM((i=r.options)===null||i===void 0?void 0:i.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new VO(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}const AM="auth-compat";function RM(n){n.INTERNAL.registerComponent(new qn(AM,e=>{const t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("auth");return new ff(t,r)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:fs.EMAIL_SIGNIN,PASSWORD_RESET:fs.PASSWORD_RESET,RECOVER_EMAIL:fs.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:fs.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:fs.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:fs.VERIFY_EMAIL}},EmailAuthProvider:Yr,FacebookAuthProvider:bn,GithubAuthProvider:Cn,GoogleAuthProvider:Pn,OAuthProvider:Ps,SAMLAuthProvider:qc,PhoneAuthProvider:Ep,PhoneMultiFactorGenerator:Gw,RecaptchaVerifier:TM,TwitterAuthProvider:Dn,Auth:ff,AuthCredential:Zs,Error:Dt}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(iM,sM)}RM(Ur);var SM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},q,Tp=Tp||{},Z=SM||self;function Sl(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Za(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function bM(n){return Object.prototype.hasOwnProperty.call(n,qd)&&n[qd]||(n[qd]=++PM)}var qd="closure_uid_"+(1e9*Math.random()>>>0),PM=0;function CM(n,e,t){return n.call.apply(n.bind,arguments)}function DM(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function wt(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?wt=CM:wt=DM,wt.apply(null,arguments)}function pc(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function at(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var a=Array(arguments.length-2),l=2;l<arguments.length;l++)a[l-2]=arguments[l];return e.prototype[i].apply(r,a)}}function Jr(){this.s=this.s,this.o=this.o}var kM=0;Jr.prototype.s=!1;Jr.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),kM!=0)&&bM(this)};Jr.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Xw=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Ap(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function cv(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Sl(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let a=0;a<s;a++)n[i+a]=r[a]}else n.push(r)}}function Et(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Et.prototype.h=function(){this.defaultPrevented=!0};var xM=function(){if(!Z.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};Z.addEventListener("test",t,e),Z.removeEventListener("test",t,e)}catch{}return n}();function Ta(n){return/^[\s\xa0]*$/.test(n)}function bl(){var n=Z.navigator;return n&&(n=n.userAgent)?n:""}function kn(n){return bl().indexOf(n)!=-1}function Rp(n){return Rp[" "](n),n}Rp[" "]=function(){};function NM(n,e){var t=RF;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var VM=kn("Opera"),Ms=kn("Trident")||kn("MSIE"),Zw=kn("Edge"),pf=Zw||Ms,eE=kn("Gecko")&&!(bl().toLowerCase().indexOf("webkit")!=-1&&!kn("Edge"))&&!(kn("Trident")||kn("MSIE"))&&!kn("Edge"),OM=bl().toLowerCase().indexOf("webkit")!=-1&&!kn("Edge");function tE(){var n=Z.document;return n?n.documentMode:void 0}var gf;e:{var $d="",Wd=function(){var n=bl();if(eE)return/rv:([^\);]+)(\)|;)/.exec(n);if(Zw)return/Edge\/([\d\.]+)/.exec(n);if(Ms)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(OM)return/WebKit\/(\S+)/.exec(n);if(VM)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(Wd&&($d=Wd?Wd[1]:""),Ms){var Gd=tE();if(Gd!=null&&Gd>parseFloat($d)){gf=String(Gd);break e}}gf=$d}var mf;if(Z.document&&Ms){var lv=tE();mf=lv||parseInt(gf,10)||void 0}else mf=void 0;var LM=mf;function Aa(n,e){if(Et.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(eE){e:{try{Rp(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:MM[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Aa.$.h.call(this)}}at(Aa,Et);var MM={2:"touch",3:"pen",4:"mouse"};Aa.prototype.h=function(){Aa.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var eu="closure_listenable_"+(1e6*Math.random()|0),FM=0;function UM(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++FM,this.fa=this.ia=!1}function Pl(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Sp(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function BM(n,e){for(const t in n)e.call(void 0,n[t],t,n)}function nE(n){const e={};for(const t in n)e[t]=n[t];return e}const hv="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rE(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<hv.length;s++)t=hv[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Cl(n){this.src=n,this.g={},this.h=0}Cl.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var a=yf(n,e,r,i);return-1<a?(e=n[a],t||(e.ia=!1)):(e=new UM(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function _f(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=Xw(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Pl(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function yf(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var bp="closure_lm_"+(1e6*Math.random()|0),zd={};function iE(n,e,t,r,i){if(r&&r.once)return oE(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)iE(n,e[s],t,r,i);return null}return t=Dp(t),n&&n[eu]?n.O(e,t,Za(r)?!!r.capture:!!r,i):sE(n,e,t,!1,r,i)}function sE(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var a=Za(i)?!!i.capture:!!i,l=Cp(n);if(l||(n[bp]=l=new Cl(n)),t=l.add(e,t,r,a,s),t.proxy)return t;if(r=qM(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)xM||(i=a),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(uE(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function qM(){function n(t){return e.call(n.src,n.listener,t)}const e=$M;return n}function oE(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)oE(n,e[s],t,r,i);return null}return t=Dp(t),n&&n[eu]?n.P(e,t,Za(r)?!!r.capture:!!r,i):sE(n,e,t,!0,r,i)}function aE(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)aE(n,e[s],t,r,i);else r=Za(r)?!!r.capture:!!r,t=Dp(t),n&&n[eu]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=yf(s,t,r,i),-1<t&&(Pl(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=Cp(n))&&(e=n.g[e.toString()],n=-1,e&&(n=yf(e,t,r,i)),(t=-1<n?e[n]:null)&&Pp(t))}function Pp(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[eu])_f(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(uE(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Cp(e))?(_f(t,n),t.h==0&&(t.src=null,e[bp]=null)):Pl(n)}}}function uE(n){return n in zd?zd[n]:zd[n]="on"+n}function $M(n,e){if(n.fa)n=!0;else{e=new Aa(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Pp(n),n=t.call(r,e)}return n}function Cp(n){return n=n[bp],n instanceof Cl?n:null}var Kd="__closure_events_fn_"+(1e9*Math.random()>>>0);function Dp(n){return typeof n=="function"?n:(n[Kd]||(n[Kd]=function(e){return n.handleEvent(e)}),n[Kd])}function ot(){Jr.call(this),this.i=new Cl(this),this.S=this,this.J=null}at(ot,Jr);ot.prototype[eu]=!0;ot.prototype.removeEventListener=function(n,e,t,r){aE(this,n,e,t,r)};function mt(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new Et(e,n);else if(e instanceof Et)e.target=e.target||n;else{var i=e;e=new Et(r,n),rE(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var a=e.g=t[s];i=gc(a,r,!0,e)&&i}if(a=e.g=n,i=gc(a,r,!0,e)&&i,i=gc(a,r,!1,e)&&i,t)for(s=0;s<t.length;s++)a=e.g=t[s],i=gc(a,r,!1,e)&&i}ot.prototype.N=function(){if(ot.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Pl(t[r]);delete n.g[e],n.h--}}this.J=null};ot.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};ot.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function gc(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var a=e[s];if(a&&!a.fa&&a.capture==t){var l=a.listener,h=a.la||a.src;a.ia&&_f(n.i,a),i=l.call(h,r)!==!1&&i}}return i&&!r.defaultPrevented}var kp=Z.JSON.stringify;class WM{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function GM(){var n=xp;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class zM{constructor(){this.h=this.g=null}add(e,t){const r=cE.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}}var cE=new WM(()=>new KM,n=>n.reset());class KM{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function HM(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function jM(n){Z.setTimeout(()=>{throw n},0)}let Ra,Sa=!1,xp=new zM,lE=()=>{const n=Z.Promise.resolve(void 0);Ra=()=>{n.then(QM)}};var QM=()=>{for(var n;n=GM();){try{n.h.call(n.g)}catch(t){jM(t)}var e=cE;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Sa=!1};function Dl(n,e){ot.call(this),this.h=n||1,this.g=e||Z,this.j=wt(this.qb,this),this.l=Date.now()}at(Dl,ot);q=Dl.prototype;q.ga=!1;q.T=null;q.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),mt(this,"tick"),this.ga&&(Np(this),this.start()))}};q.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Np(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}q.N=function(){Dl.$.N.call(this),Np(this),delete this.g};function Vp(n,e,t){if(typeof n=="function")t&&(n=wt(n,t));else if(n&&typeof n.handleEvent=="function")n=wt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:Z.setTimeout(n,e||0)}function hE(n){n.g=Vp(()=>{n.g=null,n.i&&(n.i=!1,hE(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class YM extends Jr{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:hE(this)}N(){super.N(),this.g&&(Z.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ba(n){Jr.call(this),this.h=n,this.g={}}at(ba,Jr);var dv=[];function dE(n,e,t,r){Array.isArray(t)||(t&&(dv[0]=t.toString()),t=dv);for(var i=0;i<t.length;i++){var s=iE(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function fE(n){Sp(n.g,function(e,t){this.g.hasOwnProperty(t)&&Pp(e)},n),n.g={}}ba.prototype.N=function(){ba.$.N.call(this),fE(this)};ba.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function kl(){this.g=!0}kl.prototype.Ea=function(){this.g=!1};function JM(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var a="",l=s.split("&"),h=0;h<l.length;h++){var f=l[h].split("=");if(1<f.length){var p=f[0];f=f[1];var m=p.split("_");a=2<=m.length&&m[1]=="type"?a+(p+"="+f+"&"):a+(p+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+a})}function XM(n,e,t,r,i,s,a){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+a})}function Rs(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+eF(n,t)+(r?" "+r:"")})}function ZM(n,e){n.info(function(){return"TIMEOUT: "+e})}kl.prototype.info=function(){};function eF(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var a=1;a<i.length;a++)i[a]=""}}}}return kp(t)}catch{return e}}var Gi={},fv=null;function xl(){return fv=fv||new ot}Gi.Ta="serverreachability";function pE(n){Et.call(this,Gi.Ta,n)}at(pE,Et);function Pa(n){const e=xl();mt(e,new pE(e))}Gi.STAT_EVENT="statevent";function gE(n,e){Et.call(this,Gi.STAT_EVENT,n),this.stat=e}at(gE,Et);function Ct(n){const e=xl();mt(e,new gE(e,n))}Gi.Ua="timingevent";function mE(n,e){Et.call(this,Gi.Ua,n),this.size=e}at(mE,Et);function tu(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return Z.setTimeout(function(){n()},e)}var Nl={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},_E={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Op(){}Op.prototype.h=null;function pv(n){return n.h||(n.h=n.i())}function yE(){}var nu={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Lp(){Et.call(this,"d")}at(Lp,Et);function Mp(){Et.call(this,"c")}at(Mp,Et);var vf;function Vl(){}at(Vl,Op);Vl.prototype.g=function(){return new XMLHttpRequest};Vl.prototype.i=function(){return{}};vf=new Vl;function ru(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new ba(this),this.P=tF,n=pf?125:void 0,this.V=new Dl(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new vE}function vE(){this.i=null,this.g="",this.h=!1}var tF=45e3,IE={},If={};q=ru.prototype;q.setTimeout=function(n){this.P=n};function wf(n,e,t){n.L=1,n.A=Ll(cr(e)),n.u=t,n.S=!0,wE(n,null)}function wE(n,e){n.G=Date.now(),iu(n),n.B=cr(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),CE(t.i,"t",r),n.o=0,t=n.l.J,n.h=new vE,n.g=YE(n.l,t?e:null,!n.u),0<n.O&&(n.M=new YM(wt(n.Pa,n,n.g),n.O)),dE(n.U,n.g,"readystatechange",n.nb),e=n.I?nE(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Pa(),JM(n.j,n.v,n.B,n.m,n.W,n.u)}q.nb=function(n){n=n.target;const e=this.M;e&&Nn(n)==3?e.l():this.Pa(n)};q.Pa=function(n){try{if(n==this.g)e:{const p=Nn(this.g);var e=this.g.Ia();const m=this.g.da();if(!(3>p)&&(p!=3||pf||this.g&&(this.h.h||this.g.ja()||yv(this.g)))){this.J||p!=4||e==7||(e==8||0>=m?Pa(3):Pa(2)),Ol(this);var t=this.g.da();this.ca=t;t:if(EE(this)){var r=yv(this.g);n="";var i=r.length,s=Nn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ei(this),aa(this);var a="";break t}this.h.i=new Z.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,a=this.h.g}else a=this.g.ja();if(this.i=t==200,XM(this.j,this.v,this.B,this.m,this.W,p,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var l,h=this.g;if((l=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ta(l)){var f=l;break t}}f=null}if(t=f)Rs(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Ef(this,t);else{this.i=!1,this.s=3,Ct(12),Ei(this),aa(this);break e}}this.S?(TE(this,p,a),pf&&this.i&&p==3&&(dE(this.U,this.V,"tick",this.mb),this.V.start())):(Rs(this.j,this.m,a,null),Ef(this,a)),p==4&&Ei(this),this.i&&!this.J&&(p==4?KE(this.l,this):(this.i=!1,iu(this)))}else EF(this.g),t==400&&0<a.indexOf("Unknown SID")?(this.s=3,Ct(12)):(this.s=0,Ct(13)),Ei(this),aa(this)}}}catch{}finally{}};function EE(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function TE(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=nF(n,t),i==If){e==4&&(n.s=4,Ct(14),r=!1),Rs(n.j,n.m,null,"[Incomplete Response]");break}else if(i==IE){n.s=4,Ct(15),Rs(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else Rs(n.j,n.m,i,null),Ef(n,i);EE(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Ct(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Wp(e),e.M=!0,Ct(11))):(Rs(n.j,n.m,t,"[Invalid Chunked Response]"),Ei(n),aa(n))}q.mb=function(){if(this.g){var n=Nn(this.g),e=this.g.ja();this.o<e.length&&(Ol(this),TE(this,n,e),this.i&&n!=4&&iu(this))}};function nF(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?If:(t=Number(e.substring(t,r)),isNaN(t)?IE:(r+=1,r+t>e.length?If:(e=e.slice(r,r+t),n.o=r+t,e)))}q.cancel=function(){this.J=!0,Ei(this)};function iu(n){n.Y=Date.now()+n.P,AE(n,n.P)}function AE(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=tu(wt(n.lb,n),e)}function Ol(n){n.C&&(Z.clearTimeout(n.C),n.C=null)}q.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(ZM(this.j,this.B),this.L!=2&&(Pa(),Ct(17)),Ei(this),this.s=2,aa(this)):AE(this,this.Y-n)};function aa(n){n.l.H==0||n.J||KE(n.l,n)}function Ei(n){Ol(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Np(n.V),fE(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Ef(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Tf(t.i,n))){if(!n.K&&Tf(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Hc(t),Bl(t);else break e;$p(t),Ct(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=tu(wt(t.ib,t),6e3));if(1>=xE(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Ti(t,11)}else if((n.K||t.g==n)&&Hc(t),!Ta(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let f=i[e];if(t.V=f[0],f=f[1],t.H==2)if(f[0]=="c"){t.K=f[1],t.pa=f[2];const p=f[3];p!=null&&(t.ra=p,t.l.info("VER="+t.ra));const m=f[4];m!=null&&(t.Ga=m,t.l.info("SVER="+t.Ga));const I=f[5];I!=null&&typeof I=="number"&&0<I&&(r=1.5*I,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const A=n.g;if(A){const L=A.g?A.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(L){var s=r.i;s.g||L.indexOf("spdy")==-1&&L.indexOf("quic")==-1&&L.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Fp(s,s.h),s.h=null))}if(r.F){const M=A.g?A.g.getResponseHeader("X-HTTP-Session-Id"):null;M&&(r.Da=M,De(r.I,r.F,M))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var a=n;if(r.wa=QE(r,r.J?r.pa:null,r.Y),a.K){NE(r.i,a);var l=a,h=r.L;h&&l.setTimeout(h),l.C&&(Ol(l),iu(l)),r.g=a}else GE(r);0<t.j.length&&ql(t)}else f[0]!="stop"&&f[0]!="close"||Ti(t,7);else t.H==3&&(f[0]=="stop"||f[0]=="close"?f[0]=="stop"?Ti(t,7):qp(t):f[0]!="noop"&&t.h&&t.h.Aa(f),t.A=0)}}Pa(4)}catch{}}function rF(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Sl(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function iF(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Sl(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}function RE(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Sl(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=iF(n),r=rF(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var SE=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function sF(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Ci(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Ci){this.h=n.h,zc(this,n.j),this.s=n.s,this.g=n.g,Kc(this,n.m),this.l=n.l;var e=n.i,t=new Ca;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),gv(this,t),this.o=n.o}else n&&(e=String(n).match(SE))?(this.h=!1,zc(this,e[1]||"",!0),this.s=Zo(e[2]||""),this.g=Zo(e[3]||"",!0),Kc(this,e[4]),this.l=Zo(e[5]||"",!0),gv(this,e[6]||"",!0),this.o=Zo(e[7]||"")):(this.h=!1,this.i=new Ca(null,this.h))}Ci.prototype.toString=function(){var n=[],e=this.j;e&&n.push(ea(e,mv,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(ea(e,mv,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(ea(t,t.charAt(0)=="/"?uF:aF,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",ea(t,lF)),n.join("")};function cr(n){return new Ci(n)}function zc(n,e,t){n.j=t?Zo(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Kc(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function gv(n,e,t){e instanceof Ca?(n.i=e,hF(n.i,n.h)):(t||(e=ea(e,cF)),n.i=new Ca(e,n.h))}function De(n,e,t){n.i.set(e,t)}function Ll(n){return De(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Zo(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function ea(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,oF),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function oF(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var mv=/[#\/\?@]/g,aF=/[#\?:]/g,uF=/[#\?]/g,cF=/[#\?@]/g,lF=/#/g;function Ca(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Xr(n){n.g||(n.g=new Map,n.h=0,n.i&&sF(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}q=Ca.prototype;q.add=function(n,e){Xr(this),this.i=null,n=to(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function bE(n,e){Xr(n),e=to(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function PE(n,e){return Xr(n),e=to(n,e),n.g.has(e)}q.forEach=function(n,e){Xr(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};q.ta=function(){Xr(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};q.Z=function(n){Xr(this);let e=[];if(typeof n=="string")PE(this,n)&&(e=e.concat(this.g.get(to(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};q.set=function(n,e){return Xr(this),this.i=null,n=to(this,n),PE(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};q.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function CE(n,e,t){bE(n,e),0<t.length&&(n.i=null,n.g.set(to(n,e),Ap(t)),n.h+=t.length)}q.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;a[r]!==""&&(i+="="+encodeURIComponent(String(a[r]))),n.push(i)}}return this.i=n.join("&")};function to(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function hF(n,e){e&&!n.j&&(Xr(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(bE(this,r),CE(this,i,t))},n)),n.j=e}var dF=class{constructor(n,e){this.g=n,this.map=e}};function DE(n){this.l=n||fF,Z.PerformanceNavigationTiming?(n=Z.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(Z.g&&Z.g.Ka&&Z.g.Ka()&&Z.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var fF=10;function kE(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function xE(n){return n.h?1:n.g?n.g.size:0}function Tf(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Fp(n,e){n.g?n.g.add(e):n.h=e}function NE(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}DE.prototype.cancel=function(){if(this.i=VE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function VE(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Ap(n.i)}var pF=class{stringify(n){return Z.JSON.stringify(n,void 0)}parse(n){return Z.JSON.parse(n,void 0)}};function gF(){this.g=new pF}function mF(n,e,t){const r=t||"";try{RE(n,function(i,s){let a=i;Za(i)&&(a=kp(i)),e.push(r+s+"="+encodeURIComponent(a))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function _F(n,e){const t=new kl;if(Z.Image){const r=new Image;r.onload=pc(mc,t,r,"TestLoadImage: loaded",!0,e),r.onerror=pc(mc,t,r,"TestLoadImage: error",!1,e),r.onabort=pc(mc,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=pc(mc,t,r,"TestLoadImage: timeout",!1,e),Z.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function mc(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function Ml(n){this.l=n.ec||null,this.j=n.ob||!1}at(Ml,Op);Ml.prototype.g=function(){return new Fl(this.l,this.j)};Ml.prototype.i=function(n){return function(){return n}}({});function Fl(n,e){ot.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Up,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}at(Fl,ot);var Up=0;q=Fl.prototype;q.open=function(n,e){if(this.readyState!=Up)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Da(this)};q.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||Z).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};q.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,su(this)),this.readyState=Up};q.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Da(this)),this.g&&(this.readyState=3,Da(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Z.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;OE(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function OE(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}q.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?su(this):Da(this),this.readyState==3&&OE(this)}};q.Za=function(n){this.g&&(this.response=this.responseText=n,su(this))};q.Ya=function(n){this.g&&(this.response=n,su(this))};q.ka=function(){this.g&&su(this)};function su(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Da(n)}q.setRequestHeader=function(n,e){this.v.append(n,e)};q.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};q.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Da(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Fl.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var yF=Z.JSON.parse;function $e(n){ot.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=LE,this.L=this.M=!1}at($e,ot);var LE="",vF=/^https?$/i,IF=["POST","PUT"];q=$e.prototype;q.Oa=function(n){this.M=n};q.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():vf.g(),this.C=this.u?pv(this.u):pv(vf),this.g.onreadystatechange=wt(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){_v(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(const s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=Z.FormData&&n instanceof Z.FormData,!(0<=Xw(IF,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of t)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{UE(this),0<this.B&&((this.L=wF(this.g))?(this.g.timeout=this.B,this.g.ontimeout=wt(this.ua,this)):this.A=Vp(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){_v(this,s)}};function wF(n){return Ms&&typeof n.timeout=="number"&&n.ontimeout!==void 0}q.ua=function(){typeof Tp<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,mt(this,"timeout"),this.abort(8))};function _v(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,ME(n),Ul(n)}function ME(n){n.F||(n.F=!0,mt(n,"complete"),mt(n,"error"))}q.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,mt(this,"complete"),mt(this,"abort"),Ul(this))};q.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ul(this,!0)),$e.$.N.call(this)};q.La=function(){this.s||(this.G||this.v||this.l?FE(this):this.kb())};q.kb=function(){FE(this)};function FE(n){if(n.h&&typeof Tp<"u"&&(!n.C[1]||Nn(n)!=4||n.da()!=2)){if(n.v&&Nn(n)==4)Vp(n.La,0,n);else if(mt(n,"readystatechange"),Nn(n)==4){n.h=!1;try{const a=n.da();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=a===0){var i=String(n.I).match(SE)[1]||null;!i&&Z.self&&Z.self.location&&(i=Z.self.location.protocol.slice(0,-1)),r=!vF.test(i?i.toLowerCase():"")}t=r}if(t)mt(n,"complete"),mt(n,"success");else{n.m=6;try{var s=2<Nn(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",ME(n)}}finally{Ul(n)}}}}function Ul(n,e){if(n.g){UE(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||mt(n,"ready");try{t.onreadystatechange=r}catch{}}}function UE(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(Z.clearTimeout(n.A),n.A=null)}q.isActive=function(){return!!this.g};function Nn(n){return n.g?n.g.readyState:0}q.da=function(){try{return 2<Nn(this)?this.g.status:-1}catch{return-1}};q.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};q.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),yF(e)}};function yv(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case LE:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function EF(n){const e={};n=(n.g&&2<=Nn(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Ta(n[r]))continue;var t=HM(n[r]);const i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}BM(e,function(r){return r.join(", ")})}q.Ia=function(){return this.m};q.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function BE(n){let e="";return Sp(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function Bp(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=BE(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):De(n,e,t))}function qo(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function qE(n){this.Ga=0,this.j=[],this.l=new kl,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=qo("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=qo("baseRetryDelayMs",5e3,n),this.hb=qo("retryDelaySeedMs",1e4,n),this.eb=qo("forwardChannelMaxRetries",2,n),this.xa=qo("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new DE(n&&n.concurrentRequestLimit),this.Ja=new gF,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}q=qE.prototype;q.ra=8;q.H=1;function qp(n){if($E(n),n.H==3){var e=n.W++,t=cr(n.I);if(De(t,"SID",n.K),De(t,"RID",e),De(t,"TYPE","terminate"),ou(n,t),e=new ru(n,n.l,e),e.L=2,e.A=Ll(cr(t)),t=!1,Z.navigator&&Z.navigator.sendBeacon)try{t=Z.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&Z.Image&&(new Image().src=e.A,t=!0),t||(e.g=YE(e.l,null),e.g.ha(e.A)),e.G=Date.now(),iu(e)}jE(n)}function Bl(n){n.g&&(Wp(n),n.g.cancel(),n.g=null)}function $E(n){Bl(n),n.u&&(Z.clearTimeout(n.u),n.u=null),Hc(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&Z.clearTimeout(n.m),n.m=null)}function ql(n){if(!kE(n.i)&&!n.m){n.m=!0;var e=n.Na;Ra||lE(),Sa||(Ra(),Sa=!0),xp.add(e,n),n.C=0}}function TF(n,e){return xE(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=tu(wt(n.Na,n,e),HE(n,n.C)),n.C++,!0)}q.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new ru(this,this.l,n);let s=this.s;if(this.U&&(s?(s=nE(s),rE(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=WE(this,i,e),t=cr(this.I),De(t,"RID",n),De(t,"CVER",22),this.F&&De(t,"X-HTTP-Session-Id",this.F),ou(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(BE(s)))+"&"+e:this.o&&Bp(t,this.o,s)),Fp(this.i,i),this.bb&&De(t,"TYPE","init"),this.P?(De(t,"$req",e),De(t,"SID","null"),i.aa=!0,wf(i,t,null)):wf(i,t,e),this.H=2}}else this.H==3&&(n?vv(this,n):this.j.length==0||kE(this.i)||vv(this))};function vv(n,e){var t;e?t=e.m:t=n.W++;const r=cr(n.I);De(r,"SID",n.K),De(r,"RID",t),De(r,"AID",n.V),ou(n,r),n.o&&n.s&&Bp(r,n.o,n.s),t=new ru(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=WE(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Fp(n.i,t),wf(t,r,e)}function ou(n,e){n.na&&Sp(n.na,function(t,r){De(e,r,t)}),n.h&&RE({},function(t,r){De(e,r,t)})}function WE(n,e,t){t=Math.min(n.j.length,t);var r=n.h?wt(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const a=["count="+t];s==-1?0<t?(s=i[0].g,a.push("ofs="+s)):s=0:a.push("ofs="+s);let l=!0;for(let h=0;h<t;h++){let f=i[h].g;const p=i[h].map;if(f-=s,0>f)s=Math.max(0,i[h].g-100),l=!1;else try{mF(p,a,"req"+f+"_")}catch{r&&r(p)}}if(l){r=a.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function GE(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Ra||lE(),Sa||(Ra(),Sa=!0),xp.add(e,n),n.A=0}}function $p(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=tu(wt(n.Ma,n),HE(n,n.A)),n.A++,!0)}q.Ma=function(){if(this.u=null,zE(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=tu(wt(this.jb,this),n)}};q.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ct(10),Bl(this),zE(this))};function Wp(n){n.B!=null&&(Z.clearTimeout(n.B),n.B=null)}function zE(n){n.g=new ru(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=cr(n.wa);De(e,"RID","rpc"),De(e,"SID",n.K),De(e,"AID",n.V),De(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&De(e,"TO",n.qa),De(e,"TYPE","xmlhttp"),ou(n,e),n.o&&n.s&&Bp(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Ll(cr(e)),t.u=null,t.S=!0,wE(t,n)}q.ib=function(){this.v!=null&&(this.v=null,Bl(this),$p(this),Ct(19))};function Hc(n){n.v!=null&&(Z.clearTimeout(n.v),n.v=null)}function KE(n,e){var t=null;if(n.g==e){Hc(n),Wp(n),n.g=null;var r=2}else if(Tf(n.i,e))t=e.F,NE(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=xl(),mt(r,new mE(r,t)),ql(n)}else GE(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&TF(n,e)||r==2&&$p(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Ti(n,5);break;case 4:Ti(n,10);break;case 3:Ti(n,6);break;default:Ti(n,2)}}}function HE(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Ti(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=wt(n.pb,n);t||(t=new Ci("//www.google.com/images/cleardot.gif"),Z.location&&Z.location.protocol=="http"||zc(t,"https"),Ll(t)),_F(t.toString(),r)}else Ct(2);n.H=0,n.h&&n.h.za(e),jE(n),$E(n)}q.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ct(2)):(this.l.info("Failed to ping google.com"),Ct(1))};function jE(n){if(n.H=0,n.ma=[],n.h){const e=VE(n.i);(e.length!=0||n.j.length!=0)&&(cv(n.ma,e),cv(n.ma,n.j),n.i.i.length=0,Ap(n.j),n.j.length=0),n.h.ya()}}function QE(n,e,t){var r=t instanceof Ci?cr(t):new Ci(t);if(r.g!="")e&&(r.g=e+"."+r.g),Kc(r,r.m);else{var i=Z.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Ci(null);r&&zc(s,r),e&&(s.g=e),i&&Kc(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&De(r,t,e),De(r,"VER",n.ra),ou(n,r),r}function YE(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new $e(new Ml({ob:t})):new $e(n.va),e.Oa(n.J),e}q.isActive=function(){return!!this.h&&this.h.isActive(this)};function JE(){}q=JE.prototype;q.Ba=function(){};q.Aa=function(){};q.za=function(){};q.ya=function(){};q.isActive=function(){return!0};q.Va=function(){};function jc(){if(Ms&&!(10<=Number(LM)))throw Error("Environmental error: no available transport.")}jc.prototype.g=function(n,e){return new Jt(n,e)};function Jt(n,e){ot.call(this),this.g=new qE(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Ta(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ta(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new no(this)}at(Jt,ot);Jt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Ct(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=QE(n,null,n.Y),ql(n)};Jt.prototype.close=function(){qp(this.g)};Jt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=kp(n),n=t);e.j.push(new dF(e.fb++,n)),e.H==3&&ql(e)};Jt.prototype.N=function(){this.g.h=null,delete this.j,qp(this.g),delete this.g,Jt.$.N.call(this)};function XE(n){Lp.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}at(XE,Lp);function ZE(){Mp.call(this),this.status=1}at(ZE,Mp);function no(n){this.g=n}at(no,JE);no.prototype.Ba=function(){mt(this.g,"a")};no.prototype.Aa=function(n){mt(this.g,new XE(n))};no.prototype.za=function(n){mt(this.g,new ZE)};no.prototype.ya=function(){mt(this.g,"b")};function AF(){this.blockSize=-1}function vn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}at(vn,AF);vn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Hd(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],a=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(a<<7&4294967295|a>>>25),a=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(a<<12&4294967295|a>>>20),a=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(a<<17&4294967295|a>>>15),a=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(a<<22&4294967295|a>>>10),a=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(a<<12&4294967295|a>>>20),a=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(a<<17&4294967295|a>>>15),a=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(a<<22&4294967295|a>>>10),a=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(a<<12&4294967295|a>>>20),a=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(a<<17&4294967295|a>>>15),a=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(a<<22&4294967295|a>>>10),a=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(a<<12&4294967295|a>>>20),a=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(a<<17&4294967295|a>>>15),a=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(a<<22&4294967295|a>>>10),a=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(a<<9&4294967295|a>>>23),a=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(a<<20&4294967295|a>>>12),a=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(a<<9&4294967295|a>>>23),a=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(a<<20&4294967295|a>>>12),a=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(a<<9&4294967295|a>>>23),a=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(a<<20&4294967295|a>>>12),a=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(a<<9&4294967295|a>>>23),a=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(a<<20&4294967295|a>>>12),a=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(a<<11&4294967295|a>>>21),a=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(a<<16&4294967295|a>>>16),a=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(a<<23&4294967295|a>>>9),a=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(a<<11&4294967295|a>>>21),a=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(a<<16&4294967295|a>>>16),a=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(a<<23&4294967295|a>>>9),a=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(a<<11&4294967295|a>>>21),a=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(a<<16&4294967295|a>>>16),a=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(a<<23&4294967295|a>>>9),a=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(a<<11&4294967295|a>>>21),a=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(a<<16&4294967295|a>>>16),a=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(a<<23&4294967295|a>>>9),a=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(a<<10&4294967295|a>>>22),a=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(a<<15&4294967295|a>>>17),a=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(a<<21&4294967295|a>>>11),a=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(a<<10&4294967295|a>>>22),a=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(a<<15&4294967295|a>>>17),a=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(a<<21&4294967295|a>>>11),a=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(a<<10&4294967295|a>>>22),a=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(a<<15&4294967295|a>>>17),a=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(a<<21&4294967295|a>>>11),a=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(a<<10&4294967295|a>>>22),a=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(a<<15&4294967295|a>>>17),a=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}vn.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)Hd(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Hd(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Hd(this,r),i=0;break}}this.h=i,this.i+=e};vn.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function Ae(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var RF={};function Gp(n){return-128<=n&&128>n?NM(n,function(e){return new Ae([e|0],0>e?-1:0)}):new Ae([n|0],0>n?-1:0)}function Vn(n){if(isNaN(n)||!isFinite(n))return Ds;if(0>n)return ft(Vn(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Af;return new Ae(e,0)}function eT(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return ft(eT(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Vn(Math.pow(e,8)),r=Ds,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),a=parseInt(n.substring(i,i+s),e);8>s?(s=Vn(Math.pow(e,s)),r=r.R(s).add(Vn(a))):(r=r.R(t),r=r.add(Vn(a)))}return r}var Af=4294967296,Ds=Gp(0),Rf=Gp(1),Iv=Gp(16777216);q=Ae.prototype;q.ea=function(){if(un(this))return-ft(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Af+r)*e,e*=Af}return n};q.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(rr(this))return"0";if(un(this))return"-"+ft(this).toString(n);for(var e=Vn(Math.pow(n,6)),t=this,r="";;){var i=Yc(t,e).g;t=Qc(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,rr(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};q.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function rr(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function un(n){return n.h==-1}q.X=function(n){return n=Qc(this,n),un(n)?-1:rr(n)?0:1};function ft(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new Ae(t,~n.h).add(Rf)}q.abs=function(){return un(this)?ft(this):this};q.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),a=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=a>>>16,s&=65535,a&=65535,t[i]=a<<16|s}return new Ae(t,t[t.length-1]&-2147483648?-1:0)};function Qc(n,e){return n.add(ft(e))}q.R=function(n){if(rr(this)||rr(n))return Ds;if(un(this))return un(n)?ft(this).R(ft(n)):ft(ft(this).R(n));if(un(n))return ft(this.R(ft(n)));if(0>this.X(Iv)&&0>n.X(Iv))return Vn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,a=this.D(r)&65535,l=n.D(i)>>>16,h=n.D(i)&65535;t[2*r+2*i]+=a*h,_c(t,2*r+2*i),t[2*r+2*i+1]+=s*h,_c(t,2*r+2*i+1),t[2*r+2*i+1]+=a*l,_c(t,2*r+2*i+1),t[2*r+2*i+2]+=s*l,_c(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new Ae(t,0)};function _c(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function $o(n,e){this.g=n,this.h=e}function Yc(n,e){if(rr(e))throw Error("division by zero");if(rr(n))return new $o(Ds,Ds);if(un(n))return e=Yc(ft(n),e),new $o(ft(e.g),ft(e.h));if(un(e))return e=Yc(n,ft(e)),new $o(ft(e.g),e.h);if(30<n.g.length){if(un(n)||un(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Rf,r=e;0>=r.X(n);)t=wv(t),r=wv(r);var i=ps(t,1),s=ps(r,1);for(r=ps(r,2),t=ps(t,2);!rr(r);){var a=s.add(r);0>=a.X(n)&&(i=i.add(t),s=a),r=ps(r,1),t=ps(t,1)}return e=Qc(n,i.R(e)),new $o(i,e)}for(i=Ds;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Vn(t),a=s.R(e);un(a)||0<a.X(n);)t-=r,s=Vn(t),a=s.R(e);rr(s)&&(s=Rf),i=i.add(s),n=Qc(n,a)}return new $o(i,n)}q.gb=function(n){return Yc(this,n).h};q.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new Ae(t,this.h&n.h)};q.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new Ae(t,this.h|n.h)};q.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new Ae(t,this.h^n.h)};function wv(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new Ae(t,n.h)}function ps(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new Ae(i,n.h)}jc.prototype.createWebChannel=jc.prototype.g;Jt.prototype.send=Jt.prototype.u;Jt.prototype.open=Jt.prototype.m;Jt.prototype.close=Jt.prototype.close;Nl.NO_ERROR=0;Nl.TIMEOUT=8;Nl.HTTP_ERROR=6;_E.COMPLETE="complete";yE.EventType=nu;nu.OPEN="a";nu.CLOSE="b";nu.ERROR="c";nu.MESSAGE="d";ot.prototype.listen=ot.prototype.O;$e.prototype.listenOnce=$e.prototype.P;$e.prototype.getLastError=$e.prototype.Sa;$e.prototype.getLastErrorCode=$e.prototype.Ia;$e.prototype.getStatus=$e.prototype.da;$e.prototype.getResponseJson=$e.prototype.Wa;$e.prototype.getResponseText=$e.prototype.ja;$e.prototype.send=$e.prototype.ha;$e.prototype.setWithCredentials=$e.prototype.Oa;vn.prototype.digest=vn.prototype.l;vn.prototype.reset=vn.prototype.reset;vn.prototype.update=vn.prototype.j;Ae.prototype.add=Ae.prototype.add;Ae.prototype.multiply=Ae.prototype.R;Ae.prototype.modulo=Ae.prototype.gb;Ae.prototype.compare=Ae.prototype.X;Ae.prototype.toNumber=Ae.prototype.ea;Ae.prototype.toString=Ae.prototype.toString;Ae.prototype.getBits=Ae.prototype.D;Ae.fromNumber=Vn;Ae.fromString=eT;var SF=function(){return new jc},bF=function(){return xl()},jd=Nl,PF=_E,CF=Gi,Ev={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},yc=yE,DF=$e,kF=vn,ks=Ae;const Tv="@firebase/firestore";class it{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}it.UNAUTHENTICATED=new it(null),it.GOOGLE_CREDENTIALS=new it("google-credentials-uid"),it.FIRST_PARTY=new it("first-party-uid"),it.MOCK_USER=new it("mock-user");let ro="10.7.0";const Br=new gl("@firebase/firestore");function vs(){return Br.logLevel}function xF(n){Br.setLogLevel(n)}function N(n,...e){if(Br.logLevel<=ce.DEBUG){const t=e.map(zp);Br.debug(`Firestore (${ro}): ${n}`,...t)}}function je(n,...e){if(Br.logLevel<=ce.ERROR){const t=e.map(zp);Br.error(`Firestore (${ro}): ${n}`,...t)}}function In(n,...e){if(Br.logLevel<=ce.WARN){const t=e.map(zp);Br.warn(`Firestore (${ro}): ${n}`,...t)}}function zp(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function $(n="Unexpected state"){const e=`FIRESTORE (${ro}) INTERNAL ASSERTION FAILED: `+n;throw je(e),new Error(e)}function z(n,e){n||$()}function NF(n,e){n||$()}function B(n,e){return n}const b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class k extends Dt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class st{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class tT{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class VF{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(it.UNAUTHENTICATED))}shutdown(){}}class OF{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class LF{constructor(e){this.t=e,this.currentUser=it.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i;const i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let s=new st;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new st,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const h=s;e.enqueueRetryable(async()=>{await h.promise,await i(this.currentUser)})},l=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new st)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(z(typeof r.accessToken=="string"),new tT(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return z(e===null||typeof e=="string"),new it(e)}}class MF{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=it.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class FF{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new MF(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(it.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class UF{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class BF{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{s.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(z(typeof t.token=="string"),this.R=t.token,new UF(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function qF(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class nT{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=qF(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function ne(n,e){return n<e?-1:n>e?1:0}function Fs(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function rT(n){return n+"\0"}class Oe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new k(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new k(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new k(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new k(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Oe.fromMillis(Date.now())}static fromDate(e){return Oe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Oe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ne(this.nanoseconds,e.nanoseconds):ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class K{constructor(e){this.timestamp=e}static fromTimestamp(e){return new K(e)}static min(){return new K(new Oe(0,0))}static max(){return new K(new Oe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ka{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(),r===void 0?r=e.length-t:r>e.length-t&&$(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return ka.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof ka?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ge extends ka{construct(e,t,r){return new ge(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new k(b.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new ge(t)}static emptyPath(){return new ge([])}}const $F=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ne extends ka{construct(e,t,r){return new Ne(e,t,r)}static isValidIdentifier(e){return $F.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ne.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Ne(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new k(b.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new k(b.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new k(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else l==="`"?(a=!a,i++):l!=="."||a?(r+=l,i++):(s(),i++)}if(s(),a)throw new k(b.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ne(t)}static emptyPath(){return new Ne([])}}class F{constructor(e){this.path=e}static fromPath(e){return new F(ge.fromString(e))}static fromName(e){return new F(ge.fromString(e).popFirst(5))}static empty(){return new F(ge.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ge.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ge.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new F(new ge(e.slice()))}}class Jc{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Sf(n){return n.fields.find(e=>e.kind===2)}function gi(n){return n.fields.filter(e=>e.kind!==2)}Jc.UNKNOWN_ID=-1;class Pc{constructor(e,t){this.fieldPath=e,this.kind=t}}class xa{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new xa(0,Xt.min())}}function iT(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=K.fromTimestamp(r===1e9?new Oe(t+1,0):new Oe(t,r));return new Xt(i,F.empty(),e)}function sT(n){return new Xt(n.readTime,n.key,-1)}class Xt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new Xt(K.min(),F.empty(),-1)}static max(){return new Xt(K.max(),F.empty(),-1)}}function Kp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(n.documentKey,e.documentKey),t!==0?t:ne(n.largestBatchId,e.largestBatchId))}const oT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class aT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function Zr(n){if(n.code!==b.FAILED_PRECONDITION||n.message!==oT)throw n;N("LocalStore","Unexpectedly lost primary lease")}class R{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new R((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof R?t:R.resolve(t)}catch(t){return R.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):R.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):R.reject(t)}static resolve(e){return new R((t,r)=>{t(e)})}static reject(e){return new R((t,r)=>{r(e)})}static waitFor(e){return new R((t,r)=>{let i=0,s=0,a=!1;e.forEach(l=>{++i,l.next(()=>{++s,a&&s===i&&t()},h=>r(h))}),a=!0,s===i&&t()})}static or(e){let t=R.resolve(!1);for(const r of e)t=t.next(i=>i?R.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new R((r,i)=>{const s=e.length,a=new Array(s);let l=0;for(let h=0;h<s;h++){const f=h;t(e[f]).next(p=>{a[f]=p,++l,l===s&&r(a)},p=>i(p))}})}static doWhile(e,t){return new R((r,i)=>{const s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}}class $l{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new st,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new ua(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=Hp(r.target.error);this.V.reject(new ua(e,i))}}static open(e,t,r,i){try{return new $l(t,e.transaction(i,r))}catch(s){throw new ua(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(N("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new GF(t)}}class _n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,_n.S(Fe())===12.2&&je("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N("SimpleDb","Removing database:",e),mi(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!pa())return!1;if(_n.C())return!0;const e=Fe(),t=_n.S(e),r=0<t&&t<10,i=_n.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}async O(e){return this.db||(N("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{const a=s.target.result;t(a)},i.onblocked=()=>{r(new ua(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{const a=s.target.error;a.name==="VersionError"?r(new k(b.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new k(b.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new ua(e,a))},i.onupgradeneeded=s=>{N("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const a=s.target.result;this.p.N(a,i.transaction,s.oldVersion,this.version).next(()=>{N("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,i){const s=t==="readonly";let a=0;for(;;){++a;try{this.db=await this.O(e);const l=$l.open(this.db,e,s?"readonly":"readwrite",r),h=i(l).next(f=>(l.g(),f)).catch(f=>(l.abort(f),R.reject(f))).toPromise();return h.catch(()=>{}),await l.m,h}catch(l){const h=l,f=h.name!=="FirebaseError"&&a<3;if(N("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),this.close(),!f)return Promise.reject(h)}}}close(){this.db&&this.db.close(),this.db=void 0}}class WF{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return mi(this.k.delete())}}class ua extends k{constructor(e,t){super(b.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ei(n){return n.name==="IndexedDbTransactionError"}class GF{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(N("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),mi(r)}add(e){return N("SimpleDb","ADD",this.store.name,e,e),mi(this.store.add(e))}get(e){return mi(this.store.get(e)).next(t=>(t===void 0&&(t=null),N("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return N("SimpleDb","DELETE",this.store.name,e),mi(this.store.delete(e))}count(){return N("SimpleDb","COUNT",this.store.name),mi(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||typeof this.store.getAll!="function"){const i=this.cursor(r),s=[];return this.G(i,(a,l)=>{s.push(l)}).next(()=>s)}{const i=this.store.getAll(r.range);return new R((s,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{s(l.target.result)}})}}j(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new R((i,s)=>{r.onerror=a=>{s(a.target.error)},r.onsuccess=a=>{i(a.target.result)}})}H(e,t){N("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,a,l)=>l.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new R((r,i)=>{t.onerror=s=>{const a=Hp(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(l=>{l?a.continue():r()}):r()}})}G(e,t){const r=[];return new R((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const l=a.target.result;if(!l)return void i();const h=new WF(l),f=t(l.primaryKey,l.value,h);if(f instanceof R){const p=f.catch(m=>(h.done(),R.reject(m)));r.push(p)}h.isDone?i():h.$===null?l.continue():l.continue(h.$)}}).next(()=>R.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function mi(n){return new R((e,t)=>{n.onsuccess=r=>{const i=r.target.result;e(i)},n.onerror=r=>{const i=Hp(r.target.error);t(i)}})}let Av=!1;function Hp(n){const e=_n.S(Fe());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new k("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Av||(Av=!0,setTimeout(()=>{throw r},0)),r}}return n}class zF{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(e){N("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{N("IndexBackiller",`Documents written: ${await this.X.te()}`)}catch(t){ei(t)?N("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await Zr(t)}await this.ee(6e4)})}}class KF{constructor(e,t){this.localStore=e,this.persistence=t}async te(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ne(t,e))}ne(e,t){const r=new Set;let i=t,s=!0;return R.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return N("IndexBackiller",`Processing collection: ${a}`),this.re(e,a,i).next(l=>{i-=l,r.add(a)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.ie(i,s)).next(l=>(N("IndexBackiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>a.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{const a=sT(s);Kp(a,r)>0&&(r=a)}),new Xt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Bt{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.se(r),this.oe=r=>t.writeSequenceNumber(r))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}Bt._e=-1;function au(n){return n==null}function Na(n){return n===0&&1/n==-1/0}function uT(n){return typeof n=="number"&&Number.isInteger(n)&&!Na(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function kt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Rv(e)),e=HF(n.get(t),e);return Rv(e)}function HF(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Rv(n){return n+""}function On(n){const e=n.length;if(z(e>=2),e===2)return z(n.charAt(0)===""&&n.charAt(1)===""),ge.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const a=n.indexOf("",s);switch((a<0||a>t)&&$(),n.charAt(a+1)){case"":const l=n.substring(s,a);let h;i.length===0?h=l:(i+=l,h=i,i=""),r.push(h);break;case"":i+=n.substring(s,a),i+="\0";break;case"":i+=n.substring(s,a+1);break;default:$()}s=a+2}return new ge(r)}const Sv=["userId","batchId"];function Cc(n,e){return[n,kt(e)]}function cT(n,e,t){return[n,kt(e),t]}const jF={},QF=["prefixPath","collectionGroup","readTime","documentId"],YF=["prefixPath","collectionGroup","documentId"],JF=["collectionGroup","readTime","prefixPath","documentId"],XF=["canonicalId","targetId"],ZF=["targetId","path"],e2=["path","targetId"],t2=["collectionId","parent"],n2=["indexId","uid"],r2=["uid","sequenceNumber"],i2=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],s2=["indexId","uid","orderedDocumentKey"],o2=["userId","collectionPath","documentId"],a2=["userId","collectionPath","largestBatchId"],u2=["userId","collectionGroup","largestBatchId"],lT=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],c2=[...lT,"documentOverlays"],hT=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],dT=hT,l2=[...dT,"indexConfiguration","indexState","indexEntries"];class bf extends aT{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function ut(n,e){const t=B(n);return _n.M(t.ae,e)}function bv(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function zi(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function fT(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Pe{constructor(e,t){this.comparator=e,this.root=t||dt.EMPTY}insert(e,t){return new Pe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,dt.BLACK,null,null))}remove(e){return new Pe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,dt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new vc(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new vc(this.root,e,this.comparator,!1)}getReverseIterator(){return new vc(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new vc(this.root,e,this.comparator,!0)}}class vc{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class dt{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??dt.RED,this.left=i??dt.EMPTY,this.right=s??dt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new dt(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return dt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return dt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,dt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,dt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw $();const e=this.left.check();if(e!==this.right.check())throw $();return e+(this.isRed()?0:1)}}dt.EMPTY=null,dt.RED=!0,dt.BLACK=!1;dt.EMPTY=new class{constructor(){this.size=0}get key(){throw $()}get value(){throw $()}get color(){throw $()}get left(){throw $()}get right(){throw $()}copy(e,t,r,i,s){return this}insert(e,t,r){return new dt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Re{constructor(e){this.comparator=e,this.data=new Pe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Pv(this.data.getIterator())}getIteratorFrom(e){return new Pv(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Re)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Re(this.comparator);return t.data=e,t}}class Pv{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function gs(n){return n.hasNext()?n.getNext():void 0}class qt{constructor(e){this.fields=e,e.sort(Ne.comparator)}static empty(){return new qt([])}unionWith(e){let t=new Re(Ne.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new qt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Fs(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class pT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function h2(){return typeof atob<"u"}class tt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new pT("Invalid base64 string: "+s):s}}(e);return new tt(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new tt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}tt.EMPTY_BYTE_STRING=new tt("");const d2=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qr(n){if(z(!!n),typeof n=="string"){let e=0;const t=d2.exec(n);if(z(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Be(n.seconds),nanos:Be(n.nanos)}}function Be(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function $r(n){return typeof n=="string"?tt.fromBase64String(n):tt.fromUint8Array(n)}function Wl(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function jp(n){const e=n.mapValue.fields.__previous_value__;return Wl(e)?jp(e):e}function Va(n){const e=qr(n.mapValue.fields.__local_write_time__.timestampValue);return new Oe(e.seconds,e.nanos)}class f2{constructor(e,t,r,i,s,a,l,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f}}class Wr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Wr("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Wr&&e.projectId===this.projectId&&e.database===this.database}}const Vr={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Dc={nullValue:"NULL_VALUE"};function Ni(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Wl(n)?4:gT(n)?9007199254740991:10:$()}function Wn(n,e){if(n===e)return!0;const t=Ni(n);if(t!==Ni(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Va(n).isEqual(Va(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=qr(i.timestampValue),l=qr(s.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return $r(i.bytesValue).isEqual($r(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return Be(i.geoPointValue.latitude)===Be(s.geoPointValue.latitude)&&Be(i.geoPointValue.longitude)===Be(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return Be(i.integerValue)===Be(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=Be(i.doubleValue),l=Be(s.doubleValue);return a===l?Na(a)===Na(l):isNaN(a)&&isNaN(l)}return!1}(n,e);case 9:return Fs(n.arrayValue.values||[],e.arrayValue.values||[],Wn);case 10:return function(i,s){const a=i.mapValue.fields||{},l=s.mapValue.fields||{};if(bv(a)!==bv(l))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!Wn(a[h],l[h])))return!1;return!0}(n,e);default:return $()}}function Oa(n,e){return(n.values||[]).find(t=>Wn(t,e))!==void 0}function Gr(n,e){if(n===e)return 0;const t=Ni(n),r=Ni(e);if(t!==r)return ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ne(n.booleanValue,e.booleanValue);case 2:return function(s,a){const l=Be(s.integerValue||s.doubleValue),h=Be(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1}(n,e);case 3:return Cv(n.timestampValue,e.timestampValue);case 4:return Cv(Va(n),Va(e));case 5:return ne(n.stringValue,e.stringValue);case 6:return function(s,a){const l=$r(s),h=$r(a);return l.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){const l=s.split("/"),h=a.split("/");for(let f=0;f<l.length&&f<h.length;f++){const p=ne(l[f],h[f]);if(p!==0)return p}return ne(l.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){const l=ne(Be(s.latitude),Be(a.latitude));return l!==0?l:ne(Be(s.longitude),Be(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,a){const l=s.values||[],h=a.values||[];for(let f=0;f<l.length&&f<h.length;++f){const p=Gr(l[f],h[f]);if(p)return p}return ne(l.length,h.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===Vr.mapValue&&a===Vr.mapValue)return 0;if(s===Vr.mapValue)return 1;if(a===Vr.mapValue)return-1;const l=s.fields||{},h=Object.keys(l),f=a.fields||{},p=Object.keys(f);h.sort(),p.sort();for(let m=0;m<h.length&&m<p.length;++m){const I=ne(h[m],p[m]);if(I!==0)return I;const A=Gr(l[h[m]],f[p[m]]);if(A!==0)return A}return ne(h.length,p.length)}(n.mapValue,e.mapValue);default:throw $()}}function Cv(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ne(n,e);const t=qr(n),r=qr(e),i=ne(t.seconds,r.seconds);return i!==0?i:ne(t.nanos,r.nanos)}function Us(n){return Pf(n)}function Pf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=qr(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return $r(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return F.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=Pf(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${Pf(t.fields[a])}`;return i+"}"}(n.mapValue):$()}function Vi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Cf(n){return!!n&&"integerValue"in n}function La(n){return!!n&&"arrayValue"in n}function Dv(n){return!!n&&"nullValue"in n}function kv(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function kc(n){return!!n&&"mapValue"in n}function ca(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return zi(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ca(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ca(n.arrayValue.values[t]);return e}return Object.assign({},n)}function gT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function p2(n){return"nullValue"in n?Dc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Vi(Wr.empty(),F.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:$()}function g2(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Vi(Wr.empty(),F.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Vr:$()}function xv(n,e){const t=Gr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Nv(n,e){const t=Gr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class pt{constructor(e){this.value=e}static empty(){return new pt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!kc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ca(t)}setAll(e){let t=Ne.emptyPath(),r={},i=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){const h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=l.popLast()}a?r[l.lastSegment()]=ca(a):i.push(l.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());kc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Wn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];kc(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){zi(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new pt(ca(this.value))}}function mT(n){const e=[];return zi(n.fields,(t,r)=>{const i=new Ne([t]);if(kc(r)){const s=mT(r.mapValue).fields;if(s.length===0)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new qt(e)}class ke{constructor(e,t,r,i,s,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=l}static newInvalidDocument(e){return new ke(e,0,K.min(),K.min(),K.min(),pt.empty(),0)}static newFoundDocument(e,t,r,i){return new ke(e,1,t,K.min(),r,i,0)}static newNoDocument(e,t){return new ke(e,2,t,K.min(),K.min(),pt.empty(),0)}static newUnknownDocument(e,t){return new ke(e,3,t,K.min(),K.min(),pt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=pt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=pt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ke&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ke(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zr{constructor(e,t){this.position=e,this.inclusive=t}}function Vv(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],a=n.position[i];if(s.field.isKeyField()?r=F.comparator(F.fromName(a.referenceValue),t.key):r=Gr(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ov(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Wn(n.position[t],e.position[t]))return!1;return!0}class Ma{constructor(e,t="asc"){this.field=e,this.dir=t}}function m2(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class _T{}class he extends _T{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new _2(e,t,r):t==="array-contains"?new I2(e,r):t==="in"?new TT(e,r):t==="not-in"?new w2(e,r):t==="array-contains-any"?new E2(e,r):new he(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new y2(e,r):new v2(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Gr(t,this.value)):t!==null&&Ni(this.value)===Ni(t)&&this.matchesComparison(Gr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Te extends _T{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new Te(e,t)}matches(e){return Bs(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Bs(n){return n.op==="and"}function Df(n){return n.op==="or"}function Qp(n){return yT(n)&&Bs(n)}function yT(n){for(const e of n.filters)if(e instanceof Te)return!1;return!0}function kf(n){if(n instanceof he)return n.field.canonicalString()+n.op.toString()+Us(n.value);if(Qp(n))return n.filters.map(e=>kf(e)).join(",");{const e=n.filters.map(t=>kf(t)).join(",");return`${n.op}(${e})`}}function vT(n,e){return n instanceof he?function(r,i){return i instanceof he&&r.op===i.op&&r.field.isEqual(i.field)&&Wn(r.value,i.value)}(n,e):n instanceof Te?function(r,i){return i instanceof Te&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,l)=>s&&vT(a,i.filters[l]),!0):!1}(n,e):void $()}function IT(n,e){const t=n.filters.concat(e);return Te.create(t,n.op)}function wT(n){return n instanceof he?function(t){return`${t.field.canonicalString()} ${t.op} ${Us(t.value)}`}(n):n instanceof Te?function(t){return t.op.toString()+" {"+t.getFilters().map(wT).join(" ,")+"}"}(n):"Filter"}class _2 extends he{constructor(e,t,r){super(e,t,r),this.key=F.fromName(r.referenceValue)}matches(e){const t=F.comparator(e.key,this.key);return this.matchesComparison(t)}}class y2 extends he{constructor(e,t){super(e,"in",t),this.keys=ET("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class v2 extends he{constructor(e,t){super(e,"not-in",t),this.keys=ET("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ET(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>F.fromName(r.referenceValue))}class I2 extends he{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return La(t)&&Oa(t.arrayValue,this.value)}}class TT extends he{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Oa(this.value.arrayValue,t)}}class w2 extends he{constructor(e,t){super(e,"not-in",t)}matches(e){if(Oa(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Oa(this.value.arrayValue,t)}}class E2 extends he{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!La(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Oa(this.value.arrayValue,r))}}class T2{constructor(e,t=null,r=[],i=[],s=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=l,this.ce=null}}function xf(n,e=null,t=[],r=[],i=null,s=null,a=null){return new T2(n,e,t,r,i,s,a)}function Oi(n){const e=B(n);if(e.ce===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>kf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),au(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Us(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Us(r)).join(",")),e.ce=t}return e.ce}function uu(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!m2(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!vT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Ov(n.startAt,e.startAt)&&Ov(n.endAt,e.endAt)}function Xc(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Zc(n,e){return n.filters.filter(t=>t instanceof he&&t.field.isEqual(e))}function Lv(n,e,t){let r=Dc,i=!0;for(const s of Zc(n,e)){let a=Dc,l=!0;switch(s.op){case"<":case"<=":a=p2(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,l=!1;break;case"!=":case"not-in":a=Dc}xv({value:r,inclusive:i},{value:a,inclusive:l})<0&&(r=a,i=l)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];xv({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function Mv(n,e,t){let r=Vr,i=!0;for(const s of Zc(n,e)){let a=Vr,l=!0;switch(s.op){case">=":case">":a=g2(s.value),l=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,l=!1;break;case"!=":case"not-in":a=Vr}Nv({value:r,inclusive:i},{value:a,inclusive:l})>0&&(r=a,i=l)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];Nv({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}class fr{constructor(e,t=null,r=[],i=[],s=null,a="F",l=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=l,this.endAt=h,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function AT(n,e,t,r,i,s,a,l){return new fr(n,e,t,r,i,s,a,l)}function io(n){return new fr(n)}function Fv(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Yp(n){return n.collectionGroup!==null}function xs(n){const e=B(n);if(e.le===null){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new Re(Ne.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new Ma(s,r))}),t.has(Ne.keyField().canonicalString())||e.le.push(new Ma(Ne.keyField(),r))}return e.le}function xt(n){const e=B(n);return e.he||(e.he=A2(e,xs(n))),e.he}function A2(n,e){if(n.limitType==="F")return xf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new Ma(i.field,s)});const t=n.endAt?new zr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new zr(n.startAt.position,n.startAt.inclusive):null;return xf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Nf(n,e){const t=n.filters.concat([e]);return new fr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function el(n,e,t){return new fr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function cu(n,e){return uu(xt(n),xt(e))&&n.limitType===e.limitType}function RT(n){return`${Oi(xt(n))}|lt:${n.limitType}`}function Is(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>wT(i)).join(", ")}]`),au(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>Us(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>Us(i)).join(",")),`Target(${r})`}(xt(n))}; limitType=${n.limitType})`}function lu(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):F.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of xs(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,l,h){const f=Vv(a,l,h);return a.inclusive?f<=0:f<0}(r.startAt,xs(r),i)||r.endAt&&!function(a,l,h){const f=Vv(a,l,h);return a.inclusive?f>=0:f>0}(r.endAt,xs(r),i))}(n,e)}function ST(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function bT(n){return(e,t)=>{let r=!1;for(const i of xs(n)){const s=R2(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function R2(n,e,t){const r=n.field.isKeyField()?F.comparator(e.key,t.key):function(s,a,l){const h=a.data.field(s),f=l.data.field(s);return h!==null&&f!==null?Gr(h,f):$()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $()}}class ti{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){zi(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return fT(this.inner)}size(){return this.innerSize}}const S2=new Pe(F.comparator);function $t(){return S2}const PT=new Pe(F.comparator);function ta(...n){let e=PT;for(const t of n)e=e.insert(t.key,t);return e}function CT(n){let e=PT;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Ln(){return la()}function DT(){return la()}function la(){return new ti(n=>n.toString(),(n,e)=>n.isEqual(e))}const b2=new Pe(F.comparator),P2=new Re(F.comparator);function re(...n){let e=P2;for(const t of n)e=e.add(t);return e}const C2=new Re(ne);function Jp(){return C2}function kT(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Na(e)?"-0":e}}function xT(n){return{integerValue:""+n}}function NT(n,e){return uT(e)?xT(e):kT(n,e)}class Gl{constructor(){this._=void 0}}function D2(n,e,t){return n instanceof qs?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Wl(s)&&(s=jp(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):n instanceof Li?OT(n,e):n instanceof Mi?LT(n,e):function(i,s){const a=VT(i,s),l=Uv(a)+Uv(i.Ie);return Cf(a)&&Cf(i.Ie)?xT(l):kT(i.serializer,l)}(n,e)}function k2(n,e,t){return n instanceof Li?OT(n,e):n instanceof Mi?LT(n,e):t}function VT(n,e){return n instanceof $s?function(r){return Cf(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class qs extends Gl{}class Li extends Gl{constructor(e){super(),this.elements=e}}function OT(n,e){const t=MT(e);for(const r of n.elements)t.some(i=>Wn(i,r))||t.push(r);return{arrayValue:{values:t}}}class Mi extends Gl{constructor(e){super(),this.elements=e}}function LT(n,e){let t=MT(e);for(const r of n.elements)t=t.filter(i=>!Wn(i,r));return{arrayValue:{values:t}}}class $s extends Gl{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Uv(n){return Be(n.integerValue||n.doubleValue)}function MT(n){return La(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class hu{constructor(e,t){this.field=e,this.transform=t}}function x2(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Li&&i instanceof Li||r instanceof Mi&&i instanceof Mi?Fs(r.elements,i.elements,Wn):r instanceof $s&&i instanceof $s?Wn(r.Ie,i.Ie):r instanceof qs&&i instanceof qs}(n.transform,e.transform)}class N2{constructor(e,t){this.version=e,this.transformResults=t}}class Ve{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ve}static exists(e){return new Ve(void 0,e)}static updateTime(e){return new Ve(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function xc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class zl{}function FT(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new oo(n.key,Ve.none()):new so(n.key,n.data,Ve.none());{const t=n.data,r=pt.empty();let i=new Re(Ne.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new pr(n.key,r,new qt(i.toArray()),Ve.none())}}function V2(n,e,t){n instanceof so?function(i,s,a){const l=i.value.clone(),h=qv(i.fieldTransforms,s,a.transformResults);l.setAll(h),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):n instanceof pr?function(i,s,a){if(!xc(i.precondition,s))return void s.convertToUnknownDocument(a.version);const l=qv(i.fieldTransforms,s,a.transformResults),h=s.data;h.setAll(UT(i)),h.setAll(l),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function ha(n,e,t,r){return n instanceof so?function(s,a,l,h){if(!xc(s.precondition,a))return l;const f=s.value.clone(),p=$v(s.fieldTransforms,h,a);return f.setAll(p),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof pr?function(s,a,l,h){if(!xc(s.precondition,a))return l;const f=$v(s.fieldTransforms,h,a),p=a.data;return p.setAll(UT(s)),p.setAll(f),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(s,a,l){return xc(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,e,t)}function O2(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=VT(r.transform,i||null);s!=null&&(t===null&&(t=pt.empty()),t.set(r.field,s))}return t||null}function Bv(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Fs(r,i,(s,a)=>x2(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class so extends zl{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class pr extends zl{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function UT(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function qv(n,e,t){const r=new Map;z(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],a=s.transform,l=e.data.field(s.field);r.set(s.field,k2(a,l,t[i]))}return r}function $v(n,e,t){const r=new Map;for(const i of n){const s=i.transform,a=t.data.field(i.field);r.set(i.field,D2(s,a,e))}return r}class oo extends zl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Xp extends zl{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Zp{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&V2(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=ha(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=ha(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=DT();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let l=this.applyToLocalView(a,s.mutatedFields);l=t.has(i.key)?null:l;const h=FT(a,l);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(K.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),re())}isEqual(e){return this.batchId===e.batchId&&Fs(this.mutations,e.mutations,(t,r)=>Bv(t,r))&&Fs(this.baseMutations,e.baseMutations,(t,r)=>Bv(t,r))}}class eg{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){z(e.mutations.length===r.length);let i=function(){return b2}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new eg(e,t,r,i)}}class tg{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class L2{constructor(e,t){this.count=e,this.unchangedNames=t}}var Ye,pe;function BT(n){switch(n){default:return $();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0}}function qT(n){if(n===void 0)return je("GRPC error has no .code"),b.UNKNOWN;switch(n){case Ye.OK:return b.OK;case Ye.CANCELLED:return b.CANCELLED;case Ye.UNKNOWN:return b.UNKNOWN;case Ye.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case Ye.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case Ye.INTERNAL:return b.INTERNAL;case Ye.UNAVAILABLE:return b.UNAVAILABLE;case Ye.UNAUTHENTICATED:return b.UNAUTHENTICATED;case Ye.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case Ye.NOT_FOUND:return b.NOT_FOUND;case Ye.ALREADY_EXISTS:return b.ALREADY_EXISTS;case Ye.PERMISSION_DENIED:return b.PERMISSION_DENIED;case Ye.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case Ye.ABORTED:return b.ABORTED;case Ye.OUT_OF_RANGE:return b.OUT_OF_RANGE;case Ye.UNIMPLEMENTED:return b.UNIMPLEMENTED;case Ye.DATA_LOSS:return b.DATA_LOSS;default:return $()}}(pe=Ye||(Ye={}))[pe.OK=0]="OK",pe[pe.CANCELLED=1]="CANCELLED",pe[pe.UNKNOWN=2]="UNKNOWN",pe[pe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",pe[pe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",pe[pe.NOT_FOUND=5]="NOT_FOUND",pe[pe.ALREADY_EXISTS=6]="ALREADY_EXISTS",pe[pe.PERMISSION_DENIED=7]="PERMISSION_DENIED",pe[pe.UNAUTHENTICATED=16]="UNAUTHENTICATED",pe[pe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",pe[pe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",pe[pe.ABORTED=10]="ABORTED",pe[pe.OUT_OF_RANGE=11]="OUT_OF_RANGE",pe[pe.UNIMPLEMENTED=12]="UNIMPLEMENTED",pe[pe.INTERNAL=13]="INTERNAL",pe[pe.UNAVAILABLE=14]="UNAVAILABLE",pe[pe.DATA_LOSS=15]="DATA_LOSS";function $T(){return new TextEncoder}const M2=new ks([4294967295,4294967295],0);function Wv(n){const e=$T().encode(n),t=new kF;return t.update(e),new Uint8Array(t.digest())}function Gv(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new ks([t,r],0),new ks([i,s],0)]}class ng{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new na(`Invalid padding: ${t}`);if(r<0)throw new na(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new na(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new na(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=ks.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(ks.fromNumber(r)));return i.compare(M2)===1&&(i=new ks([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const t=Wv(e),[r,i]=Gv(t);for(let s=0;s<this.hashCount;s++){const a=this.de(r,i,s);if(!this.Ae(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new ng(s,i,t);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.Te===0)return;const t=Wv(e),[r,i]=Gv(t);for(let s=0;s<this.hashCount;s++){const a=this.de(r,i,s);this.Re(a)}}Re(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class na extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class du{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,fu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new du(K.min(),i,new Pe(ne),$t(),re())}}class fu{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new fu(r,t,re(),re(),re())}}class Nc{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class WT{constructor(e,t){this.targetId=e,this.fe=t}}class GT{constructor(e,t,r=tt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class zv{constructor(){this.ge=0,this.pe=Hv(),this.ye=tt.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=re(),t=re(),r=re();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:$()}}),new fu(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=Hv()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,z(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class F2{constructor(e){this.Le=e,this.ke=new Map,this.qe=$t(),this.Qe=Kv(),this.Ke=new Pe(ne)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:$()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(Xc(s))if(r===0){const a=new F(s.path);this.We(t,a,ke.newNoDocument(a,K.min()))}else z(r===1);else{const a=this.Ze(t);if(a!==r){const l=this.Xe(e),h=l?this.et(l,e,a):1;if(h!==0){this.He(t);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,f)}}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let a,l;try{a=$r(r).toUint8Array()}catch(h){if(h instanceof pT)return In("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new ng(a,i,s)}catch(h){return In(h instanceof na?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.Te===0?null:l}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const a=this.Le.nt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,a)=>{const l=this.Ye(a);if(l){if(s.current&&Xc(l.target)){const h=new F(l.target.path);this.qe.get(h)!==null||this.st(a,h)||this.We(a,h,ke.newNoDocument(h,e))}s.De&&(t.set(a,s.ve()),s.Fe())}});let r=re();this.Qe.forEach((s,a)=>{let l=!0;a.forEachWhile(h=>{const f=this.Ye(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(s))}),this.qe.forEach((s,a)=>a.setReadTime(e));const i=new du(e,t,this.Ke,this.qe,r);return this.qe=$t(),this.Qe=Kv(),this.Ke=new Pe(ne),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new zv,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new Re(ne),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=this.Ye(e)!==null;return t||N("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new zv),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function Kv(){return new Pe(F.comparator)}function Hv(){return new Pe(F.comparator)}const U2=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),B2=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),q2=(()=>({and:"AND",or:"OR"}))();class $2{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Vf(n,e){return n.useProto3Json||au(e)?e:{value:e}}function Ws(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function zT(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function W2(n,e){return Ws(n,e.toTimestamp())}function Qe(n){return z(!!n),K.fromTimestamp(function(t){const r=qr(t);return new Oe(r.seconds,r.nanos)}(n))}function rg(n,e){return function(r){return new ge(["projects",r.projectId,"databases",r.database])}(n).child("documents").child(e).canonicalString()}function KT(n){const e=ge.fromString(n);return z(tA(e)),e}function Fa(n,e){return rg(n.databaseId,e.path)}function Un(n,e){const t=KT(e);if(t.get(1)!==n.databaseId.projectId)throw new k(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new k(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(jT(t))}function Of(n,e){return rg(n.databaseId,e)}function HT(n){const e=KT(n);return e.length===4?ge.emptyPath():jT(e)}function Ua(n){return new ge(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function jT(n){return z(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function jv(n,e,t){return{name:Fa(n,e),fields:t.value.mapValue.fields}}function QT(n,e,t){const r=Un(n,e.name),i=Qe(e.updateTime),s=e.createTime?Qe(e.createTime):K.min(),a=new pt({mapValue:{fields:e.fields}}),l=ke.newFoundDocument(r,i,s,a);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function G2(n,e){return"found"in e?function(r,i){z(!!i.found),i.found.name,i.found.updateTime;const s=Un(r,i.found.name),a=Qe(i.found.updateTime),l=i.found.createTime?Qe(i.found.createTime):K.min(),h=new pt({mapValue:{fields:i.found.fields}});return ke.newFoundDocument(s,a,l,h)}(n,e):"missing"in e?function(r,i){z(!!i.missing),z(!!i.readTime);const s=Un(r,i.missing),a=Qe(i.readTime);return ke.newNoDocument(s,a)}(n,e):$()}function z2(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:$()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(f,p){return f.useProto3Json?(z(p===void 0||typeof p=="string"),tt.fromBase64String(p||"")):(z(p===void 0||p instanceof Uint8Array),tt.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(f){const p=f.code===void 0?b.UNKNOWN:qT(f.code);return new k(p,f.message||"")}(a);t=new GT(r,i,s,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Un(n,r.document.name),s=Qe(r.document.updateTime),a=r.document.createTime?Qe(r.document.createTime):K.min(),l=new pt({mapValue:{fields:r.document.fields}}),h=ke.newFoundDocument(i,s,a,l),f=r.targetIds||[],p=r.removedTargetIds||[];t=new Nc(f,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Un(n,r.document),s=r.readTime?Qe(r.readTime):K.min(),a=ke.newNoDocument(i,s),l=r.removedTargetIds||[];t=new Nc([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Un(n,r.document),s=r.removedTargetIds||[];t=new Nc([],s,i,null)}else{if(!("filter"in e))return $();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,a=new L2(i,s),l=r.targetId;t=new WT(l,a)}}return t}function Ba(n,e){let t;if(e instanceof so)t={update:jv(n,e.key,e.value)};else if(e instanceof oo)t={delete:Fa(n,e.key)};else if(e instanceof pr)t={update:jv(n,e.key,e.data),updateMask:J2(e.fieldMask)};else{if(!(e instanceof Xp))return $();t={verify:Fa(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){const l=a.transform;if(l instanceof qs)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Li)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Mi)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof $s)return{fieldPath:a.field.canonicalString(),increment:l.Ie};throw $()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:W2(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:$()}(n,e.precondition)),t}function Lf(n,e){const t=e.currentDocument?function(s){return s.updateTime!==void 0?Ve.updateTime(Qe(s.updateTime)):s.exists!==void 0?Ve.exists(s.exists):Ve.none()}(e.currentDocument):Ve.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(a,l){let h=null;if("setToServerValue"in l)z(l.setToServerValue==="REQUEST_TIME"),h=new qs;else if("appendMissingElements"in l){const p=l.appendMissingElements.values||[];h=new Li(p)}else if("removeAllFromArray"in l){const p=l.removeAllFromArray.values||[];h=new Mi(p)}else"increment"in l?h=new $s(a,l.increment):$();const f=Ne.fromServerFormat(l.fieldPath);return new hu(f,h)}(n,i)):[];if(e.update){e.update.name;const i=Un(n,e.update.name),s=new pt({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(h){const f=h.fieldPaths||[];return new qt(f.map(p=>Ne.fromServerFormat(p)))}(e.updateMask);return new pr(i,s,a,t,r)}return new so(i,s,t,r)}if(e.delete){const i=Un(n,e.delete);return new oo(i,t)}if(e.verify){const i=Un(n,e.verify);return new Xp(i,t)}return $()}function K2(n,e){return n&&n.length>0?(z(e!==void 0),n.map(t=>function(i,s){let a=i.updateTime?Qe(i.updateTime):Qe(s);return a.isEqual(K.min())&&(a=Qe(s)),new N2(a,i.transformResults||[])}(t,e))):[]}function YT(n,e){return{documents:[Of(n,e.path)]}}function JT(n,e){const t={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(t.parent=Of(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Of(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(h){if(h.length!==0)return eA(Te.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(h){if(h.length!==0)return h.map(f=>function(m){return{field:ws(m.field),direction:j2(m.dir)}}(f))}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const a=Vf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),t}function XT(n){let e=HT(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){z(r===1);const p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let s=[];t.where&&(s=function(m){const I=ZT(m);return I instanceof Te&&Qp(I)?I.getFilters():[I]}(t.where));let a=[];t.orderBy&&(a=function(m){return m.map(I=>function(L){return new Ma(Es(L.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(I))}(t.orderBy));let l=null;t.limit&&(l=function(m){let I;return I=typeof m=="object"?m.value:m,au(I)?null:I}(t.limit));let h=null;t.startAt&&(h=function(m){const I=!!m.before,A=m.values||[];return new zr(A,I)}(t.startAt));let f=null;return t.endAt&&(f=function(m){const I=!m.before,A=m.values||[];return new zr(A,I)}(t.endAt)),AT(e,i,a,s,l,"F",h,f)}function H2(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ZT(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Es(t.unaryFilter.field);return he.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Es(t.unaryFilter.field);return he.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Es(t.unaryFilter.field);return he.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Es(t.unaryFilter.field);return he.create(a,"!=",{nullValue:"NULL_VALUE"});default:return $()}}(n):n.fieldFilter!==void 0?function(t){return he.create(Es(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return $()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Te.create(t.compositeFilter.filters.map(r=>ZT(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return $()}}(t.compositeFilter.op))}(n):$()}function j2(n){return U2[n]}function Q2(n){return B2[n]}function Y2(n){return q2[n]}function ws(n){return{fieldPath:n.canonicalString()}}function Es(n){return Ne.fromServerFormat(n.fieldPath)}function eA(n){return n instanceof he?function(t){if(t.op==="=="){if(kv(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NAN"}};if(Dv(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(kv(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NOT_NAN"}};if(Dv(t.value))return{unaryFilter:{field:ws(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ws(t.field),op:Q2(t.op),value:t.value}}}(n):n instanceof Te?function(t){const r=t.getFilters().map(i=>eA(i));return r.length===1?r[0]:{compositeFilter:{op:Y2(t.op),filters:r}}}(n):$()}function J2(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function tA(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class ir{constructor(e,t,r,i,s=K.min(),a=K.min(),l=tt.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(e){return new ir(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new ir(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new ir(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new ir(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class nA{constructor(e){this.ut=e}}function X2(n,e){let t;if(e.document)t=QT(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=F.fromSegments(e.noDocument.path),i=Ui(e.noDocument.readTime);t=ke.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return $();{const r=F.fromSegments(e.unknownDocument.path),i=Ui(e.unknownDocument.version);t=ke.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new Oe(i[0],i[1]);return K.fromTimestamp(s)}(e.readTime)),t}function Qv(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:tl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,a){return{name:Fa(s,a.key),fields:a.data.value.mapValue.fields,updateTime:Ws(s,a.version.toTimestamp()),createTime:Ws(s,a.createTime.toTimestamp())}}(n.ut,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Fi(e.version)};else{if(!e.isUnknownDocument())return $();r.unknownDocument={path:t.path.toArray(),version:Fi(e.version)}}return r}function tl(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Fi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ui(n){const e=new Oe(n.seconds,n.nanoseconds);return K.fromTimestamp(e)}function _i(n,e){const t=(e.baseMutations||[]).map(s=>Lf(n.ut,s));for(let s=0;s<e.mutations.length-1;++s){const a=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const l=e.mutations[s+1];a.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(s=>Lf(n.ut,s)),i=Oe.fromMillis(e.localWriteTimeMs);return new Zp(e.batchId,i,t,r)}function ra(n){const e=Ui(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ui(n.lastLimboFreeSnapshotVersion):K.min();let r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return z(s.documents.length===1),xt(io(HT(s.documents[0])))}(n.query):function(s){return xt(XT(s))}(n.query),new ir(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,tt.fromBase64String(n.resumeToken))}function rA(n,e){const t=Fi(e.snapshotVersion),r=Fi(e.lastLimboFreeSnapshotVersion);let i;i=Xc(e.target)?YT(n.ut,e.target):JT(n.ut,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Oi(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function ig(n){const e=XT({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?el(e,e.limit,"L"):e}function Qd(n,e){return new tg(e.largestBatchId,Lf(n.ut,e.overlayMutation))}function Yv(n,e){const t=e.path.lastSegment();return[n,kt(e.path.popLast()),t]}function Jv(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Fi(r.readTime),documentKey:kt(r.documentKey.path),largestBatchId:r.largestBatchId}}class Z2{getBundleMetadata(e,t){return Xv(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Ui(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return Xv(e).put(function(i){return{bundleId:i.id,createTime:Fi(Qe(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return Zv(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:ig(s.bundledQuery),readTime:Ui(s.readTime)}}(r)})}saveNamedQuery(e,t){return Zv(e).put(function(i){return{name:i.name,readTime:Fi(Qe(i.readTime)),bundledQuery:i.bundledQuery}}(t))}}function Xv(n){return ut(n,"bundles")}function Zv(n){return ut(n,"namedQueries")}class Kl{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){const r=t.uid||"";return new Kl(e,r)}getOverlay(e,t){return Wo(e).get(Yv(this.userId,t)).next(r=>r?Qd(this.serializer,r):null)}getOverlays(e,t){const r=Ln();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,a)=>{const l=new tg(t,a);i.push(this.lt(e,l))}),R.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(a=>i.add(kt(a.getCollectionPath())));const s=[];return i.forEach(a=>{const l=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);s.push(Wo(e).H("collectionPathOverlayIndex",l))}),R.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Ln(),s=kt(t),a=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Wo(e).W("collectionPathOverlayIndex",a).next(l=>{for(const h of l){const f=Qd(this.serializer,h);i.set(f.getKey(),f)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=Ln();let a;const l=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Wo(e).Y({index:"collectionGroupOverlayIndex",range:l},(h,f,p)=>{const m=Qd(this.serializer,f);s.size()<i||m.largestBatchId===a?(s.set(m.getKey(),m),a=m.largestBatchId):p.done()}).next(()=>s)}lt(e,t){return Wo(e).put(function(i,s,a){const[l,h,f]=Yv(s,a.mutation.key);return{userId:s,collectionPath:h,documentId:f,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:Ba(i.ut,a.mutation)}}(this.serializer,this.userId,t))}}function Wo(n){return ut(n,"documentOverlays")}class yi{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(Be(e.integerValue));else if("doubleValue"in e){const r=Be(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),Na(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Tt(t,20),typeof r=="string"?t.dt(r):(t.dt(`${r.seconds||""}`),t.Et(r.nanos||0))}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt($r(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?gT(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):$()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),F.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}yi.St=new yi;function eU(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function eI(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const a=eU(255&r[s]);if(i+=a,a!==8)break}return i}(n);return Math.ceil(e/8)}class tU{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Bt(e),r=eI(t);this.Lt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Bt(e),r=eI(t);this.Lt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Lt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;t===0?(this.Qt(0),this.Qt(255)):t===255?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;t===0?(this.$t(0),this.$t(255)):t===255?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Lt(1),this.buffer[this.position++]=e}$t(e){this.Lt(1),this.buffer[this.position++]=~e}Lt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class nU{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class rU{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class Go{constructor(){this.Wt=new tU,this.Gt=new nU(this.Wt),this.zt=new rU(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return e===0?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class vi{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new vi(this.indexId,this.documentKey,this.arrayValue,r)}}function br(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=tI(n.arrayValue,e.arrayValue),t!==0?t:(t=tI(n.directionalValue,e.directionalValue),t!==0?t:F.comparator(n.documentKey,e.documentKey)))}function tI(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}class nI{constructor(e){this.Jt=new Re((t,r)=>Ne.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(z(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=Sf(e);if(t!==void 0&&!this.tn(t))return!1;const r=gi(e);let i=new Set,s=0,a=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const l=this.Jt.getIterator().getNext();if(!i.has(l.field.canonicalString())){const h=r[s];if(!this.nn(l,h)||!this.rn(this.Yt[a++],h))return!1}++s}for(;s<r.length;++s){const l=r[s];if(a>=this.Yt.length||!this.rn(this.Yt[a++],l))return!1}return!0}sn(){if(this.Xt)return null;let e=new Re(Ne.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Pc(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Pc(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Pc(r.field,r.dir==="asc"?0:1)));return new Jc(Jc.UNKNOWN_ID,this.collectionId,t,xa.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function iA(n){var e,t;if(z(n instanceof he||n instanceof Te),n instanceof he){if(n instanceof TT){const i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>he.create(n.field,"==",s)))||[];return Te.create(i,"or")}return n}const r=n.filters.map(i=>iA(i));return Te.create(r,n.op)}function iU(n){if(n.getFilters().length===0)return[];const e=Uf(iA(n));return z(sA(e)),Mf(e)||Ff(e)?[e]:e.getFilters()}function Mf(n){return n instanceof he}function Ff(n){return n instanceof Te&&Qp(n)}function sA(n){return Mf(n)||Ff(n)||function(t){if(t instanceof Te&&Df(t)){for(const r of t.getFilters())if(!Mf(r)&&!Ff(r))return!1;return!0}return!1}(n)}function Uf(n){if(z(n instanceof he||n instanceof Te),n instanceof he)return n;if(n.filters.length===1)return Uf(n.filters[0]);const e=n.filters.map(r=>Uf(r));let t=Te.create(e,n.op);return t=nl(t),sA(t)?t:(z(t instanceof Te),z(Bs(t)),z(t.filters.length>1),t.filters.reduce((r,i)=>sg(r,i)))}function sg(n,e){let t;return z(n instanceof he||n instanceof Te),z(e instanceof he||e instanceof Te),t=n instanceof he?e instanceof he?function(i,s){return Te.create([i,s],"and")}(n,e):rI(n,e):e instanceof he?rI(e,n):function(i,s){if(z(i.filters.length>0&&s.filters.length>0),Bs(i)&&Bs(s))return IT(i,s.getFilters());const a=Df(i)?i:s,l=Df(i)?s:i,h=a.filters.map(f=>sg(f,l));return Te.create(h,"or")}(n,e),nl(t)}function rI(n,e){if(Bs(e))return IT(e,n.getFilters());{const t=e.filters.map(r=>sg(n,r));return Te.create(t,"or")}}function nl(n){if(z(n instanceof he||n instanceof Te),n instanceof he)return n;const e=n.getFilters();if(e.length===1)return nl(e[0]);if(yT(n))return n;const t=e.map(i=>nl(i)),r=[];return t.forEach(i=>{i instanceof he?r.push(i):i instanceof Te&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Te.create(r,n.op)}class sU{constructor(){this.on=new og}addToCollectionParentIndex(e,t){return this.on.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(Xt.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(Xt.min())}updateCollectionGroup(e,t,r){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}}class og{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Re(ge.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Re(ge.comparator)).toArray()}}const Ic=new Uint8Array(0);class oU{constructor(e,t){this.user=e,this.databaseId=t,this._n=new og,this.an=new ti(r=>Oi(r),(r,i)=>uu(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:kt(i)};return iI(e).put(s)}return R.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[rT(t),""],!1,!0);return iI(e).W(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;r.push(On(a.parent))}return r})}addFieldIndex(e,t){const r=zo(e),i=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(h=>[h.fieldPath.canonicalString(),h.kind])}}(t);delete i.indexId;const s=r.add(i);if(t.indexState){const a=_s(e);return s.next(l=>{a.put(Jv(l,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=zo(e),i=_s(e),s=ms(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=zo(e),r=ms(e),i=_s(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return R.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){const s=new nI(r).sn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=ms(e);let i=!0;const s=new Map;return R.forEach(this.un(t),a=>this.cn(e,a).next(l=>{i&&(i=!!l),s.set(a,l)})).next(()=>{if(i){let a=re();const l=[];return R.forEach(s,(h,f)=>{N("IndexedDbIndexManager",`Using index ${function(j){return`id=${j.indexId}|cg=${j.collectionGroup}|f=${j.fields.map(ye=>`${ye.fieldPath}:${ye.kind}`).join(",")}`}(h)} to execute ${Oi(t)}`);const p=function(j,ye){const de=Sf(ye);if(de===void 0)return null;for(const me of Zc(j,de.fieldPath))switch(me.op){case"array-contains-any":return me.value.arrayValue.values||[];case"array-contains":return[me.value]}return null}(f,h),m=function(j,ye){const de=new Map;for(const me of gi(ye))for(const we of Zc(j,me.fieldPath))switch(we.op){case"==":case"in":de.set(me.fieldPath.canonicalString(),we.value);break;case"not-in":case"!=":return de.set(me.fieldPath.canonicalString(),we.value),Array.from(de.values())}return null}(f,h),I=function(j,ye){const de=[];let me=!0;for(const we of gi(ye)){const Nt=we.kind===0?Lv(j,we.fieldPath,j.startAt):Mv(j,we.fieldPath,j.startAt);de.push(Nt.value),me&&(me=Nt.inclusive)}return new zr(de,me)}(f,h),A=function(j,ye){const de=[];let me=!0;for(const we of gi(ye)){const Nt=we.kind===0?Mv(j,we.fieldPath,j.endAt):Lv(j,we.fieldPath,j.endAt);de.push(Nt.value),me&&(me=Nt.inclusive)}return new zr(de,me)}(f,h),L=this.ln(h,f,I),M=this.ln(h,f,A),V=this.hn(h,f,m),Y=this.Pn(h.indexId,p,L,I.inclusive,M,A.inclusive,V);return R.forEach(Y,ae=>r.j(ae,t.limit).next(j=>{j.forEach(ye=>{const de=F.fromSegments(ye.documentKey);a.has(de)||(a=a.add(de),l.push(de))})}))}).next(()=>l)}return R.resolve(null)})}un(e){let t=this.an.get(e);return t||(e.filters.length===0?t=[e]:t=iU(Te.create(e.filters,"and")).map(r=>xf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,a,l){const h=(t!=null?t.length:1)*Math.max(r.length,s.length),f=h/(t!=null?t.length:1),p=[];for(let m=0;m<h;++m){const I=t?this.In(t[m/f]):Ic,A=this.Tn(e,I,r[m%f],i),L=this.En(e,I,s[m%f],a),M=l.map(V=>this.Tn(e,I,V,!0));p.push(...this.createRange(A,L,M))}return p}Tn(e,t,r,i){const s=new vi(e,F.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new vi(e,F.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new nI(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const l of s)r.en(l)&&(!a||l.fields.length>a.fields.length)&&(a=l);return a})}getIndexType(e,t){let r=2;const i=this.un(t);return R.forEach(i,s=>this.cn(e,s).next(a=>{a?r!==0&&a.fields.length<function(h){let f=new Re(Ne.comparator),p=!1;for(const m of h.filters)for(const I of m.getFlattenedFilters())I.field.isKeyField()||(I.op==="array-contains"||I.op==="array-contains-any"?p=!0:f=f.add(I.field));for(const m of h.orderBy)m.field.isKeyField()||(f=f.add(m.field));return f.size+(p?1:0)}(s)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(t)&&i.length>1&&r===2?1:r)}dn(e,t){const r=new Go;for(const i of gi(e)){const s=t.data.field(i.fieldPath);if(s==null)return null;const a=r.jt(i.kind);yi.St.ht(s,a)}return r.Ut()}In(e){const t=new Go;return yi.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new Go;return yi.St.ht(Vi(this.databaseId,t),r.jt(function(s){const a=gi(s);return a.length===0?0:a[a.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(r===null)return[];let i=[];i.push(new Go);let s=0;for(const a of gi(e)){const l=r[s++];for(const h of i)if(this.Rn(t,a.fieldPath)&&La(l))i=this.Vn(i,a,l);else{const f=h.jt(a.kind);yi.St.ht(l,f)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const a of r.arrayValue.values||[])for(const l of i){const h=new Go;h.seed(l.Ut()),yi.St.ht(a,h.jt(t.kind)),s.push(h)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof he&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=zo(e),i=_s(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const a=[];return R.forEach(s,l=>i.get([l.indexId,this.uid]).next(h=>{a.push(function(p,m){const I=m?new xa(m.sequenceNumber,new Xt(Ui(m.readTime),new F(On(m.documentKey)),m.largestBatchId)):xa.empty(),A=p.fields.map(([L,M])=>new Pc(Ne.fromServerFormat(L),M));return new Jc(p.indexId,p.collectionGroup,A,I)}(l,h))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ne(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=zo(e),s=_s(e);return this.fn(e).next(a=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>R.forEach(l,h=>s.put(Jv(h.indexId,this.user,a,r)))))}updateIndexEntries(e,t){const r=new Map;return R.forEach(t,(i,s)=>{const a=r.get(i.collectionGroup);return(a?R.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),R.forEach(l,h=>this.gn(e,i,h).next(f=>{const p=this.pn(s,h);return f.isEqual(p)?R.resolve():this.yn(e,s,h,f,p)}))))})}wn(e,t,r,i){return ms(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return ms(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=ms(e);let s=new Re(br);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(a,l)=>{s=s.add(new vi(r.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>s)}pn(e,t){let r=new Re(br);const i=this.dn(t,e);if(i==null)return r;const s=Sf(t);if(s!=null){const a=e.data.field(s.fieldPath);if(La(a))for(const l of a.arrayValue.values||[])r=r.add(new vi(t.indexId,e.key,this.In(l),i))}else r=r.add(new vi(t.indexId,e.key,Ic,i));return r}yn(e,t,r,i,s){N("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(h,f,p,m,I){const A=h.getIterator(),L=f.getIterator();let M=gs(A),V=gs(L);for(;M||V;){let Y=!1,ae=!1;if(M&&V){const j=p(M,V);j<0?ae=!0:j>0&&(Y=!0)}else M!=null?ae=!0:Y=!0;Y?(m(V),V=gs(L)):ae?(I(M),M=gs(A)):(M=gs(A),V=gs(L))}}(i,s,br,l=>{a.push(this.wn(e,t,r,l))},l=>{a.push(this.Sn(e,t,r,l))}),R.waitFor(a)}fn(e){let t=1;return _s(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((a,l)=>br(a,l)).filter((a,l,h)=>!l||br(a,h[l-1])!==0);const i=[];i.push(e);for(const a of r){const l=br(a,e),h=br(a,t);if(l===0)i[0]=e.Ht();else if(l>0&&h<0)i.push(a),i.push(a.Ht());else if(h>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.bn(i[a],i[a+1]))return[];const l=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Ic,[]],h=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Ic,[]];s.push(IDBKeyRange.bound(l,h))}return s}bn(e,t){return br(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sI)}getMinOffset(e,t){return R.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||$())).next(sI)}}function iI(n){return ut(n,"collectionParents")}function ms(n){return ut(n,"indexEntries")}function zo(n){return ut(n,"indexConfiguration")}function _s(n){return ut(n,"indexState")}function sI(n){z(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Kp(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new Xt(e.readTime,e.documentKey,t)}const oI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Ut{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Ut(e,Ut.DEFAULT_COLLECTION_PERCENTILE,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function oA(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let l=0;const h=r.Y({range:a},(p,m,I)=>(l++,I.delete()));s.push(h.next(()=>{z(l===1)}));const f=[];for(const p of t.mutations){const m=cT(e,p.key.path,t.batchId);s.push(i.delete(m)),f.push(p.key)}return R.waitFor(s).next(()=>f)}function rl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw $();e=n.noDocument}return JSON.stringify(e).length}Ut.DEFAULT_COLLECTION_PERCENTILE=10,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ut.DEFAULT=new Ut(41943040,Ut.DEFAULT_COLLECTION_PERCENTILE,Ut.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ut.DISABLED=new Ut(-1,0,0);class Hl{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){z(e.uid!=="");const s=e.isAuthenticated()?e.uid:"";return new Hl(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Pr(e).Y({index:"userMutationsIndex",range:r},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Ts(e),a=Pr(e);return a.add({}).next(l=>{z(typeof l=="number");const h=new Zp(l,t,r,i),f=function(A,L,M){const V=M.baseMutations.map(ae=>Ba(A.ut,ae)),Y=M.mutations.map(ae=>Ba(A.ut,ae));return{userId:L,batchId:M.batchId,localWriteTimeMs:M.localWriteTime.toMillis(),baseMutations:V,mutations:Y}}(this.serializer,this.userId,h),p=[];let m=new Re((I,A)=>ne(I.canonicalString(),A.canonicalString()));for(const I of i){const A=cT(this.userId,I.key.path,l);m=m.add(I.key.path.popLast()),p.push(a.put(f)),p.push(s.put(A,jF))}return m.forEach(I=>{p.push(this.indexManager.addToCollectionParentIndex(e,I))}),e.addOnCommittedListener(()=>{this.Dn[l]=h.keys()}),R.waitFor(p).next(()=>h)})}lookupMutationBatch(e,t){return Pr(e).get(t).next(r=>r?(z(r.userId===this.userId),_i(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?R.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Pr(e).Y({index:"userMutationsIndex",range:i},(a,l,h)=>{l.userId===this.userId&&(z(l.batchId>=r),s=_i(this.serializer,l)),h.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Pr(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{r=s.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Pr(e).W("userMutationsIndex",t).next(r=>r.map(i=>_i(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Cc(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Ts(e).Y({range:i},(a,l,h)=>{const[f,p,m]=a,I=On(p);if(f===this.userId&&t.path.isEqual(I))return Pr(e).get(m).next(A=>{if(!A)throw $();z(A.userId===this.userId),s.push(_i(this.serializer,A))});h.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Re(ne);const i=[];return t.forEach(s=>{const a=Cc(this.userId,s.path),l=IDBKeyRange.lowerBound(a),h=Ts(e).Y({range:l},(f,p,m)=>{const[I,A,L]=f,M=On(A);I===this.userId&&s.path.isEqual(M)?r=r.add(L):m.done()});i.push(h)}),R.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Cc(this.userId,r),a=IDBKeyRange.lowerBound(s);let l=new Re(ne);return Ts(e).Y({range:a},(h,f,p)=>{const[m,I,A]=h,L=On(I);m===this.userId&&r.isPrefixOf(L)?L.length===i&&(l=l.add(A)):p.done()}).next(()=>this.vn(e,l))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Pr(e).get(s).next(a=>{if(a===null)throw $();z(a.userId===this.userId),r.push(_i(this.serializer,a))}))}),R.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return oA(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),R.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return Ts(e).Y({range:r},(s,a,l)=>{if(s[0]===this.userId){const h=On(s[1]);i.push(h)}else l.done()}).next(()=>{z(i.length===0)})})}containsKey(e,t){return aA(e,this.userId,t)}Mn(e){return uA(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function aA(n,e,t){const r=Cc(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let a=!1;return Ts(n).Y({range:s,J:!0},(l,h,f)=>{const[p,m,I]=l;p===e&&m===i&&(a=!0),f.done()}).next(()=>a)}function Pr(n){return ut(n,"mutations")}function Ts(n){return ut(n,"documentMutations")}function uA(n){return ut(n,"mutationQueues")}class Bi{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new Bi(0)}static Nn(){return new Bi(-1)}}class aU{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const r=new Bi(t.highestTargetId);return t.highestTargetId=r.next(),this.Ln(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>K.fromTimestamp(new Oe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Ln(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Ln(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>ys(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(z(r.targetCount>0),r.targetCount-=1,this.Ln(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return ys(e).Y((a,l)=>{const h=ra(l);h.sequenceNumber<=t&&r.get(h.targetId)===null&&(i++,s.push(this.removeTargetData(e,h)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(e,t){return ys(e).Y((r,i)=>{const s=ra(i);t(s)})}Bn(e){return aI(e).get("targetGlobalKey").next(t=>(z(t!==null),t))}Ln(e,t){return aI(e).put("targetGlobalKey",t)}kn(e,t){return ys(e).put(rA(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Oi(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return ys(e).Y({range:i,index:"queryTargetsIndex"},(a,l,h)=>{const f=ra(l);uu(t,f.target)&&(s=f,h.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Dr(e);return t.forEach(a=>{const l=kt(a.path);i.push(s.put({targetId:r,path:l})),i.push(this.referenceDelegate.addReference(e,r,a))}),R.waitFor(i)}removeMatchingKeys(e,t,r){const i=Dr(e);return R.forEach(t,s=>{const a=kt(s.path);return R.waitFor([i.delete([r,a]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Dr(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Dr(e);let s=re();return i.Y({range:r,J:!0},(a,l,h)=>{const f=On(a[1]),p=new F(f);s=s.add(p)}).next(()=>s)}containsKey(e,t){const r=kt(t.path),i=IDBKeyRange.bound([r],[rT(r)],!1,!0);let s=0;return Dr(e).Y({index:"documentTargetsIndex",J:!0,range:i},([a,l],h,f)=>{a!==0&&(s++,f.done())}).next(()=>s>0)}_t(e,t){return ys(e).get(t).next(r=>r?ra(r):null)}}function ys(n){return ut(n,"targets")}function aI(n){return ut(n,"targetGlobal")}function Dr(n){return ut(n,"targetDocuments")}function uI([n,e],[t,r]){const i=ne(n,t);return i===0?ne(e,r):i}class uU{constructor(e){this.Qn=e,this.buffer=new Re(uI),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();uI(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class cU{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return this.Wn!==null}Gn(e){N("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Wn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ei(t)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Zr(t)}await this.Gn(3e5)})}}class lU{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return R.resolve(Bt._e);const r=new uU(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(N("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(oI)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),oI):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,a,l,h,f;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,a=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,l=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(f=Date.now(),vs()<=ce.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(l-a)+`ms
	Removed ${s} targets in `+(h-l)+`ms
	Removed ${m} documents in `+(f-h)+`ms
Total Duration: ${f-p}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}}function hU(n,e){return new lU(n,e)}class dU{constructor(e,t){this.db=e,this.garbageCollector=hU(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return wc(e,r)}removeReference(e,t,r){return wc(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return wc(e,t)}Xn(e,t){return function(i,s){let a=!1;return uA(i).Z(l=>aA(i,l,s).next(h=>(h&&(a=!0),R.resolve(!h)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(a,l)=>{if(l<=t){const h=this.Xn(e,a).next(f=>{if(!f)return s++,r.getEntry(e,a).next(()=>(r.removeEntry(a,K.min()),Dr(e).delete(function(m){return[0,kt(m.path)]}(a))))});i.push(h)}}).next(()=>R.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return wc(e,t)}Zn(e,t){const r=Dr(e);let i,s=Bt._e;return r.Y({index:"documentTargetsIndex"},([a,l],{path:h,sequenceNumber:f})=>{a===0?(s!==Bt._e&&t(new F(On(i)),s),s=f,i=h):s=Bt._e}).next(()=>{s!==Bt._e&&t(new F(On(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function wc(n,e){return Dr(n).put(function(r,i){return{targetId:0,path:kt(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}class cA{constructor(){this.changes=new ti(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ke.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?R.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class fU{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return fi(e).put(r)}removeEntry(e,t,r){return fi(e).delete(function(s,a){const l=s.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],tl(a),l[l.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=ke.newInvalidDocument(t);return fi(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Ko(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:ke.newInvalidDocument(t)};return fi(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(Ko(t))},(i,s)=>{r={document:this.tr(t,s),size:rl(s)}}).next(()=>r)}getEntries(e,t){let r=$t();return this.rr(e,t,(i,s)=>{const a=this.tr(i,s);r=r.insert(i,a)}).next(()=>r)}ir(e,t){let r=$t(),i=new Pe(F.comparator);return this.rr(e,t,(s,a)=>{const l=this.tr(s,a);r=r.insert(s,l),i=i.insert(s,rl(a))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return R.resolve();let i=new Re(hI);t.forEach(h=>i=i.add(h));const s=IDBKeyRange.bound(Ko(i.first()),Ko(i.last())),a=i.getIterator();let l=a.getNext();return fi(e).Y({index:"documentKeyIndex",range:s},(h,f,p)=>{const m=F.fromSegments([...f.prefixPath,f.collectionGroup,f.documentId]);for(;l&&hI(l,m)<0;)r(l,null),l=a.getNext();l&&l.isEqual(m)&&(r(l,f),l=a.hasNext()?a.getNext():null),l?p.U(Ko(l)):p.done()}).next(()=>{for(;l;)r(l,null),l=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const a=t.path,l=[a.popLast().toArray(),a.lastSegment(),tl(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],h=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return fi(e).W(IDBKeyRange.bound(l,h,!0)).next(f=>{s==null||s.incrementDocumentReadCount(f.length);let p=$t();for(const m of f){const I=this.tr(F.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);I.isFoundDocument()&&(lu(t,I)||i.has(I.key))&&(p=p.insert(I.key,I))}return p})}getAllFromCollectionGroup(e,t,r,i){let s=$t();const a=lI(t,r),l=lI(t,Xt.max());return fi(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,l,!0)},(h,f,p)=>{const m=this.tr(F.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);s=s.insert(m.key,m),s.size===i&&p.done()}).next(()=>s)}newChangeBuffer(e){return new pU(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return cI(e).get("remoteDocumentGlobalKey").next(t=>(z(!!t),t))}er(e,t){return cI(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=X2(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(K.min())))return r}return ke.newInvalidDocument(e)}}function lA(n){return new fU(n)}class pU extends cA{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new ti(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new Re((s,a)=>ne(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const l=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,l.readTime)),a.isValidDocument()){const h=Qv(this._r.serializer,a);i=i.add(s.path.popLast());const f=rl(h);r+=f-l.size,t.push(this._r.addEntry(e,s,h))}else if(r-=l.size,this.trackRemovals){const h=Qv(this._r.serializer,a.convertToNoDocument(K.min()));t.push(this._r.addEntry(e,s,h))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),R.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,a)=>{this.ar.set(s,{size:a,readTime:r.get(s).readTime})}),r))}}function cI(n){return ut(n,"remoteDocumentGlobal")}function fi(n){return ut(n,"remoteDocumentsV14")}function Ko(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function lI(n,e){const t=e.documentKey.path.toArray();return[n,tl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function hI(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ne(t[s],r[s]),i)return i;return i=ne(t.length,r.length),i||(i=ne(t[t.length-2],r[r.length-2]),i||ne(t[t.length-1],r[r.length-1]))}class gU{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class hA{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&ha(r.mutation,i,qt.empty(),Oe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,re()).next(()=>r))}getLocalViewOfDocuments(e,t,r=re()){const i=Ln();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=ta();return s.forEach((l,h)=>{a=a.insert(l,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=Ln();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,re()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,r,i){let s=$t();const a=la(),l=function(){return la()}();return t.forEach((h,f)=>{const p=r.get(f.key);i.has(f.key)&&(p===void 0||p.mutation instanceof pr)?s=s.insert(f.key,f):p!==void 0?(a.set(f.key,p.mutation.getFieldMask()),ha(p.mutation,f,p.mutation.getFieldMask(),Oe.now())):a.set(f.key,qt.empty())}),this.recalculateAndSaveOverlays(e,s).next(h=>(h.forEach((f,p)=>a.set(f,p)),t.forEach((f,p)=>{var m;return l.set(f,new gU(p,(m=a.get(f))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,t){const r=la();let i=new Pe((a,l)=>a-l),s=re();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const l of a)l.keys().forEach(h=>{const f=t.get(h);if(f===null)return;let p=r.get(h)||qt.empty();p=l.applyToLocalView(f,p),r.set(h,p);const m=(i.get(l.batchId)||re()).add(h);i=i.insert(l.batchId,m)})}).next(()=>{const a=[],l=i.getReverseIterator();for(;l.hasNext();){const h=l.getNext(),f=h.key,p=h.value,m=DT();p.forEach(I=>{if(!s.has(I)){const A=FT(t.get(I),r.get(I));A!==null&&m.set(I,A),s=s.add(I)}}),a.push(this.documentOverlayCache.saveOverlays(e,f,m))}return R.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Yp(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):R.resolve(Ln());let l=-1,h=s;return a.next(f=>R.forEach(f,(p,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),s.get(p)?R.resolve():this.remoteDocumentCache.getEntry(e,p).next(I=>{h=h.insert(p,I)}))).next(()=>this.populateOverlays(e,f,s)).next(()=>this.computeViews(e,h,f,re())).next(p=>({batchId:l,changes:CT(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next(r=>{let i=ta();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let a=ta();return this.indexManager.getCollectionParents(e,s).next(l=>R.forEach(l,h=>{const f=function(m,I){return new fr(I,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,h.child(s));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next(p=>{p.forEach((m,I)=>{a=a.insert(m,I)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((h,f)=>{const p=f.getKey();a.get(p)===null&&(a=a.insert(p,ke.newInvalidDocument(p)))});let l=ta();return a.forEach((h,f)=>{const p=s.get(h);p!==void 0&&ha(p.mutation,f,qt.empty(),Oe.now()),lu(t,f)&&(l=l.insert(h,f))}),l})}}class mU{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return R.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Qe(i.createTime)}}(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,function(i){return{name:i.name,query:ig(i.bundledQuery),readTime:Qe(i.readTime)}}(t)),R.resolve()}}class _U{constructor(){this.overlays=new Pe(F.comparator),this.lr=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ln();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),R.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),R.resolve()}getOverlaysForCollection(e,t,r){const i=Ln(),s=t.length+1,a=new F(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const h=l.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===s&&h.largestBatchId>r&&i.set(h.getKey(),h)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Pe((f,p)=>f-p);const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let p=s.get(f.largestBatchId);p===null&&(p=Ln(),s=s.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}const l=Ln(),h=s.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,p)=>l.set(f,p)),!(l.size()>=i)););return R.resolve(l)}lt(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new tg(t,r));let s=this.lr.get(t);s===void 0&&(s=re(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class ag{constructor(){this.hr=new Re(rt.Pr),this.Ir=new Re(rt.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new rt(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new rt(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new F(new ge([])),r=new rt(t,e),i=new rt(t,e+1),s=[];return this.Ir.forEachInRange([r,i],a=>{this.dr(a),s.push(a.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new F(new ge([])),r=new rt(t,e),i=new rt(t,e+1);let s=re();return this.Ir.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new rt(e,0),r=this.hr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class rt{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return F.comparator(e.key,t.key)||ne(e.gr,t.gr)}static Tr(e,t){return ne(e.gr,t.gr)||F.comparator(e.key,t.key)}}class yU{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new Re(rt.Pr)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Zp(s,t,r,i);this.mutationQueue.push(a);for(const l of i)this.yr=this.yr.add(new rt(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return R.resolve(a)}lookupMutationBatch(e,t){return R.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.Sr(r),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new rt(t,0),i=new rt(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],a=>{const l=this.wr(a.gr);s.push(l)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Re(ne);return t.forEach(i=>{const s=new rt(i,0),a=new rt(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,a],l=>{r=r.add(l.gr)})}),R.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;F.isDocumentKey(s)||(s=s.child(""));const a=new rt(new F(s),0);let l=new Re(ne);return this.yr.forEachWhile(h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(l=l.add(h.gr)),!0)},a),R.resolve(this.br(l))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){z(this.Dr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return R.forEach(t.mutations,i=>{const s=new rt(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new rt(t,0),i=this.yr.firstAfterOrEqual(r);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class vU{constructor(e){this.Cr=e,this.docs=function(){return new Pe(F.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return R.resolve(r?r.document.mutableCopy():ke.newInvalidDocument(t))}getEntries(e,t){let r=$t();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():ke.newInvalidDocument(i))}),R.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=$t();const a=t.path,l=new F(a.child("")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){const{key:f,value:{document:p}}=h.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||Kp(sT(p),r)<=0||(i.has(p.key)||lu(t,p))&&(s=s.insert(p.key,p.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(e,t,r,i){$()}vr(e,t){return R.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new IU(this)}getSize(e){return R.resolve(this.size)}}class IU extends cA{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),R.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class wU{constructor(e){this.persistence=e,this.Fr=new ti(t=>Oi(t),uu),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.Mr=0,this.Or=new ag,this.targetCount=0,this.Nr=Bi.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),R.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new Bi(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.kn(t),R.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.Fr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return R.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),R.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),R.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),R.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return R.resolve(r)}containsKey(e,t){return R.resolve(this.Or.containsKey(t))}}class dA{constructor(e,t){this.Br={},this.overlays={},this.Lr=new Bt(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new wU(this),this.indexManager=new sU,this.remoteDocumentCache=function(i){return new vU(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new nA(t),this.Kr=new mU(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new _U,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new yU(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){N("MemoryPersistence","Starting transaction:",e);const i=new EU(this.Lr.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return R.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}}class EU extends aT{constructor(e){super(),this.currentSequenceNumber=e}}class jl{constructor(e){this.persistence=e,this.Gr=new ag,this.zr=null}static jr(e){return new jl(e)}get Hr(){if(this.zr)return this.zr;throw $()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),R.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),R.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Hr,r=>{const i=F.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,K.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return R.or([()=>R.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class TU{constructor(e){this.serializer=e}N(e,t,r,i){const s=new $l("createOrUpgrade",t);r<1&&i>=1&&(function(h){h.createObjectStore("owner")}(e),function(h){h.createObjectStore("mutationQueues",{keyPath:"userId"}),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Sv,{unique:!0}),h.createObjectStore("documentMutations")}(e),dI(e),function(h){h.createObjectStore("remoteDocuments")}(e));let a=R.resolve();return r<3&&i>=3&&(r!==0&&(function(h){h.deleteObjectStore("targetDocuments"),h.deleteObjectStore("targets"),h.deleteObjectStore("targetGlobal")}(e),dI(e)),a=a.next(()=>function(h){const f=h.store("targetGlobal"),p={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:K.min().toTimestamp(),targetCount:0};return f.put("targetGlobalKey",p)}(s))),r<4&&i>=4&&(r!==0&&(a=a.next(()=>function(h,f){return f.store("mutations").W().next(p=>{h.deleteObjectStore("mutations"),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Sv,{unique:!0});const m=f.store("mutations"),I=p.map(A=>m.put(A));return R.waitFor(I)})}(e,s))),a=a.next(()=>{(function(h){h.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(a=a.next(()=>this.Zr(s))),r<6&&i>=6&&(a=a.next(()=>(function(h){h.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(a=a.next(()=>this.ei(s))),r<8&&i>=8&&(a=a.next(()=>this.ti(e,s))),r<9&&i>=9&&(a=a.next(()=>{(function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(a=a.next(()=>this.ni(s))),r<11&&i>=11&&(a=a.next(()=>{(function(h){h.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(h){h.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(a=a.next(()=>{(function(h){const f=h.createObjectStore("documentOverlays",{keyPath:o2});f.createIndex("collectionPathOverlayIndex",a2,{unique:!1}),f.createIndex("collectionGroupOverlayIndex",u2,{unique:!1})})(e)})),r<13&&i>=13&&(a=a.next(()=>function(h){const f=h.createObjectStore("remoteDocumentsV14",{keyPath:QF});f.createIndex("documentKeyIndex",YF),f.createIndex("collectionGroupIndex",JF)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(a=a.next(()=>this.ii(e,s))),r<15&&i>=15&&(a=a.next(()=>function(h){h.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),h.createObjectStore("indexState",{keyPath:n2}).createIndex("sequenceNumberIndex",r2,{unique:!1}),h.createObjectStore("indexEntries",{keyPath:i2}).createIndex("documentKeyIndex",s2,{unique:!1})}(e))),a}Xr(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=rl(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>R.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",a).next(l=>R.forEach(l,h=>{z(h.userId===s.userId);const f=_i(this.serializer,h);return oA(e,s.userId,f).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Y((a,l)=>{const h=new ge(a),f=function(m){return[0,kt(m)]}(h);s.push(t.get(f).next(p=>p?R.resolve():(m=>t.put({targetId:0,path:kt(m),sequenceNumber:i.highestListenSequenceNumber}))(h)))}).next(()=>R.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:t2});const r=t.store("collectionParents"),i=new og,s=a=>{if(i.add(a)){const l=a.lastSegment(),h=a.popLast();return r.put({collectionId:l,parent:kt(h)})}};return t.store("remoteDocuments").Y({J:!0},(a,l)=>{const h=new ge(a);return s(h.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([a,l,h],f)=>{const p=On(l);return s(p.popLast())}))}ni(e){const t=e.store("targets");return t.Y((r,i)=>{const s=ra(i),a=rA(this.serializer,s);return t.put(a)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.Y((s,a)=>{const l=t.store("remoteDocumentsV14"),h=function(m){return m.document?new F(ge.fromString(m.document.name).popFirst(5)):m.noDocument?F.fromSegments(m.noDocument.path):m.unknownDocument?F.fromSegments(m.unknownDocument.path):$()}(a).path.toArray(),f={prefixPath:h.slice(0,h.length-2),collectionGroup:h[h.length-2],documentId:h[h.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(l.put(f))}).next(()=>R.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=lA(this.serializer),s=new dA(jl.jr,this.serializer.ut);return r.W().next(a=>{const l=new Map;return a.forEach(h=>{var f;let p=(f=l.get(h.userId))!==null&&f!==void 0?f:re();_i(this.serializer,h).keys().forEach(m=>p=p.add(m)),l.set(h.userId,p)}),R.forEach(l,(h,f)=>{const p=new it(f),m=Kl.ct(this.serializer,p),I=s.getIndexManager(p),A=Hl.ct(p,this.serializer,I,s.referenceDelegate);return new hA(i,A,m,I).recalculateAndSaveOverlaysForDocumentKeys(new bf(t,Bt._e),h).next()})})}}function dI(n){n.createObjectStore("targetDocuments",{keyPath:ZF}).createIndex("documentTargetsIndex",e2,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",XF,{unique:!0}),n.createObjectStore("targetGlobal")}const Yd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ug{constructor(e,t,r,i,s,a,l,h,f,p,m=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=a,this.document=l,this.oi=f,this._i=p,this.ai=m,this.Lr=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=I=>Promise.resolve(),!ug.D())throw new k(b.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new dU(this,i),this.Ii=t+"main",this.serializer=new nA(h),this.Ti=new _n(this.Ii,this.ai,new TU(this.serializer)),this.qr=new aU(this.referenceDelegate,this.serializer),this.remoteDocumentCache=lA(this.serializer),this.Kr=new Z2,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,p===!1&&je("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new k(b.FAILED_PRECONDITION,Yd);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Lr=new Bt(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){return this.Pi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget(async()=>{this.started&&await this.di()}))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Ec(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(ei(e))return N("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return Ho(e).get("owner").next(t=>R.resolve(this.wi(t)))}Si(e){return Ec(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=ut(t,"clientMetadata");return r.W().next(i=>{const s=this.Ci(i,18e5),a=i.filter(l=>s.indexOf(l)===-1);return R.forEach(a,l=>r.delete(l.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ei)for(const t of e)this.Ei.removeItem(this.vi(t.clientId))}}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?R.resolve(!0):Ho(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new k(b.FAILED_PRECONDITION,Yd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Ec(e).W().next(r=>this.Ci(r,5e3).find(i=>{if(this.clientId!==i.clientId){const s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,l=this.networkEnabled===i.networkEnabled;if(s||a&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&N("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),await this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new bf(e,Bt._e);return this.pi(t).next(()=>this.Si(t))}),this.Ti.close(),this.Ni()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Ec(e).W().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return Hl.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new oU(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return Kl.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){N("IndexedDbPersistence","Starting transaction:",e);const i=t==="readonly"?"readonly":"readwrite",s=function(h){return h===15?l2:h===14?dT:h===13?hT:h===12?c2:h===11?lT:void $()}(this.ai);let a;return this.Ti.runTransaction(e,i,s,l=>(a=new bf(l,this.Lr?this.Lr.next():Bt._e),t==="readwrite-primary"?this.fi(a).next(h=>!!h||this.gi(a)).next(h=>{if(!h)throw je(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new k(b.FAILED_PRECONDITION,oT);return r(a)}).next(h=>this.yi(a).next(()=>h)):this.Li(a).next(()=>r(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Li(e){return Ho(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new k(b.FAILED_PRECONDITION,Yd)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Ho(e).put("owner",t)}static D(){return _n.D()}pi(e){const t=Ho(e);return t.get("owner").next(r=>this.wi(r)?(N("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):R.resolve())}Di(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(je(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ai(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground=this.document.visibilityState==="visible")}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;Hk()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=((t=this.Ei)===null||t===void 0?void 0:t.getItem(this.vi(e)))!==null;return N("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return je("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){je("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Ho(n){return ut(n,"owner")}function Ec(n){return ut(n,"clientMetadata")}function cg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class lg{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=re(),i=re();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new lg(e,t.fromCache,r,i)}}class AU{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class fA{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new AU;return this.Hi(e,t,a).next(l=>{if(s.result=l,this.$i)return this.Ji(e,t,a,l.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(vs()<=ce.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Is(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),R.resolve()):(vs()<=ce.DEBUG&&N("QueryEngine","Query:",Is(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(vs()<=ce.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Is(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,xt(t))):R.resolve())}zi(e,t){if(Fv(t))return R.resolve(null);let r=xt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=el(t,null,"F"),r=xt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=re(...s);return this.Gi.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(h=>{const f=this.Yi(t,l);return this.Zi(t,f,a,h.readTime)?this.zi(e,el(t,null,"F")):this.Xi(e,f,t,h)}))})))}ji(e,t,r,i){return Fv(t)||i.isEqual(K.min())?R.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const a=this.Yi(t,s);return this.Zi(t,a,r,i)?R.resolve(null):(vs()<=ce.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Is(t)),this.Xi(e,a,t,iT(i,-1)).next(l=>l))})}Yi(e,t){let r=new Re(bT(e));return t.forEach((i,s)=>{lu(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return vs()<=ce.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Is(t)),this.Gi.getDocumentsMatchingQuery(e,t,Xt.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class RU{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new Pe(ne),this.ns=new ti(s=>Oi(s),uu),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new hA(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function pA(n,e,t,r){return new RU(n,e,t,r)}async function gA(n,e){const t=B(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],l=[];let h=re();for(const f of i){a.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}for(const f of s){l.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(f=>({_s:f,removedBatchIds:a,addedBatchIds:l}))})})}function SU(n,e){const t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(l,h,f,p){const m=f.batch,I=m.keys();let A=R.resolve();return I.forEach(L=>{A=A.next(()=>p.getEntry(h,L)).next(M=>{const V=f.docVersions.get(L);z(V!==null),M.version.compareTo(V)<0&&(m.applyToRemoteDocument(M,f),M.isValidDocument()&&(M.setReadTime(f.commitVersion),p.addEntry(M)))})}),A.next(()=>l.mutationQueue.removeMutationBatch(h,m))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let h=re();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function mA(n){const e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function bU(n,e){const t=B(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const l=[];e.targetChanges.forEach((p,m)=>{const I=i.get(m);if(!I)return;l.push(t.qr.removeMatchingKeys(s,p.removedDocuments,m).next(()=>t.qr.addMatchingKeys(s,p.addedDocuments,m)));let A=I.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?A=A.withResumeToken(tt.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):p.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(p.resumeToken,r)),i=i.insert(m,A),function(M,V,Y){return M.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-M.snapshotVersion.toMicroseconds()>=3e8?!0:Y.addedDocuments.size+Y.modifiedDocuments.size+Y.removedDocuments.size>0}(I,A,p)&&l.push(t.qr.updateTargetData(s,A))});let h=$t(),f=re();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,p))}),l.push(_A(s,a,e.documentUpdates).next(p=>{h=p.us,f=p.cs})),!r.isEqual(K.min())){const p=t.qr.getLastRemoteSnapshotVersion(s).next(m=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));l.push(p)}return R.waitFor(l).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,h,f)).next(()=>h)}).then(s=>(t.ts=i,s))}function _A(n,e,t){let r=re(),i=re();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=$t();return t.forEach((l,h)=>{const f=s.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(l)),h.isNoDocument()&&h.version.isEqual(K.min())?(e.removeEntry(l,h.readTime),a=a.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),a=a.insert(l,h)):N("LocalStore","Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)}),{us:a,cs:i}})}function PU(n,e){const t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Gs(n,e){const t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,R.resolve(i)):t.qr.allocateTargetId(r).next(a=>(i=new ir(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}async function zs(n,e,t){const r=B(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!ei(a))throw a;N("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}function il(n,e,t){const r=B(n);let i=K.min(),s=re();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,f,p){const m=B(h),I=m.ns.get(p);return I!==void 0?R.resolve(m.ts.get(I)):m.qr.getTargetData(f,p)}(r,a,xt(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(a,l.targetId).next(h=>{s=h})}).next(()=>r.es.getDocumentsMatchingQuery(a,e,t?i:K.min(),t?s:re())).next(l=>(IA(r,ST(e),l),{documents:l,ls:s})))}function yA(n,e){const t=B(n),r=B(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(a=>a?a.target:null))}function vA(n,e){const t=B(n),r=t.rs.get(e)||K.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,iT(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(IA(t,e,i),i))}function IA(n,e,t){let r=n.rs.get(e)||K.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}async function CU(n,e,t,r){const i=B(n);let s=re(),a=$t();for(const f of t){const p=e.hs(f.metadata.name);f.document&&(s=s.add(p));const m=e.Ps(f);m.setReadTime(e.Is(f.metadata.readTime)),a=a.insert(p,m)}const l=i.ss.newChangeBuffer({trackRemovals:!0}),h=await Gs(i,function(p){return xt(io(ge.fromString(`__bundle__/docs/${p}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",f=>_A(f,l,a).next(p=>(l.apply(f),p)).next(p=>i.qr.removeMatchingKeysForTargetId(f,h.targetId).next(()=>i.qr.addMatchingKeys(f,s,h.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(f,p.us,p.cs)).next(()=>p.us)))}async function DU(n,e,t=re()){const r=await Gs(n,xt(ig(e.bundledQuery))),i=B(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Qe(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return i.Kr.saveNamedQuery(s,e);const l=r.withResumeToken(tt.EMPTY_BYTE_STRING,a);return i.ts=i.ts.insert(l.targetId,l),i.qr.updateTargetData(s,l).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}function fI(n,e){return`firestore_clients_${n}_${e}`}function pI(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Jd(n,e){return`firestore_targets_${n}_${e}`}class sl{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new k(i.error.code,i.error.message))),a?new sl(e,t,i.state,s):(je("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class da{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new k(r.error.code,r.error.message))),s?new da(e,r.state,i):(je("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ol{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Jp();for(let a=0;i&&a<r.activeTargetIds.length;++a)i=uT(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new ol(e,s):(je("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class hg{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new hg(t.clientId,t.onlineState):(je("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Bf{constructor(){this.activeTargetIds=Jp()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Xd{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new Pe(ne),this.started=!1,this.ps=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=fI(this.persistenceKey,this.Rs),this.ws=function(h){return`firestore_sequence_number_${h}`}(this.persistenceKey),this.gs=this.gs.insert(this.Rs,new Bf),this.Ss=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.Cs=function(h){return`firestore_online_state_${h}`}(this.persistenceKey),this.vs=function(h){return`firestore_bundle_loaded_v2_${h}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Bi();for(const r of e){if(r===this.Rs)continue;const i=this.getItem(fI(this.persistenceKey,r));if(i){const s=ol.Ts(r,i);s&&(this.gs=this.gs.insert(s.clientId,s))}}this.Fs();const t=this.storage.getItem(this.Cs);if(t){const r=this.Ms(t);r&&this.xs(r)}for(const r of this.ps)this.fs(r);this.ps=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Jd(this.persistenceKey,e));if(r){const i=da.Ts(e,r);i&&(t=i.state)}}return this.Ls.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Ls.As(e),this.Fs()}isLocalQueryTarget(e){return this.Ls.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Jd(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return N("SharedClientState","READ",e,t),t}setItem(e,t){N("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){N("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){const t=e;if(t.storageArea===this.storage){if(N("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ys)return void je("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Ss.test(t.key)){if(t.newValue==null){const r=this.Ks(t.key);return this.$s(r,null)}{const r=this.Us(t.key,t.newValue);if(r)return this.$s(r.clientId,r)}}else if(this.bs.test(t.key)){if(t.newValue!==null){const r=this.Ws(t.key,t.newValue);if(r)return this.Gs(r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){const r=this.zs(t.key,t.newValue);if(r)return this.js(r)}}else if(t.key===this.Cs){if(t.newValue!==null){const r=this.Ms(t.newValue);if(r)return this.xs(r)}}else if(t.key===this.ws){const r=function(s){let a=Bt._e;if(s!=null)try{const l=JSON.parse(s);z(typeof l=="number"),a=l}catch(l){je("SharedClientState","Failed to read sequence number from WebStorage",l)}return a}(t.newValue);r!==Bt._e&&this.sequenceNumberHandler(r)}else if(t.key===this.vs){const r=this.Hs(t.newValue);await Promise.all(r.map(i=>this.syncEngine.Js(i)))}}}else this.ps.push(t)})}}get Ls(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Ls.Es())}Ns(e,t,r){const i=new sl(this.currentUser,e,t,r),s=pI(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Bs(e){const t=pI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){const t={clientId:this.Rs,onlineState:e};this.storage.setItem(this.Cs,JSON.stringify(t))}ks(e,t,r){const i=Jd(this.persistenceKey,e),s=new da(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return ol.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return sl.Ts(new it(s),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return da.Ts(i,t)}Ms(e){return hg.Ts(e)}Hs(e){return JSON.parse(e)}async Gs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Ys(e.batchId,e.state,e.error);N("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),a=[],l=[];return s.forEach(h=>{i.has(h)||a.push(h)}),i.forEach(h=>{s.has(h)||l.push(h)}),this.syncEngine.Xs(a,l).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=Jp();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class wA{constructor(){this.eo=new Bf,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new Bf,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class kU{ro(e){}shutdown(){}}class gI{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Tc=null;function Zd(){return Tc===null?Tc=function(){return 268435456+Math.round(2147483648*Math.random())}():Tc++,"0x"+Tc.toString(16)}const xU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class NU{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}const It="WebChannelConnection";class VU extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.mo=r+"://"+t.host,this.fo=`projects/${i}/databases/${s}`,this.po=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get yo(){return!1}wo(t,r,i,s,a){const l=Zd(),h=this.So(t,r);N("RestConnection",`Sending RPC '${t}' ${l}:`,h,i);const f={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(f,s,a),this.Do(t,h,f,i).then(p=>(N("RestConnection",`Received RPC '${t}' ${l}: `,p),p),p=>{throw In("RestConnection",`RPC '${t}' ${l} failed with error: `,p,"url: ",h,"request:",i),p})}Co(t,r,i,s,a,l){return this.wo(t,r,i,s,a)}bo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+ro}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}So(t,r){const i=xU[t];return`${this.mo}/v1/${r}:${i}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,t,r,i){const s=Zd();return new Promise((a,l)=>{const h=new DF;h.setWithCredentials(!0),h.listenOnce(PF.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case jd.NO_ERROR:const p=h.getResponseJson();N(It,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(p)),a(p);break;case jd.TIMEOUT:N(It,`RPC '${e}' ${s} timed out`),l(new k(b.DEADLINE_EXCEEDED,"Request time out"));break;case jd.HTTP_ERROR:const m=h.getStatus();if(N(It,`RPC '${e}' ${s} failed with status:`,m,"response text:",h.getResponseText()),m>0){let I=h.getResponseJson();Array.isArray(I)&&(I=I[0]);const A=I==null?void 0:I.error;if(A&&A.status&&A.message){const L=function(V){const Y=V.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(Y)>=0?Y:b.UNKNOWN}(A.status);l(new k(L,A.message))}else l(new k(b.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new k(b.UNAVAILABLE,"Connection failed."));break;default:$()}}finally{N(It,`RPC '${e}' ${s} completed.`)}});const f=JSON.stringify(i);N(It,`RPC '${e}' ${s} sending request:`,i),h.send(t,"POST",f,r,15)})}vo(e,t,r){const i=Zd(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=SF(),l=bF(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.bo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const p=s.join("");N(It,`Creating RPC '${e}' stream ${i}: ${p}`,h);const m=a.createWebChannel(p,h);let I=!1,A=!1;const L=new NU({co:V=>{A?N(It,`Not sending because RPC '${e}' stream ${i} is closed:`,V):(I||(N(It,`Opening RPC '${e}' stream ${i} transport.`),m.open(),I=!0),N(It,`RPC '${e}' stream ${i} sending:`,V),m.send(V))},lo:()=>m.close()}),M=(V,Y,ae)=>{V.listen(Y,j=>{try{ae(j)}catch(ye){setTimeout(()=>{throw ye},0)}})};return M(m,yc.EventType.OPEN,()=>{A||N(It,`RPC '${e}' stream ${i} transport opened.`)}),M(m,yc.EventType.CLOSE,()=>{A||(A=!0,N(It,`RPC '${e}' stream ${i} transport closed`),L.Ro())}),M(m,yc.EventType.ERROR,V=>{A||(A=!0,In(It,`RPC '${e}' stream ${i} transport errored:`,V),L.Ro(new k(b.UNAVAILABLE,"The operation could not be completed")))}),M(m,yc.EventType.MESSAGE,V=>{var Y;if(!A){const ae=V.data[0];z(!!ae);const j=ae,ye=j.error||((Y=j[0])===null||Y===void 0?void 0:Y.error);if(ye){N(It,`RPC '${e}' stream ${i} received error:`,ye);const de=ye.status;let me=function(zn){const Yi=Ye[zn];if(Yi!==void 0)return qT(Yi)}(de),we=ye.message;me===void 0&&(me=b.INTERNAL,we="Unknown error status: "+de+" with message "+ye.message),A=!0,L.Ro(new k(me,we)),m.close()}else N(It,`RPC '${e}' stream ${i} received:`,ae),L.Vo(ae)}}),M(l,CF.STAT_EVENT,V=>{V.stat===Ev.PROXY?N(It,`RPC '${e}' stream ${i} detected buffering proxy`):V.stat===Ev.NOPROXY&&N(It,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{L.Ao()},0),L}}function EA(){return typeof window<"u"?window:null}function Vc(){return typeof document<"u"?document:null}function pu(n){return new $2(n,!0)}class dg{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Fo=r,this.Mo=i,this.xo=s,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();const t=Math.floor(this.Oo+this.qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&N("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Oo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){this.No!==null&&(this.No.skipDelay(),this.No=null)}cancel(){this.No!==null&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class TA{constructor(e,t,r,i,s,a,l,h){this.si=e,this.Ko=r,this.$o=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new dg(e,t)}jo(){return this.state===1||this.state===5||this.Ho()}Ho(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Jo()}async stop(){this.jo()&&await this.close(0)}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&this.Wo===null&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}async Xo(){if(this.Ho())return this.close(0)}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}async close(e,t){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,e!==4?this.zo.reset():t&&t.code===b.RESOURCE_EXHAUSTED?(je(t.toString()),je("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):t&&t.code===b.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.r_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Io(t)}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),t=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Uo===t&&this.s_(r,i)},r=>{e(()=>{const i=new k(b.UNKNOWN,"Fetching auth token failed: "+r.message);return this.o_(i)})})}s_(e,t){const r=this.i_(this.Uo);this.stream=this.__(e,t),this.stream.ho(()=>{r(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(i=>{r(()=>this.o_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Jo(){this.state=5,this.zo.ko(async()=>{this.state=0,this.start()})}o_(e){return N("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return t=>{this.si.enqueueAndForget(()=>this.Uo===e?t():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class OU extends TA{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}__(e,t){return this.connection.vo("Listen",e,t)}onMessage(e){this.zo.reset();const t=z2(this.serializer,e),r=function(s){if(!("targetChange"in s))return K.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?K.min():a.readTime?Qe(a.readTime):K.min()}(e);return this.listener.a_(t,r)}u_(e){const t={};t.database=Ua(this.serializer),t.addTarget=function(s,a){let l;const h=a.target;if(l=Xc(h)?{documents:YT(s,h)}:{query:JT(s,h)},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=zT(s,a.resumeToken);const f=Vf(s,a.expectedCount);f!==null&&(l.expectedCount=f)}else if(a.snapshotVersion.compareTo(K.min())>0){l.readTime=Ws(s,a.snapshotVersion.toTimestamp());const f=Vf(s,a.expectedCount);f!==null&&(l.expectedCount=f)}return l}(this.serializer,e);const r=H2(this.serializer,e);r&&(t.labels=r),this.e_(t)}c_(e){const t={};t.database=Ua(this.serializer),t.removeTarget=e,this.e_(t)}}class LU extends TA{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,t){return this.connection.vo("Write",e,t)}onMessage(e){if(z(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();const t=K2(e.writeResults,e.commitTime),r=Qe(e.commitTime);return this.listener.I_(r,t)}return z(!e.writeResults||e.writeResults.length===0),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=Ua(this.serializer),this.e_(e)}P_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Ba(this.serializer,r))};this.e_(t)}}class MU extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.d_=!1}A_(){if(this.d_)throw new k(b.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,t,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.wo(e,t,r,i,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new k(b.UNKNOWN,i.toString())})}Co(e,t,r,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(e,t,r,s,a,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new k(b.UNKNOWN,s.toString())})}terminate(){this.d_=!0}}class FU{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){this.V_===0&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){this.state==="Online"?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,e==="Online"&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(je(t),this.f_=!1):N("OnlineStateTracker",t)}S_(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}}class UU{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=s,this.F_.ro(a=>{r.enqueueAndForget(async()=>{ni(this)&&(N("RemoteStore","Restarting streams for network reachability change."),await async function(h){const f=B(h);f.C_.add(4),await ao(f),f.M_.set("Unknown"),f.C_.delete(4),await gu(f)}(this))})}),this.M_=new FU(r,i)}}async function gu(n){if(ni(n))for(const e of n.v_)await e(!0)}async function ao(n){for(const e of n.v_)await e(!1)}function Ql(n,e){const t=B(n);t.D_.has(e.targetId)||(t.D_.set(e.targetId,e),gg(t)?pg(t):co(t).Ho()&&fg(t,e))}function qa(n,e){const t=B(n),r=co(t);t.D_.delete(e),r.Ho()&&AA(t,e),t.D_.size===0&&(r.Ho()?r.Zo():ni(t)&&t.M_.set("Unknown"))}function fg(n,e){if(n.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}co(n).u_(e)}function AA(n,e){n.x_.Oe(e),co(n).c_(e)}function pg(n){n.x_=new F2({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.D_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),co(n).start(),n.M_.g_()}function gg(n){return ni(n)&&!co(n).jo()&&n.D_.size>0}function ni(n){return B(n).C_.size===0}function RA(n){n.x_=void 0}async function BU(n){n.D_.forEach((e,t)=>{fg(n,e)})}async function qU(n,e){RA(n),gg(n)?(n.M_.w_(e),pg(n)):n.M_.set("Unknown")}async function $U(n,e,t){if(n.M_.set("Online"),e instanceof GT&&e.state===2&&e.cause)try{await async function(i,s){const a=s.cause;for(const l of s.targetIds)i.D_.has(l)&&(await i.remoteSyncer.rejectListen(l,a),i.D_.delete(l),i.x_.removeTarget(l))}(n,e)}catch(r){N("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await al(n,r)}else if(e instanceof Nc?n.x_.$e(e):e instanceof WT?n.x_.Je(e):n.x_.Ge(e),!t.isEqual(K.min()))try{const r=await mA(n.localStore);t.compareTo(r)>=0&&await function(s,a){const l=s.x_.it(a);return l.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const p=s.D_.get(f);p&&s.D_.set(f,p.withResumeToken(h.resumeToken,a))}}),l.targetMismatches.forEach((h,f)=>{const p=s.D_.get(h);if(!p)return;s.D_.set(h,p.withResumeToken(tt.EMPTY_BYTE_STRING,p.snapshotVersion)),AA(s,h);const m=new ir(p.target,h,f,p.sequenceNumber);fg(s,m)}),s.remoteSyncer.applyRemoteEvent(l)}(n,t)}catch(r){N("RemoteStore","Failed to raise snapshot:",r),await al(n,r)}}async function al(n,e,t){if(!ei(e))throw e;n.C_.add(1),await ao(n),n.M_.set("Offline"),t||(t=()=>mA(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{N("RemoteStore","Retrying IndexedDB access"),await t(),n.C_.delete(1),await gu(n)})}function SA(n,e){return e().catch(t=>al(n,t,e))}async function uo(n){const e=B(n),t=Kr(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;WU(e);)try{const i=await PU(e.localStore,r);if(i===null){e.b_.length===0&&t.Zo();break}r=i.batchId,GU(e,i)}catch(i){await al(e,i)}bA(e)&&PA(e)}function WU(n){return ni(n)&&n.b_.length<10}function GU(n,e){n.b_.push(e);const t=Kr(n);t.Ho()&&t.h_&&t.P_(e.mutations)}function bA(n){return ni(n)&&!Kr(n).jo()&&n.b_.length>0}function PA(n){Kr(n).start()}async function zU(n){Kr(n).E_()}async function KU(n){const e=Kr(n);for(const t of n.b_)e.P_(t.mutations)}async function HU(n,e,t){const r=n.b_.shift(),i=eg.from(r,e,t);await SA(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await uo(n)}async function jU(n,e){e&&Kr(n).h_&&await async function(r,i){if(function(a){return BT(a)&&a!==b.ABORTED}(i.code)){const s=r.b_.shift();Kr(r).Yo(),await SA(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await uo(r)}}(n,e),bA(n)&&PA(n)}async function mI(n,e){const t=B(n);t.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");const r=ni(t);t.C_.add(3),await ao(t),r&&t.M_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.C_.delete(3),await gu(t)}async function qf(n,e){const t=B(n);e?(t.C_.delete(2),await gu(t)):e||(t.C_.add(2),await ao(t),t.M_.set("Unknown"))}function co(n){return n.O_||(n.O_=function(t,r,i){const s=B(t);return s.A_(),new OU(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:BU.bind(null,n),Io:qU.bind(null,n),a_:$U.bind(null,n)}),n.v_.push(async e=>{e?(n.O_.Yo(),gg(n)?pg(n):n.M_.set("Unknown")):(await n.O_.stop(),RA(n))})),n.O_}function Kr(n){return n.N_||(n.N_=function(t,r,i){const s=B(t);return s.A_(),new LU(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:zU.bind(null,n),Io:jU.bind(null,n),T_:KU.bind(null,n),I_:HU.bind(null,n)}),n.v_.push(async e=>{e?(n.N_.Yo(),await uo(n)):(await n.N_.stop(),n.b_.length>0&&(N("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))})),n.N_}class mg{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new st,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const a=Date.now()+r,l=new mg(e,t,a,i,s);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(b.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function lo(n,e){if(je("AsyncQueue",`${e}: ${n}`),ei(n))return new k(b.UNAVAILABLE,`${e}: ${n}`);throw n}class Ns{constructor(e){this.comparator=e?(t,r)=>e(t,r)||F.comparator(t.key,r.key):(t,r)=>F.comparator(t.key,r.key),this.keyedMap=ta(),this.sortedSet=new Pe(this.comparator)}static emptySet(e){return new Ns(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ns)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new Ns;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class _I{constructor(){this.B_=new Pe(F.comparator)}track(e){const t=e.doc.key,r=this.B_.get(t);r?e.type!==0&&r.type===3?this.B_=this.B_.insert(t,e):e.type===3&&r.type!==1?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.B_=this.B_.remove(t):e.type===1&&r.type===2?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):$():this.B_=this.B_.insert(t,e)}L_(){const e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Ks{constructor(e,t,r,i,s,a,l,h,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,i,s){const a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new Ks(e,t,Ns.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&cu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class QU{constructor(){this.k_=void 0,this.listeners=[]}}class YU{constructor(){this.queries=new ti(e=>RT(e),cu),this.onlineState="Unknown",this.q_=new Set}}async function _g(n,e){const t=B(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new QU),i)try{s.k_=await t.onListen(r)}catch(a){const l=lo(a,`Initialization of query '${Is(e.query)}' failed`);return void e.onError(l)}t.queries.set(r,s),s.listeners.push(e),e.Q_(t.onlineState),s.k_&&e.K_(s.k_)&&vg(t)}async function yg(n,e){const t=B(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const a=s.listeners.indexOf(e);a>=0&&(s.listeners.splice(a,1),i=s.listeners.length===0)}if(i)return t.queries.delete(r),t.onUnlisten(r)}function JU(n,e){const t=B(n);let r=!1;for(const i of e){const s=i.query,a=t.queries.get(s);if(a){for(const l of a.listeners)l.K_(i)&&(r=!0);a.k_=i}}r&&vg(t)}function XU(n,e,t){const r=B(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function vg(n){n.q_.forEach(e=>{e.next()})}class Ig{constructor(e,t,r){this.query=e,this.U_=t,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=r||{}}K_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new Ks(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.W_?this.z_(e)&&(this.U_.next(e),t=!0):this.j_(e,this.onlineState)&&(this.H_(e),t=!0),this.G_=e,t}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let t=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),t=!0),t}j_(e,t){if(!e.fromCache)return!0;const r=t!=="Offline";return(!this.options.J_||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}z_(e){if(e.docChanges.length>0)return!0;const t=this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}H_(e){e=Ks.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}class ZU{constructor(e,t){this.Y_=e,this.byteLength=t}Z_(){return"metadata"in this.Y_}}class yI{constructor(e){this.serializer=e}hs(e){return Un(this.serializer,e)}Ps(e){return e.metadata.exists?QT(this.serializer,e.document,!1):ke.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return Qe(e)}}class eB{constructor(e,t,r){this.X_=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=CA(e)}ea(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Y_.namedQuery)this.queries.push(e.Y_.namedQuery);else if(e.Y_.documentMetadata){this.documents.push({metadata:e.Y_.documentMetadata}),e.Y_.documentMetadata.exists||++t;const r=ge.fromString(e.Y_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Y_.document&&(this.documents[this.documents.length-1].document=e.Y_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ta(e){const t=new Map,r=new yI(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const a of i.metadata.queries){const l=(t.get(a)||re()).add(s);t.set(a,l)}}return t}async complete(){const e=await CU(this.localStore,new yI(this.serializer),this.documents,this.X_.id),t=this.ta(this.documents);for(const r of this.queries)await DU(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,na:this.collectionGroups,ra:e}}}function CA(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class DA{constructor(e){this.key=e}}class kA{constructor(e){this.key=e}}class xA{constructor(e,t){this.query=e,this.ia=t,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=re(),this.mutatedKeys=re(),this._a=bT(e),this.aa=new Ns(this._a)}get ua(){return this.ia}ca(e,t){const r=t?t.la:new _I,i=t?t.aa:this.aa;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,l=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,m)=>{const I=i.get(p),A=lu(this.query,m)?m:null,L=!!I&&this.mutatedKeys.has(I.key),M=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let V=!1;I&&A?I.data.isEqual(A.data)?L!==M&&(r.track({type:3,doc:A}),V=!0):this.ha(I,A)||(r.track({type:2,doc:A}),V=!0,(h&&this._a(A,h)>0||f&&this._a(A,f)<0)&&(l=!0)):!I&&A?(r.track({type:0,doc:A}),V=!0):I&&!A&&(r.track({type:1,doc:I}),V=!0,(h||f)&&(l=!0)),V&&(A?(a=a.add(A),s=M?s.add(p):s.delete(p)):(a=a.delete(p),s=s.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),s=s.delete(p.key),r.track({type:1,doc:p})}return{aa:a,la:r,Zi:l,mutatedKeys:s}}ha(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const a=e.la.L_();a.sort((p,m)=>function(A,L){const M=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $()}};return M(A)-M(L)}(p.type,m.type)||this._a(p.doc,m.doc)),this.Pa(r),i=i!=null&&i;const l=t&&!i?this.Ia():[],h=this.oa.size===0&&this.current&&!i?1:0,f=h!==this.sa;return this.sa=h,a.length!==0||f?{snapshot:new Ks(this.query,e.aa,s,a,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ta:l}:{Ta:l}}Q_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({aa:this.aa,la:new _I,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(t=>this.ia=this.ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ia=this.ia.delete(t)),this.current=e.current)}Ia(){if(!this.current)return[];const e=this.oa;this.oa=re(),this.aa.forEach(r=>{this.Ea(r.key)&&(this.oa=this.oa.add(r.key))});const t=[];return e.forEach(r=>{this.oa.has(r)||t.push(new kA(r))}),this.oa.forEach(r=>{e.has(r)||t.push(new DA(r))}),t}da(e){this.ia=e.ls,this.oa=re();const t=this.ca(e.documents);return this.applyChanges(t,!0)}Aa(){return Ks.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,this.sa===0,this.hasCachedResults)}}class tB{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class nB{constructor(e){this.key=e,this.Ra=!1}}class rB{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Va={},this.ma=new ti(l=>RT(l),cu),this.fa=new Map,this.ga=new Set,this.pa=new Pe(F.comparator),this.ya=new Map,this.wa=new ag,this.Sa={},this.ba=new Map,this.Da=Bi.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return this.Ca===!0}}async function iB(n,e){const t=Rg(n);let r,i;const s=t.ma.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const a=await Gs(t.localStore,xt(e)),l=t.sharedClientState.addLocalQueryTarget(a.targetId);r=a.targetId,i=await wg(t,e,r,l==="current",a.resumeToken),t.isPrimaryClient&&Ql(t.remoteStore,a)}return i}async function wg(n,e,t,r,i){n.va=(m,I,A)=>async function(M,V,Y,ae){let j=V.view.ca(Y);j.Zi&&(j=await il(M.localStore,V.query,!1).then(({documents:we})=>V.view.ca(we,j)));const ye=ae&&ae.targetChanges.get(V.targetId),de=ae&&ae.targetMismatches.get(V.targetId)!=null,me=V.view.applyChanges(j,M.isPrimaryClient,ye,de);return $f(M,V.targetId,me.Ta),me.snapshot}(n,m,I,A);const s=await il(n.localStore,e,!0),a=new xA(e,s.ls),l=a.ca(s.documents),h=fu.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),f=a.applyChanges(l,n.isPrimaryClient,h);$f(n,t,f.Ta);const p=new tB(e,t,a);return n.ma.set(e,p),n.fa.has(t)?n.fa.get(t).push(e):n.fa.set(t,[e]),f.snapshot}async function sB(n,e){const t=B(n),r=t.ma.get(e),i=t.fa.get(r.targetId);if(i.length>1)return t.fa.set(r.targetId,i.filter(s=>!cu(s,e))),void t.ma.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||await zs(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),qa(t.remoteStore,r.targetId),Hs(t,r.targetId)}).catch(Zr)):(Hs(t,r.targetId),await zs(t.localStore,r.targetId,!0))}async function oB(n,e,t){const r=Sg(n);try{const i=await function(a,l){const h=B(a),f=Oe.now(),p=l.reduce((A,L)=>A.add(L.key),re());let m,I;return h.persistence.runTransaction("Locally write mutations","readwrite",A=>{let L=$t(),M=re();return h.ss.getEntries(A,p).next(V=>{L=V,L.forEach((Y,ae)=>{ae.isValidDocument()||(M=M.add(Y))})}).next(()=>h.localDocuments.getOverlayedDocuments(A,L)).next(V=>{m=V;const Y=[];for(const ae of l){const j=O2(ae,m.get(ae.key).overlayedDocument);j!=null&&Y.push(new pr(ae.key,j,mT(j.value.mapValue),Ve.exists(!0)))}return h.mutationQueue.addMutationBatch(A,f,Y,l)}).next(V=>{I=V;const Y=V.applyToLocalDocumentSet(m,M);return h.documentOverlayCache.saveOverlays(A,V.batchId,Y)})}).then(()=>({batchId:I.batchId,changes:CT(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,l,h){let f=a.Sa[a.currentUser.toKey()];f||(f=new Pe(ne)),f=f.insert(l,h),a.Sa[a.currentUser.toKey()]=f}(r,i.batchId,t),await gr(r,i.changes),await uo(r.remoteStore)}catch(i){const s=lo(i,"Failed to persist write");t.reject(s)}}async function NA(n,e){const t=B(n);try{const r=await bU(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.ya.get(s);a&&(z(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Ra=!0:i.modifiedDocuments.size>0?z(a.Ra):i.removedDocuments.size>0&&(z(a.Ra),a.Ra=!1))}),await gr(t,r,e)}catch(r){await Zr(r)}}function vI(n,e,t){const r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.ma.forEach((s,a)=>{const l=a.view.Q_(e);l.snapshot&&i.push(l.snapshot)}),function(a,l){const h=B(a);h.onlineState=l;let f=!1;h.queries.forEach((p,m)=>{for(const I of m.listeners)I.Q_(l)&&(f=!0)}),f&&vg(h)}(r.eventManager,e),i.length&&r.Va.a_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function aB(n,e,t){const r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.ya.get(e),s=i&&i.key;if(s){let a=new Pe(F.comparator);a=a.insert(s,ke.newNoDocument(s,K.min()));const l=re().add(s),h=new du(K.min(),new Map,new Pe(ne),a,l);await NA(r,h),r.pa=r.pa.remove(s),r.ya.delete(e),Ag(r)}else await zs(r.localStore,e,!1).then(()=>Hs(r,e,t)).catch(Zr)}async function uB(n,e){const t=B(n),r=e.batch.batchId;try{const i=await SU(t.localStore,e);Tg(t,r,null),Eg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await gr(t,i)}catch(i){await Zr(i)}}async function cB(n,e,t){const r=B(n);try{const i=await function(a,l){const h=B(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let p;return h.mutationQueue.lookupMutationBatch(f,l).next(m=>(z(m!==null),p=m.keys(),h.mutationQueue.removeMutationBatch(f,m))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,p,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p)).next(()=>h.localDocuments.getDocuments(f,p))})}(r.localStore,e);Tg(r,e,t),Eg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await gr(r,i)}catch(i){await Zr(i)}}async function lB(n,e){const t=B(n);ni(t.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(a){const l=B(a);return l.persistence.runTransaction("Get highest unacknowledged batch id","readonly",h=>l.mutationQueue.getHighestUnacknowledgedBatchId(h))}(t.localStore);if(r===-1)return void e.resolve();const i=t.ba.get(r)||[];i.push(e),t.ba.set(r,i)}catch(r){const i=lo(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}function Eg(n,e){(n.ba.get(e)||[]).forEach(t=>{t.resolve()}),n.ba.delete(e)}function Tg(n,e,t){const r=B(n);let i=r.Sa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Sa[r.currentUser.toKey()]=i}}function Hs(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.fa.get(e))n.ma.delete(r),t&&n.Va.Fa(r,t);n.fa.delete(e),n.isPrimaryClient&&n.wa.Rr(e).forEach(r=>{n.wa.containsKey(r)||VA(n,r)})}function VA(n,e){n.ga.delete(e.path.canonicalString());const t=n.pa.get(e);t!==null&&(qa(n.remoteStore,t),n.pa=n.pa.remove(e),n.ya.delete(t),Ag(n))}function $f(n,e,t){for(const r of t)r instanceof DA?(n.wa.addReference(r.key,e),hB(n,r)):r instanceof kA?(N("SyncEngine","Document no longer in limbo: "+r.key),n.wa.removeReference(r.key,e),n.wa.containsKey(r.key)||VA(n,r.key)):$()}function hB(n,e){const t=e.key,r=t.path.canonicalString();n.pa.get(t)||n.ga.has(r)||(N("SyncEngine","New document in limbo: "+t),n.ga.add(r),Ag(n))}function Ag(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){const e=n.ga.values().next().value;n.ga.delete(e);const t=new F(ge.fromString(e)),r=n.Da.next();n.ya.set(r,new nB(t)),n.pa=n.pa.insert(t,r),Ql(n.remoteStore,new ir(xt(io(t.path)),r,"TargetPurposeLimboResolution",Bt._e))}}async function gr(n,e,t){const r=B(n),i=[],s=[],a=[];r.ma.isEmpty()||(r.ma.forEach((l,h)=>{a.push(r.va(h,e,t).then(f=>{if((f||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(h.targetId,f!=null&&f.fromCache?"not-current":"current"),f){i.push(f);const p=lg.Qi(h.targetId,f);s.push(p)}}))}),await Promise.all(a),r.Va.a_(i),await async function(h,f){const p=B(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>R.forEach(f,I=>R.forEach(I.ki,A=>p.persistence.referenceDelegate.addReference(m,I.targetId,A)).next(()=>R.forEach(I.qi,A=>p.persistence.referenceDelegate.removeReference(m,I.targetId,A)))))}catch(m){if(!ei(m))throw m;N("LocalStore","Failed to update sequence numbers: "+m)}for(const m of f){const I=m.targetId;if(!m.fromCache){const A=p.ts.get(I),L=A.snapshotVersion,M=A.withLastLimboFreeSnapshotVersion(L);p.ts=p.ts.insert(I,M)}}}(r.localStore,s))}async function dB(n,e){const t=B(n);if(!t.currentUser.isEqual(e)){N("SyncEngine","User change. New user:",e.toKey());const r=await gA(t.localStore,e);t.currentUser=e,function(s,a){s.ba.forEach(l=>{l.forEach(h=>{h.reject(new k(b.CANCELLED,a))})}),s.ba.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await gr(t,r._s)}}function fB(n,e){const t=B(n),r=t.ya.get(e);if(r&&r.Ra)return re().add(r.key);{let i=re();const s=t.fa.get(e);if(!s)return i;for(const a of s){const l=t.ma.get(a);i=i.unionWith(l.view.ua)}return i}}async function pB(n,e){const t=B(n),r=await il(t.localStore,e.query,!0),i=e.view.da(r);return t.isPrimaryClient&&$f(t,e.targetId,i.Ta),i}async function gB(n,e){const t=B(n);return vA(t.localStore,e).then(r=>gr(t,r))}async function mB(n,e,t,r){const i=B(n),s=await function(l,h){const f=B(l),p=B(f.mutationQueue);return f.persistence.runTransaction("Lookup mutation documents","readonly",m=>p.Cn(m,h).next(I=>I?f.localDocuments.getDocuments(m,I):R.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?await uo(i.remoteStore):t==="acknowledged"||t==="rejected"?(Tg(i,e,r||null),Eg(i,e),function(l,h){B(B(l).mutationQueue).Fn(h)}(i.localStore,e)):$(),await gr(i,s)):N("SyncEngine","Cannot apply mutation batch with id: "+e)}async function _B(n,e){const t=B(n);if(Rg(t),Sg(t),e===!0&&t.Ca!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),i=await II(t,r.toArray());t.Ca=!0,await qf(t.remoteStore,!0);for(const s of i)Ql(t.remoteStore,s)}else if(e===!1&&t.Ca!==!1){const r=[];let i=Promise.resolve();t.fa.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):i=i.then(()=>(Hs(t,a),zs(t.localStore,a,!0))),qa(t.remoteStore,a)}),await i,await II(t,r),function(a){const l=B(a);l.ya.forEach((h,f)=>{qa(l.remoteStore,f)}),l.wa.Vr(),l.ya=new Map,l.pa=new Pe(F.comparator)}(t),t.Ca=!1,await qf(t.remoteStore,!1)}}async function II(n,e,t){const r=B(n),i=[],s=[];for(const a of e){let l;const h=r.fa.get(a);if(h&&h.length!==0){l=await Gs(r.localStore,xt(h[0]));for(const f of h){const p=r.ma.get(f),m=await pB(r,p);m.snapshot&&s.push(m.snapshot)}}else{const f=await yA(r.localStore,a);l=await Gs(r.localStore,f),await wg(r,OA(f),a,!1,l.resumeToken)}i.push(l)}return r.Va.a_(s),i}function OA(n){return AT(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function yB(n){return function(t){return B(B(t).persistence).Bi()}(B(n).localStore)}async function vB(n,e,t,r){const i=B(n);if(i.Ca)return void N("SyncEngine","Ignoring unexpected query state notification.");const s=i.fa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=await vA(i.localStore,ST(s[0])),l=du.createSynthesizedRemoteEventForCurrentChange(e,t==="current",tt.EMPTY_BYTE_STRING);await gr(i,a,l);break}case"rejected":await zs(i.localStore,e,!0),Hs(i,e,r);break;default:$()}}async function IB(n,e,t){const r=Rg(n);if(r.Ca){for(const i of e){if(r.fa.has(i)){N("SyncEngine","Adding an already active target "+i);continue}const s=await yA(r.localStore,i),a=await Gs(r.localStore,s);await wg(r,OA(s),a.targetId,!1,a.resumeToken),Ql(r.remoteStore,a)}for(const i of t)r.fa.has(i)&&await zs(r.localStore,i,!1).then(()=>{qa(r.remoteStore,i),Hs(r,i)}).catch(Zr)}}function Rg(n){const e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=NA.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=fB.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=aB.bind(null,e),e.Va.a_=JU.bind(null,e.eventManager),e.Va.Fa=XU.bind(null,e.eventManager),e}function Sg(n){const e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=uB.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=cB.bind(null,e),e}function wB(n,e,t){const r=B(n);(async function(s,a,l){try{const h=await a.getMetadata();if(await function(A,L){const M=B(A),V=Qe(L.createTime);return M.persistence.runTransaction("hasNewerBundle","readonly",Y=>M.Kr.getBundleMetadata(Y,L.id)).then(Y=>!!Y&&Y.createTime.compareTo(V)>=0)}(s.localStore,h))return await a.close(),l._completeWith(function(A){return{taskState:"Success",documentsLoaded:A.totalDocuments,bytesLoaded:A.totalBytes,totalDocuments:A.totalDocuments,totalBytes:A.totalBytes}}(h)),Promise.resolve(new Set);l._updateProgress(CA(h));const f=new eB(h,s.localStore,a.serializer);let p=await a.Ma();for(;p;){const I=await f.ea(p);I&&l._updateProgress(I),p=await a.Ma()}const m=await f.complete();return await gr(s,m.ra,void 0),await function(A,L){const M=B(A);return M.persistence.runTransaction("Save bundle","readwrite",V=>M.Kr.saveBundleMetadata(V,L))}(s.localStore,h),l._completeWith(m.progress),Promise.resolve(m.na)}catch(h){return In("SyncEngine",`Loading bundle failed with ${h}`),l._failWith(h),Promise.resolve(new Set)}})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}class Wf{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=pu(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return pA(this.persistence,new fA,e.initialUser,this.serializer)}createPersistence(e){return new dA(jl.jr,this.serializer)}createSharedClientState(e){return new wA}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class LA extends Wf{constructor(e,t,r){super(),this.xa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xa.initialize(this,e),await Sg(this.xa.syncEngine),await uo(this.xa.remoteStore),await this.persistence.mi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return pA(this.persistence,new fA,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new cU(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new KF(t,this.persistence);return new zF(e.asyncQueue,r)}createPersistence(e){const t=cg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Ut.withCacheSize(this.cacheSizeBytes):Ut.DEFAULT;return new ug(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,EA(),Vc(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new wA}}class EB extends LA{constructor(e,t){super(e,t,!1),this.xa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xa.syncEngine;this.sharedClientState instanceof Xd&&(this.sharedClientState.syncEngine={Ys:mB.bind(null,t),Zs:vB.bind(null,t),Xs:IB.bind(null,t),Bi:yB.bind(null,t),Js:gB.bind(null,t)},await this.sharedClientState.start()),await this.persistence.mi(async r=>{await _B(this.xa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){const t=EA();if(!Xd.D(t))throw new k(b.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=cg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Xd(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class bg{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>vI(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=dB.bind(null,this.syncEngine),await qf(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new YU}()}createDatastore(e){const t=pu(e.databaseInfo.databaseId),r=function(s){return new VU(s)}(e.databaseInfo);return function(s,a,l,h){return new MU(s,a,l,h)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,a,l){return new UU(r,i,s,a,l)}(this.localStore,this.datastore,e.asyncQueue,t=>vI(this.syncEngine,t,0),function(){return gI.D()?new gI:new kU}())}createSyncEngine(e,t){return function(i,s,a,l,h,f,p){const m=new rB(i,s,a,l,h,f);return p&&(m.Ca=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(t){const r=B(t);N("RemoteStore","RemoteStore shutting down."),r.C_.add(5),await ao(r),r.F_.shutdown(),r.M_.set("Unknown")}(this.remoteStore)}}function wI(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class Yl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):je("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class TB{constructor(e,t){this.Ba=e,this.serializer=t,this.metadata=new st,this.buffer=new Uint8Array,this.La=function(){return new TextDecoder("utf-8")}(),this.ka().then(r=>{r&&r.Z_()?this.metadata.resolve(r.Y_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Y_)}`))},r=>this.metadata.reject(r))}close(){return this.Ba.cancel()}async getMetadata(){return this.metadata.promise}async Ma(){return await this.getMetadata(),this.ka()}async ka(){const e=await this.qa();if(e===null)return null;const t=this.La.decode(e),r=Number(t);isNaN(r)&&this.Qa(`length string (${t}) is not valid number`);const i=await this.Ka(r);return new ZU(JSON.parse(i),e.length+r)}$a(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qa(){for(;this.$a()<0&&!await this.Ua(););if(this.buffer.length===0)return null;const e=this.$a();e<0&&this.Qa("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Ka(e){for(;this.buffer.length<e;)await this.Ua()&&this.Qa("Reached the end of bundle when more is expected.");const t=this.La.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qa(e){throw this.Ba.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ua(){const e=await this.Ba.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class AB{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new k(b.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(i,s){const a=B(i),l=Ua(a.serializer)+"/documents",h={documents:s.map(I=>Fa(a.serializer,I))},f=await a.Co("BatchGetDocuments",l,h,s.length),p=new Map;f.forEach(I=>{const A=G2(a.serializer,I);p.set(A.key.toString(),A)});const m=[];return s.forEach(I=>{const A=p.get(I.toString());z(!!A),m.push(A)}),m}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new oo(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const i=F.fromPath(r);this.mutations.push(new Xp(i,this.precondition(i)))}),await async function(r,i){const s=B(r),a=Ua(s.serializer)+"/documents",l={writes:i.map(h=>Ba(s.serializer,h))};await s.wo("Commit",a,l)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw $();t=K.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new k(b.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(K.min())?Ve.exists(!1):Ve.updateTime(t):Ve.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(K.min()))throw new k(b.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ve.updateTime(t)}return Ve.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class RB{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Wa=r.maxAttempts,this.zo=new dg(this.asyncQueue,"transaction_retry")}run(){this.Wa-=1,this.Ga()}Ga(){this.zo.ko(async()=>{const e=new AB(this.datastore),t=this.za(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.ja(i)}))}).catch(r=>{this.ja(r)})})}za(e){try{const t=this.updateFunction(e);return!au(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ja(e){this.Wa>0&&this.Ha(e)?(this.Wa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(e)}Ha(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!BT(t)}return!1}}class SB{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=it.UNAUTHENTICATED,this.clientId=nT.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async s=>{N("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(r,s=>(N("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new k(b.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new st;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=lo(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Oc(n,e){n.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");const t=await n.getConfiguration();await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await gA(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function Gf(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Pg(n);N("FirestoreClient","Initializing OnlineComponentProvider");const r=await n.getConfiguration();await e.initialize(t,r),n.setCredentialChangeListener(i=>mI(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>mI(e.remoteStore,s)),n._onlineComponents=e}function MA(n){return n.name==="FirebaseError"?n.code===b.FAILED_PRECONDITION||n.code===b.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}async function Pg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){N("FirestoreClient","Using user provided OfflineComponentProvider");try{await Oc(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!MA(t))throw t;In("Error using user provided cache. Falling back to memory cache: "+t),await Oc(n,new Wf)}}else N("FirestoreClient","Using default OfflineComponentProvider"),await Oc(n,new Wf);return n._offlineComponents}async function Jl(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(N("FirestoreClient","Using user provided OnlineComponentProvider"),await Gf(n,n._uninitializedComponentsProvider._online)):(N("FirestoreClient","Using default OnlineComponentProvider"),await Gf(n,new bg))),n._onlineComponents}function FA(n){return Pg(n).then(e=>e.persistence)}function Cg(n){return Pg(n).then(e=>e.localStore)}function UA(n){return Jl(n).then(e=>e.remoteStore)}function Dg(n){return Jl(n).then(e=>e.syncEngine)}function bB(n){return Jl(n).then(e=>e.datastore)}async function js(n){const e=await Jl(n),t=e.eventManager;return t.onListen=iB.bind(null,e.syncEngine),t.onUnlisten=sB.bind(null,e.syncEngine),t}function PB(n){return n.asyncQueue.enqueue(async()=>{const e=await FA(n),t=await UA(n);return e.setNetworkEnabled(!0),function(i){const s=B(i);return s.C_.delete(0),gu(s)}(t)})}function CB(n){return n.asyncQueue.enqueue(async()=>{const e=await FA(n),t=await UA(n);return e.setNetworkEnabled(!1),async function(i){const s=B(i);s.C_.add(0),await ao(s),s.M_.set("Offline")}(t)})}function DB(n,e){const t=new st;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,a){try{const l=await function(f,p){const m=B(f);return m.persistence.runTransaction("read document","readonly",I=>m.localDocuments.getDocument(I,p))}(i,s);l.isFoundDocument()?a.resolve(l):l.isNoDocument()?a.resolve(null):a.reject(new k(b.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){const h=lo(l,`Failed to get document '${s} from cache`);a.reject(h)}}(await Cg(n),e,t)),t.promise}function BA(n,e,t={}){const r=new st;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,l,h,f){const p=new Yl({next:I=>{a.enqueueAndForget(()=>yg(s,m));const A=I.docs.has(l);!A&&I.fromCache?f.reject(new k(b.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&I.fromCache&&h&&h.source==="server"?f.reject(new k(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(I)},error:I=>f.reject(I)}),m=new Ig(io(l.path),p,{includeMetadataChanges:!0,J_:!0});return _g(s,m)}(await js(n),n.asyncQueue,e,t,r)),r.promise}function kB(n,e){const t=new st;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,a){try{const l=await il(i,s,!0),h=new xA(s,l.ls),f=h.ca(l.documents),p=h.applyChanges(f,!1);a.resolve(p.snapshot)}catch(l){const h=lo(l,`Failed to execute query '${s} against cache`);a.reject(h)}}(await Cg(n),e,t)),t.promise}function qA(n,e,t={}){const r=new st;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,l,h,f){const p=new Yl({next:I=>{a.enqueueAndForget(()=>yg(s,m)),I.fromCache&&h.source==="server"?f.reject(new k(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(I)},error:I=>f.reject(I)}),m=new Ig(l,p,{includeMetadataChanges:!0,J_:!0});return _g(s,m)}(await js(n),n.asyncQueue,e,t,r)),r.promise}function xB(n,e){const t=new Yl(e);return n.asyncQueue.enqueueAndForget(async()=>function(i,s){B(i).q_.add(s),s.next()}(await js(n),t)),()=>{t.Na(),n.asyncQueue.enqueueAndForget(async()=>function(i,s){B(i).q_.delete(s)}(await js(n),t))}}function NB(n,e,t,r){const i=function(a,l){let h;return h=typeof a=="string"?$T().encode(a):a,function(p,m){return new TB(p,m)}(function(p,m){if(p instanceof Uint8Array)return wI(p,m);if(p instanceof ArrayBuffer)return wI(new Uint8Array(p),m);if(p instanceof ReadableStream)return p.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(h),l)}(t,pu(e));n.asyncQueue.enqueueAndForget(async()=>{wB(await Dg(n),i,r)})}function VB(n,e){return n.asyncQueue.enqueue(async()=>function(r,i){const s=B(r);return s.persistence.runTransaction("Get named query","readonly",a=>s.Kr.getNamedQuery(a,i))}(await Cg(n),e))}function $A(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const EI=new Map;function kg(n,e,t){if(!t)throw new k(b.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function WA(n,e,t,r){if(e===!0&&r===!0)throw new k(b.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function TI(n){if(!F.isDocumentKey(n))throw new k(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function AI(n){if(F.isDocumentKey(n))throw new k(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Xl(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$()}function _e(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new k(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Xl(n);throw new k(b.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function GA(n,e){if(e<=0)throw new k(b.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class RI{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new k(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new k(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}WA("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=$A((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new k(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new k(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new k(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class mu{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new RI({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new k(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new k(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new RI(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new VF;switch(r.type){case"firstParty":return new FF(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new k(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=EI.get(t);r&&(N("ComponentProvider","Removing Datastore"),EI.delete(t),r.terminate())}(this),Promise.resolve()}}function OB(n,e,t,r={}){var i;const s=(n=_e(n,mu))._getSettings(),a=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&In("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let l,h;if(typeof r.mockUserToken=="string")l=r.mockUserToken,h=it.MOCK_USER;else{l=Gk(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new k(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new it(f)}n._authCredentials=new OF(new tT(l,h))}}let Tt=class{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Tt(this.firestore,e,this._query)}},Le=class{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ar(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Le(this.firestore,e,this._key)}},ar=class extends Tt{constructor(e,t,r){super(e,t,io(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Le(this.firestore,null,new F(e))}withConverter(e){return new ar(this.firestore,e,this._path)}};function zA(n,e,...t){if(n=H(n),kg("collection","path",e),n instanceof mu){const r=ge.fromString(e,...t);return AI(r),new ar(n,null,r)}{if(!(n instanceof Le||n instanceof ar))throw new k(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ge.fromString(e,...t));return AI(r),new ar(n.firestore,null,r)}}function LB(n,e){if(n=_e(n,mu),kg("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new k(b.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Tt(n,null,function(r){return new fr(ge.emptyPath(),r)}(e))}function $a(n,e,...t){if(n=H(n),arguments.length===1&&(e=nT.newId()),kg("doc","path",e),n instanceof mu){const r=ge.fromString(e,...t);return TI(r),new Le(n,null,new F(r))}{if(!(n instanceof Le||n instanceof ar))throw new k(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ge.fromString(e,...t));return TI(r),new Le(n.firestore,n instanceof ar?n.converter:null,new F(r))}}function KA(n,e){return n=H(n),e=H(e),(n instanceof Le||n instanceof ar)&&(e instanceof Le||e instanceof ar)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function HA(n,e){return n=H(n),e=H(e),n instanceof Tt&&e instanceof Tt&&n.firestore===e.firestore&&cu(n._query,e._query)&&n.converter===e.converter}class MB{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new dg(this,"async_queue_retry"),this.iu=()=>{const t=Vc();t&&N("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const e=Vc();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const t=Vc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const t=new st;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}async _u(){if(this.Ya.length!==0){try{await this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(e){if(!ei(e))throw e;N("AsyncQueue","Operation failed with retryable error: "+e)}this.Ya.length>0&&this.zo.ko(()=>this._u())}}ou(e){const t=this.Ja.then(()=>(this.tu=!0,e().catch(r=>{this.eu=r,this.tu=!1;const i=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(r);throw je("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.tu=!1,r))));return this.Ja=t,t}enqueueAfterDelay(e,t,r){this.su(),this.ru.indexOf(e)>-1&&(t=0);const i=mg.createAndSchedule(this,e,t,r,s=>this.au(s));return this.Xa.push(i),i}su(){this.eu&&$()}verifyOperationInProgress(){}async uu(){let e;do e=this.Ja,await e;while(e!==this.Ja)}cu(e){for(const t of this.Xa)if(t.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Xa)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){const t=this.Xa.indexOf(e);this.Xa.splice(t,1)}}function zf(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}class FB{constructor(){this._progressObserver={},this._taskCompletionResolver=new st,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const UB=-1;let We=class extends mu{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new MB}(),this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||jA(this),this._firestoreClient.terminate()}};function ct(n){return n._firestoreClient||jA(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function jA(n){var e,t,r;const i=n._freezeSettings(),s=function(l,h,f,p){return new f2(l,h,f,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,$A(p.experimentalLongPollingOptions),p.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new SB(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function BB(n,e){YA(n=_e(n,We));const t=ct(n);if(t._uninitializedComponentsProvider)throw new k(b.FAILED_PRECONDITION,"SDK cache is already specified.");In("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new bg;return QA(t,i,new LA(i,r.cacheSizeBytes,e==null?void 0:e.forceOwnership))}function qB(n){YA(n=_e(n,We));const e=ct(n);if(e._uninitializedComponentsProvider)throw new k(b.FAILED_PRECONDITION,"SDK cache is already specified.");In("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new bg;return QA(e,r,new EB(r,t.cacheSizeBytes))}function QA(n,e,t){const r=new st;return n.asyncQueue.enqueue(async()=>{try{await Oc(n,t),await Gf(n,e),r.resolve()}catch(i){const s=i;if(!MA(s))throw s;In("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}}).then(()=>r.promise)}function $B(n){if(n._initialized&&!n._terminated)throw new k(b.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new st;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!_n.D())return Promise.resolve();const i=r+"main";await _n.delete(i)}(cg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function WB(n){return function(t){const r=new st;return t.asyncQueue.enqueueAndForget(async()=>lB(await Dg(t),r)),r.promise}(ct(n=_e(n,We)))}function GB(n){return PB(ct(n=_e(n,We)))}function zB(n){return CB(ct(n=_e(n,We)))}function KB(n,e){const t=ct(n=_e(n,We)),r=new FB;return NB(t,n._databaseId,e,r),r}function HB(n,e){return VB(ct(n=_e(n,We)),e).then(t=>t?new Tt(n,null,t.query):null)}function YA(n){if(n._initialized||n._terminated)throw new k(b.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Gn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Gn(tt.fromBase64String(e))}catch(t){throw new k(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Gn(tt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}let Hr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new k(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ne(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};let Ki=class{constructor(e){this._methodName=e}};class Zl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new k(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new k(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ne(this._lat,e._lat)||ne(this._long,e._long)}}const jB=/^__.*__$/;class QB{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new pr(e,this.data,this.fieldMask,t,this.fieldTransforms):new so(e,this.data,t,this.fieldTransforms)}}class JA{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new pr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function XA(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $()}}class eh{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Pu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new eh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Au(e),i}Ru(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Pu(),i}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return ul(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(e.length===0)throw this.mu("Document fields must not be empty");if(XA(this.Iu)&&jB.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class YB{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||pu(e)}pu(e,t,r,i=!1){return new eh({Iu:e,methodName:t,gu:r,path:Ne.emptyPath(),du:!1,fu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Hi(n){const e=n._freezeSettings(),t=pu(n._databaseId);return new YB(n._databaseId,!!e.ignoreUndefinedProperties,t)}function th(n,e,t,r,i,s={}){const a=n.pu(s.merge||s.mergeFields?2:0,e,t,i);Og("Data must be an object, but it was:",a,r);const l=t0(r,a);let h,f;if(s.merge)h=new qt(a.fieldMask),f=a.fieldTransforms;else if(s.mergeFields){const p=[];for(const m of s.mergeFields){const I=Kf(e,m,t);if(!a.contains(I))throw new k(b.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);r0(p,I)||p.push(I)}h=new qt(p),f=a.fieldTransforms.filter(m=>h.covers(m.field))}else h=null,f=a.fieldTransforms;return new QB(new pt(l),h,f)}class _u extends Ki{_toFieldTransform(e){if(e.Iu!==2)throw e.Iu===1?e.mu(`${this._methodName}() can only appear at the top level of your update data`):e.mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof _u}}function ZA(n,e,t){return new eh({Iu:3,gu:e.settings.gu,methodName:n._methodName,du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class xg extends Ki{_toFieldTransform(e){return new hu(e.path,new qs)}isEqual(e){return e instanceof xg}}class JB extends Ki{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=ZA(this,e,!0),r=this.yu.map(s=>ji(s,t)),i=new Li(r);return new hu(e.path,i)}isEqual(e){return this===e}}class XB extends Ki{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=ZA(this,e,!0),r=this.yu.map(s=>ji(s,t)),i=new Mi(r);return new hu(e.path,i)}isEqual(e){return this===e}}class ZB extends Ki{constructor(e,t){super(e),this.wu=t}_toFieldTransform(e){const t=new $s(e.serializer,NT(e.serializer,this.wu));return new hu(e.path,t)}isEqual(e){return this===e}}function Ng(n,e,t,r){const i=n.pu(1,e,t);Og("Data must be an object, but it was:",i,r);const s=[],a=pt.empty();zi(r,(h,f)=>{const p=Lg(e,h,t);f=H(f);const m=i.Ru(p);if(f instanceof _u)s.push(p);else{const I=ji(f,m);I!=null&&(s.push(p),a.set(p,I))}});const l=new qt(s);return new JA(a,l,i.fieldTransforms)}function Vg(n,e,t,r,i,s){const a=n.pu(1,e,t),l=[Kf(e,r,t)],h=[i];if(s.length%2!=0)throw new k(b.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let I=0;I<s.length;I+=2)l.push(Kf(e,s[I])),h.push(s[I+1]);const f=[],p=pt.empty();for(let I=l.length-1;I>=0;--I)if(!r0(f,l[I])){const A=l[I];let L=h[I];L=H(L);const M=a.Ru(A);if(L instanceof _u)f.push(A);else{const V=ji(L,M);V!=null&&(f.push(A),p.set(A,V))}}const m=new qt(f);return new JA(p,m,a.fieldTransforms)}function e0(n,e,t,r=!1){return ji(t,n.pu(r?4:3,e))}function ji(n,e){if(n0(n=H(n)))return Og("Unsupported field value:",e,n),t0(n,e);if(n instanceof Ki)return function(r,i){if(!XA(i.Iu))throw i.mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.mu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.du&&e.Iu!==4)throw e.mu("Nested arrays are not supported");return function(r,i){const s=[];let a=0;for(const l of r){let h=ji(l,i.Vu(a));h==null&&(h={nullValue:"NULL_VALUE"}),s.push(h),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=H(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return NT(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=Oe.fromDate(r);return{timestampValue:Ws(i.serializer,s)}}if(r instanceof Oe){const s=new Oe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ws(i.serializer,s)}}if(r instanceof Zl)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Gn)return{bytesValue:zT(i.serializer,r._byteString)};if(r instanceof Le){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.mu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:rg(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.mu(`Unsupported field value: ${Xl(r)}`)}(n,e)}function t0(n,e){const t={};return fT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):zi(n,(r,i)=>{const s=ji(i,e.Eu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function n0(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Oe||n instanceof Zl||n instanceof Gn||n instanceof Le||n instanceof Ki)}function Og(n,e,t){if(!n0(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const r=Xl(t);throw r==="an object"?e.mu(n+" a custom object"):e.mu(n+" "+r)}}function Kf(n,e,t){if((e=H(e))instanceof Hr)return e._internalPath;if(typeof e=="string")return Lg(n,e);throw ul("Field path arguments must be of type string or ",n,!1,void 0,t)}const eq=new RegExp("[~\\*/\\[\\]]");function Lg(n,e,t){if(e.search(eq)>=0)throw ul(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Hr(...e.split("."))._internalPath}catch{throw ul(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function ul(n,e,t,r,i){const s=r&&!r.isEmpty(),a=i!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(s||a)&&(h+=" (found",s&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new k(b.INVALID_ARGUMENT,l+n+h)}function r0(n,e){return n.some(t=>t.isEqual(e))}class Wa{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Le(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new tq(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(nh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class tq extends Wa{data(){return super.data()}}function nh(n,e){return typeof e=="string"?Lg(n,e):e instanceof Hr?e._internalPath:e._delegate._internalPath}function i0(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new k(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Mg{}class yu extends Mg{}function Cr(n,e,...t){let r=[];e instanceof Mg&&r.push(e),r=r.concat(t),function(s){const a=s.filter(h=>h instanceof Fg).length,l=s.filter(h=>h instanceof rh).length;if(a>1||a>0&&l>0)throw new k(b.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class rh extends yu{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new rh(e,t,r)}_apply(e){const t=this._parse(e);return o0(e._query,t),new Tt(e.firestore,e.converter,Nf(e._query,t))}_parse(e){const t=Hi(e.firestore);return function(s,a,l,h,f,p,m){let I;if(f.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new k(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){bI(m,p);const A=[];for(const L of m)A.push(SI(h,s,L));I={arrayValue:{values:A}}}else I=SI(h,s,m)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||bI(m,p),I=e0(l,a,m,p==="in"||p==="not-in");return he.create(f,p,I)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function nq(n,e,t){const r=e,i=nh("where",n);return rh._create(i,r,t)}class Fg extends Mg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Fg(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Te.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let a=i;const l=s.getFlattenedFilters();for(const h of l)o0(a,h),a=Nf(a,h)}(e._query,t),new Tt(e.firestore,e.converter,Nf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ug extends yu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ug(e,t)}_apply(e){const t=function(i,s,a){if(i.startAt!==null)throw new k(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new k(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Ma(s,a)}(e._query,this._field,this._direction);return new Tt(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new fr(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function rq(n,e="asc"){const t=e,r=nh("orderBy",n);return Ug._create(r,t)}class ih extends yu{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new ih(e,t,r)}_apply(e){return new Tt(e.firestore,e.converter,el(e._query,this._limit,this._limitType))}}function iq(n){return GA("limit",n),ih._create("limit",n,"F")}function sq(n){return GA("limitToLast",n),ih._create("limitToLast",n,"L")}class sh extends yu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new sh(e,t,r)}_apply(e){const t=s0(e,this.type,this._docOrFields,this._inclusive);return new Tt(e.firestore,e.converter,function(i,s){return new fr(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}}function oq(...n){return sh._create("startAt",n,!0)}function aq(...n){return sh._create("startAfter",n,!1)}class oh extends yu{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new oh(e,t,r)}_apply(e){const t=s0(e,this.type,this._docOrFields,this._inclusive);return new Tt(e.firestore,e.converter,function(i,s){return new fr(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}}function uq(...n){return oh._create("endBefore",n,!1)}function cq(...n){return oh._create("endAt",n,!0)}function s0(n,e,t,r){if(t[0]=H(t[0]),t[0]instanceof Wa)return function(s,a,l,h,f){if(!h)throw new k(b.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const p=[];for(const m of xs(s))if(m.field.isKeyField())p.push(Vi(a,h.key));else{const I=h.data.field(m.field);if(Wl(I))throw new k(b.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(I===null){const A=m.field.canonicalString();throw new k(b.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}p.push(I)}return new zr(p,f)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Hi(n.firestore);return function(a,l,h,f,p,m){const I=a.explicitOrderBy;if(p.length>I.length)throw new k(b.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const A=[];for(let L=0;L<p.length;L++){const M=p[L];if(I[L].field.isKeyField()){if(typeof M!="string")throw new k(b.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof M}`);if(!Yp(a)&&M.indexOf("/")!==-1)throw new k(b.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${M}' contains a slash.`);const V=a.path.child(ge.fromString(M));if(!F.isDocumentKey(V))throw new k(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);const Y=new F(V);A.push(Vi(l,Y))}else{const V=e0(h,f,M);A.push(V)}}return new zr(A,m)}(n._query,n.firestore._databaseId,i,e,t,r)}}function SI(n,e,t){if(typeof(t=H(t))=="string"){if(t==="")throw new k(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yp(e)&&t.indexOf("/")!==-1)throw new k(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ge.fromString(t));if(!F.isDocumentKey(r))throw new k(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Vi(n,new F(r))}if(t instanceof Le)return Vi(n,t._key);throw new k(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Xl(t)}.`)}function bI(n,e){if(!Array.isArray(n)||n.length===0)throw new k(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function o0(n,e){const t=function(i,s){for(const a of i)for(const l of a.getFlattenedFilters())if(s.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new k(b.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new k(b.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Bg{convertValue(e,t="none"){switch(Ni(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Be(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes($r(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw $()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return zi(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Zl(Be(e.latitude),Be(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=jp(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Va(e));default:return null}}convertTimestamp(e){const t=qr(e);return new Oe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ge.fromString(e);z(tA(r));const i=new Wr(r.get(1),r.get(3)),s=new F(r.popFirst(5));return i.isEqual(t)||je(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function ah(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class lq extends Bg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Le(this.firestore,null,t)}}class Ai{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}let lr=class extends Wa{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new fa(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(nh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},fa=class extends lr{data(e={}){return super.data(e)}},jr=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ai(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new fa(this._firestore,this._userDataWriter,r.key,r,new Ai(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new k(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(l=>{const h=new fa(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Ai(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>s||l.type!==3).map(l=>{const h=new fa(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Ai(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,p=-1;return l.type!==0&&(f=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),p=a.indexOf(l.doc.key)),{type:hq(l.type),doc:h,oldIndex:f,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function hq(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $()}}function a0(n,e){return n instanceof lr&&e instanceof lr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof jr&&e instanceof jr&&n._firestore===e._firestore&&HA(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function u0(n){n=_e(n,Le);const e=_e(n.firestore,We);return BA(ct(e),n._key).then(t=>qg(e,n,t))}class Qi extends Bg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Gn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Le(this.firestore,null,t)}}function dq(n){n=_e(n,Le);const e=_e(n.firestore,We),t=ct(e),r=new Qi(e);return DB(t,n._key).then(i=>new lr(e,r,n._key,i,new Ai(i!==null&&i.hasLocalMutations,!0),n.converter))}function fq(n){n=_e(n,Le);const e=_e(n.firestore,We);return BA(ct(e),n._key,{source:"server"}).then(t=>qg(e,n,t))}function pq(n){n=_e(n,Tt);const e=_e(n.firestore,We),t=ct(e),r=new Qi(e);return i0(n._query),qA(t,n._query).then(i=>new jr(e,r,n,i))}function gq(n){n=_e(n,Tt);const e=_e(n.firestore,We),t=ct(e),r=new Qi(e);return kB(t,n._query).then(i=>new jr(e,r,n,i))}function mq(n){n=_e(n,Tt);const e=_e(n.firestore,We),t=ct(e),r=new Qi(e);return qA(t,n._query,{source:"server"}).then(i=>new jr(e,r,n,i))}function PI(n,e,t){n=_e(n,Le);const r=_e(n.firestore,We),i=ah(n.converter,e,t);return vu(r,[th(Hi(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Ve.none())])}function CI(n,e,t,...r){n=_e(n,Le);const i=_e(n.firestore,We),s=Hi(i);let a;return a=typeof(e=H(e))=="string"||e instanceof Hr?Vg(s,"updateDoc",n._key,e,t,r):Ng(s,"updateDoc",n._key,e),vu(i,[a.toMutation(n._key,Ve.exists(!0))])}function _q(n){return vu(_e(n.firestore,We),[new oo(n._key,Ve.none())])}function yq(n,e){const t=_e(n.firestore,We),r=$a(n),i=ah(n.converter,e);return vu(t,[th(Hi(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Ve.exists(!1))]).then(()=>r)}function c0(n,...e){var t,r,i;n=H(n);let s={includeMetadataChanges:!1},a=0;typeof e[a]!="object"||zf(e[a])||(s=e[a],a++);const l={includeMetadataChanges:s.includeMetadataChanges};if(zf(e[a])){const m=e[a];e[a]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[a+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[a+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let h,f,p;if(n instanceof Le)f=_e(n.firestore,We),p=io(n._key.path),h={next:m=>{e[a]&&e[a](qg(f,n,m))},error:e[a+1],complete:e[a+2]};else{const m=_e(n,Tt);f=_e(m.firestore,We),p=m._query;const I=new Qi(f);h={next:A=>{e[a]&&e[a](new jr(f,I,m,A))},error:e[a+1],complete:e[a+2]},i0(n._query)}return function(I,A,L,M){const V=new Yl(M),Y=new Ig(A,V,L);return I.asyncQueue.enqueueAndForget(async()=>_g(await js(I),Y)),()=>{V.Na(),I.asyncQueue.enqueueAndForget(async()=>yg(await js(I),Y))}}(ct(f),p,l,h)}function vq(n,e){return xB(ct(n=_e(n,We)),zf(e)?e:{next:e})}function vu(n,e){return function(r,i){const s=new st;return r.asyncQueue.enqueueAndForget(async()=>oB(await Dg(r),i,s)),s.promise}(ct(n),e)}function qg(n,e,t){const r=t.docs.get(e._key),i=new Qi(n);return new lr(n,i,e._key,r,new Ai(t.hasPendingWrites,t.fromCache),e.converter)}const Iq={maxAttempts:5};let wq=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Hi(e)}set(e,t,r){this._verifyNotCommitted();const i=kr(e,this._firestore),s=ah(i.converter,t,r),a=th(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,Ve.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=kr(e,this._firestore);let a;return a=typeof(t=H(t))=="string"||t instanceof Hr?Vg(this._dataReader,"WriteBatch.update",s._key,t,r,i):Ng(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,Ve.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=kr(e,this._firestore);return this._mutations=this._mutations.concat(new oo(t._key,Ve.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new k(b.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function kr(n,e){if((n=H(n)).firestore!==e)throw new k(b.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}let Eq=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Hi(t)}get(t){const r=kr(t,this._firestore),i=new lq(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return $();const a=s[0];if(a.isFoundDocument())return new Wa(this._firestore,i,a.key,a,r.converter);if(a.isNoDocument())return new Wa(this._firestore,i,r._key,null,r.converter);throw $()})}set(t,r,i){const s=kr(t,this._firestore),a=ah(s.converter,r,i),l=th(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,l),this}update(t,r,i,...s){const a=kr(t,this._firestore);let l;return l=typeof(r=H(r))=="string"||r instanceof Hr?Vg(this._dataReader,"Transaction.update",a._key,r,i,s):Ng(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,l),this}delete(t){const r=kr(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=kr(e,this._firestore),r=new Qi(this._firestore);return super.get(e).then(i=>new lr(this._firestore,r,t._key,i._document,new Ai(!1,!1),t.converter))}};function Tq(n,e,t){n=_e(n,We);const r=Object.assign(Object.assign({},Iq),t);return function(s){if(s.maxAttempts<1)throw new k(b.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,a,l){const h=new st;return s.asyncQueue.enqueueAndForget(async()=>{const f=await bB(s);new RB(s.asyncQueue,f,l,a,h).run()}),h.promise}(ct(n),i=>e(new Eq(n,i)),r)}function Aq(){return new _u("deleteField")}function Rq(){return new xg("serverTimestamp")}function Sq(...n){return new JB("arrayUnion",n)}function bq(...n){return new XB("arrayRemove",n)}function Pq(n){return new ZB("increment",n)}(function(e,t=!0){(function(i){ro=i})(Qr),Fr(new qn("firestore",(r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),l=new We(new LF(r.getProvider("auth-internal")),new BF(r.getProvider("app-check-internal")),function(f,p){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new k(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wr(f.options.projectId,p)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),l._setSettings(s),l},"PUBLIC").setMultipleInstances(!0)),Mn(Tv,"4.4.0",e),Mn(Tv,"4.4.0","esm2017")})();const Cq="@firebase/firestore-compat",Dq="0.3.23";function $g(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new k("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function DI(){if(typeof Uint8Array>"u")throw new k("unimplemented","Uint8Arrays are not available in this environment.")}function kI(){if(!h2())throw new k("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Ga{constructor(e){this._delegate=e}static fromBase64String(e){return kI(),new Ga(Gn.fromBase64String(e))}static fromUint8Array(e){return DI(),new Ga(Gn.fromUint8Array(e))}toBase64(){return kI(),this._delegate.toBase64()}toUint8Array(){return DI(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Hf(n){return kq(n,["next","error","complete"])}function kq(n,e){if(typeof n!="object"||n===null)return!1;const t=n;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}class xq{enableIndexedDbPersistence(e,t){return BB(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return qB(e._delegate)}clearIndexedDbPersistence(e){return $B(e._delegate)}}class l0{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Wr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&In("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){OB(this._delegate,e,t,r)}enableNetwork(){return GB(this._delegate)}disableNetwork(){return zB(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,WA("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return WB(this._delegate)}onSnapshotsInSync(e){return vq(this._delegate,e)}get app(){if(!this._appCompat)throw new k("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Qs(this,zA(this._delegate,e))}catch(t){throw Pt(t,"collection()","Firestore.collection()")}}doc(e){try{return new cn(this,$a(this._delegate,e))}catch(t){throw Pt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new bt(this,LB(this._delegate,e))}catch(t){throw Pt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Tq(this._delegate,t=>e(new h0(this,t)))}batch(){return ct(this._delegate),new d0(new wq(this._delegate,e=>vu(this._delegate,e)))}loadBundle(e){return KB(this._delegate,e)}namedQuery(e){return HB(this._delegate,e).then(t=>t?new bt(this,t):null)}}class uh extends Bg{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ga(new Gn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return cn.forKey(t,this.firestore,null)}}function Nq(n){xF(n)}class h0{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new uh(e)}get(e){const t=Ri(e);return this._delegate.get(t).then(r=>new za(this._firestore,new lr(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=Ri(e);return r?($g("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Ri(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Ri(e);return this._delegate.delete(t),this}}class d0{constructor(e){this._delegate=e}set(e,t,r){const i=Ri(e);return r?($g("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=Ri(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=Ri(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class qi{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new fa(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ka(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=qi.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new qi(e,new uh(e),t),i.set(t,s)),s}}qi.INSTANCES=new WeakMap;class cn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new uh(e)}static forPath(e,t,r){if(e.length%2!==0)throw new k("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new cn(t,new Le(t._delegate,r,new F(e)))}static forKey(e,t,r){return new cn(t,new Le(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Qs(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Qs(this.firestore,zA(this._delegate,e))}catch(t){throw Pt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=H(e),e instanceof Le?KA(this._delegate,e):!1}set(e,t){t=$g("DocumentReference.set",t);try{return t?PI(this._delegate,e,t):PI(this._delegate,e)}catch(r){throw Pt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?CI(this._delegate,e):CI(this._delegate,e,t,...r)}catch(i){throw Pt(i,"updateDoc()","DocumentReference.update()")}}delete(){return _q(this._delegate)}onSnapshot(...e){const t=f0(e),r=p0(e,i=>new za(this.firestore,new lr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return c0(this._delegate,t,r)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=dq(this._delegate):(e==null?void 0:e.source)==="server"?t=fq(this._delegate):t=u0(this._delegate),t.then(r=>new za(this.firestore,new lr(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new cn(this.firestore,e?this._delegate.withConverter(qi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Pt(n,e,t){return n.message=n.message.replace(e,t),n}function f0(n){for(const e of n)if(typeof e=="object"&&!Hf(e))return e;return{}}function p0(n,e){var t,r;let i;return Hf(n[0])?i=n[0]:Hf(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}class za{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new cn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return a0(this._delegate,e._delegate)}}class Ka extends za{data(e){const t=this._delegate.data(e);return this._delegate._converter||NF(t!==void 0),t}}class bt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new uh(e)}where(e,t,r){try{return new bt(this.firestore,Cr(this._delegate,nq(e,t,r)))}catch(i){throw Pt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new bt(this.firestore,Cr(this._delegate,rq(e,t)))}catch(r){throw Pt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new bt(this.firestore,Cr(this._delegate,iq(e)))}catch(t){throw Pt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new bt(this.firestore,Cr(this._delegate,sq(e)))}catch(t){throw Pt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new bt(this.firestore,Cr(this._delegate,oq(...e)))}catch(t){throw Pt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new bt(this.firestore,Cr(this._delegate,aq(...e)))}catch(t){throw Pt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new bt(this.firestore,Cr(this._delegate,uq(...e)))}catch(t){throw Pt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new bt(this.firestore,Cr(this._delegate,cq(...e)))}catch(t){throw Pt(t,"endAt()","Query.endAt()")}}isEqual(e){return HA(this._delegate,e._delegate)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=gq(this._delegate):(e==null?void 0:e.source)==="server"?t=mq(this._delegate):t=pq(this._delegate),t.then(r=>new jf(this.firestore,new jr(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=f0(e),r=p0(e,i=>new jf(this.firestore,new jr(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return c0(this._delegate,t,r)}withConverter(e){return new bt(this.firestore,e?this._delegate.withConverter(qi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class Vq{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Ka(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class jf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new bt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ka(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Vq(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Ka(this._firestore,r))})}isEqual(e){return a0(this._delegate,e._delegate)}}class Qs extends bt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new cn(this.firestore,e):null}doc(e){try{return e===void 0?new cn(this.firestore,$a(this._delegate)):new cn(this.firestore,$a(this._delegate,e))}catch(t){throw Pt(t,"doc()","CollectionReference.doc()")}}add(e){return yq(this._delegate,e).then(t=>new cn(this.firestore,t))}isEqual(e){return KA(this._delegate,e._delegate)}withConverter(e){return new Qs(this.firestore,e?this._delegate.withConverter(qi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function Ri(n){return _e(n,Le)}class Wg{constructor(...e){this._delegate=new Hr(...e)}static documentId(){return new Wg(Ne.keyField().canonicalString())}isEqual(e){return e=H(e),e instanceof Hr?this._delegate._internalPath.isEqual(e._internalPath):!1}}class Ii{constructor(e){this._delegate=e}static serverTimestamp(){const e=Rq();return e._methodName="FieldValue.serverTimestamp",new Ii(e)}static delete(){const e=Aq();return e._methodName="FieldValue.delete",new Ii(e)}static arrayUnion(...e){const t=Sq(...e);return t._methodName="FieldValue.arrayUnion",new Ii(t)}static arrayRemove(...e){const t=bq(...e);return t._methodName="FieldValue.arrayRemove",new Ii(t)}static increment(e){const t=Pq(e);return t._methodName="FieldValue.increment",new Ii(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Oq={Firestore:l0,GeoPoint:Zl,Timestamp:Oe,Blob:Ga,Transaction:h0,WriteBatch:d0,DocumentReference:cn,DocumentSnapshot:za,Query:bt,QueryDocumentSnapshot:Ka,QuerySnapshot:jf,CollectionReference:Qs,FieldPath:Wg,FieldValue:Ii,setLogLevel:Nq,CACHE_SIZE_UNLIMITED:UB};function Lq(n,e){n.INTERNAL.registerComponent(new qn("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},Oq)))}function Mq(n){Lq(n,(e,t)=>new l0(e,t,new xq)),n.registerVersion(Cq,Dq)}Mq(Ur);const Fq={apiKey:"AIzaSyCfFGZC07caKFCARPJmMU-qsuAW8jLIu3E",authDomain:"project-fitness-07.firebaseapp.com",projectId:"project-fitness-07",storageBucket:"project-fitness-07.appspot.com",messagingSenderId:"607206642972",appId:"1:607206642972:web:ea1d5c525a976b668cd6d9"},Ha=Ur.initializeApp(Fq);async function B4({email:n,password:e,name:t}){await Ha.auth().createUserWithEmailAndPassword(n,e),await(await Ha.auth().currentUser).updateProfile({displayName:t})}async function q4({email:n,password:e}){try{await Ha.auth().signInWithEmailAndPassword(n,e)}catch(t){console.log(t.message)}}async function $4(){await Ha.auth().signOut()}const jo={fs:Ur.firestore(),getCurrentUserID:async function(){return new Promise((n,e)=>{Ha.auth().onAuthStateChanged(t=>{t?n(t.uid):e("User not authenticated")})})},addData:async function(n,e){const t=await this.getCurrentUserID();this.fs.collection("users").doc(t).set({[n]:e},{merge:!0}).then(()=>!0).catch(r=>(console.error("Error writing document: ",r),!1))},removeData:async function(n){const e=await this.getCurrentUserID();this.fs.collection("users").doc(e).update({[n]:Ur.firestore.FieldValue.delete()},{merge:!0}).then(()=>!0).catch(t=>(console.error("Error writing document: ",t),!1))},getData:async function(){const n=await this.getCurrentUserID(),e=$a(this.fs,"users",n),t=await u0(e);if(t.exists())return t.data();console.error("No such document")}},Vs={add:function(n,e){return new Promise((t,r)=>{try{jo.addData(n,e),t(!0)}catch{r(!1)}})},get:function(){return new Promise(async(n,e)=>{try{const t=await jo.getData();n(Object.values(t))}catch{e([])}})},idIsFavorite:async function(n){try{return(await this.get()).some(t=>t._id===n)}catch{return!1}},getObjectById:async function(n){try{const t=(await this.get()).find(r=>r._id===n)||null;return t?{...t,isFavorite:!0}:null}catch{return null}},addAndGet:async function(n,e){return new Promise(async(t,r)=>{try{await jo.addData(n,e),setTimeout(async()=>{const i=await jo.getData();t(Object.values(i))},200)}catch{r([])}})},remove:async function(n){return new Promise((e,t)=>{try{jo.removeData(n),e(!0)}catch{t(!1)}})}},Uq=async function(n){const{_id:e}=n;try{if(await Vs.idIsFavorite(e)){const r=await Vs.remove(e);return console.log(`Object with _id ${e} removed from favorites.`),!1}else{const r=await Vs.add(e,n);return console.log(`Object with _id ${e} added to favorites.`),r}}catch(t){return console.error(t),!1}},Bq=n=>{const e="js-toggle-favorit",t=document.getElementById(e);return t.addEventListener("click",async i=>{const s=await Uq(n),a=s?"Remove from favorites":"Add to favorites",l=s?"icon-trash":"icon-heart";t.innerHTML=`<span >${a}</span>
       <svg class="btn-icon">
            <use href="/images/icons-sprite.svg#${l}" />
          </svg>`})},qq=n=>typeof n!="string"?n:n.split(" ").filter(e=>e).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),xI=n=>typeof n!="string"?n:n.charAt(0).toUpperCase()+n.slice(1),$q=n=>typeof n!="string"?n:n.replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase(),Wq=n=>{const e=getComputedStyle(document.documentElement).getPropertyValue("--rating-color-inactive"),t=getComputedStyle(document.documentElement).getPropertyValue("--rating-color-active");return`
<!-- DEFINE SVGs -->
<svg height="0" width="0">
  <defs>
    <!-- DEFINE ONE STAR -->
    <symbol viewBox="0 0 32 32" id="iconstar">
      <path
        d="M13.826 3.262c.684-2.106 3.663-2.106 4.348 0l1.932 5.945a2.285 2.285 0 0 0 2.174 1.579h6.251c2.214 0 3.135 2.833 1.344 4.135l-5.057 3.674a2.286 2.286 0 0 0-.83 2.556l1.931 5.945c.684 2.106-1.726 3.857-3.517 2.555l-5.057-3.674a2.286 2.286 0 0 0-2.687 0l-5.057 3.674c-1.791 1.302-4.202-.45-3.517-2.555l1.932-5.945a2.287 2.287 0 0 0-.83-2.556l-5.057-3.674c-1.791-1.302-.871-4.135 1.344-4.135h6.251c.99 0 1.868-.638 2.174-1.579l1.932-5.945z" />
    </symbol>
    <!-- DEFINE PATTERN FOR EMPTY STARS -->
    <pattern id="stars-empty" patternUnits="userSpaceOnUse" width="24" height="24">
      <use x="0" y="0" xlink:href="#iconstar" fill="${e}" height="24" width="24"/>
    </pattern>
    <!-- DEFINE PATTERN FOR FULL STARS -->
    <pattern id="stars-full" patternUnits="userSpaceOnUse" width="24" height="24">
      <use x="0" y="0" xlink:href="#iconstar" fill="${t}" height="24" width="24"/>
    </pattern>
  </defs>
</svg>

<!-- INSERT STARS -->
<svg height="24" viewBox="0 0 120 24" width="120">
  <rect fill="url(#stars-empty)" x="0" y="0" height="24" width="120"/>
  <rect fill="url(#stars-full)" x="0" y="0" height="24" width="${n}%"/>
</svg>
`},cl=document.querySelector(".js-backdrop"),ho=document.querySelector(".modalExercise"),g0=ho.querySelector(".x-button"),NI=ho.querySelector(".modalExercise__img-wrapper"),Qo=ho.querySelector(".exercise-content"),Ac=ho.querySelector(".button-box"),Gq="/project-fitness-07/",zq=5;let m0;const Kq=n=>{const{gifUrl:e,name:t,rating:r,_id:i,isFavorite:s,description:a}=n,l=Hq(n);NI.innerHTML="",NI.insertAdjacentHTML("afterbegin",Jq(e,t)),Qo.innerHTML="",Qo.insertAdjacentHTML("beforeend",Qq(t)),Qo.insertAdjacentHTML("beforeend",Yq(r)),Qo.insertAdjacentHTML("beforeend",Xq(l)),Qo.insertAdjacentHTML("beforeend",Zq(a)),jq(s)},Hq=n=>({bodyPart:n.bodyPart,equipment:n.equipment,rating:n.rating,burnedCalories:n.burnedCalories,time:n.time,popular:n.popularity}),jq=(n=!1)=>{Ac.innerHTML="",n?Ac.insertAdjacentHTML("beforeend",t4()):Ac.insertAdjacentHTML("beforeend",e4()),Ac.insertAdjacentHTML("beforeend",n4())},Qq=n=>`
    <h3 class="title">${qq(n)}</h3>
  `,Yq=n=>{const e=[],t=Math.round(n*10)/10;e.push(`<li class="rating__item value">${t}</li>`);const r=Math.round(n/zq*100);return e.push(`<li ${Wq(r)}</li>`),`<ul class="rating">${e.join("")}</ul>`},Jq=(n,e)=>`
    <img src="${n}" alt="${e}"/>
  `,Xq=({burnedCalories:n,time:e,...t})=>{const r=[];for(const[i,s]of Object.entries(t)){const a=$q(i),l=xI(a),h=xI(s);r.push(`
      <li class="exercise_details-item">
        <p class="detail-name">${l}</p>
        <p class="detail-value">${h}</p>
      </li>
    `)}return r.push(`
      <li class="exercise_details-item">
        <p class="detail-name">Burned Calories</p>
        <p class="detail-value">${n}/${e} min</p>
      </li>
  `),`<ul class="exercise_details">${r.join("")}</ul>`},Zq=n=>`
    <p class="exercise_description">${n}</p>

  `,e4=()=>Gg({text:"Add to favorites",iconId:"icon-heart",className:"js-toggle-favorite"}),t4=()=>Gg({text:"Remove from favorites",iconId:"icon-trash",className:"js-toggle-favorite"}),n4=()=>Gg({text:"Give a rating",className:"js-give-rating ghost"}),Gg=({text:n,iconId:e,className:t=""})=>{let r;return e&&(r=`
      <svg class="btn-icon">
        <use href=${Gq}images/icons-sprite.svg#${e} />
      </svg>
    `),`
    <button id="js-toggle-favorit" type="button" class="button ${t}">
      <span>${n}</span>
      ${e?r:""}
    </button>
  `},ch=()=>{cl.classList.remove("open"),ho.classList.remove("open"),g0.removeEventListener("click",ch),document.body.style.overflow="visible";const n="js-toggle-favorit";try{document.getElementById(n).removeEventListener("click",m0)}catch{console.error(`${n} not found!`)}},r4=async n=>{const{_id:e}=n;n.isFavorite=await Vs.idIsFavorite(e),Kq(n),cl.classList.add("open"),ho.classList.add("open"),g0.addEventListener("click",ch),document.body.style.overflow="hidden",m0=Bq(n)};document.addEventListener("keydown",n=>{n.key==="Escape"&&ch()});cl.addEventListener("click",n=>{n.target===cl&&ch()});const ef=document.querySelector(".exercise-cards__section");function i4(n,e){e>=375&&e<768&&n!=3?ef.style.height="1320px":e>768&&n!=3?ef.style.height="900px":ef.style.height=""}var Yo=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ll={},s4={get exports(){return ll},set exports(n){ll=n}};(function(n,e){(function(){var t,r="4.17.21",i=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",l="Invalid `variable` option passed into `_.template`",h="__lodash_hash_undefined__",f=500,p="__lodash_placeholder__",m=1,I=2,A=4,L=1,M=2,V=1,Y=2,ae=4,j=8,ye=16,de=32,me=64,we=128,Nt=256,zn=512,Yi=30,v0="...",I0=800,w0=16,Kg=1,E0=2,T0=3,ri=1/0,mr=9007199254740991,A0=17976931348623157e292,Iu=0/0,wn=4294967295,R0=wn-1,S0=wn>>>1,b0=[["ary",we],["bind",V],["bindKey",Y],["curry",j],["curryRight",ye],["flip",zn],["partial",de],["partialRight",me],["rearg",Nt]],Ji="[object Arguments]",wu="[object Array]",P0="[object AsyncFunction]",po="[object Boolean]",go="[object Date]",C0="[object DOMException]",Eu="[object Error]",Tu="[object Function]",Hg="[object GeneratorFunction]",hn="[object Map]",mo="[object Number]",D0="[object Null]",Kn="[object Object]",jg="[object Promise]",k0="[object Proxy]",_o="[object RegExp]",dn="[object Set]",yo="[object String]",Au="[object Symbol]",x0="[object Undefined]",vo="[object WeakMap]",N0="[object WeakSet]",Io="[object ArrayBuffer]",Xi="[object DataView]",lh="[object Float32Array]",hh="[object Float64Array]",dh="[object Int8Array]",fh="[object Int16Array]",ph="[object Int32Array]",gh="[object Uint8Array]",mh="[object Uint8ClampedArray]",_h="[object Uint16Array]",yh="[object Uint32Array]",V0=/\b__p \+= '';/g,O0=/\b(__p \+=) '' \+/g,L0=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Qg=/&(?:amp|lt|gt|quot|#39);/g,Yg=/[&<>"']/g,M0=RegExp(Qg.source),F0=RegExp(Yg.source),U0=/<%-([\s\S]+?)%>/g,B0=/<%([\s\S]+?)%>/g,Jg=/<%=([\s\S]+?)%>/g,q0=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$0=/^\w*$/,W0=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,vh=/[\\^$.*+?()[\]{}|]/g,G0=RegExp(vh.source),Ih=/^\s+/,z0=/\s/,K0=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,H0=/\{\n\/\* \[wrapped with (.+)\] \*/,j0=/,? & /,Q0=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Y0=/[()=,{}\[\]\/\s]/,J0=/\\(\\)?/g,X0=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Xg=/\w*$/,Z0=/^[-+]0x[0-9a-f]+$/i,eR=/^0b[01]+$/i,tR=/^\[object .+?Constructor\]$/,nR=/^0o[0-7]+$/i,rR=/^(?:0|[1-9]\d*)$/,iR=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Ru=/($^)/,sR=/['\n\r\u2028\u2029\\]/g,Su="\\ud800-\\udfff",oR="\\u0300-\\u036f",aR="\\ufe20-\\ufe2f",uR="\\u20d0-\\u20ff",Zg=oR+aR+uR,em="\\u2700-\\u27bf",tm="a-z\\xdf-\\xf6\\xf8-\\xff",cR="\\xac\\xb1\\xd7\\xf7",lR="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",hR="\\u2000-\\u206f",dR=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",nm="A-Z\\xc0-\\xd6\\xd8-\\xde",rm="\\ufe0e\\ufe0f",im=cR+lR+hR+dR,wh="['’]",fR="["+Su+"]",sm="["+im+"]",bu="["+Zg+"]",om="\\d+",pR="["+em+"]",am="["+tm+"]",um="[^"+Su+im+om+em+tm+nm+"]",Eh="\\ud83c[\\udffb-\\udfff]",gR="(?:"+bu+"|"+Eh+")",cm="[^"+Su+"]",Th="(?:\\ud83c[\\udde6-\\uddff]){2}",Ah="[\\ud800-\\udbff][\\udc00-\\udfff]",Zi="["+nm+"]",lm="\\u200d",hm="(?:"+am+"|"+um+")",mR="(?:"+Zi+"|"+um+")",dm="(?:"+wh+"(?:d|ll|m|re|s|t|ve))?",fm="(?:"+wh+"(?:D|LL|M|RE|S|T|VE))?",pm=gR+"?",gm="["+rm+"]?",_R="(?:"+lm+"(?:"+[cm,Th,Ah].join("|")+")"+gm+pm+")*",yR="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vR="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",mm=gm+pm+_R,IR="(?:"+[pR,Th,Ah].join("|")+")"+mm,wR="(?:"+[cm+bu+"?",bu,Th,Ah,fR].join("|")+")",ER=RegExp(wh,"g"),TR=RegExp(bu,"g"),Rh=RegExp(Eh+"(?="+Eh+")|"+wR+mm,"g"),AR=RegExp([Zi+"?"+am+"+"+dm+"(?="+[sm,Zi,"$"].join("|")+")",mR+"+"+fm+"(?="+[sm,Zi+hm,"$"].join("|")+")",Zi+"?"+hm+"+"+dm,Zi+"+"+fm,vR,yR,om,IR].join("|"),"g"),RR=RegExp("["+lm+Su+Zg+rm+"]"),SR=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,bR=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],PR=-1,Ce={};Ce[lh]=Ce[hh]=Ce[dh]=Ce[fh]=Ce[ph]=Ce[gh]=Ce[mh]=Ce[_h]=Ce[yh]=!0,Ce[Ji]=Ce[wu]=Ce[Io]=Ce[po]=Ce[Xi]=Ce[go]=Ce[Eu]=Ce[Tu]=Ce[hn]=Ce[mo]=Ce[Kn]=Ce[_o]=Ce[dn]=Ce[yo]=Ce[vo]=!1;var be={};be[Ji]=be[wu]=be[Io]=be[Xi]=be[po]=be[go]=be[lh]=be[hh]=be[dh]=be[fh]=be[ph]=be[hn]=be[mo]=be[Kn]=be[_o]=be[dn]=be[yo]=be[Au]=be[gh]=be[mh]=be[_h]=be[yh]=!0,be[Eu]=be[Tu]=be[vo]=!1;var CR={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},DR={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},kR={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},xR={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},NR=parseFloat,VR=parseInt,_m=typeof Yo=="object"&&Yo&&Yo.Object===Object&&Yo,OR=typeof self=="object"&&self&&self.Object===Object&&self,lt=_m||OR||Function("return this")(),Sh=e&&!e.nodeType&&e,ii=Sh&&!0&&n&&!n.nodeType&&n,ym=ii&&ii.exports===Sh,bh=ym&&_m.process,Zt=function(){try{var E=ii&&ii.require&&ii.require("util").types;return E||bh&&bh.binding&&bh.binding("util")}catch{}}(),vm=Zt&&Zt.isArrayBuffer,Im=Zt&&Zt.isDate,wm=Zt&&Zt.isMap,Em=Zt&&Zt.isRegExp,Tm=Zt&&Zt.isSet,Am=Zt&&Zt.isTypedArray;function Wt(E,P,S){switch(S.length){case 0:return E.call(P);case 1:return E.call(P,S[0]);case 2:return E.call(P,S[0],S[1]);case 3:return E.call(P,S[0],S[1],S[2])}return E.apply(P,S)}function LR(E,P,S,W){for(var ee=-1,ve=E==null?0:E.length;++ee<ve;){var Xe=E[ee];P(W,Xe,S(Xe),E)}return W}function en(E,P){for(var S=-1,W=E==null?0:E.length;++S<W&&P(E[S],S,E)!==!1;);return E}function MR(E,P){for(var S=E==null?0:E.length;S--&&P(E[S],S,E)!==!1;);return E}function Rm(E,P){for(var S=-1,W=E==null?0:E.length;++S<W;)if(!P(E[S],S,E))return!1;return!0}function _r(E,P){for(var S=-1,W=E==null?0:E.length,ee=0,ve=[];++S<W;){var Xe=E[S];P(Xe,S,E)&&(ve[ee++]=Xe)}return ve}function Pu(E,P){var S=E==null?0:E.length;return!!S&&es(E,P,0)>-1}function Ph(E,P,S){for(var W=-1,ee=E==null?0:E.length;++W<ee;)if(S(P,E[W]))return!0;return!1}function xe(E,P){for(var S=-1,W=E==null?0:E.length,ee=Array(W);++S<W;)ee[S]=P(E[S],S,E);return ee}function yr(E,P){for(var S=-1,W=P.length,ee=E.length;++S<W;)E[ee+S]=P[S];return E}function Ch(E,P,S,W){var ee=-1,ve=E==null?0:E.length;for(W&&ve&&(S=E[++ee]);++ee<ve;)S=P(S,E[ee],ee,E);return S}function FR(E,P,S,W){var ee=E==null?0:E.length;for(W&&ee&&(S=E[--ee]);ee--;)S=P(S,E[ee],ee,E);return S}function Dh(E,P){for(var S=-1,W=E==null?0:E.length;++S<W;)if(P(E[S],S,E))return!0;return!1}var UR=kh("length");function BR(E){return E.split("")}function qR(E){return E.match(Q0)||[]}function Sm(E,P,S){var W;return S(E,function(ee,ve,Xe){if(P(ee,ve,Xe))return W=ve,!1}),W}function Cu(E,P,S,W){for(var ee=E.length,ve=S+(W?1:-1);W?ve--:++ve<ee;)if(P(E[ve],ve,E))return ve;return-1}function es(E,P,S){return P===P?ZR(E,P,S):Cu(E,bm,S)}function $R(E,P,S,W){for(var ee=S-1,ve=E.length;++ee<ve;)if(W(E[ee],P))return ee;return-1}function bm(E){return E!==E}function Pm(E,P){var S=E==null?0:E.length;return S?Nh(E,P)/S:Iu}function kh(E){return function(P){return P==null?t:P[E]}}function xh(E){return function(P){return E==null?t:E[P]}}function Cm(E,P,S,W,ee){return ee(E,function(ve,Xe,Se){S=W?(W=!1,ve):P(S,ve,Xe,Se)}),S}function WR(E,P){var S=E.length;for(E.sort(P);S--;)E[S]=E[S].value;return E}function Nh(E,P){for(var S,W=-1,ee=E.length;++W<ee;){var ve=P(E[W]);ve!==t&&(S=S===t?ve:S+ve)}return S}function Vh(E,P){for(var S=-1,W=Array(E);++S<E;)W[S]=P(S);return W}function GR(E,P){return xe(P,function(S){return[S,E[S]]})}function Dm(E){return E&&E.slice(0,Vm(E)+1).replace(Ih,"")}function Gt(E){return function(P){return E(P)}}function Oh(E,P){return xe(P,function(S){return E[S]})}function wo(E,P){return E.has(P)}function km(E,P){for(var S=-1,W=E.length;++S<W&&es(P,E[S],0)>-1;);return S}function xm(E,P){for(var S=E.length;S--&&es(P,E[S],0)>-1;);return S}function zR(E,P){for(var S=E.length,W=0;S--;)E[S]===P&&++W;return W}var KR=xh(CR),HR=xh(DR);function jR(E){return"\\"+xR[E]}function QR(E,P){return E==null?t:E[P]}function ts(E){return RR.test(E)}function YR(E){return SR.test(E)}function JR(E){for(var P,S=[];!(P=E.next()).done;)S.push(P.value);return S}function Lh(E){var P=-1,S=Array(E.size);return E.forEach(function(W,ee){S[++P]=[ee,W]}),S}function Nm(E,P){return function(S){return E(P(S))}}function vr(E,P){for(var S=-1,W=E.length,ee=0,ve=[];++S<W;){var Xe=E[S];(Xe===P||Xe===p)&&(E[S]=p,ve[ee++]=S)}return ve}function Du(E){var P=-1,S=Array(E.size);return E.forEach(function(W){S[++P]=W}),S}function XR(E){var P=-1,S=Array(E.size);return E.forEach(function(W){S[++P]=[W,W]}),S}function ZR(E,P,S){for(var W=S-1,ee=E.length;++W<ee;)if(E[W]===P)return W;return-1}function eS(E,P,S){for(var W=S+1;W--;)if(E[W]===P)return W;return W}function ns(E){return ts(E)?nS(E):UR(E)}function fn(E){return ts(E)?rS(E):BR(E)}function Vm(E){for(var P=E.length;P--&&z0.test(E.charAt(P)););return P}var tS=xh(kR);function nS(E){for(var P=Rh.lastIndex=0;Rh.test(E);)++P;return P}function rS(E){return E.match(Rh)||[]}function iS(E){return E.match(AR)||[]}var sS=function E(P){P=P==null?lt:rs.defaults(lt.Object(),P,rs.pick(lt,bR));var S=P.Array,W=P.Date,ee=P.Error,ve=P.Function,Xe=P.Math,Se=P.Object,Mh=P.RegExp,oS=P.String,tn=P.TypeError,ku=S.prototype,aS=ve.prototype,is=Se.prototype,xu=P["__core-js_shared__"],Nu=aS.toString,Ee=is.hasOwnProperty,uS=0,Om=function(){var o=/[^.]+$/.exec(xu&&xu.keys&&xu.keys.IE_PROTO||"");return o?"Symbol(src)_1."+o:""}(),Vu=is.toString,cS=Nu.call(Se),lS=lt._,hS=Mh("^"+Nu.call(Ee).replace(vh,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ou=ym?P.Buffer:t,Ir=P.Symbol,Lu=P.Uint8Array,Lm=Ou?Ou.allocUnsafe:t,Mu=Nm(Se.getPrototypeOf,Se),Mm=Se.create,Fm=is.propertyIsEnumerable,Fu=ku.splice,Um=Ir?Ir.isConcatSpreadable:t,Eo=Ir?Ir.iterator:t,si=Ir?Ir.toStringTag:t,Uu=function(){try{var o=li(Se,"defineProperty");return o({},"",{}),o}catch{}}(),dS=P.clearTimeout!==lt.clearTimeout&&P.clearTimeout,fS=W&&W.now!==lt.Date.now&&W.now,pS=P.setTimeout!==lt.setTimeout&&P.setTimeout,Bu=Xe.ceil,qu=Xe.floor,Fh=Se.getOwnPropertySymbols,gS=Ou?Ou.isBuffer:t,Bm=P.isFinite,mS=ku.join,_S=Nm(Se.keys,Se),Ze=Xe.max,yt=Xe.min,yS=W.now,vS=P.parseInt,qm=Xe.random,IS=ku.reverse,Uh=li(P,"DataView"),To=li(P,"Map"),Bh=li(P,"Promise"),ss=li(P,"Set"),Ao=li(P,"WeakMap"),Ro=li(Se,"create"),$u=Ao&&new Ao,os={},wS=hi(Uh),ES=hi(To),TS=hi(Bh),AS=hi(ss),RS=hi(Ao),Wu=Ir?Ir.prototype:t,So=Wu?Wu.valueOf:t,$m=Wu?Wu.toString:t;function _(o){if(Ue(o)&&!te(o)&&!(o instanceof le)){if(o instanceof nn)return o;if(Ee.call(o,"__wrapped__"))return W_(o)}return new nn(o)}var as=function(){function o(){}return function(u){if(!Me(u))return{};if(Mm)return Mm(u);o.prototype=u;var c=new o;return o.prototype=t,c}}();function Gu(){}function nn(o,u){this.__wrapped__=o,this.__actions__=[],this.__chain__=!!u,this.__index__=0,this.__values__=t}_.templateSettings={escape:U0,evaluate:B0,interpolate:Jg,variable:"",imports:{_}},_.prototype=Gu.prototype,_.prototype.constructor=_,nn.prototype=as(Gu.prototype),nn.prototype.constructor=nn;function le(o){this.__wrapped__=o,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=wn,this.__views__=[]}function SS(){var o=new le(this.__wrapped__);return o.__actions__=Vt(this.__actions__),o.__dir__=this.__dir__,o.__filtered__=this.__filtered__,o.__iteratees__=Vt(this.__iteratees__),o.__takeCount__=this.__takeCount__,o.__views__=Vt(this.__views__),o}function bS(){if(this.__filtered__){var o=new le(this);o.__dir__=-1,o.__filtered__=!0}else o=this.clone(),o.__dir__*=-1;return o}function PS(){var o=this.__wrapped__.value(),u=this.__dir__,c=te(o),d=u<0,g=c?o.length:0,y=Bb(0,g,this.__views__),v=y.start,w=y.end,T=w-v,C=d?w:v-1,D=this.__iteratees__,x=D.length,U=0,G=yt(T,this.__takeCount__);if(!c||!d&&g==T&&G==T)return d_(o,this.__actions__);var J=[];e:for(;T--&&U<G;){C+=u;for(var se=-1,X=o[C];++se<x;){var ue=D[se],fe=ue.iteratee,Ht=ue.type,St=fe(X);if(Ht==E0)X=St;else if(!St){if(Ht==Kg)continue e;break e}}J[U++]=X}return J}le.prototype=as(Gu.prototype),le.prototype.constructor=le;function oi(o){var u=-1,c=o==null?0:o.length;for(this.clear();++u<c;){var d=o[u];this.set(d[0],d[1])}}function CS(){this.__data__=Ro?Ro(null):{},this.size=0}function DS(o){var u=this.has(o)&&delete this.__data__[o];return this.size-=u?1:0,u}function kS(o){var u=this.__data__;if(Ro){var c=u[o];return c===h?t:c}return Ee.call(u,o)?u[o]:t}function xS(o){var u=this.__data__;return Ro?u[o]!==t:Ee.call(u,o)}function NS(o,u){var c=this.__data__;return this.size+=this.has(o)?0:1,c[o]=Ro&&u===t?h:u,this}oi.prototype.clear=CS,oi.prototype.delete=DS,oi.prototype.get=kS,oi.prototype.has=xS,oi.prototype.set=NS;function Hn(o){var u=-1,c=o==null?0:o.length;for(this.clear();++u<c;){var d=o[u];this.set(d[0],d[1])}}function VS(){this.__data__=[],this.size=0}function OS(o){var u=this.__data__,c=zu(u,o);if(c<0)return!1;var d=u.length-1;return c==d?u.pop():Fu.call(u,c,1),--this.size,!0}function LS(o){var u=this.__data__,c=zu(u,o);return c<0?t:u[c][1]}function MS(o){return zu(this.__data__,o)>-1}function FS(o,u){var c=this.__data__,d=zu(c,o);return d<0?(++this.size,c.push([o,u])):c[d][1]=u,this}Hn.prototype.clear=VS,Hn.prototype.delete=OS,Hn.prototype.get=LS,Hn.prototype.has=MS,Hn.prototype.set=FS;function jn(o){var u=-1,c=o==null?0:o.length;for(this.clear();++u<c;){var d=o[u];this.set(d[0],d[1])}}function US(){this.size=0,this.__data__={hash:new oi,map:new(To||Hn),string:new oi}}function BS(o){var u=rc(this,o).delete(o);return this.size-=u?1:0,u}function qS(o){return rc(this,o).get(o)}function $S(o){return rc(this,o).has(o)}function WS(o,u){var c=rc(this,o),d=c.size;return c.set(o,u),this.size+=c.size==d?0:1,this}jn.prototype.clear=US,jn.prototype.delete=BS,jn.prototype.get=qS,jn.prototype.has=$S,jn.prototype.set=WS;function ai(o){var u=-1,c=o==null?0:o.length;for(this.__data__=new jn;++u<c;)this.add(o[u])}function GS(o){return this.__data__.set(o,h),this}function zS(o){return this.__data__.has(o)}ai.prototype.add=ai.prototype.push=GS,ai.prototype.has=zS;function pn(o){var u=this.__data__=new Hn(o);this.size=u.size}function KS(){this.__data__=new Hn,this.size=0}function HS(o){var u=this.__data__,c=u.delete(o);return this.size=u.size,c}function jS(o){return this.__data__.get(o)}function QS(o){return this.__data__.has(o)}function YS(o,u){var c=this.__data__;if(c instanceof Hn){var d=c.__data__;if(!To||d.length<i-1)return d.push([o,u]),this.size=++c.size,this;c=this.__data__=new jn(d)}return c.set(o,u),this.size=c.size,this}pn.prototype.clear=KS,pn.prototype.delete=HS,pn.prototype.get=jS,pn.prototype.has=QS,pn.prototype.set=YS;function Wm(o,u){var c=te(o),d=!c&&di(o),g=!c&&!d&&Rr(o),y=!c&&!d&&!g&&hs(o),v=c||d||g||y,w=v?Vh(o.length,oS):[],T=w.length;for(var C in o)(u||Ee.call(o,C))&&!(v&&(C=="length"||g&&(C=="offset"||C=="parent")||y&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||Xn(C,T)))&&w.push(C);return w}function Gm(o){var u=o.length;return u?o[Jh(0,u-1)]:t}function JS(o,u){return ic(Vt(o),ui(u,0,o.length))}function XS(o){return ic(Vt(o))}function qh(o,u,c){(c!==t&&!gn(o[u],c)||c===t&&!(u in o))&&Qn(o,u,c)}function bo(o,u,c){var d=o[u];(!(Ee.call(o,u)&&gn(d,c))||c===t&&!(u in o))&&Qn(o,u,c)}function zu(o,u){for(var c=o.length;c--;)if(gn(o[c][0],u))return c;return-1}function ZS(o,u,c,d){return wr(o,function(g,y,v){u(d,g,c(g),v)}),d}function zm(o,u){return o&&Tn(u,nt(u),o)}function eb(o,u){return o&&Tn(u,Lt(u),o)}function Qn(o,u,c){u=="__proto__"&&Uu?Uu(o,u,{configurable:!0,enumerable:!0,value:c,writable:!0}):o[u]=c}function $h(o,u){for(var c=-1,d=u.length,g=S(d),y=o==null;++c<d;)g[c]=y?t:Ed(o,u[c]);return g}function ui(o,u,c){return o===o&&(c!==t&&(o=o<=c?o:c),u!==t&&(o=o>=u?o:u)),o}function rn(o,u,c,d,g,y){var v,w=u&m,T=u&I,C=u&A;if(c&&(v=g?c(o,d,g,y):c(o)),v!==t)return v;if(!Me(o))return o;var D=te(o);if(D){if(v=$b(o),!w)return Vt(o,v)}else{var x=vt(o),U=x==Tu||x==Hg;if(Rr(o))return g_(o,w);if(x==Kn||x==Ji||U&&!g){if(v=T||U?{}:V_(o),!w)return T?kb(o,eb(v,o)):Db(o,zm(v,o))}else{if(!be[x])return g?o:{};v=Wb(o,x,w)}}y||(y=new pn);var G=y.get(o);if(G)return G;y.set(o,v),cy(o)?o.forEach(function(X){v.add(rn(X,u,c,X,o,y))}):ay(o)&&o.forEach(function(X,ue){v.set(ue,rn(X,u,c,ue,o,y))});var J=C?T?ud:ad:T?Lt:nt,se=D?t:J(o);return en(se||o,function(X,ue){se&&(ue=X,X=o[ue]),bo(v,ue,rn(X,u,c,ue,o,y))}),v}function tb(o){var u=nt(o);return function(c){return Km(c,o,u)}}function Km(o,u,c){var d=c.length;if(o==null)return!d;for(o=Se(o);d--;){var g=c[d],y=u[g],v=o[g];if(v===t&&!(g in o)||!y(v))return!1}return!0}function Hm(o,u,c){if(typeof o!="function")throw new tn(a);return Vo(function(){o.apply(t,c)},u)}function Po(o,u,c,d){var g=-1,y=Pu,v=!0,w=o.length,T=[],C=u.length;if(!w)return T;c&&(u=xe(u,Gt(c))),d?(y=Ph,v=!1):u.length>=i&&(y=wo,v=!1,u=new ai(u));e:for(;++g<w;){var D=o[g],x=c==null?D:c(D);if(D=d||D!==0?D:0,v&&x===x){for(var U=C;U--;)if(u[U]===x)continue e;T.push(D)}else y(u,x,d)||T.push(D)}return T}var wr=I_(En),jm=I_(Gh,!0);function nb(o,u){var c=!0;return wr(o,function(d,g,y){return c=!!u(d,g,y),c}),c}function Ku(o,u,c){for(var d=-1,g=o.length;++d<g;){var y=o[d],v=u(y);if(v!=null&&(w===t?v===v&&!Kt(v):c(v,w)))var w=v,T=y}return T}function rb(o,u,c,d){var g=o.length;for(c=ie(c),c<0&&(c=-c>g?0:g+c),d=d===t||d>g?g:ie(d),d<0&&(d+=g),d=c>d?0:hy(d);c<d;)o[c++]=u;return o}function Qm(o,u){var c=[];return wr(o,function(d,g,y){u(d,g,y)&&c.push(d)}),c}function ht(o,u,c,d,g){var y=-1,v=o.length;for(c||(c=zb),g||(g=[]);++y<v;){var w=o[y];u>0&&c(w)?u>1?ht(w,u-1,c,d,g):yr(g,w):d||(g[g.length]=w)}return g}var Wh=w_(),Ym=w_(!0);function En(o,u){return o&&Wh(o,u,nt)}function Gh(o,u){return o&&Ym(o,u,nt)}function Hu(o,u){return _r(u,function(c){return Zn(o[c])})}function ci(o,u){u=Tr(u,o);for(var c=0,d=u.length;o!=null&&c<d;)o=o[An(u[c++])];return c&&c==d?o:t}function Jm(o,u,c){var d=u(o);return te(o)?d:yr(d,c(o))}function At(o){return o==null?o===t?x0:D0:si&&si in Se(o)?Ub(o):Xb(o)}function zh(o,u){return o>u}function ib(o,u){return o!=null&&Ee.call(o,u)}function sb(o,u){return o!=null&&u in Se(o)}function ob(o,u,c){return o>=yt(u,c)&&o<Ze(u,c)}function Kh(o,u,c){for(var d=c?Ph:Pu,g=o[0].length,y=o.length,v=y,w=S(y),T=1/0,C=[];v--;){var D=o[v];v&&u&&(D=xe(D,Gt(u))),T=yt(D.length,T),w[v]=!c&&(u||g>=120&&D.length>=120)?new ai(v&&D):t}D=o[0];var x=-1,U=w[0];e:for(;++x<g&&C.length<T;){var G=D[x],J=u?u(G):G;if(G=c||G!==0?G:0,!(U?wo(U,J):d(C,J,c))){for(v=y;--v;){var se=w[v];if(!(se?wo(se,J):d(o[v],J,c)))continue e}U&&U.push(J),C.push(G)}}return C}function ab(o,u,c,d){return En(o,function(g,y,v){u(d,c(g),y,v)}),d}function Co(o,u,c){u=Tr(u,o),o=F_(o,u);var d=o==null?o:o[An(on(u))];return d==null?t:Wt(d,o,c)}function Xm(o){return Ue(o)&&At(o)==Ji}function ub(o){return Ue(o)&&At(o)==Io}function cb(o){return Ue(o)&&At(o)==go}function Do(o,u,c,d,g){return o===u?!0:o==null||u==null||!Ue(o)&&!Ue(u)?o!==o&&u!==u:lb(o,u,c,d,Do,g)}function lb(o,u,c,d,g,y){var v=te(o),w=te(u),T=v?wu:vt(o),C=w?wu:vt(u);T=T==Ji?Kn:T,C=C==Ji?Kn:C;var D=T==Kn,x=C==Kn,U=T==C;if(U&&Rr(o)){if(!Rr(u))return!1;v=!0,D=!1}if(U&&!D)return y||(y=new pn),v||hs(o)?k_(o,u,c,d,g,y):Mb(o,u,T,c,d,g,y);if(!(c&L)){var G=D&&Ee.call(o,"__wrapped__"),J=x&&Ee.call(u,"__wrapped__");if(G||J){var se=G?o.value():o,X=J?u.value():u;return y||(y=new pn),g(se,X,c,d,y)}}return U?(y||(y=new pn),Fb(o,u,c,d,g,y)):!1}function hb(o){return Ue(o)&&vt(o)==hn}function Hh(o,u,c,d){var g=c.length,y=g,v=!d;if(o==null)return!y;for(o=Se(o);g--;){var w=c[g];if(v&&w[2]?w[1]!==o[w[0]]:!(w[0]in o))return!1}for(;++g<y;){w=c[g];var T=w[0],C=o[T],D=w[1];if(v&&w[2]){if(C===t&&!(T in o))return!1}else{var x=new pn;if(d)var U=d(C,D,T,o,u,x);if(!(U===t?Do(D,C,L|M,d,x):U))return!1}}return!0}function Zm(o){if(!Me(o)||Hb(o))return!1;var u=Zn(o)?hS:tR;return u.test(hi(o))}function db(o){return Ue(o)&&At(o)==_o}function fb(o){return Ue(o)&&vt(o)==dn}function pb(o){return Ue(o)&&lc(o.length)&&!!Ce[At(o)]}function e_(o){return typeof o=="function"?o:o==null?Mt:typeof o=="object"?te(o)?r_(o[0],o[1]):n_(o):Ey(o)}function jh(o){if(!No(o))return _S(o);var u=[];for(var c in Se(o))Ee.call(o,c)&&c!="constructor"&&u.push(c);return u}function gb(o){if(!Me(o))return Jb(o);var u=No(o),c=[];for(var d in o)d=="constructor"&&(u||!Ee.call(o,d))||c.push(d);return c}function Qh(o,u){return o<u}function t_(o,u){var c=-1,d=Ot(o)?S(o.length):[];return wr(o,function(g,y,v){d[++c]=u(g,y,v)}),d}function n_(o){var u=ld(o);return u.length==1&&u[0][2]?L_(u[0][0],u[0][1]):function(c){return c===o||Hh(c,o,u)}}function r_(o,u){return dd(o)&&O_(u)?L_(An(o),u):function(c){var d=Ed(c,o);return d===t&&d===u?Td(c,o):Do(u,d,L|M)}}function ju(o,u,c,d,g){o!==u&&Wh(u,function(y,v){if(g||(g=new pn),Me(y))mb(o,u,v,c,ju,d,g);else{var w=d?d(pd(o,v),y,v+"",o,u,g):t;w===t&&(w=y),qh(o,v,w)}},Lt)}function mb(o,u,c,d,g,y,v){var w=pd(o,c),T=pd(u,c),C=v.get(T);if(C){qh(o,c,C);return}var D=y?y(w,T,c+"",o,u,v):t,x=D===t;if(x){var U=te(T),G=!U&&Rr(T),J=!U&&!G&&hs(T);D=T,U||G||J?te(w)?D=w:Ke(w)?D=Vt(w):G?(x=!1,D=g_(T,!0)):J?(x=!1,D=m_(T,!0)):D=[]:Oo(T)||di(T)?(D=w,di(w)?D=dy(w):(!Me(w)||Zn(w))&&(D=V_(T))):x=!1}x&&(v.set(T,D),g(D,T,d,y,v),v.delete(T)),qh(o,c,D)}function i_(o,u){var c=o.length;if(c)return u+=u<0?c:0,Xn(u,c)?o[u]:t}function s_(o,u,c){u.length?u=xe(u,function(y){return te(y)?function(v){return ci(v,y.length===1?y[0]:y)}:y}):u=[Mt];var d=-1;u=xe(u,Gt(Q()));var g=t_(o,function(y,v,w){var T=xe(u,function(C){return C(y)});return{criteria:T,index:++d,value:y}});return WR(g,function(y,v){return Cb(y,v,c)})}function _b(o,u){return o_(o,u,function(c,d){return Td(o,d)})}function o_(o,u,c){for(var d=-1,g=u.length,y={};++d<g;){var v=u[d],w=ci(o,v);c(w,v)&&ko(y,Tr(v,o),w)}return y}function yb(o){return function(u){return ci(u,o)}}function Yh(o,u,c,d){var g=d?$R:es,y=-1,v=u.length,w=o;for(o===u&&(u=Vt(u)),c&&(w=xe(o,Gt(c)));++y<v;)for(var T=0,C=u[y],D=c?c(C):C;(T=g(w,D,T,d))>-1;)w!==o&&Fu.call(w,T,1),Fu.call(o,T,1);return o}function a_(o,u){for(var c=o?u.length:0,d=c-1;c--;){var g=u[c];if(c==d||g!==y){var y=g;Xn(g)?Fu.call(o,g,1):ed(o,g)}}return o}function Jh(o,u){return o+qu(qm()*(u-o+1))}function vb(o,u,c,d){for(var g=-1,y=Ze(Bu((u-o)/(c||1)),0),v=S(y);y--;)v[d?y:++g]=o,o+=c;return v}function Xh(o,u){var c="";if(!o||u<1||u>mr)return c;do u%2&&(c+=o),u=qu(u/2),u&&(o+=o);while(u);return c}function oe(o,u){return gd(M_(o,u,Mt),o+"")}function Ib(o){return Gm(ds(o))}function wb(o,u){var c=ds(o);return ic(c,ui(u,0,c.length))}function ko(o,u,c,d){if(!Me(o))return o;u=Tr(u,o);for(var g=-1,y=u.length,v=y-1,w=o;w!=null&&++g<y;){var T=An(u[g]),C=c;if(T==="__proto__"||T==="constructor"||T==="prototype")return o;if(g!=v){var D=w[T];C=d?d(D,T,w):t,C===t&&(C=Me(D)?D:Xn(u[g+1])?[]:{})}bo(w,T,C),w=w[T]}return o}var u_=$u?function(o,u){return $u.set(o,u),o}:Mt,Eb=Uu?function(o,u){return Uu(o,"toString",{configurable:!0,enumerable:!1,value:Rd(u),writable:!0})}:Mt;function Tb(o){return ic(ds(o))}function sn(o,u,c){var d=-1,g=o.length;u<0&&(u=-u>g?0:g+u),c=c>g?g:c,c<0&&(c+=g),g=u>c?0:c-u>>>0,u>>>=0;for(var y=S(g);++d<g;)y[d]=o[d+u];return y}function Ab(o,u){var c;return wr(o,function(d,g,y){return c=u(d,g,y),!c}),!!c}function Qu(o,u,c){var d=0,g=o==null?d:o.length;if(typeof u=="number"&&u===u&&g<=S0){for(;d<g;){var y=d+g>>>1,v=o[y];v!==null&&!Kt(v)&&(c?v<=u:v<u)?d=y+1:g=y}return g}return Zh(o,u,Mt,c)}function Zh(o,u,c,d){var g=0,y=o==null?0:o.length;if(y===0)return 0;u=c(u);for(var v=u!==u,w=u===null,T=Kt(u),C=u===t;g<y;){var D=qu((g+y)/2),x=c(o[D]),U=x!==t,G=x===null,J=x===x,se=Kt(x);if(v)var X=d||J;else C?X=J&&(d||U):w?X=J&&U&&(d||!G):T?X=J&&U&&!G&&(d||!se):G||se?X=!1:X=d?x<=u:x<u;X?g=D+1:y=D}return yt(y,R0)}function c_(o,u){for(var c=-1,d=o.length,g=0,y=[];++c<d;){var v=o[c],w=u?u(v):v;if(!c||!gn(w,T)){var T=w;y[g++]=v===0?0:v}}return y}function l_(o){return typeof o=="number"?o:Kt(o)?Iu:+o}function zt(o){if(typeof o=="string")return o;if(te(o))return xe(o,zt)+"";if(Kt(o))return $m?$m.call(o):"";var u=o+"";return u=="0"&&1/o==-ri?"-0":u}function Er(o,u,c){var d=-1,g=Pu,y=o.length,v=!0,w=[],T=w;if(c)v=!1,g=Ph;else if(y>=i){var C=u?null:Ob(o);if(C)return Du(C);v=!1,g=wo,T=new ai}else T=u?[]:w;e:for(;++d<y;){var D=o[d],x=u?u(D):D;if(D=c||D!==0?D:0,v&&x===x){for(var U=T.length;U--;)if(T[U]===x)continue e;u&&T.push(x),w.push(D)}else g(T,x,c)||(T!==w&&T.push(x),w.push(D))}return w}function ed(o,u){return u=Tr(u,o),o=F_(o,u),o==null||delete o[An(on(u))]}function h_(o,u,c,d){return ko(o,u,c(ci(o,u)),d)}function Yu(o,u,c,d){for(var g=o.length,y=d?g:-1;(d?y--:++y<g)&&u(o[y],y,o););return c?sn(o,d?0:y,d?y+1:g):sn(o,d?y+1:0,d?g:y)}function d_(o,u){var c=o;return c instanceof le&&(c=c.value()),Ch(u,function(d,g){return g.func.apply(g.thisArg,yr([d],g.args))},c)}function td(o,u,c){var d=o.length;if(d<2)return d?Er(o[0]):[];for(var g=-1,y=S(d);++g<d;)for(var v=o[g],w=-1;++w<d;)w!=g&&(y[g]=Po(y[g]||v,o[w],u,c));return Er(ht(y,1),u,c)}function f_(o,u,c){for(var d=-1,g=o.length,y=u.length,v={};++d<g;){var w=d<y?u[d]:t;c(v,o[d],w)}return v}function nd(o){return Ke(o)?o:[]}function rd(o){return typeof o=="function"?o:Mt}function Tr(o,u){return te(o)?o:dd(o,u)?[o]:$_(Ie(o))}var Rb=oe;function Ar(o,u,c){var d=o.length;return c=c===t?d:c,!u&&c>=d?o:sn(o,u,c)}var p_=dS||function(o){return lt.clearTimeout(o)};function g_(o,u){if(u)return o.slice();var c=o.length,d=Lm?Lm(c):new o.constructor(c);return o.copy(d),d}function id(o){var u=new o.constructor(o.byteLength);return new Lu(u).set(new Lu(o)),u}function Sb(o,u){var c=u?id(o.buffer):o.buffer;return new o.constructor(c,o.byteOffset,o.byteLength)}function bb(o){var u=new o.constructor(o.source,Xg.exec(o));return u.lastIndex=o.lastIndex,u}function Pb(o){return So?Se(So.call(o)):{}}function m_(o,u){var c=u?id(o.buffer):o.buffer;return new o.constructor(c,o.byteOffset,o.length)}function __(o,u){if(o!==u){var c=o!==t,d=o===null,g=o===o,y=Kt(o),v=u!==t,w=u===null,T=u===u,C=Kt(u);if(!w&&!C&&!y&&o>u||y&&v&&T&&!w&&!C||d&&v&&T||!c&&T||!g)return 1;if(!d&&!y&&!C&&o<u||C&&c&&g&&!d&&!y||w&&c&&g||!v&&g||!T)return-1}return 0}function Cb(o,u,c){for(var d=-1,g=o.criteria,y=u.criteria,v=g.length,w=c.length;++d<v;){var T=__(g[d],y[d]);if(T){if(d>=w)return T;var C=c[d];return T*(C=="desc"?-1:1)}}return o.index-u.index}function y_(o,u,c,d){for(var g=-1,y=o.length,v=c.length,w=-1,T=u.length,C=Ze(y-v,0),D=S(T+C),x=!d;++w<T;)D[w]=u[w];for(;++g<v;)(x||g<y)&&(D[c[g]]=o[g]);for(;C--;)D[w++]=o[g++];return D}function v_(o,u,c,d){for(var g=-1,y=o.length,v=-1,w=c.length,T=-1,C=u.length,D=Ze(y-w,0),x=S(D+C),U=!d;++g<D;)x[g]=o[g];for(var G=g;++T<C;)x[G+T]=u[T];for(;++v<w;)(U||g<y)&&(x[G+c[v]]=o[g++]);return x}function Vt(o,u){var c=-1,d=o.length;for(u||(u=S(d));++c<d;)u[c]=o[c];return u}function Tn(o,u,c,d){var g=!c;c||(c={});for(var y=-1,v=u.length;++y<v;){var w=u[y],T=d?d(c[w],o[w],w,c,o):t;T===t&&(T=o[w]),g?Qn(c,w,T):bo(c,w,T)}return c}function Db(o,u){return Tn(o,hd(o),u)}function kb(o,u){return Tn(o,x_(o),u)}function Ju(o,u){return function(c,d){var g=te(c)?LR:ZS,y=u?u():{};return g(c,o,Q(d,2),y)}}function us(o){return oe(function(u,c){var d=-1,g=c.length,y=g>1?c[g-1]:t,v=g>2?c[2]:t;for(y=o.length>3&&typeof y=="function"?(g--,y):t,v&&Rt(c[0],c[1],v)&&(y=g<3?t:y,g=1),u=Se(u);++d<g;){var w=c[d];w&&o(u,w,d,y)}return u})}function I_(o,u){return function(c,d){if(c==null)return c;if(!Ot(c))return o(c,d);for(var g=c.length,y=u?g:-1,v=Se(c);(u?y--:++y<g)&&d(v[y],y,v)!==!1;);return c}}function w_(o){return function(u,c,d){for(var g=-1,y=Se(u),v=d(u),w=v.length;w--;){var T=v[o?w:++g];if(c(y[T],T,y)===!1)break}return u}}function xb(o,u,c){var d=u&V,g=xo(o);function y(){var v=this&&this!==lt&&this instanceof y?g:o;return v.apply(d?c:this,arguments)}return y}function E_(o){return function(u){u=Ie(u);var c=ts(u)?fn(u):t,d=c?c[0]:u.charAt(0),g=c?Ar(c,1).join(""):u.slice(1);return d[o]()+g}}function cs(o){return function(u){return Ch(Iy(vy(u).replace(ER,"")),o,"")}}function xo(o){return function(){var u=arguments;switch(u.length){case 0:return new o;case 1:return new o(u[0]);case 2:return new o(u[0],u[1]);case 3:return new o(u[0],u[1],u[2]);case 4:return new o(u[0],u[1],u[2],u[3]);case 5:return new o(u[0],u[1],u[2],u[3],u[4]);case 6:return new o(u[0],u[1],u[2],u[3],u[4],u[5]);case 7:return new o(u[0],u[1],u[2],u[3],u[4],u[5],u[6])}var c=as(o.prototype),d=o.apply(c,u);return Me(d)?d:c}}function Nb(o,u,c){var d=xo(o);function g(){for(var y=arguments.length,v=S(y),w=y,T=ls(g);w--;)v[w]=arguments[w];var C=y<3&&v[0]!==T&&v[y-1]!==T?[]:vr(v,T);if(y-=C.length,y<c)return b_(o,u,Xu,g.placeholder,t,v,C,t,t,c-y);var D=this&&this!==lt&&this instanceof g?d:o;return Wt(D,this,v)}return g}function T_(o){return function(u,c,d){var g=Se(u);if(!Ot(u)){var y=Q(c,3);u=nt(u),c=function(w){return y(g[w],w,g)}}var v=o(u,c,d);return v>-1?g[y?u[v]:v]:t}}function A_(o){return Jn(function(u){var c=u.length,d=c,g=nn.prototype.thru;for(o&&u.reverse();d--;){var y=u[d];if(typeof y!="function")throw new tn(a);if(g&&!v&&nc(y)=="wrapper")var v=new nn([],!0)}for(d=v?d:c;++d<c;){y=u[d];var w=nc(y),T=w=="wrapper"?cd(y):t;T&&fd(T[0])&&T[1]==(we|j|de|Nt)&&!T[4].length&&T[9]==1?v=v[nc(T[0])].apply(v,T[3]):v=y.length==1&&fd(y)?v[w]():v.thru(y)}return function(){var C=arguments,D=C[0];if(v&&C.length==1&&te(D))return v.plant(D).value();for(var x=0,U=c?u[x].apply(this,C):D;++x<c;)U=u[x].call(this,U);return U}})}function Xu(o,u,c,d,g,y,v,w,T,C){var D=u&we,x=u&V,U=u&Y,G=u&(j|ye),J=u&zn,se=U?t:xo(o);function X(){for(var ue=arguments.length,fe=S(ue),Ht=ue;Ht--;)fe[Ht]=arguments[Ht];if(G)var St=ls(X),jt=zR(fe,St);if(d&&(fe=y_(fe,d,g,G)),y&&(fe=v_(fe,y,v,G)),ue-=jt,G&&ue<C){var He=vr(fe,St);return b_(o,u,Xu,X.placeholder,c,fe,He,w,T,C-ue)}var mn=x?c:this,tr=U?mn[o]:o;return ue=fe.length,w?fe=Zb(fe,w):J&&ue>1&&fe.reverse(),D&&T<ue&&(fe.length=T),this&&this!==lt&&this instanceof X&&(tr=se||xo(tr)),tr.apply(mn,fe)}return X}function R_(o,u){return function(c,d){return ab(c,o,u(d),{})}}function Zu(o,u){return function(c,d){var g;if(c===t&&d===t)return u;if(c!==t&&(g=c),d!==t){if(g===t)return d;typeof c=="string"||typeof d=="string"?(c=zt(c),d=zt(d)):(c=l_(c),d=l_(d)),g=o(c,d)}return g}}function sd(o){return Jn(function(u){return u=xe(u,Gt(Q())),oe(function(c){var d=this;return o(u,function(g){return Wt(g,d,c)})})})}function ec(o,u){u=u===t?" ":zt(u);var c=u.length;if(c<2)return c?Xh(u,o):u;var d=Xh(u,Bu(o/ns(u)));return ts(u)?Ar(fn(d),0,o).join(""):d.slice(0,o)}function Vb(o,u,c,d){var g=u&V,y=xo(o);function v(){for(var w=-1,T=arguments.length,C=-1,D=d.length,x=S(D+T),U=this&&this!==lt&&this instanceof v?y:o;++C<D;)x[C]=d[C];for(;T--;)x[C++]=arguments[++w];return Wt(U,g?c:this,x)}return v}function S_(o){return function(u,c,d){return d&&typeof d!="number"&&Rt(u,c,d)&&(c=d=t),u=er(u),c===t?(c=u,u=0):c=er(c),d=d===t?u<c?1:-1:er(d),vb(u,c,d,o)}}function tc(o){return function(u,c){return typeof u=="string"&&typeof c=="string"||(u=an(u),c=an(c)),o(u,c)}}function b_(o,u,c,d,g,y,v,w,T,C){var D=u&j,x=D?v:t,U=D?t:v,G=D?y:t,J=D?t:y;u|=D?de:me,u&=~(D?me:de),u&ae||(u&=~(V|Y));var se=[o,u,g,G,x,J,U,w,T,C],X=c.apply(t,se);return fd(o)&&U_(X,se),X.placeholder=d,B_(X,o,u)}function od(o){var u=Xe[o];return function(c,d){if(c=an(c),d=d==null?0:yt(ie(d),292),d&&Bm(c)){var g=(Ie(c)+"e").split("e"),y=u(g[0]+"e"+(+g[1]+d));return g=(Ie(y)+"e").split("e"),+(g[0]+"e"+(+g[1]-d))}return u(c)}}var Ob=ss&&1/Du(new ss([,-0]))[1]==ri?function(o){return new ss(o)}:Pd;function P_(o){return function(u){var c=vt(u);return c==hn?Lh(u):c==dn?XR(u):GR(u,o(u))}}function Yn(o,u,c,d,g,y,v,w){var T=u&Y;if(!T&&typeof o!="function")throw new tn(a);var C=d?d.length:0;if(C||(u&=~(de|me),d=g=t),v=v===t?v:Ze(ie(v),0),w=w===t?w:ie(w),C-=g?g.length:0,u&me){var D=d,x=g;d=g=t}var U=T?t:cd(o),G=[o,u,c,d,g,D,x,y,v,w];if(U&&Yb(G,U),o=G[0],u=G[1],c=G[2],d=G[3],g=G[4],w=G[9]=G[9]===t?T?0:o.length:Ze(G[9]-C,0),!w&&u&(j|ye)&&(u&=~(j|ye)),!u||u==V)var J=xb(o,u,c);else u==j||u==ye?J=Nb(o,u,w):(u==de||u==(V|de))&&!g.length?J=Vb(o,u,c,d):J=Xu.apply(t,G);var se=U?u_:U_;return B_(se(J,G),o,u)}function C_(o,u,c,d){return o===t||gn(o,is[c])&&!Ee.call(d,c)?u:o}function D_(o,u,c,d,g,y){return Me(o)&&Me(u)&&(y.set(u,o),ju(o,u,t,D_,y),y.delete(u)),o}function Lb(o){return Oo(o)?t:o}function k_(o,u,c,d,g,y){var v=c&L,w=o.length,T=u.length;if(w!=T&&!(v&&T>w))return!1;var C=y.get(o),D=y.get(u);if(C&&D)return C==u&&D==o;var x=-1,U=!0,G=c&M?new ai:t;for(y.set(o,u),y.set(u,o);++x<w;){var J=o[x],se=u[x];if(d)var X=v?d(se,J,x,u,o,y):d(J,se,x,o,u,y);if(X!==t){if(X)continue;U=!1;break}if(G){if(!Dh(u,function(ue,fe){if(!wo(G,fe)&&(J===ue||g(J,ue,c,d,y)))return G.push(fe)})){U=!1;break}}else if(!(J===se||g(J,se,c,d,y))){U=!1;break}}return y.delete(o),y.delete(u),U}function Mb(o,u,c,d,g,y,v){switch(c){case Xi:if(o.byteLength!=u.byteLength||o.byteOffset!=u.byteOffset)return!1;o=o.buffer,u=u.buffer;case Io:return!(o.byteLength!=u.byteLength||!y(new Lu(o),new Lu(u)));case po:case go:case mo:return gn(+o,+u);case Eu:return o.name==u.name&&o.message==u.message;case _o:case yo:return o==u+"";case hn:var w=Lh;case dn:var T=d&L;if(w||(w=Du),o.size!=u.size&&!T)return!1;var C=v.get(o);if(C)return C==u;d|=M,v.set(o,u);var D=k_(w(o),w(u),d,g,y,v);return v.delete(o),D;case Au:if(So)return So.call(o)==So.call(u)}return!1}function Fb(o,u,c,d,g,y){var v=c&L,w=ad(o),T=w.length,C=ad(u),D=C.length;if(T!=D&&!v)return!1;for(var x=T;x--;){var U=w[x];if(!(v?U in u:Ee.call(u,U)))return!1}var G=y.get(o),J=y.get(u);if(G&&J)return G==u&&J==o;var se=!0;y.set(o,u),y.set(u,o);for(var X=v;++x<T;){U=w[x];var ue=o[U],fe=u[U];if(d)var Ht=v?d(fe,ue,U,u,o,y):d(ue,fe,U,o,u,y);if(!(Ht===t?ue===fe||g(ue,fe,c,d,y):Ht)){se=!1;break}X||(X=U=="constructor")}if(se&&!X){var St=o.constructor,jt=u.constructor;St!=jt&&"constructor"in o&&"constructor"in u&&!(typeof St=="function"&&St instanceof St&&typeof jt=="function"&&jt instanceof jt)&&(se=!1)}return y.delete(o),y.delete(u),se}function Jn(o){return gd(M_(o,t,K_),o+"")}function ad(o){return Jm(o,nt,hd)}function ud(o){return Jm(o,Lt,x_)}var cd=$u?function(o){return $u.get(o)}:Pd;function nc(o){for(var u=o.name+"",c=os[u],d=Ee.call(os,u)?c.length:0;d--;){var g=c[d],y=g.func;if(y==null||y==o)return g.name}return u}function ls(o){var u=Ee.call(_,"placeholder")?_:o;return u.placeholder}function Q(){var o=_.iteratee||Sd;return o=o===Sd?e_:o,arguments.length?o(arguments[0],arguments[1]):o}function rc(o,u){var c=o.__data__;return Kb(u)?c[typeof u=="string"?"string":"hash"]:c.map}function ld(o){for(var u=nt(o),c=u.length;c--;){var d=u[c],g=o[d];u[c]=[d,g,O_(g)]}return u}function li(o,u){var c=QR(o,u);return Zm(c)?c:t}function Ub(o){var u=Ee.call(o,si),c=o[si];try{o[si]=t;var d=!0}catch{}var g=Vu.call(o);return d&&(u?o[si]=c:delete o[si]),g}var hd=Fh?function(o){return o==null?[]:(o=Se(o),_r(Fh(o),function(u){return Fm.call(o,u)}))}:Cd,x_=Fh?function(o){for(var u=[];o;)yr(u,hd(o)),o=Mu(o);return u}:Cd,vt=At;(Uh&&vt(new Uh(new ArrayBuffer(1)))!=Xi||To&&vt(new To)!=hn||Bh&&vt(Bh.resolve())!=jg||ss&&vt(new ss)!=dn||Ao&&vt(new Ao)!=vo)&&(vt=function(o){var u=At(o),c=u==Kn?o.constructor:t,d=c?hi(c):"";if(d)switch(d){case wS:return Xi;case ES:return hn;case TS:return jg;case AS:return dn;case RS:return vo}return u});function Bb(o,u,c){for(var d=-1,g=c.length;++d<g;){var y=c[d],v=y.size;switch(y.type){case"drop":o+=v;break;case"dropRight":u-=v;break;case"take":u=yt(u,o+v);break;case"takeRight":o=Ze(o,u-v);break}}return{start:o,end:u}}function qb(o){var u=o.match(H0);return u?u[1].split(j0):[]}function N_(o,u,c){u=Tr(u,o);for(var d=-1,g=u.length,y=!1;++d<g;){var v=An(u[d]);if(!(y=o!=null&&c(o,v)))break;o=o[v]}return y||++d!=g?y:(g=o==null?0:o.length,!!g&&lc(g)&&Xn(v,g)&&(te(o)||di(o)))}function $b(o){var u=o.length,c=new o.constructor(u);return u&&typeof o[0]=="string"&&Ee.call(o,"index")&&(c.index=o.index,c.input=o.input),c}function V_(o){return typeof o.constructor=="function"&&!No(o)?as(Mu(o)):{}}function Wb(o,u,c){var d=o.constructor;switch(u){case Io:return id(o);case po:case go:return new d(+o);case Xi:return Sb(o,c);case lh:case hh:case dh:case fh:case ph:case gh:case mh:case _h:case yh:return m_(o,c);case hn:return new d;case mo:case yo:return new d(o);case _o:return bb(o);case dn:return new d;case Au:return Pb(o)}}function Gb(o,u){var c=u.length;if(!c)return o;var d=c-1;return u[d]=(c>1?"& ":"")+u[d],u=u.join(c>2?", ":" "),o.replace(K0,`{
/* [wrapped with `+u+`] */
`)}function zb(o){return te(o)||di(o)||!!(Um&&o&&o[Um])}function Xn(o,u){var c=typeof o;return u=u??mr,!!u&&(c=="number"||c!="symbol"&&rR.test(o))&&o>-1&&o%1==0&&o<u}function Rt(o,u,c){if(!Me(c))return!1;var d=typeof u;return(d=="number"?Ot(c)&&Xn(u,c.length):d=="string"&&u in c)?gn(c[u],o):!1}function dd(o,u){if(te(o))return!1;var c=typeof o;return c=="number"||c=="symbol"||c=="boolean"||o==null||Kt(o)?!0:$0.test(o)||!q0.test(o)||u!=null&&o in Se(u)}function Kb(o){var u=typeof o;return u=="string"||u=="number"||u=="symbol"||u=="boolean"?o!=="__proto__":o===null}function fd(o){var u=nc(o),c=_[u];if(typeof c!="function"||!(u in le.prototype))return!1;if(o===c)return!0;var d=cd(c);return!!d&&o===d[0]}function Hb(o){return!!Om&&Om in o}var jb=xu?Zn:Dd;function No(o){var u=o&&o.constructor,c=typeof u=="function"&&u.prototype||is;return o===c}function O_(o){return o===o&&!Me(o)}function L_(o,u){return function(c){return c==null?!1:c[o]===u&&(u!==t||o in Se(c))}}function Qb(o){var u=uc(o,function(d){return c.size===f&&c.clear(),d}),c=u.cache;return u}function Yb(o,u){var c=o[1],d=u[1],g=c|d,y=g<(V|Y|we),v=d==we&&c==j||d==we&&c==Nt&&o[7].length<=u[8]||d==(we|Nt)&&u[7].length<=u[8]&&c==j;if(!(y||v))return o;d&V&&(o[2]=u[2],g|=c&V?0:ae);var w=u[3];if(w){var T=o[3];o[3]=T?y_(T,w,u[4]):w,o[4]=T?vr(o[3],p):u[4]}return w=u[5],w&&(T=o[5],o[5]=T?v_(T,w,u[6]):w,o[6]=T?vr(o[5],p):u[6]),w=u[7],w&&(o[7]=w),d&we&&(o[8]=o[8]==null?u[8]:yt(o[8],u[8])),o[9]==null&&(o[9]=u[9]),o[0]=u[0],o[1]=g,o}function Jb(o){var u=[];if(o!=null)for(var c in Se(o))u.push(c);return u}function Xb(o){return Vu.call(o)}function M_(o,u,c){return u=Ze(u===t?o.length-1:u,0),function(){for(var d=arguments,g=-1,y=Ze(d.length-u,0),v=S(y);++g<y;)v[g]=d[u+g];g=-1;for(var w=S(u+1);++g<u;)w[g]=d[g];return w[u]=c(v),Wt(o,this,w)}}function F_(o,u){return u.length<2?o:ci(o,sn(u,0,-1))}function Zb(o,u){for(var c=o.length,d=yt(u.length,c),g=Vt(o);d--;){var y=u[d];o[d]=Xn(y,c)?g[y]:t}return o}function pd(o,u){if(!(u==="constructor"&&typeof o[u]=="function")&&u!="__proto__")return o[u]}var U_=q_(u_),Vo=pS||function(o,u){return lt.setTimeout(o,u)},gd=q_(Eb);function B_(o,u,c){var d=u+"";return gd(o,Gb(d,eP(qb(d),c)))}function q_(o){var u=0,c=0;return function(){var d=yS(),g=w0-(d-c);if(c=d,g>0){if(++u>=I0)return arguments[0]}else u=0;return o.apply(t,arguments)}}function ic(o,u){var c=-1,d=o.length,g=d-1;for(u=u===t?d:u;++c<u;){var y=Jh(c,g),v=o[y];o[y]=o[c],o[c]=v}return o.length=u,o}var $_=Qb(function(o){var u=[];return o.charCodeAt(0)===46&&u.push(""),o.replace(W0,function(c,d,g,y){u.push(g?y.replace(J0,"$1"):d||c)}),u});function An(o){if(typeof o=="string"||Kt(o))return o;var u=o+"";return u=="0"&&1/o==-ri?"-0":u}function hi(o){if(o!=null){try{return Nu.call(o)}catch{}try{return o+""}catch{}}return""}function eP(o,u){return en(b0,function(c){var d="_."+c[0];u&c[1]&&!Pu(o,d)&&o.push(d)}),o.sort()}function W_(o){if(o instanceof le)return o.clone();var u=new nn(o.__wrapped__,o.__chain__);return u.__actions__=Vt(o.__actions__),u.__index__=o.__index__,u.__values__=o.__values__,u}function tP(o,u,c){(c?Rt(o,u,c):u===t)?u=1:u=Ze(ie(u),0);var d=o==null?0:o.length;if(!d||u<1)return[];for(var g=0,y=0,v=S(Bu(d/u));g<d;)v[y++]=sn(o,g,g+=u);return v}function nP(o){for(var u=-1,c=o==null?0:o.length,d=0,g=[];++u<c;){var y=o[u];y&&(g[d++]=y)}return g}function rP(){var o=arguments.length;if(!o)return[];for(var u=S(o-1),c=arguments[0],d=o;d--;)u[d-1]=arguments[d];return yr(te(c)?Vt(c):[c],ht(u,1))}var iP=oe(function(o,u){return Ke(o)?Po(o,ht(u,1,Ke,!0)):[]}),sP=oe(function(o,u){var c=on(u);return Ke(c)&&(c=t),Ke(o)?Po(o,ht(u,1,Ke,!0),Q(c,2)):[]}),oP=oe(function(o,u){var c=on(u);return Ke(c)&&(c=t),Ke(o)?Po(o,ht(u,1,Ke,!0),t,c):[]});function aP(o,u,c){var d=o==null?0:o.length;return d?(u=c||u===t?1:ie(u),sn(o,u<0?0:u,d)):[]}function uP(o,u,c){var d=o==null?0:o.length;return d?(u=c||u===t?1:ie(u),u=d-u,sn(o,0,u<0?0:u)):[]}function cP(o,u){return o&&o.length?Yu(o,Q(u,3),!0,!0):[]}function lP(o,u){return o&&o.length?Yu(o,Q(u,3),!0):[]}function hP(o,u,c,d){var g=o==null?0:o.length;return g?(c&&typeof c!="number"&&Rt(o,u,c)&&(c=0,d=g),rb(o,u,c,d)):[]}function G_(o,u,c){var d=o==null?0:o.length;if(!d)return-1;var g=c==null?0:ie(c);return g<0&&(g=Ze(d+g,0)),Cu(o,Q(u,3),g)}function z_(o,u,c){var d=o==null?0:o.length;if(!d)return-1;var g=d-1;return c!==t&&(g=ie(c),g=c<0?Ze(d+g,0):yt(g,d-1)),Cu(o,Q(u,3),g,!0)}function K_(o){var u=o==null?0:o.length;return u?ht(o,1):[]}function dP(o){var u=o==null?0:o.length;return u?ht(o,ri):[]}function fP(o,u){var c=o==null?0:o.length;return c?(u=u===t?1:ie(u),ht(o,u)):[]}function pP(o){for(var u=-1,c=o==null?0:o.length,d={};++u<c;){var g=o[u];d[g[0]]=g[1]}return d}function H_(o){return o&&o.length?o[0]:t}function gP(o,u,c){var d=o==null?0:o.length;if(!d)return-1;var g=c==null?0:ie(c);return g<0&&(g=Ze(d+g,0)),es(o,u,g)}function mP(o){var u=o==null?0:o.length;return u?sn(o,0,-1):[]}var _P=oe(function(o){var u=xe(o,nd);return u.length&&u[0]===o[0]?Kh(u):[]}),yP=oe(function(o){var u=on(o),c=xe(o,nd);return u===on(c)?u=t:c.pop(),c.length&&c[0]===o[0]?Kh(c,Q(u,2)):[]}),vP=oe(function(o){var u=on(o),c=xe(o,nd);return u=typeof u=="function"?u:t,u&&c.pop(),c.length&&c[0]===o[0]?Kh(c,t,u):[]});function IP(o,u){return o==null?"":mS.call(o,u)}function on(o){var u=o==null?0:o.length;return u?o[u-1]:t}function wP(o,u,c){var d=o==null?0:o.length;if(!d)return-1;var g=d;return c!==t&&(g=ie(c),g=g<0?Ze(d+g,0):yt(g,d-1)),u===u?eS(o,u,g):Cu(o,bm,g,!0)}function EP(o,u){return o&&o.length?i_(o,ie(u)):t}var TP=oe(j_);function j_(o,u){return o&&o.length&&u&&u.length?Yh(o,u):o}function AP(o,u,c){return o&&o.length&&u&&u.length?Yh(o,u,Q(c,2)):o}function RP(o,u,c){return o&&o.length&&u&&u.length?Yh(o,u,t,c):o}var SP=Jn(function(o,u){var c=o==null?0:o.length,d=$h(o,u);return a_(o,xe(u,function(g){return Xn(g,c)?+g:g}).sort(__)),d});function bP(o,u){var c=[];if(!(o&&o.length))return c;var d=-1,g=[],y=o.length;for(u=Q(u,3);++d<y;){var v=o[d];u(v,d,o)&&(c.push(v),g.push(d))}return a_(o,g),c}function md(o){return o==null?o:IS.call(o)}function PP(o,u,c){var d=o==null?0:o.length;return d?(c&&typeof c!="number"&&Rt(o,u,c)?(u=0,c=d):(u=u==null?0:ie(u),c=c===t?d:ie(c)),sn(o,u,c)):[]}function CP(o,u){return Qu(o,u)}function DP(o,u,c){return Zh(o,u,Q(c,2))}function kP(o,u){var c=o==null?0:o.length;if(c){var d=Qu(o,u);if(d<c&&gn(o[d],u))return d}return-1}function xP(o,u){return Qu(o,u,!0)}function NP(o,u,c){return Zh(o,u,Q(c,2),!0)}function VP(o,u){var c=o==null?0:o.length;if(c){var d=Qu(o,u,!0)-1;if(gn(o[d],u))return d}return-1}function OP(o){return o&&o.length?c_(o):[]}function LP(o,u){return o&&o.length?c_(o,Q(u,2)):[]}function MP(o){var u=o==null?0:o.length;return u?sn(o,1,u):[]}function FP(o,u,c){return o&&o.length?(u=c||u===t?1:ie(u),sn(o,0,u<0?0:u)):[]}function UP(o,u,c){var d=o==null?0:o.length;return d?(u=c||u===t?1:ie(u),u=d-u,sn(o,u<0?0:u,d)):[]}function BP(o,u){return o&&o.length?Yu(o,Q(u,3),!1,!0):[]}function qP(o,u){return o&&o.length?Yu(o,Q(u,3)):[]}var $P=oe(function(o){return Er(ht(o,1,Ke,!0))}),WP=oe(function(o){var u=on(o);return Ke(u)&&(u=t),Er(ht(o,1,Ke,!0),Q(u,2))}),GP=oe(function(o){var u=on(o);return u=typeof u=="function"?u:t,Er(ht(o,1,Ke,!0),t,u)});function zP(o){return o&&o.length?Er(o):[]}function KP(o,u){return o&&o.length?Er(o,Q(u,2)):[]}function HP(o,u){return u=typeof u=="function"?u:t,o&&o.length?Er(o,t,u):[]}function _d(o){if(!(o&&o.length))return[];var u=0;return o=_r(o,function(c){if(Ke(c))return u=Ze(c.length,u),!0}),Vh(u,function(c){return xe(o,kh(c))})}function Q_(o,u){if(!(o&&o.length))return[];var c=_d(o);return u==null?c:xe(c,function(d){return Wt(u,t,d)})}var jP=oe(function(o,u){return Ke(o)?Po(o,u):[]}),QP=oe(function(o){return td(_r(o,Ke))}),YP=oe(function(o){var u=on(o);return Ke(u)&&(u=t),td(_r(o,Ke),Q(u,2))}),JP=oe(function(o){var u=on(o);return u=typeof u=="function"?u:t,td(_r(o,Ke),t,u)}),XP=oe(_d);function ZP(o,u){return f_(o||[],u||[],bo)}function eC(o,u){return f_(o||[],u||[],ko)}var tC=oe(function(o){var u=o.length,c=u>1?o[u-1]:t;return c=typeof c=="function"?(o.pop(),c):t,Q_(o,c)});function Y_(o){var u=_(o);return u.__chain__=!0,u}function nC(o,u){return u(o),o}function sc(o,u){return u(o)}var rC=Jn(function(o){var u=o.length,c=u?o[0]:0,d=this.__wrapped__,g=function(y){return $h(y,o)};return u>1||this.__actions__.length||!(d instanceof le)||!Xn(c)?this.thru(g):(d=d.slice(c,+c+(u?1:0)),d.__actions__.push({func:sc,args:[g],thisArg:t}),new nn(d,this.__chain__).thru(function(y){return u&&!y.length&&y.push(t),y}))});function iC(){return Y_(this)}function sC(){return new nn(this.value(),this.__chain__)}function oC(){this.__values__===t&&(this.__values__=ly(this.value()));var o=this.__index__>=this.__values__.length,u=o?t:this.__values__[this.__index__++];return{done:o,value:u}}function aC(){return this}function uC(o){for(var u,c=this;c instanceof Gu;){var d=W_(c);d.__index__=0,d.__values__=t,u?g.__wrapped__=d:u=d;var g=d;c=c.__wrapped__}return g.__wrapped__=o,u}function cC(){var o=this.__wrapped__;if(o instanceof le){var u=o;return this.__actions__.length&&(u=new le(this)),u=u.reverse(),u.__actions__.push({func:sc,args:[md],thisArg:t}),new nn(u,this.__chain__)}return this.thru(md)}function lC(){return d_(this.__wrapped__,this.__actions__)}var hC=Ju(function(o,u,c){Ee.call(o,c)?++o[c]:Qn(o,c,1)});function dC(o,u,c){var d=te(o)?Rm:nb;return c&&Rt(o,u,c)&&(u=t),d(o,Q(u,3))}function fC(o,u){var c=te(o)?_r:Qm;return c(o,Q(u,3))}var pC=T_(G_),gC=T_(z_);function mC(o,u){return ht(oc(o,u),1)}function _C(o,u){return ht(oc(o,u),ri)}function yC(o,u,c){return c=c===t?1:ie(c),ht(oc(o,u),c)}function J_(o,u){var c=te(o)?en:wr;return c(o,Q(u,3))}function X_(o,u){var c=te(o)?MR:jm;return c(o,Q(u,3))}var vC=Ju(function(o,u,c){Ee.call(o,c)?o[c].push(u):Qn(o,c,[u])});function IC(o,u,c,d){o=Ot(o)?o:ds(o),c=c&&!d?ie(c):0;var g=o.length;return c<0&&(c=Ze(g+c,0)),hc(o)?c<=g&&o.indexOf(u,c)>-1:!!g&&es(o,u,c)>-1}var wC=oe(function(o,u,c){var d=-1,g=typeof u=="function",y=Ot(o)?S(o.length):[];return wr(o,function(v){y[++d]=g?Wt(u,v,c):Co(v,u,c)}),y}),EC=Ju(function(o,u,c){Qn(o,c,u)});function oc(o,u){var c=te(o)?xe:t_;return c(o,Q(u,3))}function TC(o,u,c,d){return o==null?[]:(te(u)||(u=u==null?[]:[u]),c=d?t:c,te(c)||(c=c==null?[]:[c]),s_(o,u,c))}var AC=Ju(function(o,u,c){o[c?0:1].push(u)},function(){return[[],[]]});function RC(o,u,c){var d=te(o)?Ch:Cm,g=arguments.length<3;return d(o,Q(u,4),c,g,wr)}function SC(o,u,c){var d=te(o)?FR:Cm,g=arguments.length<3;return d(o,Q(u,4),c,g,jm)}function bC(o,u){var c=te(o)?_r:Qm;return c(o,cc(Q(u,3)))}function PC(o){var u=te(o)?Gm:Ib;return u(o)}function CC(o,u,c){(c?Rt(o,u,c):u===t)?u=1:u=ie(u);var d=te(o)?JS:wb;return d(o,u)}function DC(o){var u=te(o)?XS:Tb;return u(o)}function kC(o){if(o==null)return 0;if(Ot(o))return hc(o)?ns(o):o.length;var u=vt(o);return u==hn||u==dn?o.size:jh(o).length}function xC(o,u,c){var d=te(o)?Dh:Ab;return c&&Rt(o,u,c)&&(u=t),d(o,Q(u,3))}var NC=oe(function(o,u){if(o==null)return[];var c=u.length;return c>1&&Rt(o,u[0],u[1])?u=[]:c>2&&Rt(u[0],u[1],u[2])&&(u=[u[0]]),s_(o,ht(u,1),[])}),ac=fS||function(){return lt.Date.now()};function VC(o,u){if(typeof u!="function")throw new tn(a);return o=ie(o),function(){if(--o<1)return u.apply(this,arguments)}}function Z_(o,u,c){return u=c?t:u,u=o&&u==null?o.length:u,Yn(o,we,t,t,t,t,u)}function ey(o,u){var c;if(typeof u!="function")throw new tn(a);return o=ie(o),function(){return--o>0&&(c=u.apply(this,arguments)),o<=1&&(u=t),c}}var yd=oe(function(o,u,c){var d=V;if(c.length){var g=vr(c,ls(yd));d|=de}return Yn(o,d,u,c,g)}),ty=oe(function(o,u,c){var d=V|Y;if(c.length){var g=vr(c,ls(ty));d|=de}return Yn(u,d,o,c,g)});function ny(o,u,c){u=c?t:u;var d=Yn(o,j,t,t,t,t,t,u);return d.placeholder=ny.placeholder,d}function ry(o,u,c){u=c?t:u;var d=Yn(o,ye,t,t,t,t,t,u);return d.placeholder=ry.placeholder,d}function iy(o,u,c){var d,g,y,v,w,T,C=0,D=!1,x=!1,U=!0;if(typeof o!="function")throw new tn(a);u=an(u)||0,Me(c)&&(D=!!c.leading,x="maxWait"in c,y=x?Ze(an(c.maxWait)||0,u):y,U="trailing"in c?!!c.trailing:U);function G(He){var mn=d,tr=g;return d=g=t,C=He,v=o.apply(tr,mn),v}function J(He){return C=He,w=Vo(ue,u),D?G(He):v}function se(He){var mn=He-T,tr=He-C,Ty=u-mn;return x?yt(Ty,y-tr):Ty}function X(He){var mn=He-T,tr=He-C;return T===t||mn>=u||mn<0||x&&tr>=y}function ue(){var He=ac();if(X(He))return fe(He);w=Vo(ue,se(He))}function fe(He){return w=t,U&&d?G(He):(d=g=t,v)}function Ht(){w!==t&&p_(w),C=0,d=T=g=w=t}function St(){return w===t?v:fe(ac())}function jt(){var He=ac(),mn=X(He);if(d=arguments,g=this,T=He,mn){if(w===t)return J(T);if(x)return p_(w),w=Vo(ue,u),G(T)}return w===t&&(w=Vo(ue,u)),v}return jt.cancel=Ht,jt.flush=St,jt}var OC=oe(function(o,u){return Hm(o,1,u)}),LC=oe(function(o,u,c){return Hm(o,an(u)||0,c)});function MC(o){return Yn(o,zn)}function uc(o,u){if(typeof o!="function"||u!=null&&typeof u!="function")throw new tn(a);var c=function(){var d=arguments,g=u?u.apply(this,d):d[0],y=c.cache;if(y.has(g))return y.get(g);var v=o.apply(this,d);return c.cache=y.set(g,v)||y,v};return c.cache=new(uc.Cache||jn),c}uc.Cache=jn;function cc(o){if(typeof o!="function")throw new tn(a);return function(){var u=arguments;switch(u.length){case 0:return!o.call(this);case 1:return!o.call(this,u[0]);case 2:return!o.call(this,u[0],u[1]);case 3:return!o.call(this,u[0],u[1],u[2])}return!o.apply(this,u)}}function FC(o){return ey(2,o)}var UC=Rb(function(o,u){u=u.length==1&&te(u[0])?xe(u[0],Gt(Q())):xe(ht(u,1),Gt(Q()));var c=u.length;return oe(function(d){for(var g=-1,y=yt(d.length,c);++g<y;)d[g]=u[g].call(this,d[g]);return Wt(o,this,d)})}),vd=oe(function(o,u){var c=vr(u,ls(vd));return Yn(o,de,t,u,c)}),sy=oe(function(o,u){var c=vr(u,ls(sy));return Yn(o,me,t,u,c)}),BC=Jn(function(o,u){return Yn(o,Nt,t,t,t,u)});function qC(o,u){if(typeof o!="function")throw new tn(a);return u=u===t?u:ie(u),oe(o,u)}function $C(o,u){if(typeof o!="function")throw new tn(a);return u=u==null?0:Ze(ie(u),0),oe(function(c){var d=c[u],g=Ar(c,0,u);return d&&yr(g,d),Wt(o,this,g)})}function WC(o,u,c){var d=!0,g=!0;if(typeof o!="function")throw new tn(a);return Me(c)&&(d="leading"in c?!!c.leading:d,g="trailing"in c?!!c.trailing:g),iy(o,u,{leading:d,maxWait:u,trailing:g})}function GC(o){return Z_(o,1)}function zC(o,u){return vd(rd(u),o)}function KC(){if(!arguments.length)return[];var o=arguments[0];return te(o)?o:[o]}function HC(o){return rn(o,A)}function jC(o,u){return u=typeof u=="function"?u:t,rn(o,A,u)}function QC(o){return rn(o,m|A)}function YC(o,u){return u=typeof u=="function"?u:t,rn(o,m|A,u)}function JC(o,u){return u==null||Km(o,u,nt(u))}function gn(o,u){return o===u||o!==o&&u!==u}var XC=tc(zh),ZC=tc(function(o,u){return o>=u}),di=Xm(function(){return arguments}())?Xm:function(o){return Ue(o)&&Ee.call(o,"callee")&&!Fm.call(o,"callee")},te=S.isArray,e1=vm?Gt(vm):ub;function Ot(o){return o!=null&&lc(o.length)&&!Zn(o)}function Ke(o){return Ue(o)&&Ot(o)}function t1(o){return o===!0||o===!1||Ue(o)&&At(o)==po}var Rr=gS||Dd,n1=Im?Gt(Im):cb;function r1(o){return Ue(o)&&o.nodeType===1&&!Oo(o)}function i1(o){if(o==null)return!0;if(Ot(o)&&(te(o)||typeof o=="string"||typeof o.splice=="function"||Rr(o)||hs(o)||di(o)))return!o.length;var u=vt(o);if(u==hn||u==dn)return!o.size;if(No(o))return!jh(o).length;for(var c in o)if(Ee.call(o,c))return!1;return!0}function s1(o,u){return Do(o,u)}function o1(o,u,c){c=typeof c=="function"?c:t;var d=c?c(o,u):t;return d===t?Do(o,u,t,c):!!d}function Id(o){if(!Ue(o))return!1;var u=At(o);return u==Eu||u==C0||typeof o.message=="string"&&typeof o.name=="string"&&!Oo(o)}function a1(o){return typeof o=="number"&&Bm(o)}function Zn(o){if(!Me(o))return!1;var u=At(o);return u==Tu||u==Hg||u==P0||u==k0}function oy(o){return typeof o=="number"&&o==ie(o)}function lc(o){return typeof o=="number"&&o>-1&&o%1==0&&o<=mr}function Me(o){var u=typeof o;return o!=null&&(u=="object"||u=="function")}function Ue(o){return o!=null&&typeof o=="object"}var ay=wm?Gt(wm):hb;function u1(o,u){return o===u||Hh(o,u,ld(u))}function c1(o,u,c){return c=typeof c=="function"?c:t,Hh(o,u,ld(u),c)}function l1(o){return uy(o)&&o!=+o}function h1(o){if(jb(o))throw new ee(s);return Zm(o)}function d1(o){return o===null}function f1(o){return o==null}function uy(o){return typeof o=="number"||Ue(o)&&At(o)==mo}function Oo(o){if(!Ue(o)||At(o)!=Kn)return!1;var u=Mu(o);if(u===null)return!0;var c=Ee.call(u,"constructor")&&u.constructor;return typeof c=="function"&&c instanceof c&&Nu.call(c)==cS}var wd=Em?Gt(Em):db;function p1(o){return oy(o)&&o>=-mr&&o<=mr}var cy=Tm?Gt(Tm):fb;function hc(o){return typeof o=="string"||!te(o)&&Ue(o)&&At(o)==yo}function Kt(o){return typeof o=="symbol"||Ue(o)&&At(o)==Au}var hs=Am?Gt(Am):pb;function g1(o){return o===t}function m1(o){return Ue(o)&&vt(o)==vo}function _1(o){return Ue(o)&&At(o)==N0}var y1=tc(Qh),v1=tc(function(o,u){return o<=u});function ly(o){if(!o)return[];if(Ot(o))return hc(o)?fn(o):Vt(o);if(Eo&&o[Eo])return JR(o[Eo]());var u=vt(o),c=u==hn?Lh:u==dn?Du:ds;return c(o)}function er(o){if(!o)return o===0?o:0;if(o=an(o),o===ri||o===-ri){var u=o<0?-1:1;return u*A0}return o===o?o:0}function ie(o){var u=er(o),c=u%1;return u===u?c?u-c:u:0}function hy(o){return o?ui(ie(o),0,wn):0}function an(o){if(typeof o=="number")return o;if(Kt(o))return Iu;if(Me(o)){var u=typeof o.valueOf=="function"?o.valueOf():o;o=Me(u)?u+"":u}if(typeof o!="string")return o===0?o:+o;o=Dm(o);var c=eR.test(o);return c||nR.test(o)?VR(o.slice(2),c?2:8):Z0.test(o)?Iu:+o}function dy(o){return Tn(o,Lt(o))}function I1(o){return o?ui(ie(o),-mr,mr):o===0?o:0}function Ie(o){return o==null?"":zt(o)}var w1=us(function(o,u){if(No(u)||Ot(u)){Tn(u,nt(u),o);return}for(var c in u)Ee.call(u,c)&&bo(o,c,u[c])}),fy=us(function(o,u){Tn(u,Lt(u),o)}),dc=us(function(o,u,c,d){Tn(u,Lt(u),o,d)}),E1=us(function(o,u,c,d){Tn(u,nt(u),o,d)}),T1=Jn($h);function A1(o,u){var c=as(o);return u==null?c:zm(c,u)}var R1=oe(function(o,u){o=Se(o);var c=-1,d=u.length,g=d>2?u[2]:t;for(g&&Rt(u[0],u[1],g)&&(d=1);++c<d;)for(var y=u[c],v=Lt(y),w=-1,T=v.length;++w<T;){var C=v[w],D=o[C];(D===t||gn(D,is[C])&&!Ee.call(o,C))&&(o[C]=y[C])}return o}),S1=oe(function(o){return o.push(t,D_),Wt(py,t,o)});function b1(o,u){return Sm(o,Q(u,3),En)}function P1(o,u){return Sm(o,Q(u,3),Gh)}function C1(o,u){return o==null?o:Wh(o,Q(u,3),Lt)}function D1(o,u){return o==null?o:Ym(o,Q(u,3),Lt)}function k1(o,u){return o&&En(o,Q(u,3))}function x1(o,u){return o&&Gh(o,Q(u,3))}function N1(o){return o==null?[]:Hu(o,nt(o))}function V1(o){return o==null?[]:Hu(o,Lt(o))}function Ed(o,u,c){var d=o==null?t:ci(o,u);return d===t?c:d}function O1(o,u){return o!=null&&N_(o,u,ib)}function Td(o,u){return o!=null&&N_(o,u,sb)}var L1=R_(function(o,u,c){u!=null&&typeof u.toString!="function"&&(u=Vu.call(u)),o[u]=c},Rd(Mt)),M1=R_(function(o,u,c){u!=null&&typeof u.toString!="function"&&(u=Vu.call(u)),Ee.call(o,u)?o[u].push(c):o[u]=[c]},Q),F1=oe(Co);function nt(o){return Ot(o)?Wm(o):jh(o)}function Lt(o){return Ot(o)?Wm(o,!0):gb(o)}function U1(o,u){var c={};return u=Q(u,3),En(o,function(d,g,y){Qn(c,u(d,g,y),d)}),c}function B1(o,u){var c={};return u=Q(u,3),En(o,function(d,g,y){Qn(c,g,u(d,g,y))}),c}var q1=us(function(o,u,c){ju(o,u,c)}),py=us(function(o,u,c,d){ju(o,u,c,d)}),$1=Jn(function(o,u){var c={};if(o==null)return c;var d=!1;u=xe(u,function(y){return y=Tr(y,o),d||(d=y.length>1),y}),Tn(o,ud(o),c),d&&(c=rn(c,m|I|A,Lb));for(var g=u.length;g--;)ed(c,u[g]);return c});function W1(o,u){return gy(o,cc(Q(u)))}var G1=Jn(function(o,u){return o==null?{}:_b(o,u)});function gy(o,u){if(o==null)return{};var c=xe(ud(o),function(d){return[d]});return u=Q(u),o_(o,c,function(d,g){return u(d,g[0])})}function z1(o,u,c){u=Tr(u,o);var d=-1,g=u.length;for(g||(g=1,o=t);++d<g;){var y=o==null?t:o[An(u[d])];y===t&&(d=g,y=c),o=Zn(y)?y.call(o):y}return o}function K1(o,u,c){return o==null?o:ko(o,u,c)}function H1(o,u,c,d){return d=typeof d=="function"?d:t,o==null?o:ko(o,u,c,d)}var my=P_(nt),_y=P_(Lt);function j1(o,u,c){var d=te(o),g=d||Rr(o)||hs(o);if(u=Q(u,4),c==null){var y=o&&o.constructor;g?c=d?new y:[]:Me(o)?c=Zn(y)?as(Mu(o)):{}:c={}}return(g?en:En)(o,function(v,w,T){return u(c,v,w,T)}),c}function Q1(o,u){return o==null?!0:ed(o,u)}function Y1(o,u,c){return o==null?o:h_(o,u,rd(c))}function J1(o,u,c,d){return d=typeof d=="function"?d:t,o==null?o:h_(o,u,rd(c),d)}function ds(o){return o==null?[]:Oh(o,nt(o))}function X1(o){return o==null?[]:Oh(o,Lt(o))}function Z1(o,u,c){return c===t&&(c=u,u=t),c!==t&&(c=an(c),c=c===c?c:0),u!==t&&(u=an(u),u=u===u?u:0),ui(an(o),u,c)}function eD(o,u,c){return u=er(u),c===t?(c=u,u=0):c=er(c),o=an(o),ob(o,u,c)}function tD(o,u,c){if(c&&typeof c!="boolean"&&Rt(o,u,c)&&(u=c=t),c===t&&(typeof u=="boolean"?(c=u,u=t):typeof o=="boolean"&&(c=o,o=t)),o===t&&u===t?(o=0,u=1):(o=er(o),u===t?(u=o,o=0):u=er(u)),o>u){var d=o;o=u,u=d}if(c||o%1||u%1){var g=qm();return yt(o+g*(u-o+NR("1e-"+((g+"").length-1))),u)}return Jh(o,u)}var nD=cs(function(o,u,c){return u=u.toLowerCase(),o+(c?yy(u):u)});function yy(o){return Ad(Ie(o).toLowerCase())}function vy(o){return o=Ie(o),o&&o.replace(iR,KR).replace(TR,"")}function rD(o,u,c){o=Ie(o),u=zt(u);var d=o.length;c=c===t?d:ui(ie(c),0,d);var g=c;return c-=u.length,c>=0&&o.slice(c,g)==u}function iD(o){return o=Ie(o),o&&F0.test(o)?o.replace(Yg,HR):o}function sD(o){return o=Ie(o),o&&G0.test(o)?o.replace(vh,"\\$&"):o}var oD=cs(function(o,u,c){return o+(c?"-":"")+u.toLowerCase()}),aD=cs(function(o,u,c){return o+(c?" ":"")+u.toLowerCase()}),uD=E_("toLowerCase");function cD(o,u,c){o=Ie(o),u=ie(u);var d=u?ns(o):0;if(!u||d>=u)return o;var g=(u-d)/2;return ec(qu(g),c)+o+ec(Bu(g),c)}function lD(o,u,c){o=Ie(o),u=ie(u);var d=u?ns(o):0;return u&&d<u?o+ec(u-d,c):o}function hD(o,u,c){o=Ie(o),u=ie(u);var d=u?ns(o):0;return u&&d<u?ec(u-d,c)+o:o}function dD(o,u,c){return c||u==null?u=0:u&&(u=+u),vS(Ie(o).replace(Ih,""),u||0)}function fD(o,u,c){return(c?Rt(o,u,c):u===t)?u=1:u=ie(u),Xh(Ie(o),u)}function pD(){var o=arguments,u=Ie(o[0]);return o.length<3?u:u.replace(o[1],o[2])}var gD=cs(function(o,u,c){return o+(c?"_":"")+u.toLowerCase()});function mD(o,u,c){return c&&typeof c!="number"&&Rt(o,u,c)&&(u=c=t),c=c===t?wn:c>>>0,c?(o=Ie(o),o&&(typeof u=="string"||u!=null&&!wd(u))&&(u=zt(u),!u&&ts(o))?Ar(fn(o),0,c):o.split(u,c)):[]}var _D=cs(function(o,u,c){return o+(c?" ":"")+Ad(u)});function yD(o,u,c){return o=Ie(o),c=c==null?0:ui(ie(c),0,o.length),u=zt(u),o.slice(c,c+u.length)==u}function vD(o,u,c){var d=_.templateSettings;c&&Rt(o,u,c)&&(u=t),o=Ie(o),u=dc({},u,d,C_);var g=dc({},u.imports,d.imports,C_),y=nt(g),v=Oh(g,y),w,T,C=0,D=u.interpolate||Ru,x="__p += '",U=Mh((u.escape||Ru).source+"|"+D.source+"|"+(D===Jg?X0:Ru).source+"|"+(u.evaluate||Ru).source+"|$","g"),G="//# sourceURL="+(Ee.call(u,"sourceURL")?(u.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++PR+"]")+`
`;o.replace(U,function(X,ue,fe,Ht,St,jt){return fe||(fe=Ht),x+=o.slice(C,jt).replace(sR,jR),ue&&(w=!0,x+=`' +
__e(`+ue+`) +
'`),St&&(T=!0,x+=`';
`+St+`;
__p += '`),fe&&(x+=`' +
((__t = (`+fe+`)) == null ? '' : __t) +
'`),C=jt+X.length,X}),x+=`';
`;var J=Ee.call(u,"variable")&&u.variable;if(!J)x=`with (obj) {
`+x+`
}
`;else if(Y0.test(J))throw new ee(l);x=(T?x.replace(V0,""):x).replace(O0,"$1").replace(L0,"$1;"),x="function("+(J||"obj")+`) {
`+(J?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(T?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+x+`return __p
}`;var se=wy(function(){return ve(y,G+"return "+x).apply(t,v)});if(se.source=x,Id(se))throw se;return se}function ID(o){return Ie(o).toLowerCase()}function wD(o){return Ie(o).toUpperCase()}function ED(o,u,c){if(o=Ie(o),o&&(c||u===t))return Dm(o);if(!o||!(u=zt(u)))return o;var d=fn(o),g=fn(u),y=km(d,g),v=xm(d,g)+1;return Ar(d,y,v).join("")}function TD(o,u,c){if(o=Ie(o),o&&(c||u===t))return o.slice(0,Vm(o)+1);if(!o||!(u=zt(u)))return o;var d=fn(o),g=xm(d,fn(u))+1;return Ar(d,0,g).join("")}function AD(o,u,c){if(o=Ie(o),o&&(c||u===t))return o.replace(Ih,"");if(!o||!(u=zt(u)))return o;var d=fn(o),g=km(d,fn(u));return Ar(d,g).join("")}function RD(o,u){var c=Yi,d=v0;if(Me(u)){var g="separator"in u?u.separator:g;c="length"in u?ie(u.length):c,d="omission"in u?zt(u.omission):d}o=Ie(o);var y=o.length;if(ts(o)){var v=fn(o);y=v.length}if(c>=y)return o;var w=c-ns(d);if(w<1)return d;var T=v?Ar(v,0,w).join(""):o.slice(0,w);if(g===t)return T+d;if(v&&(w+=T.length-w),wd(g)){if(o.slice(w).search(g)){var C,D=T;for(g.global||(g=Mh(g.source,Ie(Xg.exec(g))+"g")),g.lastIndex=0;C=g.exec(D);)var x=C.index;T=T.slice(0,x===t?w:x)}}else if(o.indexOf(zt(g),w)!=w){var U=T.lastIndexOf(g);U>-1&&(T=T.slice(0,U))}return T+d}function SD(o){return o=Ie(o),o&&M0.test(o)?o.replace(Qg,tS):o}var bD=cs(function(o,u,c){return o+(c?" ":"")+u.toUpperCase()}),Ad=E_("toUpperCase");function Iy(o,u,c){return o=Ie(o),u=c?t:u,u===t?YR(o)?iS(o):qR(o):o.match(u)||[]}var wy=oe(function(o,u){try{return Wt(o,t,u)}catch(c){return Id(c)?c:new ee(c)}}),PD=Jn(function(o,u){return en(u,function(c){c=An(c),Qn(o,c,yd(o[c],o))}),o});function CD(o){var u=o==null?0:o.length,c=Q();return o=u?xe(o,function(d){if(typeof d[1]!="function")throw new tn(a);return[c(d[0]),d[1]]}):[],oe(function(d){for(var g=-1;++g<u;){var y=o[g];if(Wt(y[0],this,d))return Wt(y[1],this,d)}})}function DD(o){return tb(rn(o,m))}function Rd(o){return function(){return o}}function kD(o,u){return o==null||o!==o?u:o}var xD=A_(),ND=A_(!0);function Mt(o){return o}function Sd(o){return e_(typeof o=="function"?o:rn(o,m))}function VD(o){return n_(rn(o,m))}function OD(o,u){return r_(o,rn(u,m))}var LD=oe(function(o,u){return function(c){return Co(c,o,u)}}),MD=oe(function(o,u){return function(c){return Co(o,c,u)}});function bd(o,u,c){var d=nt(u),g=Hu(u,d);c==null&&!(Me(u)&&(g.length||!d.length))&&(c=u,u=o,o=this,g=Hu(u,nt(u)));var y=!(Me(c)&&"chain"in c)||!!c.chain,v=Zn(o);return en(g,function(w){var T=u[w];o[w]=T,v&&(o.prototype[w]=function(){var C=this.__chain__;if(y||C){var D=o(this.__wrapped__),x=D.__actions__=Vt(this.__actions__);return x.push({func:T,args:arguments,thisArg:o}),D.__chain__=C,D}return T.apply(o,yr([this.value()],arguments))})}),o}function FD(){return lt._===this&&(lt._=lS),this}function Pd(){}function UD(o){return o=ie(o),oe(function(u){return i_(u,o)})}var BD=sd(xe),qD=sd(Rm),$D=sd(Dh);function Ey(o){return dd(o)?kh(An(o)):yb(o)}function WD(o){return function(u){return o==null?t:ci(o,u)}}var GD=S_(),zD=S_(!0);function Cd(){return[]}function Dd(){return!1}function KD(){return{}}function HD(){return""}function jD(){return!0}function QD(o,u){if(o=ie(o),o<1||o>mr)return[];var c=wn,d=yt(o,wn);u=Q(u),o-=wn;for(var g=Vh(d,u);++c<o;)u(c);return g}function YD(o){return te(o)?xe(o,An):Kt(o)?[o]:Vt($_(Ie(o)))}function JD(o){var u=++uS;return Ie(o)+u}var XD=Zu(function(o,u){return o+u},0),ZD=od("ceil"),ek=Zu(function(o,u){return o/u},1),tk=od("floor");function nk(o){return o&&o.length?Ku(o,Mt,zh):t}function rk(o,u){return o&&o.length?Ku(o,Q(u,2),zh):t}function ik(o){return Pm(o,Mt)}function sk(o,u){return Pm(o,Q(u,2))}function ok(o){return o&&o.length?Ku(o,Mt,Qh):t}function ak(o,u){return o&&o.length?Ku(o,Q(u,2),Qh):t}var uk=Zu(function(o,u){return o*u},1),ck=od("round"),lk=Zu(function(o,u){return o-u},0);function hk(o){return o&&o.length?Nh(o,Mt):0}function dk(o,u){return o&&o.length?Nh(o,Q(u,2)):0}return _.after=VC,_.ary=Z_,_.assign=w1,_.assignIn=fy,_.assignInWith=dc,_.assignWith=E1,_.at=T1,_.before=ey,_.bind=yd,_.bindAll=PD,_.bindKey=ty,_.castArray=KC,_.chain=Y_,_.chunk=tP,_.compact=nP,_.concat=rP,_.cond=CD,_.conforms=DD,_.constant=Rd,_.countBy=hC,_.create=A1,_.curry=ny,_.curryRight=ry,_.debounce=iy,_.defaults=R1,_.defaultsDeep=S1,_.defer=OC,_.delay=LC,_.difference=iP,_.differenceBy=sP,_.differenceWith=oP,_.drop=aP,_.dropRight=uP,_.dropRightWhile=cP,_.dropWhile=lP,_.fill=hP,_.filter=fC,_.flatMap=mC,_.flatMapDeep=_C,_.flatMapDepth=yC,_.flatten=K_,_.flattenDeep=dP,_.flattenDepth=fP,_.flip=MC,_.flow=xD,_.flowRight=ND,_.fromPairs=pP,_.functions=N1,_.functionsIn=V1,_.groupBy=vC,_.initial=mP,_.intersection=_P,_.intersectionBy=yP,_.intersectionWith=vP,_.invert=L1,_.invertBy=M1,_.invokeMap=wC,_.iteratee=Sd,_.keyBy=EC,_.keys=nt,_.keysIn=Lt,_.map=oc,_.mapKeys=U1,_.mapValues=B1,_.matches=VD,_.matchesProperty=OD,_.memoize=uc,_.merge=q1,_.mergeWith=py,_.method=LD,_.methodOf=MD,_.mixin=bd,_.negate=cc,_.nthArg=UD,_.omit=$1,_.omitBy=W1,_.once=FC,_.orderBy=TC,_.over=BD,_.overArgs=UC,_.overEvery=qD,_.overSome=$D,_.partial=vd,_.partialRight=sy,_.partition=AC,_.pick=G1,_.pickBy=gy,_.property=Ey,_.propertyOf=WD,_.pull=TP,_.pullAll=j_,_.pullAllBy=AP,_.pullAllWith=RP,_.pullAt=SP,_.range=GD,_.rangeRight=zD,_.rearg=BC,_.reject=bC,_.remove=bP,_.rest=qC,_.reverse=md,_.sampleSize=CC,_.set=K1,_.setWith=H1,_.shuffle=DC,_.slice=PP,_.sortBy=NC,_.sortedUniq=OP,_.sortedUniqBy=LP,_.split=mD,_.spread=$C,_.tail=MP,_.take=FP,_.takeRight=UP,_.takeRightWhile=BP,_.takeWhile=qP,_.tap=nC,_.throttle=WC,_.thru=sc,_.toArray=ly,_.toPairs=my,_.toPairsIn=_y,_.toPath=YD,_.toPlainObject=dy,_.transform=j1,_.unary=GC,_.union=$P,_.unionBy=WP,_.unionWith=GP,_.uniq=zP,_.uniqBy=KP,_.uniqWith=HP,_.unset=Q1,_.unzip=_d,_.unzipWith=Q_,_.update=Y1,_.updateWith=J1,_.values=ds,_.valuesIn=X1,_.without=jP,_.words=Iy,_.wrap=zC,_.xor=QP,_.xorBy=YP,_.xorWith=JP,_.zip=XP,_.zipObject=ZP,_.zipObjectDeep=eC,_.zipWith=tC,_.entries=my,_.entriesIn=_y,_.extend=fy,_.extendWith=dc,bd(_,_),_.add=XD,_.attempt=wy,_.camelCase=nD,_.capitalize=yy,_.ceil=ZD,_.clamp=Z1,_.clone=HC,_.cloneDeep=QC,_.cloneDeepWith=YC,_.cloneWith=jC,_.conformsTo=JC,_.deburr=vy,_.defaultTo=kD,_.divide=ek,_.endsWith=rD,_.eq=gn,_.escape=iD,_.escapeRegExp=sD,_.every=dC,_.find=pC,_.findIndex=G_,_.findKey=b1,_.findLast=gC,_.findLastIndex=z_,_.findLastKey=P1,_.floor=tk,_.forEach=J_,_.forEachRight=X_,_.forIn=C1,_.forInRight=D1,_.forOwn=k1,_.forOwnRight=x1,_.get=Ed,_.gt=XC,_.gte=ZC,_.has=O1,_.hasIn=Td,_.head=H_,_.identity=Mt,_.includes=IC,_.indexOf=gP,_.inRange=eD,_.invoke=F1,_.isArguments=di,_.isArray=te,_.isArrayBuffer=e1,_.isArrayLike=Ot,_.isArrayLikeObject=Ke,_.isBoolean=t1,_.isBuffer=Rr,_.isDate=n1,_.isElement=r1,_.isEmpty=i1,_.isEqual=s1,_.isEqualWith=o1,_.isError=Id,_.isFinite=a1,_.isFunction=Zn,_.isInteger=oy,_.isLength=lc,_.isMap=ay,_.isMatch=u1,_.isMatchWith=c1,_.isNaN=l1,_.isNative=h1,_.isNil=f1,_.isNull=d1,_.isNumber=uy,_.isObject=Me,_.isObjectLike=Ue,_.isPlainObject=Oo,_.isRegExp=wd,_.isSafeInteger=p1,_.isSet=cy,_.isString=hc,_.isSymbol=Kt,_.isTypedArray=hs,_.isUndefined=g1,_.isWeakMap=m1,_.isWeakSet=_1,_.join=IP,_.kebabCase=oD,_.last=on,_.lastIndexOf=wP,_.lowerCase=aD,_.lowerFirst=uD,_.lt=y1,_.lte=v1,_.max=nk,_.maxBy=rk,_.mean=ik,_.meanBy=sk,_.min=ok,_.minBy=ak,_.stubArray=Cd,_.stubFalse=Dd,_.stubObject=KD,_.stubString=HD,_.stubTrue=jD,_.multiply=uk,_.nth=EP,_.noConflict=FD,_.noop=Pd,_.now=ac,_.pad=cD,_.padEnd=lD,_.padStart=hD,_.parseInt=dD,_.random=tD,_.reduce=RC,_.reduceRight=SC,_.repeat=fD,_.replace=pD,_.result=z1,_.round=ck,_.runInContext=E,_.sample=PC,_.size=kC,_.snakeCase=gD,_.some=xC,_.sortedIndex=CP,_.sortedIndexBy=DP,_.sortedIndexOf=kP,_.sortedLastIndex=xP,_.sortedLastIndexBy=NP,_.sortedLastIndexOf=VP,_.startCase=_D,_.startsWith=yD,_.subtract=lk,_.sum=hk,_.sumBy=dk,_.template=vD,_.times=QD,_.toFinite=er,_.toInteger=ie,_.toLength=hy,_.toLower=ID,_.toNumber=an,_.toSafeInteger=I1,_.toString=Ie,_.toUpper=wD,_.trim=ED,_.trimEnd=TD,_.trimStart=AD,_.truncate=RD,_.unescape=SD,_.uniqueId=JD,_.upperCase=bD,_.upperFirst=Ad,_.each=J_,_.eachRight=X_,_.first=H_,bd(_,function(){var o={};return En(_,function(u,c){Ee.call(_.prototype,c)||(o[c]=u)}),o}(),{chain:!1}),_.VERSION=r,en(["bind","bindKey","curry","curryRight","partial","partialRight"],function(o){_[o].placeholder=_}),en(["drop","take"],function(o,u){le.prototype[o]=function(c){c=c===t?1:Ze(ie(c),0);var d=this.__filtered__&&!u?new le(this):this.clone();return d.__filtered__?d.__takeCount__=yt(c,d.__takeCount__):d.__views__.push({size:yt(c,wn),type:o+(d.__dir__<0?"Right":"")}),d},le.prototype[o+"Right"]=function(c){return this.reverse()[o](c).reverse()}}),en(["filter","map","takeWhile"],function(o,u){var c=u+1,d=c==Kg||c==T0;le.prototype[o]=function(g){var y=this.clone();return y.__iteratees__.push({iteratee:Q(g,3),type:c}),y.__filtered__=y.__filtered__||d,y}}),en(["head","last"],function(o,u){var c="take"+(u?"Right":"");le.prototype[o]=function(){return this[c](1).value()[0]}}),en(["initial","tail"],function(o,u){var c="drop"+(u?"":"Right");le.prototype[o]=function(){return this.__filtered__?new le(this):this[c](1)}}),le.prototype.compact=function(){return this.filter(Mt)},le.prototype.find=function(o){return this.filter(o).head()},le.prototype.findLast=function(o){return this.reverse().find(o)},le.prototype.invokeMap=oe(function(o,u){return typeof o=="function"?new le(this):this.map(function(c){return Co(c,o,u)})}),le.prototype.reject=function(o){return this.filter(cc(Q(o)))},le.prototype.slice=function(o,u){o=ie(o);var c=this;return c.__filtered__&&(o>0||u<0)?new le(c):(o<0?c=c.takeRight(-o):o&&(c=c.drop(o)),u!==t&&(u=ie(u),c=u<0?c.dropRight(-u):c.take(u-o)),c)},le.prototype.takeRightWhile=function(o){return this.reverse().takeWhile(o).reverse()},le.prototype.toArray=function(){return this.take(wn)},En(le.prototype,function(o,u){var c=/^(?:filter|find|map|reject)|While$/.test(u),d=/^(?:head|last)$/.test(u),g=_[d?"take"+(u=="last"?"Right":""):u],y=d||/^find/.test(u);g&&(_.prototype[u]=function(){var v=this.__wrapped__,w=d?[1]:arguments,T=v instanceof le,C=w[0],D=T||te(v),x=function(ue){var fe=g.apply(_,yr([ue],w));return d&&U?fe[0]:fe};D&&c&&typeof C=="function"&&C.length!=1&&(T=D=!1);var U=this.__chain__,G=!!this.__actions__.length,J=y&&!U,se=T&&!G;if(!y&&D){v=se?v:new le(this);var X=o.apply(v,w);return X.__actions__.push({func:sc,args:[x],thisArg:t}),new nn(X,U)}return J&&se?o.apply(this,w):(X=this.thru(x),J?d?X.value()[0]:X.value():X)})}),en(["pop","push","shift","sort","splice","unshift"],function(o){var u=ku[o],c=/^(?:push|sort|unshift)$/.test(o)?"tap":"thru",d=/^(?:pop|shift)$/.test(o);_.prototype[o]=function(){var g=arguments;if(d&&!this.__chain__){var y=this.value();return u.apply(te(y)?y:[],g)}return this[c](function(v){return u.apply(te(v)?v:[],g)})}}),En(le.prototype,function(o,u){var c=_[u];if(c){var d=c.name+"";Ee.call(os,d)||(os[d]=[]),os[d].push({name:u,func:c})}}),os[Xu(t,Y).name]=[{name:"wrapper",func:t}],le.prototype.clone=SS,le.prototype.reverse=bS,le.prototype.value=PS,_.prototype.at=rC,_.prototype.chain=iC,_.prototype.commit=sC,_.prototype.next=oC,_.prototype.plant=uC,_.prototype.reverse=cC,_.prototype.toJSON=_.prototype.valueOf=_.prototype.value=lC,_.prototype.first=_.prototype.head,Eo&&(_.prototype[Eo]=aC),_},rs=sS();ii?((ii.exports=rs)._=rs,Sh._=rs):lt._=rs}).call(Yo)})(s4,ll);const o4=ll,_0=document.querySelector(".search__wrapper"),a4=document.querySelector(".search__input"),zg=document.querySelector(".filters__list"),Qf=document.querySelector(".filters__category"),u4=new hl;c4();async function c4(){const n=await u4.fetchFilters(),t=[...new Set(n.map(({filter:r})=>r))].map((r,i)=>{const s=r.toLowerCase().split(" ").join("-");return i===0?`<li id=${s} class="filters__item active">${r}</li>`:`<li id=${s} class="filters__item">${r}</li>`}).join("");zg.insertAdjacentHTML("afterbegin",t),fo()}function l4(n){const e=n.charAt(0).toUpperCase()+n.slice(1,n.length);Qf.innerHTML=`<div>/</div>${e}`,Qf.classList.add("active"),_0.classList.add("active")}function h4(){Qf.classList.remove("active"),_0.classList.remove("active")}async function d4(n){const e=n.target.value.toLowerCase().trim();Sn.keyword=e,fo()}function f4(n){const e=n.target;n.target.id,!e.classList.contains("active")&&([...zg.children].forEach(t=>{t.classList.remove("active")}),e.classList.add("active"),h4(),et.currentPage=1,fo())}const p4=o4.debounce(d4,500);a4.addEventListener("input",p4);zg.addEventListener("click",f4);window.addEventListener("resize",fo);let Sn={filter:"Muscles",bodypart:"",keyword:"",muscles:"",equipment:""};const et={currentPage:1,endPoint:3},Bn={cardsLinks:null,pageLinks:null,workoutLinks:null};async function fo(){document.querySelector(".exercise-cards__section").offsetHeight;const e=new hl;let t,r;Ek(Sn,et),bk(),i4(et.endPoint,LI());try{switch(et.endPoint){case 1:Sk(),Cy(),t=await Vs.get(),yk(t);break;case 2:Rk(),Dy(),r=Ik(et.currentPage,et.endPoint,e,Sn,r),t=await Py(r),by(),xy(),_k(t),ky(et.currentPage,e.maxPages),VI(et.endPoint),y4();break;case 3:Cy(),Dy(),r=wk(et.currentPage,et.endPoint,e,Sn,r),t=await Py(r),by(),xy(),mk(t),ky(et.currentPage,e.maxPages),g4(),VI(et.endPoint);break}}catch(i){console.log("Error: ",i),et.endPoint===1?Ck():Dk(),Pk()}}function g4(){Bn.cardsLinks=document.querySelector(".js-cards"),Bn.cardsLinks?Bn.cardsLinks.addEventListener("click",y0):console.error("Element with class 'js-cards' not found.")}function y0(n){const e=kk(n);l4(e),m4(e),e!=null&&(Sn.filter==="Muscles"?(et.endPoint=2,Sn.muscles=e):Sn.filter==="Body%20parts"?(et.endPoint=2,Sn.bodypart=e):Sn.filter==="Equipment"&&(et.endPoint=2,Sn.equipment=e)),Bn.cardsLinks.removeEventListener("click",y0),et.currentPage=1,fo()}function m4(n){return n.includes(" ")?n.replace(" ","%20"):n}function VI(){Bn.pageLinks=document.querySelector(".js-pages"),Bn.pageLinks?Bn.pageLinks.addEventListener("click",_4):console.error("Element with class 'js-pages' not found.")}function _4(n){const e=xk(n);et.currentPage!=e&&e!=null&&(et.currentPage=+e,fo())}function y4(){Bn.workoutLinks=document.querySelector(".js-cards"),Bn.workoutLinks?Bn.workoutLinks.addEventListener("click",v4):console.error("Element with class 'js-cards' not found for workout.")}async function v4(n){const e=Nk(n);if(!e)return;const t=new hl;try{t.id=e;const r=await t.fetchExerciseById();if(!r)throw new Error("Exercise not found!");r.isFavorite=Vs.getObjectById(e),r4(r)}catch(r){console.error(r)}}export{B4 as a,q4 as b,fo as c,Ha as d,et as p,$4 as s};
