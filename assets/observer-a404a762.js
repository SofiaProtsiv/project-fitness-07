import{A as uc,i as ux}from"./index-2f3ee3dc.js";const rv=document.getElementById("daily-quote"),iv=document.getElementById("quote-author"),lx=new uc;function mw(){const n=new Date,e=n.getFullYear(),t=(n.getMonth()+1).toString().padStart(2,"0");return`${n.getDate().toString().padStart(2,"0")}/${t}/${e}`}async function hx(){try{const n=await lx.fetchQuote(),e=n.quote,t=n.author,r=mw();return localStorage.setItem("today",r),localStorage.setItem("quote",e),localStorage.setItem("author",t),{quote:e,author:t}}catch(n){console.error("Error fetching quote:",n.message)}}const sv=localStorage.getItem("today"),dx=mw();if(!sv||sv!==dx)hx().then(({quote:n,author:e})=>{rv.textContent=n,iv.textContent=e});else{const n=localStorage.getItem("quote");n&&(rv.textContent=n);const e=localStorage.getItem("author");e&&(iv.textContent=e)}const _w=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},fx=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],a=n[t++],l=n[t++],h=((i&7)<<18|(s&63)<<12|(a&63)<<6|l&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const s=n[t++],a=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},yw={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],a=i+1<n.length,l=a?n[i+1]:0,h=i+2<n.length,f=h?n[i+2]:0,p=s>>2,m=(s&3)<<4|l>>4;let I=(l&15)<<2|f>>6,A=f&63;h||(A=64,a||(I=64)),r.push(t[p],t[m],t[I],t[A])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(_w(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):fx(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],l=i<n.length?t[n.charAt(i)]:0;++i;const f=i<n.length?t[n.charAt(i)]:64;++i;const m=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||l==null||f==null||m==null)throw new px;const I=s<<2|l>>4;if(r.push(I),f!==64){const A=l<<4&240|f>>2;if(r.push(A),m!==64){const L=f<<6&192|m;r.push(L)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class px extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const gx=function(n){const e=_w(n);return yw.encodeByteArray(e,!0)},nl=function(n){return gx(n).replace(/\./g,"")},vw=function(n){try{return yw.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function rl(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!mx(t)||(n[t]=rl(n[t],e[t]));return n}function mx(n){return n!=="__proto__"}function _x(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const yx=()=>_x().__FIREBASE_DEFAULTS__,vx=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Ix=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&vw(n[1]);return e&&JSON.parse(e)},vp=()=>{try{return yx()||vx()||Ix()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Iw=()=>{var n;return(n=vp())===null||n===void 0?void 0:n.config},wx=n=>{var e;return(e=vp())===null||e===void 0?void 0:e[`_${n}`]};class Ex{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function Tx(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n),l="";return[nl(JSON.stringify(t)),nl(JSON.stringify(a)),l].join(".")}function qe(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ax(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(qe())}function Ip(){var n;const e=(n=vp())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Rx(){return typeof self=="object"&&self.self===self}function ww(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function wp(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Ew(){const n=qe();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function Sx(){return!Ip()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ca(){try{return typeof indexedDB=="object"}catch{return!1}}function bx(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}const Px="FirebaseError";class Vt extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=Px,Object.setPrototypeOf(this,Vt.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Xi.prototype.create)}}class Xi{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?Cx(s,r):"Error",l=`${this.serviceName}: ${a} (${i}).`;return new Vt(i,l,r)}}function Cx(n,e){return n.replace(kx,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const kx=/\{\$([^}]+)}/g;function ov(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Dx(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Tf(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],a=e[i];if(av(s)&&av(a)){if(!Tf(s,a))return!1}else if(s!==a)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function av(n){return n!==null&&typeof n=="object"}function go(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Us(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function ha(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Tw(n,e){const t=new xx(n,e);return t.subscribe.bind(t)}class xx{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Nx(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Jd),i.error===void 0&&(i.error=Jd),i.complete===void 0&&(i.complete=Jd);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Nx(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Jd(){}function H(n){return n&&n._delegate?n._delegate:n}class zn{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const wi="[DEFAULT]";class Vx{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Ex;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Lx(e))try{this.getOrInitializeService({instanceIdentifier:wi})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=wi){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=wi){return this.instances.has(e)}getOptions(e=wi){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(s);r===l&&a.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Ox(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=wi){return this.component?this.component.multipleInstances?e:wi:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Ox(n){return n===wi?void 0:n}function Lx(n){return n.instantiationMode==="EAGER"}class Mx{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Vx(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Ep=[];var ue;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(ue||(ue={}));const Aw={debug:ue.DEBUG,verbose:ue.VERBOSE,info:ue.INFO,warn:ue.WARN,error:ue.ERROR,silent:ue.SILENT},Fx=ue.INFO,Ux={[ue.DEBUG]:"log",[ue.VERBOSE]:"log",[ue.INFO]:"info",[ue.WARN]:"warn",[ue.ERROR]:"error"},Bx=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=Ux[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Vl{constructor(e){this.name=e,this._logLevel=Fx,this._logHandler=Bx,this._userLogHandler=null,Ep.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ue))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Aw[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ue.DEBUG,...e),this._logHandler(this,ue.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ue.VERBOSE,...e),this._logHandler(this,ue.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ue.INFO,...e),this._logHandler(this,ue.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ue.WARN,...e),this._logHandler(this,ue.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ue.ERROR,...e),this._logHandler(this,ue.ERROR,...e)}}function qx(n){Ep.forEach(e=>{e.setLogLevel(n)})}function $x(n,e){for(const t of Ep){let r=null;e&&e.level&&(r=Aw[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(i,s,...a)=>{const l=a.map(h=>{if(h==null)return null;if(typeof h=="string")return h;if(typeof h=="number"||typeof h=="boolean")return h.toString();if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch{return null}}).filter(h=>h).join(" ");s>=(r??i.logLevel)&&n({level:ue[s].toLowerCase(),message:l,args:a,type:i.name})}}}const Wx=(n,e)=>e.some(t=>n instanceof t);let cv,uv;function Gx(){return cv||(cv=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function zx(){return uv||(uv=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Rw=new WeakMap,Af=new WeakMap,Sw=new WeakMap,Xd=new WeakMap,Tp=new WeakMap;function Kx(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(Br(n.result)),i()},a=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&Rw.set(t,n)}).catch(()=>{}),Tp.set(e,n),e}function Hx(n){if(Af.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),i()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});Af.set(n,e)}let Rf={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Af.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Sw.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Br(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function jx(n){Rf=n(Rf)}function Qx(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Zd(this),e,...t);return Sw.set(r,e.sort?e.sort():[e]),Br(r)}:zx().includes(n)?function(...e){return n.apply(Zd(this),e),Br(Rw.get(this))}:function(...e){return Br(n.apply(Zd(this),e))}}function Yx(n){return typeof n=="function"?Qx(n):(n instanceof IDBTransaction&&Hx(n),Wx(n,Gx())?new Proxy(n,Rf):n)}function Br(n){if(n instanceof IDBRequest)return Kx(n);if(Xd.has(n))return Xd.get(n);const e=Yx(n);return e!==n&&(Xd.set(n,e),Tp.set(e,n)),e}const Zd=n=>Tp.get(n);function Jx(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(n,e),l=Br(a);return r&&a.addEventListener("upgradeneeded",h=>{r(Br(a.result),h.oldVersion,h.newVersion,Br(a.transaction),h)}),t&&a.addEventListener("blocked",h=>t(h.oldVersion,h.newVersion,h)),l.then(h=>{s&&h.addEventListener("close",()=>s()),i&&h.addEventListener("versionchange",f=>i(f.oldVersion,f.newVersion,f))}).catch(()=>{}),l}const Xx=["get","getKey","getAll","getAllKeys","count"],Zx=["put","add","delete","clear"],ef=new Map;function lv(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(ef.get(e))return ef.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=Zx.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Xx.includes(t)))return;const s=async function(a,...l){const h=this.transaction(a,i?"readwrite":"readonly");let f=h.store;return r&&(f=f.index(l.shift())),(await Promise.all([f[t](...l),i&&h.done]))[0]};return ef.set(e,s),s}jx(n=>({...n,get:(e,t,r)=>lv(e,t)||n.get(e,t,r),has:(e,t)=>!!lv(e,t)||n.has(e,t)}));class eN{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(tN(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function tN(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Sf="@firebase/app",hv="0.9.25";const Ui=new Vl("@firebase/app"),nN="@firebase/app-compat",rN="@firebase/analytics-compat",iN="@firebase/analytics",sN="@firebase/app-check-compat",oN="@firebase/app-check",aN="@firebase/auth",cN="@firebase/auth-compat",uN="@firebase/database",lN="@firebase/database-compat",hN="@firebase/functions",dN="@firebase/functions-compat",fN="@firebase/installations",pN="@firebase/installations-compat",gN="@firebase/messaging",mN="@firebase/messaging-compat",_N="@firebase/performance",yN="@firebase/performance-compat",vN="@firebase/remote-config",IN="@firebase/remote-config-compat",wN="@firebase/storage",EN="@firebase/storage-compat",TN="@firebase/firestore",AN="@firebase/firestore-compat",RN="firebase",SN="10.7.1";const qr="[DEFAULT]",bN={[Sf]:"fire-core",[nN]:"fire-core-compat",[iN]:"fire-analytics",[rN]:"fire-analytics-compat",[oN]:"fire-app-check",[sN]:"fire-app-check-compat",[aN]:"fire-auth",[cN]:"fire-auth-compat",[uN]:"fire-rtdb",[lN]:"fire-rtdb-compat",[hN]:"fire-fn",[dN]:"fire-fn-compat",[fN]:"fire-iid",[pN]:"fire-iid-compat",[gN]:"fire-fcm",[mN]:"fire-fcm-compat",[_N]:"fire-perf",[yN]:"fire-perf-compat",[vN]:"fire-rc",[IN]:"fire-rc-compat",[wN]:"fire-gcs",[EN]:"fire-gcs-compat",[TN]:"fire-fst",[AN]:"fire-fst-compat","fire-js":"fire-js",[RN]:"fire-js-all"};const $r=new Map,ka=new Map;function il(n,e){try{n.container.addComponent(e)}catch(t){Ui.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function bw(n,e){n.container.addOrOverwriteComponent(e)}function Wr(n){const e=n.name;if(ka.has(e))return Ui.debug(`There were multiple attempts to register component ${e}.`),!1;ka.set(e,n);for(const t of $r.values())il(t,n);return!0}function Pw(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function PN(n,e,t=qr){Pw(n,e).clearInstance(t)}function CN(){ka.clear()}const kN={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},lr=new Xi("app","Firebase",kN);let DN=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new zn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw lr.create("app-deleted",{appName:this._name})}};const ni=SN;function Ap(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:qr,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw lr.create("bad-app-name",{appName:String(i)});if(t||(t=Iw()),!t)throw lr.create("no-options");const s=$r.get(i);if(s){if(Tf(t,s.options)&&Tf(r,s.config))return s;throw lr.create("duplicate-app",{appName:i})}const a=new Mx(i);for(const h of ka.values())a.addComponent(h);const l=new DN(t,r,a);return $r.set(i,l),l}function xN(n=qr){const e=$r.get(n);if(!e&&n===qr&&Iw())return Ap();if(!e)throw lr.create("no-app",{appName:n});return e}function NN(){return Array.from($r.values())}async function Cw(n){const e=n.name;$r.has(e)&&($r.delete(e),await Promise.all(n.container.getProviders().map(t=>t.delete())),n.isDeleted=!0)}function qn(n,e,t){var r;let i=(r=bN[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const l=[`Unable to register library "${i}" with version "${e}":`];s&&l.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Ui.warn(l.join(" "));return}Wr(new zn(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function kw(n,e){if(n!==null&&typeof n!="function")throw lr.create("invalid-log-argument");$x(n,e)}function Dw(n){qx(n)}const VN="firebase-heartbeat-database",ON=1,Da="firebase-heartbeat-store";let tf=null;function xw(){return tf||(tf=Jx(VN,ON,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Da)}}}).catch(n=>{throw lr.create("idb-open",{originalErrorMessage:n.message})})),tf}async function LN(n){try{return await(await xw()).transaction(Da).objectStore(Da).get(Nw(n))}catch(e){if(e instanceof Vt)Ui.warn(e.message);else{const t=lr.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Ui.warn(t.message)}}}async function dv(n,e){try{const r=(await xw()).transaction(Da,"readwrite");await r.objectStore(Da).put(e,Nw(n)),await r.done}catch(t){if(t instanceof Vt)Ui.warn(t.message);else{const r=lr.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Ui.warn(r.message)}}}function Nw(n){return`${n.name}!${n.options.appId}`}const MN=1024,FN=30*24*60*60*1e3;class UN{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new qN(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=fv();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const l=new Date(a.date).valueOf();return Date.now()-l<=FN}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=fv(),{heartbeatsToSend:r,unsentEntries:i}=BN(this._heartbeatsCache.heartbeats),s=nl(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function fv(){return new Date().toISOString().substring(0,10)}function BN(n,e=MN){const t=[];let r=n.slice();for(const i of n){const s=t.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),pv(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),pv(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class qN{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ca()?bx().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await LN(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return dv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return dv(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function pv(n){return nl(JSON.stringify({version:2,heartbeats:n})).length}function $N(n){Wr(new zn("platform-logger",e=>new eN(e),"PRIVATE")),Wr(new zn("heartbeat",e=>new UN(e),"PRIVATE")),qn(Sf,hv,n),qn(Sf,hv,"esm2017"),qn("fire-js","")}$N("");const WN=Object.freeze(Object.defineProperty({__proto__:null,SDK_VERSION:ni,_DEFAULT_ENTRY_NAME:qr,_addComponent:il,_addOrOverwriteComponent:bw,_apps:$r,_clearComponents:CN,_components:ka,_getProvider:Pw,_registerComponent:Wr,_removeServiceInstance:PN,deleteApp:Cw,getApp:xN,getApps:NN,initializeApp:Ap,onLog:kw,registerVersion:qn,setLogLevel:Dw,FirebaseError:Vt},Symbol.toStringTag,{value:"Module"}));class GN{constructor(e,t){this._delegate=e,this.firebase=t,il(e,new zn("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),Cw(this._delegate)))}_getService(e,t=qr){var r;this._delegate.checkDestroyed();const i=this._delegate.container.getProvider(e);return!i.isInitialized()&&((r=i.getComponent())===null||r===void 0?void 0:r.instantiationMode)==="EXPLICIT"&&i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=qr){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){il(this._delegate,e)}_addOrOverwriteComponent(e){bw(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const zN={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance."},gv=new Xi("app-compat","Firebase",zN);function KN(n){const e={},t={__esModule:!0,initializeApp:s,app:i,registerVersion:qn,setLogLevel:Dw,onLog:kw,apps:null,SDK_VERSION:ni,INTERNAL:{registerComponent:l,removeApp:r,useAsService:h,modularAPIs:WN}};t.default=t,Object.defineProperty(t,"apps",{get:a});function r(f){delete e[f]}function i(f){if(f=f||qr,!ov(e,f))throw gv.create("no-app",{appName:f});return e[f]}i.App=n;function s(f,p={}){const m=Ap(f,p);if(ov(e,m.name))return e[m.name];const I=new n(m,t);return e[m.name]=I,I}function a(){return Object.keys(e).map(f=>e[f])}function l(f){const p=f.name,m=p.replace("-compat","");if(Wr(f)&&f.type==="PUBLIC"){const I=(A=i())=>{if(typeof A[m]!="function")throw gv.create("invalid-app-argument",{appName:p});return A[m]()};f.serviceProps!==void 0&&rl(I,f.serviceProps),t[m]=I,n.prototype[m]=function(...A){return this._getService.bind(this,p).apply(this,f.multipleInstances?A:[])}}return f.type==="PUBLIC"?t[m]:null}function h(f,p){return p==="serverAuth"?null:p}return t}function Vw(){const n=KN(GN);n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:Vw,extendNamespace:e,createSubscribe:Tw,ErrorFactory:Xi,deepExtend:rl});function e(t){rl(n,t)}return n}const HN=Vw();const mv=new Vl("@firebase/app-compat"),jN="@firebase/app-compat",QN="0.2.25";function YN(n){qn(jN,QN,n)}if(Rx()&&self.firebase!==void 0){mv.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const n=self.firebase.SDK_VERSION;n&&n.indexOf("LITE")>=0&&mv.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Gr=HN;YN();var JN="firebase",XN="10.7.1";Gr.registerVersion(JN,XN,"app-compat");function Rp(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}const Xo={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},As={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function ZN(){return{["admin-restricted-operation"]:"This operation is restricted to administrators only.",["argument-error"]:"",["app-not-authorized"]:"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.",["app-not-installed"]:"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.",["captcha-check-failed"]:"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.",["code-expired"]:"The SMS code has expired. Please re-send the verification code to try again.",["cordova-not-ready"]:"Cordova framework is not ready.",["cors-unsupported"]:"This browser is not supported.",["credential-already-in-use"]:"This credential is already associated with a different user account.",["custom-token-mismatch"]:"The custom token corresponds to a different audience.",["requires-recent-login"]:"This operation is sensitive and requires recent authentication. Log in again before retrying this request.",["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.",["dynamic-link-not-activated"]:"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.",["email-change-needs-verification"]:"Multi-factor users must always have a verified email.",["email-already-in-use"]:"The email address is already in use by another account.",["emulator-config-failed"]:'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',["expired-action-code"]:"The action code has expired.",["cancelled-popup-request"]:"This operation has been cancelled due to another conflicting popup being opened.",["internal-error"]:"An internal AuthError has occurred.",["invalid-app-credential"]:"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.",["invalid-app-id"]:"The mobile app identifier is not registed for the current project.",["invalid-user-token"]:"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.",["invalid-auth-event"]:"An internal AuthError has occurred.",["invalid-verification-code"]:"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.",["invalid-continue-uri"]:"The continue URL provided in the request is invalid.",["invalid-cordova-configuration"]:"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.",["invalid-custom-token"]:"The custom token format is incorrect. Please check the documentation.",["invalid-dynamic-link-domain"]:"The provided dynamic link domain is not configured or authorized for the current project.",["invalid-email"]:"The email address is badly formatted.",["invalid-emulator-scheme"]:"Emulator URL must start with a valid scheme (http:// or https://).",["invalid-api-key"]:"Your API key is invalid, please check you have copied it correctly.",["invalid-cert-hash"]:"The SHA-1 certificate hash provided is invalid.",["invalid-credential"]:"The supplied auth credential is incorrect, malformed or has expired.",["invalid-message-payload"]:"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-multi-factor-session"]:"The request does not contain a valid proof of first factor successful sign-in.",["invalid-oauth-provider"]:"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.",["invalid-oauth-client-id"]:"The OAuth client ID provided is either invalid or does not match the specified API key.",["unauthorized-domain"]:"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.",["invalid-action-code"]:"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.",["wrong-password"]:"The password is invalid or the user does not have a password.",["invalid-persistence-type"]:"The specified persistence type is invalid. It can only be local, session or none.",["invalid-phone-number"]:"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].",["invalid-provider-id"]:"The specified provider ID is invalid.",["invalid-recipient-email"]:"The email corresponding to this action failed to send as the provided recipient email address is invalid.",["invalid-sender"]:"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-verification-id"]:"The verification ID used to create the phone auth credential is invalid.",["invalid-tenant-id"]:"The Auth instance's tenant ID is invalid.",["login-blocked"]:"Login blocked by user-provided method: {$originalMessage}",["missing-android-pkg-name"]:"An Android Package Name must be provided if the Android App is required to be installed.",["auth-domain-config-required"]:"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.",["missing-app-credential"]:"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.",["missing-verification-code"]:"The phone auth credential was created with an empty SMS verification code.",["missing-continue-uri"]:"A continue URL must be provided in the request.",["missing-iframe-start"]:"An internal AuthError has occurred.",["missing-ios-bundle-id"]:"An iOS Bundle ID must be provided if an App Store ID is provided.",["missing-or-invalid-nonce"]:"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.",["missing-password"]:"A non-empty password must be provided",["missing-multi-factor-info"]:"No second factor identifier is provided.",["missing-multi-factor-session"]:"The request is missing proof of first factor successful sign-in.",["missing-phone-number"]:"To send verification codes, provide a phone number for the recipient.",["missing-verification-id"]:"The phone auth credential was created with an empty verification ID.",["app-deleted"]:"This instance of FirebaseApp has been deleted.",["multi-factor-info-not-found"]:"The user does not have a second factor matching the identifier provided.",["multi-factor-auth-required"]:"Proof of ownership of a second factor is required to complete sign-in.",["account-exists-with-different-credential"]:"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.",["network-request-failed"]:"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.",["no-auth-event"]:"An internal AuthError has occurred.",["no-such-provider"]:"User was not linked to an account with the given provider.",["null-user"]:"A null user object was provided as the argument for an operation which requires a non-null user object.",["operation-not-allowed"]:"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.",["operation-not-supported-in-this-environment"]:'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',["popup-blocked"]:"Unable to establish a connection with the popup. It may have been blocked by the browser.",["popup-closed-by-user"]:"The popup has been closed by the user before finalizing the operation.",["provider-already-linked"]:"User can only be linked to one identity for the given provider.",["quota-exceeded"]:"The project's quota for this operation has been exceeded.",["redirect-cancelled-by-user"]:"The redirect operation has been cancelled by the user before finalizing.",["redirect-operation-pending"]:"A redirect sign-in operation is already pending.",["rejected-credential"]:"The request contains malformed or mismatching credentials.",["second-factor-already-in-use"]:"The second factor is already enrolled on this account.",["maximum-second-factor-count-exceeded"]:"The maximum allowed number of second factors on a user has been exceeded.",["tenant-id-mismatch"]:"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.",["user-token-expired"]:"The user's credential is no longer valid. The user must sign in again.",["too-many-requests"]:"We have blocked all requests from this device due to unusual activity. Try again later.",["unauthorized-continue-uri"]:"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.",["unsupported-first-factor"]:"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.",["unsupported-persistence-type"]:"The current environment does not support the specified persistence type.",["unsupported-tenant-operation"]:"This operation is not supported in a multi-tenant context.",["unverified-email"]:"The operation requires a verified email.",["user-cancelled"]:"The user did not grant your application the permissions it requested.",["user-not-found"]:"There is no user record corresponding to this identifier. The user may have been deleted.",["user-disabled"]:"The user account has been disabled by an administrator.",["user-mismatch"]:"The supplied credentials do not correspond to the previously signed in user.",["user-signed-out"]:"",["weak-password"]:"The password must be 6 characters long or more.",["web-storage-unsupported"]:"This browser is not supported or 3rd party cookies and data may be disabled.",["already-initialized"]:"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.",["missing-recaptcha-token"]:"The reCAPTCHA token is missing when sending request to the backend.",["invalid-recaptcha-token"]:"The reCAPTCHA token is invalid when sending request to the backend.",["invalid-recaptcha-action"]:"The reCAPTCHA action is invalid when sending request to the backend.",["recaptcha-not-enabled"]:"reCAPTCHA Enterprise integration is not enabled for this project.",["missing-client-type"]:"The reCAPTCHA client type is missing when sending request to the backend.",["missing-recaptcha-version"]:"The reCAPTCHA version is missing when sending request to the backend.",["invalid-req-type"]:"Invalid request parameters.",["invalid-recaptcha-version"]:"The reCAPTCHA version is invalid when sending request to the backend.",["unsupported-password-policy-schema-version"]:"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.",["password-does-not-meet-requirements"]:"The password does not meet the requirements."}}function Ow(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const eV=ZN,tV=Ow,Lw=new Xi("auth","Firebase",Ow());const sl=new Vl("@firebase/auth");function nV(n,...e){sl.logLevel<=ue.WARN&&sl.warn(`Auth (${ni}): ${n}`,...e)}function zu(n,...e){sl.logLevel<=ue.ERROR&&sl.error(`Auth (${ni}): ${n}`,...e)}function wt(n,...e){throw Sp(n,...e)}function vt(n,...e){return Sp(n,...e)}function Mw(n,e,t){const r=Object.assign(Object.assign({},tV()),{[e]:t});return new Xi("auth","Firebase",r).create(e,{appName:n.name})}function mo(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&wt(n,"argument-error"),Mw(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Sp(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Lw.create(n,...e)}function O(n,e,...t){if(!n)throw Sp(e,...t)}function Ln(n){const e="INTERNAL ASSERTION FAILED: "+n;throw zu(e),new Error(e)}function En(n,e){n||Ln(e)}function xa(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function bp(){return _v()==="http:"||_v()==="https:"}function _v(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function rV(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(bp()||ww()||"connection"in navigator)?navigator.onLine:!0}function iV(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class lc{constructor(e,t){this.shortDelay=e,this.longDelay=t,En(t>e,"Short delay should be less than long delay!"),this.isMobile=Ax()||wp()}get(){return rV()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Pp(n,e){En(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class Fw{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ln("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ln("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ln("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const sV={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const oV=new lc(3e4,6e4);function je(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Qe(n,e,t,r,i={}){return Uw(n,i,async()=>{let s={},a={};r&&(e==="GET"?a=r:s={body:JSON.stringify(r)});const l=go(Object.assign({key:n.config.apiKey},a)).slice(1),h=await n._getAdditionalHeaders();return h["Content-Type"]="application/json",n.languageCode&&(h["X-Firebase-Locale"]=n.languageCode),Fw.fetch()(Bw(n,n.config.apiHost,t,l),Object.assign({method:e,headers:h,referrerPolicy:"no-referrer"},s))})}async function Uw(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},sV),e);try{const i=new cV(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const a=await s.json();if("needConfirmation"in a)throw da(n,"account-exists-with-different-credential",a);if(s.ok&&!("errorMessage"in a))return a;{const l=s.ok?a.errorMessage:a.error.message,[h,f]=l.split(" : ");if(h==="FEDERATED_USER_ID_ALREADY_LINKED")throw da(n,"credential-already-in-use",a);if(h==="EMAIL_EXISTS")throw da(n,"email-already-in-use",a);if(h==="USER_DISABLED")throw da(n,"user-disabled",a);const p=r[h]||h.toLowerCase().replace(/[_\s]+/g,"-");if(f)throw Mw(n,p,f);wt(n,p)}}catch(i){if(i instanceof Vt)throw i;wt(n,"network-request-failed",{message:String(i)})}}async function mr(n,e,t,r,i={}){const s=await Qe(n,e,t,r,i);return"mfaPendingCredential"in s&&wt(n,"multi-factor-auth-required",{_serverResponse:s}),s}function Bw(n,e,t,r){const i=`${e}${t}?${r}`;return n.config.emulator?Pp(n.config,i):`${n.config.apiScheme}://${i}`}function aV(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class cV{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(vt(this.auth,"network-request-failed")),oV.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function da(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=vt(n,e,r);return i.customData._tokenResponse=t,i}function yv(n){return n!==void 0&&n.getResponse!==void 0}function vv(n){return n!==void 0&&n.enterprise!==void 0}class uV{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return aV(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function lV(n){return(await Qe(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function hV(n,e){return Qe(n,"GET","/v2/recaptchaConfig",je(n,e))}async function dV(n,e){return Qe(n,"POST","/v1/accounts:delete",e)}async function fV(n,e){return Qe(n,"POST","/v1/accounts:update",e)}async function pV(n,e){return Qe(n,"POST","/v1/accounts:lookup",e)}function va(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function gV(n,e=!1){const t=H(n),r=await t.getIdToken(e),i=Ol(r);O(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,a=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:va(nf(i.auth_time)),issuedAtTime:va(nf(i.iat)),expirationTime:va(nf(i.exp)),signInProvider:a||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function nf(n){return Number(n)*1e3}function Ol(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return zu("JWT malformed, contained fewer than 3 sections"),null;try{const i=vw(t);return i?JSON.parse(i):(zu("Failed to decode base64 JWT payload"),null)}catch(i){return zu("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function mV(n){const e=Ol(n);return O(e,"internal-error"),O(typeof e.exp<"u","internal-error"),O(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function fr(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Vt&&_V(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function _V({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class yV{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class qw{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=va(this.lastLoginAt),this.creationTime=va(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Na(n){var e;const t=n.auth,r=await n.getIdToken(),i=await fr(n,pV(t,{idToken:r}));O(i==null?void 0:i.users.length,t,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const a=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?wV(s.providerUserInfo):[],l=IV(n.providerData,a),h=n.isAnonymous,f=!(n.email&&s.passwordHash)&&!(l!=null&&l.length),p=h?f:!1,m={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:l,metadata:new qw(s.createdAt,s.lastLoginAt),isAnonymous:p};Object.assign(n,m)}async function vV(n){const e=H(n);await Na(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function IV(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function wV(n){return n.map(e=>{var{providerId:t}=e,r=Rp(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function EV(n,e){const t=await Uw(n,{},async()=>{const r=go({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,a=Bw(n,i,"/v1/token",`key=${s}`),l=await n._getAdditionalHeaders();return l["Content-Type"]="application/x-www-form-urlencoded",Fw.fetch()(a,{method:"POST",headers:l,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function TV(n,e){return Qe(n,"POST","/v2/accounts:revokeToken",je(n,e))}class Va{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){O(e.idToken,"internal-error"),O(typeof e.idToken<"u","internal-error"),O(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):mV(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return O(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:s}=await EV(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,a=new Va;return r&&(O(typeof r=="string","internal-error",{appName:e}),a.refreshToken=r),i&&(O(typeof i=="string","internal-error",{appName:e}),a.accessToken=i),s&&(O(typeof s=="number","internal-error",{appName:e}),a.expirationTime=s),a}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Va,this.toJSON())}_performRefresh(){return Ln("not implemented")}}function Dr(n,e){O(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Ni{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=Rp(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yV(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new qw(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await fr(this,this.stsTokenManager.getToken(this.auth,e));return O(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return gV(this,e)}reload(){return vV(this)}_assign(e){this!==e&&(O(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Ni(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){O(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Na(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await fr(this,dV(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,a,l,h,f,p;const m=(r=t.displayName)!==null&&r!==void 0?r:void 0,I=(i=t.email)!==null&&i!==void 0?i:void 0,A=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,L=(a=t.photoURL)!==null&&a!==void 0?a:void 0,M=(l=t.tenantId)!==null&&l!==void 0?l:void 0,V=(h=t._redirectEventId)!==null&&h!==void 0?h:void 0,Y=(f=t.createdAt)!==null&&f!==void 0?f:void 0,ae=(p=t.lastLoginAt)!==null&&p!==void 0?p:void 0,{uid:j,emailVerified:ye,isAnonymous:de,providerData:me,stsTokenManager:we}=t;O(j&&we,e,"internal-error");const Mt=Va.fromJSON(this.name,we);O(typeof j=="string",e,"internal-error"),Dr(m,e.name),Dr(I,e.name),O(typeof ye=="boolean",e,"internal-error"),O(typeof de=="boolean",e,"internal-error"),Dr(A,e.name),Dr(L,e.name),Dr(M,e.name),Dr(V,e.name),Dr(Y,e.name),Dr(ae,e.name);const Qn=new Ni({uid:j,auth:e,email:I,emailVerified:ye,displayName:m,isAnonymous:de,photoURL:L,phoneNumber:A,tenantId:M,stsTokenManager:Mt,createdAt:Y,lastLoginAt:ae});return me&&Array.isArray(me)&&(Qn.providerData=me.map(as=>Object.assign({},as))),V&&(Qn._redirectEventId=V),Qn}static async _fromIdTokenResponse(e,t,r=!1){const i=new Va;i.updateFromServerResponse(t);const s=new Ni({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Na(s),s}}const Iv=new Map;function en(n){En(n instanceof Function,"Expected a class definition");let e=Iv.get(n);return e?(En(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,Iv.set(n,e),e)}class $w{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}$w.type="NONE";const Zs=$w;function Vi(n,e,t){return`firebase:${n}:${e}:${t}`}class $s{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=Vi(this.userKey,i.apiKey,s),this.fullPersistenceKey=Vi("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Ni._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new $s(en(Zs),e,r);const i=(await Promise.all(t.map(async f=>{if(await f._isAvailable())return f}))).filter(f=>f);let s=i[0]||en(Zs);const a=Vi(r,e.config.apiKey,e.name);let l=null;for(const f of t)try{const p=await f._get(a);if(p){const m=Ni._fromJSON(e,p);f!==s&&(l=m),s=f;break}}catch{}const h=i.filter(f=>f._shouldAllowMigration);return!s._shouldAllowMigration||!h.length?new $s(s,e,r):(s=h[0],l&&await s._set(a,l.toJSON()),await Promise.all(t.map(async f=>{if(f!==s)try{await f._remove(a)}catch{}})),new $s(s,e,r))}}function wv(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(zw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Ww(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(Kw(e))return"Blackberry";if(Hw(e))return"Webos";if(Cp(e))return"Safari";if((e.includes("chrome/")||Gw(e))&&!e.includes("edge/"))return"Chrome";if(hc(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Ww(n=qe()){return/firefox\//i.test(n)}function Cp(n=qe()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Gw(n=qe()){return/crios\//i.test(n)}function zw(n=qe()){return/iemobile/i.test(n)}function hc(n=qe()){return/android/i.test(n)}function Kw(n=qe()){return/blackberry/i.test(n)}function Hw(n=qe()){return/webos/i.test(n)}function _o(n=qe()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function AV(n=qe()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function RV(n=qe()){var e;return _o(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function SV(){return Ew()&&document.documentMode===10}function jw(n=qe()){return _o(n)||hc(n)||Hw(n)||Kw(n)||/windows phone/i.test(n)||zw(n)}function bV(){try{return!!(window&&window!==window.top)}catch{return!1}}function Qw(n,e=[]){let t;switch(n){case"Browser":t=wv(qe());break;case"Worker":t=`${wv(qe())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${ni}/${r}`}class PV{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((a,l)=>{try{const h=e(s);a(h)}catch(h){l(h)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}async function CV(n,e={}){return Qe(n,"GET","/v2/passwordPolicy",je(n,e))}const kV=6;class DV{constructor(e){var t,r,i,s;const a=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=a.minPasswordLength)!==null&&t!==void 0?t:kV,a.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=a.maxPasswordLength),a.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=a.containsLowercaseCharacter),a.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=a.containsUppercaseCharacter),a.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=a.containsNumericCharacter),a.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=a.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,a,l;const h={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,h),this.validatePasswordCharacterOptions(e,h),h.isValid&&(h.isValid=(t=h.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),h.isValid&&(h.isValid=(r=h.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),h.isValid&&(h.isValid=(i=h.containsLowercaseLetter)!==null&&i!==void 0?i:!0),h.isValid&&(h.isValid=(s=h.containsUppercaseLetter)!==null&&s!==void 0?s:!0),h.isValid&&(h.isValid=(a=h.containsNumericCharacter)!==null&&a!==void 0?a:!0),h.isValid&&(h.isValid=(l=h.containsNonAlphanumericCharacter)!==null&&l!==void 0?l:!0),h}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class xV{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ev(this),this.idTokenSubscription=new Ev(this),this.beforeStateQueue=new PV(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Lw,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=en(t)),this._initializationPromise=this.queue(async()=>{var r,i;if(!this._deleted&&(this.persistenceManager=await $s.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;const r=await this.assertedPersistence.getCurrentUser();let i=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const a=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,l=i==null?void 0:i._redirectEventId,h=await this.tryRedirectSignIn(e);(!a||a===l)&&(h!=null&&h.user)&&(i=h.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(a){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(a))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return O(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Na(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=iV()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?H(e):null;return t&&O(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&O(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(en(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await CV(this),t=new DV(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Xi("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await TV(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&en(e)||this._popupRedirectResolver;O(t,this,"argument-error"),this.redirectPersistenceManager=await $s.create(this,[en(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let a=!1;const l=this._isInitialized?Promise.resolve():this._initializationPromise;if(O(l,this,"internal-error"),l.then(()=>{a||s(this.currentUser)}),typeof t=="function"){const h=e.addObserver(t,r,i);return()=>{a=!0,h()}}else{const h=e.addObserver(t);return()=>{a=!0,h()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return O(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Qw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&nV(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function ze(n){return H(n)}class Ev{constructor(e){this.auth=e,this.observer=null,this.addObserver=Tw(t=>this.observer=t)}get next(){return O(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function NV(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function kp(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=vt("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",NV().appendChild(r)})}function Yw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const VV="https://www.google.com/recaptcha/enterprise.js?render=",OV="recaptcha-enterprise",LV="NO_RECAPTCHA";class MV{constructor(e){this.type=OV,this.auth=ze(e)}async verify(e="verify",t=!1){async function r(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(a,l)=>{hV(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(h=>{if(h.recaptchaKey===void 0)l(new Error("recaptcha Enterprise site key undefined"));else{const f=new uV(h);return s.tenantId==null?s._agentRecaptchaConfig=f:s._tenantRecaptchaConfigs[s.tenantId]=f,a(f.siteKey)}}).catch(h=>{l(h)})})}function i(s,a,l){const h=window.grecaptcha;vv(h)?h.enterprise.ready(()=>{h.enterprise.execute(s,{action:e}).then(f=>{a(f)}).catch(()=>{a(LV)})}):l(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,a)=>{r(this.auth).then(l=>{if(!t&&vv(window.grecaptcha))i(l,s,a);else{if(typeof window>"u"){a(new Error("RecaptchaVerifier is only supported in browser"));return}kp(VV+l).then(()=>{i(l,s,a)}).catch(h=>{a(h)})}}).catch(l=>{a(l)})})}}async function Tv(n,e,t,r=!1){const i=new MV(n);let s;try{s=await i.verify(t)}catch{s=await i.verify(t,!0)}const a=Object.assign({},e);return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Oa(n,e,t,r){var i;if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Tv(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const a=await Tv(n,e,t,t==="getOobCode");return r(n,a)}else return Promise.reject(s)})}function FV(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(en);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function UV(n,e,t){const r=ze(n);O(r._canInitEmulator,r,"emulator-config-failed"),O(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!!(t!=null&&t.disableWarnings),s=Jw(e),{host:a,port:l}=BV(e),h=l===null?"":`:${l}`;r.config.emulator={url:`${s}//${a}${h}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:a,port:l,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||qV()}function Jw(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function BV(n){const e=Jw(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:Av(r.substr(s.length+1))}}else{const[s,a]=r.split(":");return{host:s,port:Av(a)}}}function Av(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function qV(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class yo{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Ln("not implemented")}_getIdTokenResponse(e){return Ln("not implemented")}_linkToIdToken(e,t){return Ln("not implemented")}_getReauthenticationResolver(e){return Ln("not implemented")}}async function Xw(n,e){return Qe(n,"POST","/v1/accounts:resetPassword",je(n,e))}async function $V(n,e){return Qe(n,"POST","/v1/accounts:update",e)}async function WV(n,e){return Qe(n,"POST","/v1/accounts:signUp",e)}async function GV(n,e){return Qe(n,"POST","/v1/accounts:update",je(n,e))}async function zV(n,e){return mr(n,"POST","/v1/accounts:signInWithPassword",je(n,e))}async function Ll(n,e){return Qe(n,"POST","/v1/accounts:sendOobCode",je(n,e))}async function KV(n,e){return Ll(n,e)}async function HV(n,e){return Ll(n,e)}async function jV(n,e){return Ll(n,e)}async function QV(n,e){return Ll(n,e)}async function YV(n,e){return mr(n,"POST","/v1/accounts:signInWithEmailLink",je(n,e))}async function JV(n,e){return mr(n,"POST","/v1/accounts:signInWithEmailLink",je(n,e))}class La extends yo{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new La(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new La(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Oa(e,t,"signInWithPassword",zV);case"emailLink":return YV(e,{email:this._email,oobCode:this._password});default:wt(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Oa(e,r,"signUpPassword",WV);case"emailLink":return JV(e,{idToken:t,email:this._email,oobCode:this._password});default:wt(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function hr(n,e){return mr(n,"POST","/v1/accounts:signInWithIdp",je(n,e))}const XV="http://localhost";class Kn extends yo{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Kn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):wt("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=Rp(t,["providerId","signInMethod"]);if(!r||!i)return null;const a=new Kn(r,i);return a.idToken=s.idToken||void 0,a.accessToken=s.accessToken||void 0,a.secret=s.secret,a.nonce=s.nonce,a.pendingToken=s.pendingToken||null,a}_getIdTokenResponse(e){const t=this.buildRequest();return hr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,hr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,hr(e,t)}buildRequest(){const e={requestUri:XV,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=go(t)}return e}}async function ZV(n,e){return Qe(n,"POST","/v1/accounts:sendVerificationCode",je(n,e))}async function eO(n,e){return mr(n,"POST","/v1/accounts:signInWithPhoneNumber",je(n,e))}async function tO(n,e){const t=await mr(n,"POST","/v1/accounts:signInWithPhoneNumber",je(n,e));if(t.temporaryProof)throw da(n,"account-exists-with-different-credential",t);return t}const nO={USER_NOT_FOUND:"user-not-found"};async function rO(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return mr(n,"POST","/v1/accounts:signInWithPhoneNumber",je(n,t),nO)}class Oi extends yo{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Oi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Oi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return eO(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return tO(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return rO(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s}=e;return!r&&!t&&!i&&!s?null:new Oi({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s})}}function iO(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function sO(n){const e=Us(ha(n)).link,t=e?Us(ha(e)).deep_link_id:null,r=Us(ha(n)).deep_link_id;return(r?Us(ha(r)).link:null)||r||t||e||n}class Ml{constructor(e){var t,r,i,s,a,l;const h=Us(ha(e)),f=(t=h.apiKey)!==null&&t!==void 0?t:null,p=(r=h.oobCode)!==null&&r!==void 0?r:null,m=iO((i=h.mode)!==null&&i!==void 0?i:null);O(f&&p&&m,"argument-error"),this.apiKey=f,this.operation=m,this.code=p,this.continueUrl=(s=h.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(a=h.languageCode)!==null&&a!==void 0?a:null,this.tenantId=(l=h.tenantId)!==null&&l!==void 0?l:null}static parseLink(e){const t=sO(e);try{return new Ml(t)}catch{return null}}}class ri{constructor(){this.providerId=ri.PROVIDER_ID}static credential(e,t){return La._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Ml.parseLink(t);return O(r,"argument-error"),La._fromEmailAndCode(e,r.code,r.tenantId)}}ri.PROVIDER_ID="password";ri.EMAIL_PASSWORD_SIGN_IN_METHOD="password";ri.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class _r{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class vo extends _r{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Ws extends vo{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return O("providerId"in t&&"signInMethod"in t,"argument-error"),Kn._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return O(e.idToken||e.accessToken,"argument-error"),Kn._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Ws.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Ws.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:i,pendingToken:s,nonce:a,providerId:l}=e;if(!r&&!i&&!t&&!s||!l)return null;try{return new Ws(l)._credential({idToken:t,accessToken:r,nonce:a,pendingToken:s})}catch{return null}}}class Dn extends vo{constructor(){super("facebook.com")}static credential(e){return Kn._fromParams({providerId:Dn.PROVIDER_ID,signInMethod:Dn.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Dn.credentialFromTaggedObject(e)}static credentialFromError(e){return Dn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Dn.credential(e.oauthAccessToken)}catch{return null}}}Dn.FACEBOOK_SIGN_IN_METHOD="facebook.com";Dn.PROVIDER_ID="facebook.com";class xn extends vo{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Kn._fromParams({providerId:xn.PROVIDER_ID,signInMethod:xn.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return xn.credentialFromTaggedObject(e)}static credentialFromError(e){return xn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return xn.credential(t,r)}catch{return null}}}xn.GOOGLE_SIGN_IN_METHOD="google.com";xn.PROVIDER_ID="google.com";class Nn extends vo{constructor(){super("github.com")}static credential(e){return Kn._fromParams({providerId:Nn.PROVIDER_ID,signInMethod:Nn.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Nn.credentialFromTaggedObject(e)}static credentialFromError(e){return Nn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Nn.credential(e.oauthAccessToken)}catch{return null}}}Nn.GITHUB_SIGN_IN_METHOD="github.com";Nn.PROVIDER_ID="github.com";const oO="http://localhost";class eo extends yo{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return hr(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,hr(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,hr(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,pendingToken:s}=t;return!r||!i||!s||r!==i?null:new eo(r,s)}static _create(e,t){return new eo(e,t)}buildRequest(){return{requestUri:oO,returnSecureToken:!0,pendingToken:this.pendingToken}}}const aO="saml.";class ol extends _r{constructor(e){O(e.startsWith(aO),"argument-error"),super(e)}static credentialFromResult(e){return ol.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return ol.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=eo.fromJSON(e);return O(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return eo._create(r,t)}catch{return null}}}class Vn extends vo{constructor(){super("twitter.com")}static credential(e,t){return Kn._fromParams({providerId:Vn.PROVIDER_ID,signInMethod:Vn.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Vn.credentialFromTaggedObject(e)}static credentialFromError(e){return Vn.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Vn.credential(t,r)}catch{return null}}}Vn.TWITTER_SIGN_IN_METHOD="twitter.com";Vn.PROVIDER_ID="twitter.com";async function Zw(n,e){return mr(n,"POST","/v1/accounts:signUp",je(n,e))}class pn{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const s=await Ni._fromIdTokenResponse(e,r,i),a=Rv(r);return new pn({user:s,providerId:a,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=Rv(r);return new pn({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function Rv(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}async function cO(n){var e;const t=ze(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new pn({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await Zw(t,{returnSecureToken:!0}),i=await pn._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(i.user),i}class al extends Vt{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,al.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new al(e,t,r,i)}}function eE(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?al._fromErrorAndOperation(n,s,e,r):s})}function tE(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}async function uO(n,e){const t=H(n);await Fl(!0,t,e);const{providerUserInfo:r}=await fV(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),i=tE(r||[]);return t.providerData=t.providerData.filter(s=>i.has(s.providerId)),i.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function Dp(n,e,t=!1){const r=await fr(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return pn._forOperation(n,"link",r)}async function Fl(n,e,t){await Na(e);const r=tE(e.providerData),i=n===!1?"provider-already-linked":"no-such-provider";O(r.has(t)===n,e.auth,i)}async function nE(n,e,t=!1){const{auth:r}=n,i="reauthenticate";try{const s=await fr(n,eE(r,i,e,n),t);O(s.idToken,r,"internal-error");const a=Ol(s.idToken);O(a,r,"internal-error");const{sub:l}=a;return O(n.uid===l,r,"user-mismatch"),pn._forOperation(n,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&wt(r,"user-mismatch"),s}}async function rE(n,e,t=!1){const r="signIn",i=await eE(n,r,e),s=await pn._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}async function Ul(n,e){return rE(ze(n),e)}async function iE(n,e){const t=H(n);return await Fl(!1,t,e.providerId),Dp(t,e)}async function sE(n,e){return nE(H(n),e)}async function lO(n,e){return mr(n,"POST","/v1/accounts:signInWithCustomToken",je(n,e))}async function hO(n,e){const t=ze(n),r=await lO(t,{token:e,returnSecureToken:!0}),i=await pn._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(i.user),i}class dc{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?xp._fromServerResponse(e,t):"totpInfo"in t?Np._fromServerResponse(e,t):wt(e,"internal-error")}}class xp extends dc{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new xp(t)}}class Np extends dc{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new Np(t)}}function Bl(n,e,t){var r;O(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),O(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(O(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(O(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}async function Vp(n){const e=ze(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function dO(n,e,t){const r=ze(n),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Bl(r,i,t),await Oa(r,i,"getOobCode",HV)}async function fO(n,e,t){await Xw(H(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Vp(n),r})}async function pO(n,e){await GV(H(n),{oobCode:e})}async function oE(n,e){const t=H(n),r=await Xw(t,{oobCode:e}),i=r.requestType;switch(O(i,t,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":O(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":O(r.mfaInfo,t,"internal-error");default:O(r.email,t,"internal-error")}let s=null;return r.mfaInfo&&(s=dc._fromServerResponse(ze(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function gO(n,e){const{data:t}=await oE(H(n),e);return t.email}async function mO(n,e,t){const r=ze(n),a=await Oa(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Zw).catch(h=>{throw h.code==="auth/password-does-not-meet-requirements"&&Vp(n),h}),l=await pn._fromIdTokenResponse(r,"signIn",a);return await r._updateCurrentUser(l.user),l}function _O(n,e,t){return Ul(H(n),ri.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&Vp(n),r})}async function yO(n,e,t){const r=ze(n),i={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function s(a,l){O(l.handleCodeInApp,r,"argument-error"),l&&Bl(r,a,l)}s(i,t),await Oa(r,i,"getOobCode",jV)}function vO(n,e){const t=Ml.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function IO(n,e,t){const r=H(n),i=ri.credentialWithLink(e,t||xa());return O(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Ul(r,i)}async function wO(n,e){return Qe(n,"POST","/v1/accounts:createAuthUri",je(n,e))}async function EO(n,e){const t=bp()?xa():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:i}=await wO(H(n),r);return i||[]}async function TO(n,e){const t=H(n),i={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Bl(t.auth,i,e);const{email:s}=await KV(t.auth,i);s!==n.email&&await n.reload()}async function AO(n,e,t){const r=H(n),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Bl(r.auth,s,t);const{email:a}=await QV(r.auth,s);a!==n.email&&await n.reload()}async function RO(n,e){return Qe(n,"POST","/v1/accounts:update",e)}async function SO(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=H(n),s={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},a=await fr(r,RO(r.auth,s));r.displayName=a.displayName||null,r.photoURL=a.photoUrl||null;const l=r.providerData.find(({providerId:h})=>h==="password");l&&(l.displayName=r.displayName,l.photoURL=r.photoURL),await r._updateTokensIfNecessary(a)}function bO(n,e){return aE(H(n),e,null)}function PO(n,e){return aE(H(n),null,e)}async function aE(n,e,t){const{auth:r}=n,s={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);const a=await fr(n,$V(r,s));await n._updateTokensIfNecessary(a,!0)}function CO(n){var e,t;if(!n)return null;const{providerId:r}=n,i=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},s=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const a=(t=(e=Ol(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(a){const l=a!=="anonymous"&&a!=="custom"?a:null;return new Gs(s,l)}}if(!r)return null;switch(r){case"facebook.com":return new kO(s,i);case"github.com":return new DO(s,i);case"google.com":return new xO(s,i);case"twitter.com":return new NO(s,i,n.screenName||null);case"custom":case"anonymous":return new Gs(s,null);default:return new Gs(s,r,i)}}class Gs{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class cE extends Gs{constructor(e,t,r,i){super(e,t,r),this.username=i}}class kO extends Gs{constructor(e,t){super(e,"facebook.com",t)}}class DO extends cE{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class xO extends Gs{constructor(e,t){super(e,"google.com",t)}}class NO extends cE{constructor(e,t,r){super(e,"twitter.com",t,r)}}function VO(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:CO(t)}class Pi{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Pi("enroll",e,t)}static _fromMfaPendingCredential(e){return new Pi("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Pi._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Pi._fromIdtoken(e.multiFactorSession.idToken)}return null}}class Op{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=ze(e),i=t.customData._serverResponse,s=(i.mfaInfo||[]).map(l=>dc._fromServerResponse(r,l));O(i.mfaPendingCredential,r,"internal-error");const a=Pi._fromMfaPendingCredential(i.mfaPendingCredential);return new Op(a,s,async l=>{const h=await l._process(r,a);delete i.mfaInfo,delete i.mfaPendingCredential;const f=Object.assign(Object.assign({},i),{idToken:h.idToken,refreshToken:h.refreshToken});switch(t.operationType){case"signIn":const p=await pn._fromIdTokenResponse(r,t.operationType,f);return await r._updateCurrentUser(p.user),p;case"reauthenticate":return O(t.user,r,"internal-error"),pn._forOperation(t.user,t.operationType,f);default:wt(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function OO(n,e){var t;const r=H(n),i=e;return O(e.customData.operationType,r,"argument-error"),O((t=i.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),Op._fromError(r,i)}function LO(n,e){return Qe(n,"POST","/v2/accounts/mfaEnrollment:start",je(n,e))}function MO(n,e){return Qe(n,"POST","/v2/accounts/mfaEnrollment:finalize",je(n,e))}function FO(n,e){return Qe(n,"POST","/v2/accounts/mfaEnrollment:withdraw",je(n,e))}class Lp{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>dc._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new Lp(e)}async getSession(){return Pi._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,i=await this.getSession(),s=await fr(this.user,r._process(this.user.auth,i,t));return await this.user._updateTokensIfNecessary(s),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const i=await fr(this.user,FO(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:s})=>s!==t),await this.user._updateTokensIfNecessary(i),await this.user.reload()}catch(i){throw i}}}const rf=new WeakMap;function UO(n){const e=H(n);return rf.has(e)||rf.set(e,Lp._fromUser(e)),rf.get(e)}const cl="__sak";class uE{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(cl,"1"),this.storage.removeItem(cl),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}function BO(){const n=qe();return Cp(n)||_o(n)}const qO=1e3,$O=10;class lE extends uE{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=BO()&&bV(),this.fallbackToPolling=jw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((a,l,h)=>{this.notifyListeners(a,h)});return}const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const a=this.storage.getItem(r);if(e.newValue!==a)e.newValue!==null?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}const i=()=>{const a=this.storage.getItem(r);!t&&this.localCache[r]===a||this.notifyListeners(r,a)},s=this.storage.getItem(r);SV()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,$O):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},qO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}lE.type="LOCAL";const Mp=lE;class hE extends uE{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}hE.type="SESSION";const Bi=hE;function WO(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class ql{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new ql(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:s}=t.data,a=this.handlersMap[i];if(!(a!=null&&a.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const l=Array.from(a).map(async f=>f(t.origin,s)),h=await WO(l);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:h})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}ql.receivers=[];function fc(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class GO{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,a;return new Promise((l,h)=>{const f=fc("",20);i.port1.start();const p=setTimeout(()=>{h(new Error("unsupported_event"))},r);a={messageChannel:i,onMessage(m){const I=m;if(I.data.eventId===f)switch(I.data.status){case"ack":clearTimeout(p),s=setTimeout(()=>{h(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),l(I.data.response);break;default:clearTimeout(p),clearTimeout(s),h(new Error("invalid_response"));break}}},this.handlers.add(a),i.port1.addEventListener("message",a.onMessage),this.target.postMessage({eventType:e,eventId:f,data:t},[i.port2])}).finally(()=>{a&&this.removeMessageHandler(a)})}}function tt(){return window}function zO(n){tt().location.href=n}function Fp(){return typeof tt().WorkerGlobalScope<"u"&&typeof tt().importScripts=="function"}async function KO(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function HO(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function jO(){return Fp()?self:null}const dE="firebaseLocalStorageDb",QO=1,ul="firebaseLocalStorage",fE="fbase_key";class pc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function $l(n,e){return n.transaction([ul],e?"readwrite":"readonly").objectStore(ul)}function YO(){const n=indexedDB.deleteDatabase(dE);return new pc(n).toPromise()}function bf(){const n=indexedDB.open(dE,QO);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(ul,{keyPath:fE})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(ul)?e(r):(r.close(),await YO(),e(await bf()))})})}async function Sv(n,e,t){const r=$l(n,!0).put({[fE]:e,value:t});return new pc(r).toPromise()}async function JO(n,e){const t=$l(n,!1).get(e),r=await new pc(t).toPromise();return r===void 0?null:r.value}function bv(n,e){const t=$l(n,!0).delete(e);return new pc(t).toPromise()}const XO=800,ZO=3;class pE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await bf(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>ZO)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Fp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ql._getInstance(jO()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await KO(),!this.activeServiceWorker)return;this.sender=new GO(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||HO()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await bf();return await Sv(e,cl,"1"),await bv(e,cl),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>Sv(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>JO(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>bv(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=$l(i,!1).getAll();return new pc(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),XO)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}pE.type="LOCAL";const Ma=pE;function eL(n,e){return Qe(n,"POST","/v2/accounts/mfaSignIn:start",je(n,e))}function tL(n,e){return Qe(n,"POST","/v2/accounts/mfaSignIn:finalize",je(n,e))}const nL=500,rL=6e4,Du=1e12;class iL{constructor(e){this.auth=e,this.counter=Du,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new sL(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Du;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Du;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Du;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class sL{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const i=typeof e=="string"?document.getElementById(e):e;O(i,"argument-error",{appName:t}),this.container=i,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=oL(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},rL)},nL))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function oL(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const sf=Yw("rcb"),aL=new lc(3e4,6e4),cL="https://www.google.com/recaptcha/api.js?";class uL{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=tt().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return O(lL(t),e,"argument-error"),this.shouldResolveImmediately(t)&&yv(tt().grecaptcha)?Promise.resolve(tt().grecaptcha):new Promise((r,i)=>{const s=tt().setTimeout(()=>{i(vt(e,"network-request-failed"))},aL.get());tt()[sf]=()=>{tt().clearTimeout(s),delete tt()[sf];const l=tt().grecaptcha;if(!l||!yv(l)){i(vt(e,"internal-error"));return}const h=l.render;l.render=(f,p)=>{const m=h(f,p);return this.counter++,m},this.hostLanguage=t,r(l)};const a=`${cL}?${go({onload:sf,render:"explicit",hl:t})}`;kp(a).catch(()=>{clearTimeout(s),i(vt(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=tt().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function lL(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class hL{async load(e){return new iL(e)}clearedOneInstance(){}}const gE="recaptcha",dL={theme:"light",type:"image"};let fL=class{constructor(e,t,r=Object.assign({},dL)){this.parameters=r,this.type=gE,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=ze(e),this.isInvisible=this.parameters.size==="invisible",O(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const i=typeof t=="string"?document.getElementById(t):t;O(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new hL:new uL,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(i=>{const s=a=>{a&&(this.tokenChangeListeners.delete(s),i(a))};this.tokenChangeListeners.add(s),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){O(!this.parameters.sitekey,this.auth,"argument-error"),O(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),O(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=tt()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){O(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){O(bp()&&!Fp(),this.auth,"internal-error"),await pL(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await lV(this.auth);O(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return O(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function pL(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}class Up{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Oi._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function gL(n,e,t){const r=ze(n),i=await Wl(r,e,H(t));return new Up(i,s=>Ul(r,s))}async function mL(n,e,t){const r=H(n);await Fl(!1,r,"phone");const i=await Wl(r.auth,e,H(t));return new Up(i,s=>iE(r,s))}async function _L(n,e,t){const r=H(n),i=await Wl(r.auth,e,H(t));return new Up(i,s=>sE(r,s))}async function Wl(n,e,t){var r;const i=await t.verify();try{O(typeof i=="string",n,"argument-error"),O(t.type===gE,n,"argument-error");let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const a=s.session;if("phoneNumber"in s)return O(a.type==="enroll",n,"internal-error"),(await LO(n,{idToken:a.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}})).phoneSessionInfo.sessionInfo;{O(a.type==="signin",n,"internal-error");const l=((r=s.multiFactorHint)===null||r===void 0?void 0:r.uid)||s.multiFactorUid;return O(l,n,"missing-multi-factor-info"),(await eL(n,{mfaPendingCredential:a.credential,mfaEnrollmentId:l,phoneSignInInfo:{recaptchaToken:i}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:a}=await ZV(n,{phoneNumber:s.phoneNumber,recaptchaToken:i});return a}}finally{t._reset()}}async function yL(n,e){await Dp(H(n),e)}let $n=class{constructor(e){this.providerId=$n.PROVIDER_ID,this.auth=ze(e)}verifyPhoneNumber(e,t){return Wl(this.auth,e,H(t))}static credential(e,t){return Oi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return $n.credentialFromTaggedObject(t)}static credentialFromError(e){return $n.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Oi._fromTokenResponse(t,r):null}};$n.PROVIDER_ID="phone";$n.PHONE_SIGN_IN_METHOD="phone";function Zi(n,e){return e?en(e):(O(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Bp extends yo{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return hr(e,this._buildIdpRequest())}_linkToIdToken(e,t){return hr(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return hr(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function vL(n){return rE(n.auth,new Bp(n),n.bypassAuthState)}function IL(n){const{auth:e,user:t}=n;return O(t,e,"internal-error"),nE(t,new Bp(n),n.bypassAuthState)}async function wL(n){const{auth:e,user:t}=n;return O(t,e,"internal-error"),Dp(t,new Bp(n),n.bypassAuthState)}class mE{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:a,type:l}=e;if(a){this.reject(a);return}const h={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(l)(h))}catch(f){this.reject(f)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return vL;case"linkViaPopup":case"linkViaRedirect":return wL;case"reauthViaPopup":case"reauthViaRedirect":return IL;default:wt(this.auth,"internal-error")}}resolve(e){En(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){En(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const EL=new lc(2e3,1e4);async function TL(n,e,t){const r=ze(n);mo(n,e,_r);const i=Zi(r,t);return new or(r,"signInViaPopup",e,i).executeNotNull()}async function AL(n,e,t){const r=H(n);mo(r.auth,e,_r);const i=Zi(r.auth,t);return new or(r.auth,"reauthViaPopup",e,i,r).executeNotNull()}async function RL(n,e,t){const r=H(n);mo(r.auth,e,_r);const i=Zi(r.auth,t);return new or(r.auth,"linkViaPopup",e,i,r).executeNotNull()}class or extends mE{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,or.currentPopupAction&&or.currentPopupAction.cancel(),or.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return O(e,this.auth,"internal-error"),e}async onExecution(){En(this.filter.length===1,"Popup operations only handle one event");const e=fc();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(vt(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(vt(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,or.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(vt(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,EL.get())};e()}}or.currentPopupAction=null;const SL="pendingRedirect",Ia=new Map;class bL extends mE{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Ia.get(this.auth._key());if(!e){try{const r=await PL(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Ia.set(this.auth._key(),e)}return this.bypassAuthState||Ia.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function PL(n,e){const t=yE(e),r=_E(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}async function qp(n,e){return _E(n)._set(yE(e),"true")}function CL(){Ia.clear()}function $p(n,e){Ia.set(n._key(),e)}function _E(n){return en(n._redirectPersistence)}function yE(n){return Vi(SL,n.config.apiKey,n.name)}function kL(n,e,t){return DL(n,e,t)}async function DL(n,e,t){const r=ze(n);mo(n,e,_r),await r._initializationPromise;const i=Zi(r,t);return await qp(i,r),i._openRedirect(r,e,"signInViaRedirect")}function xL(n,e,t){return NL(n,e,t)}async function NL(n,e,t){const r=H(n);mo(r.auth,e,_r),await r.auth._initializationPromise;const i=Zi(r.auth,t);await qp(i,r.auth);const s=await vE(r);return i._openRedirect(r.auth,e,"reauthViaRedirect",s)}function VL(n,e,t){return OL(n,e,t)}async function OL(n,e,t){const r=H(n);mo(r.auth,e,_r),await r.auth._initializationPromise;const i=Zi(r.auth,t);await Fl(!1,r,e.providerId),await qp(i,r.auth);const s=await vE(r);return i._openRedirect(r.auth,e,"linkViaRedirect",s)}async function LL(n,e){return await ze(n)._initializationPromise,Gl(n,e,!1)}async function Gl(n,e,t=!1){const r=ze(n),i=Zi(r,e),a=await new bL(r,i,t).execute();return a&&!t&&(delete a.user._redirectEventId,await r._persistUserIfCurrent(a.user),await r._setRedirectUser(null,e)),a}async function vE(n){const e=fc(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}const ML=10*60*1e3;class IE{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!FL(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!wE(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(vt(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=ML&&this.cachedEventUids.clear(),this.cachedEventUids.has(Pv(e))}saveEventToCache(e){this.cachedEventUids.add(Pv(e)),this.lastProcessedEventTime=Date.now()}}function Pv(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function wE({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function FL(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return wE(n);default:return!1}}async function EE(n,e={}){return Qe(n,"GET","/v1/projects",e)}const UL=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,BL=/^https?/;async function qL(n){if(n.config.emulator)return;const{authorizedDomains:e}=await EE(n);for(const t of e)try{if($L(t))return}catch{}wt(n,"unauthorized-domain")}function $L(n){const e=xa(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const a=new URL(n);return a.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&a.hostname===r}if(!BL.test(t))return!1;if(UL.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const WL=new lc(3e4,6e4);function Cv(){const n=tt().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function GL(n){return new Promise((e,t)=>{var r,i,s;function a(){Cv(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{Cv(),t(vt(n,"network-request-failed"))},timeout:WL.get()})}if(!((i=(r=tt().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=tt().gapi)===null||s===void 0)&&s.load)a();else{const l=Yw("iframefcb");return tt()[l]=()=>{gapi.load?a():t(vt(n,"network-request-failed"))},kp(`https://apis.google.com/js/api.js?onload=${l}`).catch(h=>t(h))}}).catch(e=>{throw Ku=null,e})}let Ku=null;function zL(n){return Ku=Ku||GL(n),Ku}const KL=new lc(5e3,15e3),HL="__/auth/iframe",jL="emulator/auth/iframe",QL={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},YL=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function JL(n){const e=n.config;O(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?Pp(e,jL):`https://${n.config.authDomain}/${HL}`,r={apiKey:e.apiKey,appName:n.name,v:ni},i=YL.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${go(r).slice(1)}`}async function XL(n){const e=await zL(n),t=tt().gapi;return O(t,n,"internal-error"),e.open({where:document.body,url:JL(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:QL,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const a=vt(n,"network-request-failed"),l=tt().setTimeout(()=>{s(a)},KL.get());function h(){tt().clearTimeout(l),i(r)}r.ping(h).then(h,()=>{s(a)})}))}const ZL={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},eM=500,tM=600,nM="_blank",rM="http://localhost";class kv{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function iM(n,e,t,r=eM,i=tM){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),a=Math.max((window.screen.availWidth-r)/2,0).toString();let l="";const h=Object.assign(Object.assign({},ZL),{width:r.toString(),height:i.toString(),top:s,left:a}),f=qe().toLowerCase();t&&(l=Gw(f)?nM:t),Ww(f)&&(e=e||rM,h.scrollbars="yes");const p=Object.entries(h).reduce((I,[A,L])=>`${I}${A}=${L},`,"");if(RV(f)&&l!=="_self")return sM(e||"",l),new kv(null);const m=window.open(e||"",l,p);O(m,n,"popup-blocked");try{m.focus()}catch{}return new kv(m)}function sM(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const oM="__/auth/handler",aM="emulator/auth/handler",cM=encodeURIComponent("fac");async function Pf(n,e,t,r,i,s){O(n.config.authDomain,n,"auth-domain-config-required"),O(n.config.apiKey,n,"invalid-api-key");const a={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:ni,eventId:i};if(e instanceof _r){e.setDefaultLanguage(n.languageCode),a.providerId=e.providerId||"",Dx(e.getCustomParameters())||(a.customParameters=JSON.stringify(e.getCustomParameters()));for(const[p,m]of Object.entries(s||{}))a[p]=m}if(e instanceof vo){const p=e.getScopes().filter(m=>m!=="");p.length>0&&(a.scopes=p.join(","))}n.tenantId&&(a.tid=n.tenantId);const l=a;for(const p of Object.keys(l))l[p]===void 0&&delete l[p];const h=await n._getAppCheckToken(),f=h?`#${cM}=${encodeURIComponent(h)}`:"";return`${uM(n)}?${go(l).slice(1)}${f}`}function uM({config:n}){return n.emulator?Pp(n,aM):`https://${n.authDomain}/${oM}`}const of="webStorageSupport";class lM{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Bi,this._completeRedirectFn=Gl,this._overrideRedirectResult=$p}async _openPopup(e,t,r,i){var s;En((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const a=await Pf(e,t,r,xa(),i);return iM(e,a,fc())}async _openRedirect(e,t,r,i){await this._originValidation(e);const s=await Pf(e,t,r,xa(),i);return zO(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(En(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await XL(e),r=new IE(e);return t.register("authEvent",i=>(O(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(of,{type:of},i=>{var s;const a=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[of];a!==void 0&&t(!!a),wt(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=qL(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return jw()||Cp()||_o()}}const hM=lM;class dM{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Ln("unexpected MultiFactorSessionType")}}}class Wp extends dM{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Wp(e)}_finalizeEnroll(e,t,r){return MO(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return tL(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class TE{constructor(){}static assertion(e){return Wp._fromCredential(e)}}TE.FACTOR_ID="phone";var Dv="@firebase/auth",xv="1.5.1";class fM{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){O(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function pM(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function gM(n){Wr(new zn("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;O(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});const h={apiKey:a,authDomain:l,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Qw(n)},f=new xV(r,i,s,h);return FV(f,t),f},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Wr(new zn("auth-internal",e=>{const t=ze(e.getProvider("auth").getImmediate());return(r=>new fM(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),qn(Dv,xv,pM(n)),qn(Dv,xv,"esm2017")}const mM=5*60;wx("authIdTokenMaxAge");gM("Browser");function qi(){return window}const _M=2e3;async function yM(n,e,t){var r;const{BuildInfo:i}=qi();En(e.sessionId,"AuthEvent did not contain a session ID");const s=await TM(e.sessionId),a={};return _o()?a.ibi=i.packageName:hc()?a.apn=i.packageName:wt(n,"operation-not-supported-in-this-environment"),i.displayName&&(a.appDisplayName=i.displayName),a.sessionId=s,Pf(n,t,e.type,void 0,(r=e.eventId)!==null&&r!==void 0?r:void 0,a)}async function vM(n){const{BuildInfo:e}=qi(),t={};_o()?t.iosBundleId=e.packageName:hc()?t.androidPackageName=e.packageName:wt(n,"operation-not-supported-in-this-environment"),await EE(n,t)}function IM(n){const{cordova:e}=qi();return new Promise(t=>{e.plugins.browsertab.isAvailable(r=>{let i=null;r?e.plugins.browsertab.openUrl(n):i=e.InAppBrowser.open(n,AV()?"_blank":"_system","location=yes"),t(i)})})}async function wM(n,e,t){const{cordova:r}=qi();let i=()=>{};try{await new Promise((s,a)=>{let l=null;function h(){var m;s();const I=(m=r.plugins.browsertab)===null||m===void 0?void 0:m.close;typeof I=="function"&&I(),typeof(t==null?void 0:t.close)=="function"&&t.close()}function f(){l||(l=window.setTimeout(()=>{a(vt(n,"redirect-cancelled-by-user"))},_M))}function p(){(document==null?void 0:document.visibilityState)==="visible"&&f()}e.addPassiveListener(h),document.addEventListener("resume",f,!1),hc()&&document.addEventListener("visibilitychange",p,!1),i=()=>{e.removePassiveListener(h),document.removeEventListener("resume",f,!1),document.removeEventListener("visibilitychange",p,!1),l&&window.clearTimeout(l)}})}finally{i()}}function EM(n){var e,t,r,i,s,a,l,h,f,p;const m=qi();O(typeof((e=m==null?void 0:m.universalLinks)===null||e===void 0?void 0:e.subscribe)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),O(typeof((t=m==null?void 0:m.BuildInfo)===null||t===void 0?void 0:t.packageName)<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),O(typeof((s=(i=(r=m==null?void 0:m.cordova)===null||r===void 0?void 0:r.plugins)===null||i===void 0?void 0:i.browsertab)===null||s===void 0?void 0:s.openUrl)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O(typeof((h=(l=(a=m==null?void 0:m.cordova)===null||a===void 0?void 0:a.plugins)===null||l===void 0?void 0:l.browsertab)===null||h===void 0?void 0:h.isAvailable)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),O(typeof((p=(f=m==null?void 0:m.cordova)===null||f===void 0?void 0:f.InAppBrowser)===null||p===void 0?void 0:p.open)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function TM(n){const e=AM(n),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")}function AM(n){if(En(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return new TextEncoder().encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}const RM=20;class SM extends IE{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function bM(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:kM(),postBody:null,tenantId:n.tenantId,error:vt(n,"no-auth-event")}}function PM(n,e){return Cf()._set(kf(n),e)}async function Nv(n){const e=await Cf()._get(kf(n));return e&&await Cf()._remove(kf(n)),e}function CM(n,e){var t,r;const i=xM(e);if(i.includes("/__/auth/callback")){const s=Hu(i),a=s.firebaseError?DM(decodeURIComponent(s.firebaseError)):null,l=(r=(t=a==null?void 0:a.code)===null||t===void 0?void 0:t.split("auth/"))===null||r===void 0?void 0:r[1],h=l?vt(l):null;return h?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:h,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:i,postBody:null}}return null}function kM(){const n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<RM;t++){const r=Math.floor(Math.random()*e.length);n.push(e.charAt(r))}return n.join("")}function Cf(){return en(Mp)}function kf(n){return Vi("authEvent",n.config.apiKey,n.name)}function DM(n){try{return JSON.parse(n)}catch{return null}}function xM(n){const e=Hu(n),t=e.link?decodeURIComponent(e.link):void 0,r=Hu(t).link,i=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return Hu(i).link||i||r||t||n}function Hu(n){if(!(n!=null&&n.includes("?")))return{};const[e,...t]=n.split("?");return Us(t.join("?"))}const NM=500;class VM{constructor(){this._redirectPersistence=Bi,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Gl,this._overrideRedirectResult=$p}async _initialize(e){const t=e._key();let r=this.eventManagers.get(t);return r||(r=new SM(e),this.eventManagers.set(t,r),this.attachCallbackListeners(e,r)),r}_openPopup(e){wt(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,r,i){EM(e);const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),CL(),await this._originValidation(e);const a=bM(e,r,i);await PM(e,a);const l=await yM(e,a,t),h=await IM(l);return wM(e,s,h)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=vM(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:r,handleOpenURL:i,BuildInfo:s}=qi(),a=setTimeout(async()=>{await Nv(e),t.onEvent(Vv())},NM),l=async p=>{clearTimeout(a);const m=await Nv(e);let I=null;m&&(p!=null&&p.url)&&(I=CM(m,p.url)),t.onEvent(I||Vv())};typeof r<"u"&&typeof r.subscribe=="function"&&r.subscribe(null,l);const h=i,f=`${s.packageName.toLowerCase()}://`;qi().handleOpenURL=async p=>{if(p.toLowerCase().startsWith(f)&&l({url:p}),typeof h=="function")try{h(p)}catch(m){console.error(m)}}}}const OM=VM;function Vv(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:vt("no-auth-event")}}function LM(n,e){ze(n)._logFramework(e)}var MM="@firebase/auth-compat",FM="0.5.1";const UM=1e3;function wa(){var n;return((n=self==null?void 0:self.location)===null||n===void 0?void 0:n.protocol)||null}function BM(){return wa()==="http:"||wa()==="https:"}function AE(n=qe()){return!!((wa()==="file:"||wa()==="ionic:"||wa()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function qM(){return wp()||Ip()}function $M(){return Ew()&&(document==null?void 0:document.documentMode)===11}function WM(n=qe()){return/Edge\/\d+/.test(n)}function GM(n=qe()){return $M()||WM(n)}function RE(){try{const n=self.localStorage,e=fc();if(n)return n.setItem(e,"1"),n.removeItem(e),GM()?Ca():!0}catch{return Gp()&&Ca()}return!1}function Gp(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function af(){return(BM()||ww()||AE())&&!qM()&&RE()&&!Gp()}function SE(){return AE()&&typeof document<"u"}async function zM(){return SE()?new Promise(n=>{const e=setTimeout(()=>{n(!1)},UM);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1}function KM(){return typeof window<"u"?window:null}const Zt={LOCAL:"local",NONE:"none",SESSION:"session"},Zo=O,bE="persistence";function HM(n,e){if(Zo(Object.values(Zt).includes(e),n,"invalid-persistence-type"),wp()){Zo(e!==Zt.SESSION,n,"unsupported-persistence-type");return}if(Ip()){Zo(e===Zt.NONE,n,"unsupported-persistence-type");return}if(Gp()){Zo(e===Zt.NONE||e===Zt.LOCAL&&Ca(),n,"unsupported-persistence-type");return}Zo(e===Zt.NONE||RE(),n,"unsupported-persistence-type")}async function Df(n){await n._initializationPromise;const e=PE(),t=Vi(bE,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistence())}function jM(n,e){const t=PE();if(!t)return[];const r=Vi(bE,n,e);switch(t.getItem(r)){case Zt.NONE:return[Zs];case Zt.LOCAL:return[Ma,Bi];case Zt.SESSION:return[Bi];default:return[]}}function PE(){var n;try{return((n=KM())===null||n===void 0?void 0:n.sessionStorage)||null}catch{return null}}const QM=O;class Mr{constructor(){this.browserResolver=en(hM),this.cordovaResolver=en(OM),this.underlyingResolver=null,this._redirectPersistence=Bi,this._completeRedirectFn=Gl,this._overrideRedirectResult=$p}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,r,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,r,i)}async _openRedirect(e,t,r,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,r,i)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return SE()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return QM(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await zM();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function CE(n){return n.unwrap()}function YM(n){return n.wrapped()}function JM(n){return kE(n)}function XM(n,e){var t;const r=(t=e.customData)===null||t===void 0?void 0:t._tokenResponse;if((e==null?void 0:e.code)==="auth/multi-factor-auth-required"){const i=e;i.resolver=new ZM(n,OO(n,e))}else if(r){const i=kE(e),s=e;i&&(s.credential=i,s.tenantId=r.tenantId||void 0,s.email=r.email||void 0,s.phoneNumber=r.phoneNumber||void 0)}}function kE(n){const{_tokenResponse:e}=n instanceof Vt?n.customData:n;if(!e)return null;if(!(n instanceof Vt)&&"temporaryProof"in e&&"phoneNumber"in e)return $n.credentialFromResult(n);const t=e.providerId;if(!t||t===Xo.PASSWORD)return null;let r;switch(t){case Xo.GOOGLE:r=xn;break;case Xo.FACEBOOK:r=Dn;break;case Xo.GITHUB:r=Nn;break;case Xo.TWITTER:r=Vn;break;default:const{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:a,pendingToken:l,nonce:h}=e;return!s&&!a&&!i&&!l?null:l?t.startsWith("saml.")?eo._create(t,l):Kn._fromParams({providerId:t,signInMethod:t,pendingToken:l,idToken:i,accessToken:s}):new Ws(t).credential({idToken:i,accessToken:s,rawNonce:h})}return n instanceof Vt?r.credentialFromError(n):r.credentialFromResult(n)}function $t(n,e){return e.catch(t=>{throw t instanceof Vt&&XM(n,t),t}).then(t=>{const r=t.operationType,i=t.user;return{operationType:r,credential:JM(t),additionalUserInfo:VO(t),user:Fr.getOrCreate(i)}})}async function xf(n,e){const t=await e;return{verificationId:t.verificationId,confirm:r=>$t(n,t.confirm(r))}}class ZM{constructor(e,t){this.resolver=t,this.auth=YM(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return $t(CE(this.auth),this.resolver.resolveSignIn(e))}}let Fr=class{constructor(e){this._delegate=e,this.multiFactor=UO(e)}static getOrCreate(e){return Fr.USER_MAP.has(e)||Fr.USER_MAP.set(e,new Fr(e)),Fr.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return $t(this.auth,iE(this._delegate,e))}async linkWithPhoneNumber(e,t){return xf(this.auth,mL(this._delegate,e,t))}async linkWithPopup(e){return $t(this.auth,RL(this._delegate,e,Mr))}async linkWithRedirect(e){return await Df(ze(this.auth)),VL(this._delegate,e,Mr)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return $t(this.auth,sE(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return xf(this.auth,_L(this._delegate,e,t))}reauthenticateWithPopup(e){return $t(this.auth,AL(this._delegate,e,Mr))}async reauthenticateWithRedirect(e){return await Df(ze(this.auth)),xL(this._delegate,e,Mr)}sendEmailVerification(e){return TO(this._delegate,e)}async unlink(e){return await uO(this._delegate,e),this}updateEmail(e){return bO(this._delegate,e)}updatePassword(e){return PO(this._delegate,e)}updatePhoneNumber(e){return yL(this._delegate,e)}updateProfile(e){return SO(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return AO(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}};Fr.USER_MAP=new WeakMap;const ea=O;class Nf{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:r}=e.options;ea(r,"invalid-api-key",{appName:e.name}),ea(r,"invalid-api-key",{appName:e.name});const i=typeof window<"u"?Mr:void 0;this._delegate=t.initialize({options:{persistence:eF(r,e.name),popupRedirectResolver:i}}),this._delegate._updateErrorMap(eV),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Fr.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){UV(this._delegate,e,t)}applyActionCode(e){return pO(this._delegate,e)}checkActionCode(e){return oE(this._delegate,e)}confirmPasswordReset(e,t){return fO(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return $t(this._delegate,mO(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return EO(this._delegate,e)}isSignInWithEmailLink(e){return vO(this._delegate,e)}async getRedirectResult(){ea(af(),this._delegate,"operation-not-supported-in-this-environment");const e=await LL(this._delegate,Mr);return e?$t(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){LM(this._delegate,e)}onAuthStateChanged(e,t,r){const{next:i,error:s,complete:a}=Ov(e,t,r);return this._delegate.onAuthStateChanged(i,s,a)}onIdTokenChanged(e,t,r){const{next:i,error:s,complete:a}=Ov(e,t,r);return this._delegate.onIdTokenChanged(i,s,a)}sendSignInLinkToEmail(e,t){return yO(this._delegate,e,t)}sendPasswordResetEmail(e,t){return dO(this._delegate,e,t||void 0)}async setPersistence(e){HM(this._delegate,e);let t;switch(e){case Zt.SESSION:t=Bi;break;case Zt.LOCAL:t=await en(Ma)._isAvailable()?Ma:Mp;break;case Zt.NONE:t=Zs;break;default:return wt("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return $t(this._delegate,cO(this._delegate))}signInWithCredential(e){return $t(this._delegate,Ul(this._delegate,e))}signInWithCustomToken(e){return $t(this._delegate,hO(this._delegate,e))}signInWithEmailAndPassword(e,t){return $t(this._delegate,_O(this._delegate,e,t))}signInWithEmailLink(e,t){return $t(this._delegate,IO(this._delegate,e,t))}signInWithPhoneNumber(e,t){return xf(this._delegate,gL(this._delegate,e,t))}async signInWithPopup(e){return ea(af(),this._delegate,"operation-not-supported-in-this-environment"),$t(this._delegate,TL(this._delegate,e,Mr))}async signInWithRedirect(e){return ea(af(),this._delegate,"operation-not-supported-in-this-environment"),await Df(this._delegate),kL(this._delegate,e,Mr)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return gO(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}Nf.Persistence=Zt;function Ov(n,e,t){let r=n;typeof n!="function"&&({next:r,error:e,complete:t}=n);const i=r;return{next:a=>i(a&&Fr.getOrCreate(a)),error:e,complete:t}}function eF(n,e){const t=jM(n,e);if(typeof self<"u"&&!t.includes(Ma)&&t.push(Ma),typeof window<"u")for(const r of[Mp,Bi])t.includes(r)||t.push(r);return t.includes(Zs)||t.push(Zs),t}class zp{constructor(){this.providerId="phone",this._delegate=new $n(CE(Gr.auth()))}static credential(e,t){return $n.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}zp.PHONE_SIGN_IN_METHOD=$n.PHONE_SIGN_IN_METHOD;zp.PROVIDER_ID=$n.PROVIDER_ID;const tF=O;class nF{constructor(e,t,r=Gr.app()){var i;tF((i=r.options)===null||i===void 0?void 0:i.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new fL(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}const rF="auth-compat";function iF(n){n.INTERNAL.registerComponent(new zn(rF,e=>{const t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("auth");return new Nf(t,r)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:As.EMAIL_SIGNIN,PASSWORD_RESET:As.PASSWORD_RESET,RECOVER_EMAIL:As.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:As.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:As.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:As.VERIFY_EMAIL}},EmailAuthProvider:ri,FacebookAuthProvider:Dn,GithubAuthProvider:Nn,GoogleAuthProvider:xn,OAuthProvider:Ws,SAMLAuthProvider:ol,PhoneAuthProvider:zp,PhoneMultiFactorGenerator:TE,RecaptchaVerifier:nF,TwitterAuthProvider:Vn,Auth:Nf,AuthCredential:yo,Error:Vt}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(MM,FM)}iF(Gr);var sF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},q,Kp=Kp||{},Z=sF||self;function zl(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function gc(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function oF(n){return Object.prototype.hasOwnProperty.call(n,cf)&&n[cf]||(n[cf]=++aF)}var cf="closure_uid_"+(1e9*Math.random()>>>0),aF=0;function cF(n,e,t){return n.call.apply(n.bind,arguments)}function uF(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Rt(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Rt=cF:Rt=uF,Rt.apply(null,arguments)}function xu(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function lt(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var a=Array(arguments.length-2),l=2;l<arguments.length;l++)a[l-2]=arguments[l];return e.prototype[i].apply(r,a)}}function ii(){this.s=this.s,this.o=this.o}var lF=0;ii.prototype.s=!1;ii.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),lF!=0)&&oF(this)};ii.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const DE=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Hp(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Lv(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(zl(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let a=0;a<s;a++)n[i+a]=r[a]}else n.push(r)}}function St(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}St.prototype.h=function(){this.defaultPrevented=!0};var hF=function(){if(!Z.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};Z.addEventListener("test",t,e),Z.removeEventListener("test",t,e)}catch{}return n}();function Fa(n){return/^[\s\xa0]*$/.test(n)}function Kl(){var n=Z.navigator;return n&&(n=n.userAgent)?n:""}function On(n){return Kl().indexOf(n)!=-1}function jp(n){return jp[" "](n),n}jp[" "]=function(){};function dF(n,e){var t=i2;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var fF=On("Opera"),to=On("Trident")||On("MSIE"),xE=On("Edge"),Vf=xE||to,NE=On("Gecko")&&!(Kl().toLowerCase().indexOf("webkit")!=-1&&!On("Edge"))&&!(On("Trident")||On("MSIE"))&&!On("Edge"),pF=Kl().toLowerCase().indexOf("webkit")!=-1&&!On("Edge");function VE(){var n=Z.document;return n?n.documentMode:void 0}var Of;e:{var uf="",lf=function(){var n=Kl();if(NE)return/rv:([^\);]+)(\)|;)/.exec(n);if(xE)return/Edge\/([\d\.]+)/.exec(n);if(to)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(pF)return/WebKit\/(\S+)/.exec(n);if(fF)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(lf&&(uf=lf?lf[1]:""),to){var hf=VE();if(hf!=null&&hf>parseFloat(uf)){Of=String(hf);break e}}Of=uf}var Lf;if(Z.document&&to){var Mv=VE();Lf=Mv||parseInt(Of,10)||void 0}else Lf=void 0;var gF=Lf;function Ua(n,e){if(St.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(NE){e:{try{jp(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:mF[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Ua.$.h.call(this)}}lt(Ua,St);var mF={2:"touch",3:"pen",4:"mouse"};Ua.prototype.h=function(){Ua.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var mc="closure_listenable_"+(1e6*Math.random()|0),_F=0;function yF(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++_F,this.fa=this.ia=!1}function Hl(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Qp(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function vF(n,e){for(const t in n)e.call(void 0,n[t],t,n)}function OE(n){const e={};for(const t in n)e[t]=n[t];return e}const Fv="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function LE(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<Fv.length;s++)t=Fv[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function jl(n){this.src=n,this.g={},this.h=0}jl.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var a=Ff(n,e,r,i);return-1<a?(e=n[a],t||(e.ia=!1)):(e=new yF(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function Mf(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=DE(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Hl(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Ff(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var Yp="closure_lm_"+(1e6*Math.random()|0),df={};function ME(n,e,t,r,i){if(r&&r.once)return UE(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)ME(n,e[s],t,r,i);return null}return t=Zp(t),n&&n[mc]?n.O(e,t,gc(r)?!!r.capture:!!r,i):FE(n,e,t,!1,r,i)}function FE(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var a=gc(i)?!!i.capture:!!i,l=Xp(n);if(l||(n[Yp]=l=new jl(n)),t=l.add(e,t,r,a,s),t.proxy)return t;if(r=IF(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)hF||(i=a),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(qE(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function IF(){function n(t){return e.call(n.src,n.listener,t)}const e=wF;return n}function UE(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)UE(n,e[s],t,r,i);return null}return t=Zp(t),n&&n[mc]?n.P(e,t,gc(r)?!!r.capture:!!r,i):FE(n,e,t,!0,r,i)}function BE(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)BE(n,e[s],t,r,i);else r=gc(r)?!!r.capture:!!r,t=Zp(t),n&&n[mc]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=Ff(s,t,r,i),-1<t&&(Hl(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=Xp(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Ff(e,t,r,i)),(t=-1<n?e[n]:null)&&Jp(t))}function Jp(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[mc])Mf(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(qE(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Xp(e))?(Mf(t,n),t.h==0&&(t.src=null,e[Yp]=null)):Hl(n)}}}function qE(n){return n in df?df[n]:df[n]="on"+n}function wF(n,e){if(n.fa)n=!0;else{e=new Ua(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Jp(n),n=t.call(r,e)}return n}function Xp(n){return n=n[Yp],n instanceof jl?n:null}var ff="__closure_events_fn_"+(1e9*Math.random()>>>0);function Zp(n){return typeof n=="function"?n:(n[ff]||(n[ff]=function(e){return n.handleEvent(e)}),n[ff])}function ut(){ii.call(this),this.i=new jl(this),this.S=this,this.J=null}lt(ut,ii);ut.prototype[mc]=!0;ut.prototype.removeEventListener=function(n,e,t,r){BE(this,n,e,t,r)};function It(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new St(e,n);else if(e instanceof St)e.target=e.target||n;else{var i=e;e=new St(r,n),LE(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var a=e.g=t[s];i=Nu(a,r,!0,e)&&i}if(a=e.g=n,i=Nu(a,r,!0,e)&&i,i=Nu(a,r,!1,e)&&i,t)for(s=0;s<t.length;s++)a=e.g=t[s],i=Nu(a,r,!1,e)&&i}ut.prototype.N=function(){if(ut.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Hl(t[r]);delete n.g[e],n.h--}}this.J=null};ut.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};ut.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function Nu(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var a=e[s];if(a&&!a.fa&&a.capture==t){var l=a.listener,h=a.la||a.src;a.ia&&Mf(n.i,a),i=l.call(h,r)!==!1&&i}}return i&&!r.defaultPrevented}var eg=Z.JSON.stringify;class EF{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function TF(){var n=tg;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class AF{constructor(){this.h=this.g=null}add(e,t){const r=$E.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}}var $E=new EF(()=>new RF,n=>n.reset());class RF{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function SF(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function bF(n){Z.setTimeout(()=>{throw n},0)}let Ba,qa=!1,tg=new AF,WE=()=>{const n=Z.Promise.resolve(void 0);Ba=()=>{n.then(PF)}};var PF=()=>{for(var n;n=TF();){try{n.h.call(n.g)}catch(t){bF(t)}var e=$E;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}qa=!1};function Ql(n,e){ut.call(this),this.h=n||1,this.g=e||Z,this.j=Rt(this.qb,this),this.l=Date.now()}lt(Ql,ut);q=Ql.prototype;q.ga=!1;q.T=null;q.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),It(this,"tick"),this.ga&&(ng(this),this.start()))}};q.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function ng(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}q.N=function(){Ql.$.N.call(this),ng(this),delete this.g};function rg(n,e,t){if(typeof n=="function")t&&(n=Rt(n,t));else if(n&&typeof n.handleEvent=="function")n=Rt(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:Z.setTimeout(n,e||0)}function GE(n){n.g=rg(()=>{n.g=null,n.i&&(n.i=!1,GE(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class CF extends ii{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:GE(this)}N(){super.N(),this.g&&(Z.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $a(n){ii.call(this),this.h=n,this.g={}}lt($a,ii);var Uv=[];function zE(n,e,t,r){Array.isArray(t)||(t&&(Uv[0]=t.toString()),t=Uv);for(var i=0;i<t.length;i++){var s=ME(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function KE(n){Qp(n.g,function(e,t){this.g.hasOwnProperty(t)&&Jp(e)},n),n.g={}}$a.prototype.N=function(){$a.$.N.call(this),KE(this)};$a.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Yl(){this.g=!0}Yl.prototype.Ea=function(){this.g=!1};function kF(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var a="",l=s.split("&"),h=0;h<l.length;h++){var f=l[h].split("=");if(1<f.length){var p=f[0];f=f[1];var m=p.split("_");a=2<=m.length&&m[1]=="type"?a+(p+"="+f+"&"):a+(p+"=redacted&")}}else a=null;else a=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+a})}function DF(n,e,t,r,i,s,a){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+a})}function Bs(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+NF(n,t)+(r?" "+r:"")})}function xF(n,e){n.info(function(){return"TIMEOUT: "+e})}Yl.prototype.info=function(){};function NF(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var a=1;a<i.length;a++)i[a]=""}}}}return eg(t)}catch{return e}}var es={},Bv=null;function Jl(){return Bv=Bv||new ut}es.Ta="serverreachability";function HE(n){St.call(this,es.Ta,n)}lt(HE,St);function Wa(n){const e=Jl();It(e,new HE(e))}es.STAT_EVENT="statevent";function jE(n,e){St.call(this,es.STAT_EVENT,n),this.stat=e}lt(jE,St);function Nt(n){const e=Jl();It(e,new jE(e,n))}es.Ua="timingevent";function QE(n,e){St.call(this,es.Ua,n),this.size=e}lt(QE,St);function _c(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return Z.setTimeout(function(){n()},e)}var Xl={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},YE={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function ig(){}ig.prototype.h=null;function qv(n){return n.h||(n.h=n.i())}function JE(){}var yc={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function sg(){St.call(this,"d")}lt(sg,St);function og(){St.call(this,"c")}lt(og,St);var Uf;function Zl(){}lt(Zl,ig);Zl.prototype.g=function(){return new XMLHttpRequest};Zl.prototype.i=function(){return{}};Uf=new Zl;function vc(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new $a(this),this.P=VF,n=Vf?125:void 0,this.V=new Ql(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new XE}function XE(){this.i=null,this.g="",this.h=!1}var VF=45e3,ZE={},Bf={};q=vc.prototype;q.setTimeout=function(n){this.P=n};function qf(n,e,t){n.L=1,n.A=th(pr(e)),n.u=t,n.S=!0,eT(n,null)}function eT(n,e){n.G=Date.now(),Ic(n),n.B=pr(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),cT(t.i,"t",r),n.o=0,t=n.l.J,n.h=new XE,n.g=CT(n.l,t?e:null,!n.u),0<n.O&&(n.M=new CF(Rt(n.Pa,n,n.g),n.O)),zE(n.U,n.g,"readystatechange",n.nb),e=n.I?OE(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Wa(),kF(n.j,n.v,n.B,n.m,n.W,n.u)}q.nb=function(n){n=n.target;const e=this.M;e&&Mn(n)==3?e.l():this.Pa(n)};q.Pa=function(n){try{if(n==this.g)e:{const p=Mn(this.g);var e=this.g.Ia();const m=this.g.da();if(!(3>p)&&(p!=3||Vf||this.g&&(this.h.h||this.g.ja()||zv(this.g)))){this.J||p!=4||e==7||(e==8||0>=m?Wa(3):Wa(2)),eh(this);var t=this.g.da();this.ca=t;t:if(tT(this)){var r=zv(this.g);n="";var i=r.length,s=Mn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Ci(this),Ea(this);var a="";break t}this.h.i=new Z.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,a=this.h.g}else a=this.g.ja();if(this.i=t==200,DF(this.j,this.v,this.B,this.m,this.W,p,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var l,h=this.g;if((l=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Fa(l)){var f=l;break t}}f=null}if(t=f)Bs(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,$f(this,t);else{this.i=!1,this.s=3,Nt(12),Ci(this),Ea(this);break e}}this.S?(nT(this,p,a),Vf&&this.i&&p==3&&(zE(this.U,this.V,"tick",this.mb),this.V.start())):(Bs(this.j,this.m,a,null),$f(this,a)),p==4&&Ci(this),this.i&&!this.J&&(p==4?RT(this.l,this):(this.i=!1,Ic(this)))}else t2(this.g),t==400&&0<a.indexOf("Unknown SID")?(this.s=3,Nt(12)):(this.s=0,Nt(13)),Ci(this),Ea(this)}}}catch{}finally{}};function tT(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function nT(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=OF(n,t),i==Bf){e==4&&(n.s=4,Nt(14),r=!1),Bs(n.j,n.m,null,"[Incomplete Response]");break}else if(i==ZE){n.s=4,Nt(15),Bs(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else Bs(n.j,n.m,i,null),$f(n,i);tT(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Nt(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),dg(e),e.M=!0,Nt(11))):(Bs(n.j,n.m,t,"[Invalid Chunked Response]"),Ci(n),Ea(n))}q.mb=function(){if(this.g){var n=Mn(this.g),e=this.g.ja();this.o<e.length&&(eh(this),nT(this,n,e),this.i&&n!=4&&Ic(this))}};function OF(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?Bf:(t=Number(e.substring(t,r)),isNaN(t)?ZE:(r+=1,r+t>e.length?Bf:(e=e.slice(r,r+t),n.o=r+t,e)))}q.cancel=function(){this.J=!0,Ci(this)};function Ic(n){n.Y=Date.now()+n.P,rT(n,n.P)}function rT(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=_c(Rt(n.lb,n),e)}function eh(n){n.C&&(Z.clearTimeout(n.C),n.C=null)}q.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(xF(this.j,this.B),this.L!=2&&(Wa(),Nt(17)),Ci(this),this.s=2,Ea(this)):rT(this,this.Y-n)};function Ea(n){n.l.H==0||n.J||RT(n.l,n)}function Ci(n){eh(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,ng(n.V),KE(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function $f(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Wf(t.i,n))){if(!n.K&&Wf(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)dl(t),sh(t);else break e;hg(t),Nt(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=_c(Rt(t.ib,t),6e3));if(1>=hT(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else ki(t,11)}else if((n.K||t.g==n)&&dl(t),!Fa(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let f=i[e];if(t.V=f[0],f=f[1],t.H==2)if(f[0]=="c"){t.K=f[1],t.pa=f[2];const p=f[3];p!=null&&(t.ra=p,t.l.info("VER="+t.ra));const m=f[4];m!=null&&(t.Ga=m,t.l.info("SVER="+t.Ga));const I=f[5];I!=null&&typeof I=="number"&&0<I&&(r=1.5*I,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const A=n.g;if(A){const L=A.g?A.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(L){var s=r.i;s.g||L.indexOf("spdy")==-1&&L.indexOf("quic")==-1&&L.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(ag(s,s.h),s.h=null))}if(r.F){const M=A.g?A.g.getResponseHeader("X-HTTP-Session-Id"):null;M&&(r.Da=M,xe(r.I,r.F,M))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var a=n;if(r.wa=PT(r,r.J?r.pa:null,r.Y),a.K){dT(r.i,a);var l=a,h=r.L;h&&l.setTimeout(h),l.C&&(eh(l),Ic(l)),r.g=a}else TT(r);0<t.j.length&&oh(t)}else f[0]!="stop"&&f[0]!="close"||ki(t,7);else t.H==3&&(f[0]=="stop"||f[0]=="close"?f[0]=="stop"?ki(t,7):lg(t):f[0]!="noop"&&t.h&&t.h.Aa(f),t.A=0)}}Wa(4)}catch{}}function LF(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(zl(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function MF(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(zl(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}function iT(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(zl(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=MF(n),r=LF(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var sT=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function FF(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Li(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Li){this.h=n.h,ll(this,n.j),this.s=n.s,this.g=n.g,hl(this,n.m),this.l=n.l;var e=n.i,t=new Ga;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),$v(this,t),this.o=n.o}else n&&(e=String(n).match(sT))?(this.h=!1,ll(this,e[1]||"",!0),this.s=fa(e[2]||""),this.g=fa(e[3]||"",!0),hl(this,e[4]),this.l=fa(e[5]||"",!0),$v(this,e[6]||"",!0),this.o=fa(e[7]||"")):(this.h=!1,this.i=new Ga(null,this.h))}Li.prototype.toString=function(){var n=[],e=this.j;e&&n.push(pa(e,Wv,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(pa(e,Wv,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(pa(t,t.charAt(0)=="/"?qF:BF,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",pa(t,WF)),n.join("")};function pr(n){return new Li(n)}function ll(n,e,t){n.j=t?fa(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function hl(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function $v(n,e,t){e instanceof Ga?(n.i=e,GF(n.i,n.h)):(t||(e=pa(e,$F)),n.i=new Ga(e,n.h))}function xe(n,e,t){n.i.set(e,t)}function th(n){return xe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function fa(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function pa(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,UF),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function UF(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Wv=/[#\/\?@]/g,BF=/[#\?:]/g,qF=/[#\?]/g,$F=/[#\?@]/g,WF=/#/g;function Ga(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function si(n){n.g||(n.g=new Map,n.h=0,n.i&&FF(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}q=Ga.prototype;q.add=function(n,e){si(this),this.i=null,n=Io(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function oT(n,e){si(n),e=Io(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function aT(n,e){return si(n),e=Io(n,e),n.g.has(e)}q.forEach=function(n,e){si(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};q.ta=function(){si(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};q.Z=function(n){si(this);let e=[];if(typeof n=="string")aT(this,n)&&(e=e.concat(this.g.get(Io(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};q.set=function(n,e){return si(this),this.i=null,n=Io(this,n),aT(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};q.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function cT(n,e,t){oT(n,e),0<t.length&&(n.i=null,n.g.set(Io(n,e),Hp(t)),n.h+=t.length)}q.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),a=this.Z(r);for(r=0;r<a.length;r++){var i=s;a[r]!==""&&(i+="="+encodeURIComponent(String(a[r]))),n.push(i)}}return this.i=n.join("&")};function Io(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function GF(n,e){e&&!n.j&&(si(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(oT(this,r),cT(this,i,t))},n)),n.j=e}var zF=class{constructor(n,e){this.g=n,this.map=e}};function uT(n){this.l=n||KF,Z.PerformanceNavigationTiming?(n=Z.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(Z.g&&Z.g.Ka&&Z.g.Ka()&&Z.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var KF=10;function lT(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function hT(n){return n.h?1:n.g?n.g.size:0}function Wf(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function ag(n,e){n.g?n.g.add(e):n.h=e}function dT(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}uT.prototype.cancel=function(){if(this.i=fT(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function fT(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Hp(n.i)}var HF=class{stringify(n){return Z.JSON.stringify(n,void 0)}parse(n){return Z.JSON.parse(n,void 0)}};function jF(){this.g=new HF}function QF(n,e,t){const r=t||"";try{iT(n,function(i,s){let a=i;gc(i)&&(a=eg(i)),e.push(r+s+"="+encodeURIComponent(a))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function YF(n,e){const t=new Yl;if(Z.Image){const r=new Image;r.onload=xu(Vu,t,r,"TestLoadImage: loaded",!0,e),r.onerror=xu(Vu,t,r,"TestLoadImage: error",!1,e),r.onabort=xu(Vu,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=xu(Vu,t,r,"TestLoadImage: timeout",!1,e),Z.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function Vu(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function nh(n){this.l=n.ec||null,this.j=n.ob||!1}lt(nh,ig);nh.prototype.g=function(){return new rh(this.l,this.j)};nh.prototype.i=function(n){return function(){return n}}({});function rh(n,e){ut.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=cg,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}lt(rh,ut);var cg=0;q=rh.prototype;q.open=function(n,e){if(this.readyState!=cg)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,za(this)};q.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||Z).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};q.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,wc(this)),this.readyState=cg};q.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,za(this)),this.g&&(this.readyState=3,za(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof Z.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;pT(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function pT(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}q.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?wc(this):za(this),this.readyState==3&&pT(this)}};q.Za=function(n){this.g&&(this.response=this.responseText=n,wc(this))};q.Ya=function(n){this.g&&(this.response=n,wc(this))};q.ka=function(){this.g&&wc(this)};function wc(n){n.readyState=4,n.l=null,n.j=null,n.A=null,za(n)}q.setRequestHeader=function(n,e){this.v.append(n,e)};q.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};q.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function za(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(rh.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var JF=Z.JSON.parse;function Ke(n){ut.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=gT,this.L=this.M=!1}lt(Ke,ut);var gT="",XF=/^https?$/i,ZF=["POST","PUT"];q=Ke.prototype;q.Oa=function(n){this.M=n};q.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Uf.g(),this.C=this.u?qv(this.u):qv(Uf),this.g.onreadystatechange=Rt(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){Gv(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(const s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=Z.FormData&&n instanceof Z.FormData,!(0<=DE(ZF,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of t)this.g.setRequestHeader(s,a);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{yT(this),0<this.B&&((this.L=e2(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Rt(this.ua,this)):this.A=rg(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Gv(this,s)}};function e2(n){return to&&typeof n.timeout=="number"&&n.ontimeout!==void 0}q.ua=function(){typeof Kp<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,It(this,"timeout"),this.abort(8))};function Gv(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,mT(n),ih(n)}function mT(n){n.F||(n.F=!0,It(n,"complete"),It(n,"error"))}q.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,It(this,"complete"),It(this,"abort"),ih(this))};q.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ih(this,!0)),Ke.$.N.call(this)};q.La=function(){this.s||(this.G||this.v||this.l?_T(this):this.kb())};q.kb=function(){_T(this)};function _T(n){if(n.h&&typeof Kp<"u"&&(!n.C[1]||Mn(n)!=4||n.da()!=2)){if(n.v&&Mn(n)==4)rg(n.La,0,n);else if(It(n,"readystatechange"),Mn(n)==4){n.h=!1;try{const a=n.da();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=a===0){var i=String(n.I).match(sT)[1]||null;!i&&Z.self&&Z.self.location&&(i=Z.self.location.protocol.slice(0,-1)),r=!XF.test(i?i.toLowerCase():"")}t=r}if(t)It(n,"complete"),It(n,"success");else{n.m=6;try{var s=2<Mn(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",mT(n)}}finally{ih(n)}}}}function ih(n,e){if(n.g){yT(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||It(n,"ready");try{t.onreadystatechange=r}catch{}}}function yT(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(Z.clearTimeout(n.A),n.A=null)}q.isActive=function(){return!!this.g};function Mn(n){return n.g?n.g.readyState:0}q.da=function(){try{return 2<Mn(this)?this.g.status:-1}catch{return-1}};q.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};q.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),JF(e)}};function zv(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case gT:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function t2(n){const e={};n=(n.g&&2<=Mn(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Fa(n[r]))continue;var t=SF(n[r]);const i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}vF(e,function(r){return r.join(", ")})}q.Ia=function(){return this.m};q.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function vT(n){let e="";return Qp(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function ug(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=vT(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):xe(n,e,t))}function ta(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function IT(n){this.Ga=0,this.j=[],this.l=new Yl,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=ta("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=ta("baseRetryDelayMs",5e3,n),this.hb=ta("retryDelaySeedMs",1e4,n),this.eb=ta("forwardChannelMaxRetries",2,n),this.xa=ta("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new uT(n&&n.concurrentRequestLimit),this.Ja=new jF,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}q=IT.prototype;q.ra=8;q.H=1;function lg(n){if(wT(n),n.H==3){var e=n.W++,t=pr(n.I);if(xe(t,"SID",n.K),xe(t,"RID",e),xe(t,"TYPE","terminate"),Ec(n,t),e=new vc(n,n.l,e),e.L=2,e.A=th(pr(t)),t=!1,Z.navigator&&Z.navigator.sendBeacon)try{t=Z.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&Z.Image&&(new Image().src=e.A,t=!0),t||(e.g=CT(e.l,null),e.g.ha(e.A)),e.G=Date.now(),Ic(e)}bT(n)}function sh(n){n.g&&(dg(n),n.g.cancel(),n.g=null)}function wT(n){sh(n),n.u&&(Z.clearTimeout(n.u),n.u=null),dl(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&Z.clearTimeout(n.m),n.m=null)}function oh(n){if(!lT(n.i)&&!n.m){n.m=!0;var e=n.Na;Ba||WE(),qa||(Ba(),qa=!0),tg.add(e,n),n.C=0}}function n2(n,e){return hT(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=_c(Rt(n.Na,n,e),ST(n,n.C)),n.C++,!0)}q.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new vc(this,this.l,n);let s=this.s;if(this.U&&(s?(s=OE(s),LE(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=ET(this,i,e),t=pr(this.I),xe(t,"RID",n),xe(t,"CVER",22),this.F&&xe(t,"X-HTTP-Session-Id",this.F),Ec(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(vT(s)))+"&"+e:this.o&&ug(t,this.o,s)),ag(this.i,i),this.bb&&xe(t,"TYPE","init"),this.P?(xe(t,"$req",e),xe(t,"SID","null"),i.aa=!0,qf(i,t,null)):qf(i,t,e),this.H=2}}else this.H==3&&(n?Kv(this,n):this.j.length==0||lT(this.i)||Kv(this))};function Kv(n,e){var t;e?t=e.m:t=n.W++;const r=pr(n.I);xe(r,"SID",n.K),xe(r,"RID",t),xe(r,"AID",n.V),Ec(n,r),n.o&&n.s&&ug(r,n.o,n.s),t=new vc(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=ET(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),ag(n.i,t),qf(t,r,e)}function Ec(n,e){n.na&&Qp(n.na,function(t,r){xe(e,r,t)}),n.h&&iT({},function(t,r){xe(e,r,t)})}function ET(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Rt(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const a=["count="+t];s==-1?0<t?(s=i[0].g,a.push("ofs="+s)):s=0:a.push("ofs="+s);let l=!0;for(let h=0;h<t;h++){let f=i[h].g;const p=i[h].map;if(f-=s,0>f)s=Math.max(0,i[h].g-100),l=!1;else try{QF(p,a,"req"+f+"_")}catch{r&&r(p)}}if(l){r=a.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function TT(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Ba||WE(),qa||(Ba(),qa=!0),tg.add(e,n),n.A=0}}function hg(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=_c(Rt(n.Ma,n),ST(n,n.A)),n.A++,!0)}q.Ma=function(){if(this.u=null,AT(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=_c(Rt(this.jb,this),n)}};q.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Nt(10),sh(this),AT(this))};function dg(n){n.B!=null&&(Z.clearTimeout(n.B),n.B=null)}function AT(n){n.g=new vc(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=pr(n.wa);xe(e,"RID","rpc"),xe(e,"SID",n.K),xe(e,"AID",n.V),xe(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&xe(e,"TO",n.qa),xe(e,"TYPE","xmlhttp"),Ec(n,e),n.o&&n.s&&ug(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=th(pr(e)),t.u=null,t.S=!0,eT(t,n)}q.ib=function(){this.v!=null&&(this.v=null,sh(this),hg(this),Nt(19))};function dl(n){n.v!=null&&(Z.clearTimeout(n.v),n.v=null)}function RT(n,e){var t=null;if(n.g==e){dl(n),dg(n),n.g=null;var r=2}else if(Wf(n.i,e))t=e.F,dT(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=Jl(),It(r,new QE(r,t)),oh(n)}else TT(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&n2(n,e)||r==2&&hg(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:ki(n,5);break;case 4:ki(n,10);break;case 3:ki(n,6);break;default:ki(n,2)}}}function ST(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function ki(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=Rt(n.pb,n);t||(t=new Li("//www.google.com/images/cleardot.gif"),Z.location&&Z.location.protocol=="http"||ll(t,"https"),th(t)),YF(t.toString(),r)}else Nt(2);n.H=0,n.h&&n.h.za(e),bT(n),wT(n)}q.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Nt(2)):(this.l.info("Failed to ping google.com"),Nt(1))};function bT(n){if(n.H=0,n.ma=[],n.h){const e=fT(n.i);(e.length!=0||n.j.length!=0)&&(Lv(n.ma,e),Lv(n.ma,n.j),n.i.i.length=0,Hp(n.j),n.j.length=0),n.h.ya()}}function PT(n,e,t){var r=t instanceof Li?pr(t):new Li(t);if(r.g!="")e&&(r.g=e+"."+r.g),hl(r,r.m);else{var i=Z.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Li(null);r&&ll(s,r),e&&(s.g=e),i&&hl(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&xe(r,t,e),xe(r,"VER",n.ra),Ec(n,r),r}function CT(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new Ke(new nh({ob:t})):new Ke(n.va),e.Oa(n.J),e}q.isActive=function(){return!!this.h&&this.h.isActive(this)};function kT(){}q=kT.prototype;q.Ba=function(){};q.Aa=function(){};q.za=function(){};q.ya=function(){};q.isActive=function(){return!0};q.Va=function(){};function fl(){if(to&&!(10<=Number(gF)))throw Error("Environmental error: no available transport.")}fl.prototype.g=function(n,e){return new tn(n,e)};function tn(n,e){ut.call(this),this.g=new IT(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Fa(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Fa(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new wo(this)}lt(tn,ut);tn.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Nt(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=PT(n,null,n.Y),oh(n)};tn.prototype.close=function(){lg(this.g)};tn.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=eg(n),n=t);e.j.push(new zF(e.fb++,n)),e.H==3&&oh(e)};tn.prototype.N=function(){this.g.h=null,delete this.j,lg(this.g),delete this.g,tn.$.N.call(this)};function DT(n){sg.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}lt(DT,sg);function xT(){og.call(this),this.status=1}lt(xT,og);function wo(n){this.g=n}lt(wo,kT);wo.prototype.Ba=function(){It(this.g,"a")};wo.prototype.Aa=function(n){It(this.g,new DT(n))};wo.prototype.za=function(n){It(this.g,new xT)};wo.prototype.ya=function(){It(this.g,"b")};function r2(){this.blockSize=-1}function Tn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}lt(Tn,r2);Tn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function pf(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],a=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(a<<7&4294967295|a>>>25),a=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(a<<12&4294967295|a>>>20),a=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(a<<17&4294967295|a>>>15),a=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(a<<22&4294967295|a>>>10),a=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(a<<12&4294967295|a>>>20),a=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(a<<17&4294967295|a>>>15),a=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(a<<22&4294967295|a>>>10),a=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(a<<12&4294967295|a>>>20),a=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(a<<17&4294967295|a>>>15),a=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(a<<22&4294967295|a>>>10),a=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(a<<7&4294967295|a>>>25),a=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(a<<12&4294967295|a>>>20),a=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(a<<17&4294967295|a>>>15),a=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(a<<22&4294967295|a>>>10),a=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(a<<9&4294967295|a>>>23),a=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(a<<20&4294967295|a>>>12),a=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(a<<9&4294967295|a>>>23),a=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(a<<20&4294967295|a>>>12),a=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(a<<9&4294967295|a>>>23),a=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(a<<20&4294967295|a>>>12),a=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(a<<5&4294967295|a>>>27),a=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(a<<9&4294967295|a>>>23),a=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(a<<14&4294967295|a>>>18),a=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(a<<20&4294967295|a>>>12),a=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(a<<11&4294967295|a>>>21),a=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(a<<16&4294967295|a>>>16),a=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(a<<23&4294967295|a>>>9),a=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(a<<11&4294967295|a>>>21),a=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(a<<16&4294967295|a>>>16),a=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(a<<23&4294967295|a>>>9),a=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(a<<11&4294967295|a>>>21),a=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(a<<16&4294967295|a>>>16),a=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(a<<23&4294967295|a>>>9),a=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(a<<4&4294967295|a>>>28),a=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(a<<11&4294967295|a>>>21),a=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(a<<16&4294967295|a>>>16),a=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(a<<23&4294967295|a>>>9),a=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(a<<10&4294967295|a>>>22),a=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(a<<15&4294967295|a>>>17),a=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(a<<21&4294967295|a>>>11),a=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(a<<10&4294967295|a>>>22),a=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(a<<15&4294967295|a>>>17),a=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(a<<21&4294967295|a>>>11),a=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(a<<10&4294967295|a>>>22),a=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(a<<15&4294967295|a>>>17),a=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(a<<21&4294967295|a>>>11),a=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(a<<6&4294967295|a>>>26),a=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(a<<10&4294967295|a>>>22),a=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(a<<15&4294967295|a>>>17),a=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(a<<21&4294967295|a>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}Tn.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)pf(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){pf(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){pf(this,r),i=0;break}}this.h=i,this.i+=e};Tn.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function Ae(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var i2={};function fg(n){return-128<=n&&128>n?dF(n,function(e){return new Ae([e|0],0>e?-1:0)}):new Ae([n|0],0>n?-1:0)}function Fn(n){if(isNaN(n)||!isFinite(n))return zs;if(0>n)return _t(Fn(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Gf;return new Ae(e,0)}function NT(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return _t(NT(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Fn(Math.pow(e,8)),r=zs,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),a=parseInt(n.substring(i,i+s),e);8>s?(s=Fn(Math.pow(e,s)),r=r.R(s).add(Fn(a))):(r=r.R(t),r=r.add(Fn(a)))}return r}var Gf=4294967296,zs=fg(0),zf=fg(1),Hv=fg(16777216);q=Ae.prototype;q.ea=function(){if(dn(this))return-_t(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Gf+r)*e,e*=Gf}return n};q.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(ar(this))return"0";if(dn(this))return"-"+_t(this).toString(n);for(var e=Fn(Math.pow(n,6)),t=this,r="";;){var i=gl(t,e).g;t=pl(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,ar(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};q.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function ar(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function dn(n){return n.h==-1}q.X=function(n){return n=pl(this,n),dn(n)?-1:ar(n)?0:1};function _t(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new Ae(t,~n.h).add(zf)}q.abs=function(){return dn(this)?_t(this):this};q.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),a=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=a>>>16,s&=65535,a&=65535,t[i]=a<<16|s}return new Ae(t,t[t.length-1]&-2147483648?-1:0)};function pl(n,e){return n.add(_t(e))}q.R=function(n){if(ar(this)||ar(n))return zs;if(dn(this))return dn(n)?_t(this).R(_t(n)):_t(_t(this).R(n));if(dn(n))return _t(this.R(_t(n)));if(0>this.X(Hv)&&0>n.X(Hv))return Fn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,a=this.D(r)&65535,l=n.D(i)>>>16,h=n.D(i)&65535;t[2*r+2*i]+=a*h,Ou(t,2*r+2*i),t[2*r+2*i+1]+=s*h,Ou(t,2*r+2*i+1),t[2*r+2*i+1]+=a*l,Ou(t,2*r+2*i+1),t[2*r+2*i+2]+=s*l,Ou(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new Ae(t,0)};function Ou(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function na(n,e){this.g=n,this.h=e}function gl(n,e){if(ar(e))throw Error("division by zero");if(ar(n))return new na(zs,zs);if(dn(n))return e=gl(_t(n),e),new na(_t(e.g),_t(e.h));if(dn(e))return e=gl(n,_t(e)),new na(_t(e.g),e.h);if(30<n.g.length){if(dn(n)||dn(e))throw Error("slowDivide_ only works with positive integers.");for(var t=zf,r=e;0>=r.X(n);)t=jv(t),r=jv(r);var i=Rs(t,1),s=Rs(r,1);for(r=Rs(r,2),t=Rs(t,2);!ar(r);){var a=s.add(r);0>=a.X(n)&&(i=i.add(t),s=a),r=Rs(r,1),t=Rs(t,1)}return e=pl(n,i.R(e)),new na(i,e)}for(i=zs;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Fn(t),a=s.R(e);dn(a)||0<a.X(n);)t-=r,s=Fn(t),a=s.R(e);ar(s)&&(s=zf),i=i.add(s),n=pl(n,a)}return new na(i,n)}q.gb=function(n){return gl(this,n).h};q.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new Ae(t,this.h&n.h)};q.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new Ae(t,this.h|n.h)};q.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new Ae(t,this.h^n.h)};function jv(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new Ae(t,n.h)}function Rs(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new Ae(i,n.h)}fl.prototype.createWebChannel=fl.prototype.g;tn.prototype.send=tn.prototype.u;tn.prototype.open=tn.prototype.m;tn.prototype.close=tn.prototype.close;Xl.NO_ERROR=0;Xl.TIMEOUT=8;Xl.HTTP_ERROR=6;YE.COMPLETE="complete";JE.EventType=yc;yc.OPEN="a";yc.CLOSE="b";yc.ERROR="c";yc.MESSAGE="d";ut.prototype.listen=ut.prototype.O;Ke.prototype.listenOnce=Ke.prototype.P;Ke.prototype.getLastError=Ke.prototype.Sa;Ke.prototype.getLastErrorCode=Ke.prototype.Ia;Ke.prototype.getStatus=Ke.prototype.da;Ke.prototype.getResponseJson=Ke.prototype.Wa;Ke.prototype.getResponseText=Ke.prototype.ja;Ke.prototype.send=Ke.prototype.ha;Ke.prototype.setWithCredentials=Ke.prototype.Oa;Tn.prototype.digest=Tn.prototype.l;Tn.prototype.reset=Tn.prototype.reset;Tn.prototype.update=Tn.prototype.j;Ae.prototype.add=Ae.prototype.add;Ae.prototype.multiply=Ae.prototype.R;Ae.prototype.modulo=Ae.prototype.gb;Ae.prototype.compare=Ae.prototype.X;Ae.prototype.toNumber=Ae.prototype.ea;Ae.prototype.toString=Ae.prototype.toString;Ae.prototype.getBits=Ae.prototype.D;Ae.fromNumber=Fn;Ae.fromString=NT;var s2=function(){return new fl},o2=function(){return Jl()},gf=Xl,a2=YE,c2=es,Qv={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Lu=JE,u2=Ke,l2=Tn,Ks=Ae;const Yv="@firebase/firestore";class at{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}at.UNAUTHENTICATED=new at(null),at.GOOGLE_CREDENTIALS=new at("google-credentials-uid"),at.FIRST_PARTY=new at("first-party-uid"),at.MOCK_USER=new at("mock-user");let Eo="10.7.0";const zr=new Vl("@firebase/firestore");function xs(){return zr.logLevel}function h2(n){zr.setLogLevel(n)}function N(n,...e){if(zr.logLevel<=ue.DEBUG){const t=e.map(pg);zr.debug(`Firestore (${Eo}): ${n}`,...t)}}function Xe(n,...e){if(zr.logLevel<=ue.ERROR){const t=e.map(pg);zr.error(`Firestore (${Eo}): ${n}`,...t)}}function An(n,...e){if(zr.logLevel<=ue.WARN){const t=e.map(pg);zr.warn(`Firestore (${Eo}): ${n}`,...t)}}function pg(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function $(n="Unexpected state"){const e=`FIRESTORE (${Eo}) INTERNAL ASSERTION FAILED: `+n;throw Xe(e),new Error(e)}function z(n,e){n||$()}function d2(n,e){n||$()}function B(n,e){return n}const b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class D extends Vt{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ct{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class VT{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class f2{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(at.UNAUTHENTICATED))}shutdown(){}}class p2{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class g2{constructor(e){this.t=e,this.currentUser=at.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i;const i=h=>this.i!==r?(r=this.i,t(h)):Promise.resolve();let s=new ct;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new ct,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const h=s;e.enqueueRetryable(async()=>{await h.promise,await i(this.currentUser)})},l=h=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(h=>l(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new ct)}},0),a()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(z(typeof r.accessToken=="string"),new VT(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return z(e===null||typeof e=="string"),new at(e)}}class m2{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=at.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class _2{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new m2(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(at.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class y2{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class v2{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{s.error!=null&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,N("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(z(typeof t.token=="string"),this.R=t.token,new y2(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function I2(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class OT{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=I2(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function ne(n,e){return n<e?-1:n>e?1:0}function no(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function LT(n){return n+"\0"}class Fe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new D(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new D(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new D(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new D(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return Fe.fromMillis(Date.now())}static fromDate(e){return Fe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new Fe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?ne(this.nanoseconds,e.nanoseconds):ne(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class K{constructor(e){this.timestamp=e}static fromTimestamp(e){return new K(e)}static min(){return new K(new Fe(0,0))}static max(){return new K(new Fe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ka{constructor(e,t,r){t===void 0?t=0:t>e.length&&$(),r===void 0?r=e.length-t:r>e.length-t&&$(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Ka.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ka?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),a=t.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ge extends Ka{construct(e,t,r){return new ge(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new D(b.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new ge(t)}static emptyPath(){return new ge([])}}const w2=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Le extends Ka{construct(e,t,r){return new Le(e,t,r)}static isValidIdentifier(e){return w2.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Le.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Le(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new D(b.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let a=!1;for(;i<e.length;){const l=e[i];if(l==="\\"){if(i+1===e.length)throw new D(b.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new D(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else l==="`"?(a=!a,i++):l!=="."||a?(r+=l,i++):(s(),i++)}if(s(),a)throw new D(b.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Le(t)}static emptyPath(){return new Le([])}}class F{constructor(e){this.path=e}static fromPath(e){return new F(ge.fromString(e))}static fromName(e){return new F(ge.fromString(e).popFirst(5))}static empty(){return new F(ge.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ge.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ge.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new F(new ge(e.slice()))}}class ml{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Kf(n){return n.fields.find(e=>e.kind===2)}function Ei(n){return n.fields.filter(e=>e.kind!==2)}ml.UNKNOWN_ID=-1;class ju{constructor(e,t){this.fieldPath=e,this.kind=t}}class Ha{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Ha(0,nn.min())}}function MT(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=K.fromTimestamp(r===1e9?new Fe(t+1,0):new Fe(t,r));return new nn(i,F.empty(),e)}function FT(n){return new nn(n.readTime,n.key,-1)}class nn{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new nn(K.min(),F.empty(),-1)}static max(){return new nn(K.max(),F.empty(),-1)}}function gg(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=F.comparator(n.documentKey,e.documentKey),t!==0?t:ne(n.largestBatchId,e.largestBatchId))}const UT="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class BT{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function oi(n){if(n.code!==b.FAILED_PRECONDITION||n.message!==UT)throw n;N("LocalStore","Unexpectedly lost primary lease")}class R{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&$(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new R((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof R?t:R.resolve(t)}catch(t){return R.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):R.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):R.reject(t)}static resolve(e){return new R((t,r)=>{t(e)})}static reject(e){return new R((t,r)=>{r(e)})}static waitFor(e){return new R((t,r)=>{let i=0,s=0,a=!1;e.forEach(l=>{++i,l.next(()=>{++s,a&&s===i&&t()},h=>r(h))}),a=!0,s===i&&t()})}static or(e){let t=R.resolve(!1);for(const r of e)t=t.next(i=>i?R.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new R((r,i)=>{const s=e.length,a=new Array(s);let l=0;for(let h=0;h<s;h++){const f=h;t(e[f]).next(p=>{a[f]=p,++l,l===s&&r(a)},p=>i(p))}})}static doWhile(e,t){return new R((r,i)=>{const s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}}class ah{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new ct,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new Ta(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=mg(r.target.error);this.V.reject(new Ta(e,i))}}static open(e,t,r,i){try{return new ah(t,e.transaction(i,r))}catch(s){throw new Ta(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(N("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new T2(t)}}class wn{constructor(e,t,r){this.name=e,this.version=t,this.p=r,wn.S(qe())===12.2&&Xe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N("SimpleDb","Removing database:",e),Ti(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Ca())return!1;if(wn.C())return!0;const e=qe(),t=wn.S(e),r=0<t&&t<10,i=wn.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}async O(e){return this.db||(N("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{const a=s.target.result;t(a)},i.onblocked=()=>{r(new Ta(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{const a=s.target.error;a.name==="VersionError"?r(new D(b.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new D(b.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new Ta(e,a))},i.onupgradeneeded=s=>{N("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const a=s.target.result;this.p.N(a,i.transaction,s.oldVersion,this.version).next(()=>{N("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,i){const s=t==="readonly";let a=0;for(;;){++a;try{this.db=await this.O(e);const l=ah.open(this.db,e,s?"readonly":"readwrite",r),h=i(l).next(f=>(l.g(),f)).catch(f=>(l.abort(f),R.reject(f))).toPromise();return h.catch(()=>{}),await l.m,h}catch(l){const h=l,f=h.name!=="FirebaseError"&&a<3;if(N("SimpleDb","Transaction failed with error:",h.message,"Retrying:",f),this.close(),!f)return Promise.reject(h)}}}close(){this.db&&this.db.close(),this.db=void 0}}class E2{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return Ti(this.k.delete())}}class Ta extends D{constructor(e,t){super(b.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function ai(n){return n.name==="IndexedDbTransactionError"}class T2{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(N("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Ti(r)}add(e){return N("SimpleDb","ADD",this.store.name,e,e),Ti(this.store.add(e))}get(e){return Ti(this.store.get(e)).next(t=>(t===void 0&&(t=null),N("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return N("SimpleDb","DELETE",this.store.name,e),Ti(this.store.delete(e))}count(){return N("SimpleDb","COUNT",this.store.name),Ti(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||typeof this.store.getAll!="function"){const i=this.cursor(r),s=[];return this.G(i,(a,l)=>{s.push(l)}).next(()=>s)}{const i=this.store.getAll(r.range);return new R((s,a)=>{i.onerror=l=>{a(l.target.error)},i.onsuccess=l=>{s(l.target.result)}})}}j(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new R((i,s)=>{r.onerror=a=>{s(a.target.error)},r.onsuccess=a=>{i(a.target.result)}})}H(e,t){N("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,a,l)=>l.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new R((r,i)=>{t.onerror=s=>{const a=mg(s.target.error);i(a)},t.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(l=>{l?a.continue():r()}):r()}})}G(e,t){const r=[];return new R((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const l=a.target.result;if(!l)return void i();const h=new E2(l),f=t(l.primaryKey,l.value,h);if(f instanceof R){const p=f.catch(m=>(h.done(),R.reject(m)));r.push(p)}h.isDone?i():h.$===null?l.continue():l.continue(h.$)}}).next(()=>R.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Ti(n){return new R((e,t)=>{n.onsuccess=r=>{const i=r.target.result;e(i)},n.onerror=r=>{const i=mg(r.target.error);t(i)}})}let Jv=!1;function mg(n){const e=wn.S(qe());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new D("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Jv||(Jv=!0,setTimeout(()=>{throw r},0)),r}}return n}class A2{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(e){N("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{N("IndexBackiller",`Documents written: ${await this.X.te()}`)}catch(t){ai(t)?N("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await oi(t)}await this.ee(6e4)})}}class R2{constructor(e,t){this.localStore=e,this.persistence=t}async te(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ne(t,e))}ne(e,t){const r=new Set;let i=t,s=!0;return R.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return N("IndexBackiller",`Processing collection: ${a}`),this.re(e,a,i).next(l=>{i-=l,r.add(a)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.ie(i,s)).next(l=>(N("IndexBackiller",`Updating offset: ${l}`),this.localStore.indexManager.updateCollectionGroup(e,t,l))).next(()=>a.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{const a=FT(s);gg(a,r)>0&&(r=a)}),new nn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Gt{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.se(r),this.oe=r=>t.writeSequenceNumber(r))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}Gt._e=-1;function Tc(n){return n==null}function ja(n){return n===0&&1/n==-1/0}function qT(n){return typeof n=="number"&&Number.isInteger(n)&&!ja(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function Ot(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Xv(e)),e=S2(n.get(t),e);return Xv(e)}function S2(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Xv(n){return n+""}function Un(n){const e=n.length;if(z(e>=2),e===2)return z(n.charAt(0)===""&&n.charAt(1)===""),ge.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const a=n.indexOf("",s);switch((a<0||a>t)&&$(),n.charAt(a+1)){case"":const l=n.substring(s,a);let h;i.length===0?h=l:(i+=l,h=i,i=""),r.push(h);break;case"":i+=n.substring(s,a),i+="\0";break;case"":i+=n.substring(s,a+1);break;default:$()}s=a+2}return new ge(r)}const Zv=["userId","batchId"];function Qu(n,e){return[n,Ot(e)]}function $T(n,e,t){return[n,Ot(e),t]}const b2={},P2=["prefixPath","collectionGroup","readTime","documentId"],C2=["prefixPath","collectionGroup","documentId"],k2=["collectionGroup","readTime","prefixPath","documentId"],D2=["canonicalId","targetId"],x2=["targetId","path"],N2=["path","targetId"],V2=["collectionId","parent"],O2=["indexId","uid"],L2=["uid","sequenceNumber"],M2=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],F2=["indexId","uid","orderedDocumentKey"],U2=["userId","collectionPath","documentId"],B2=["userId","collectionPath","largestBatchId"],q2=["userId","collectionGroup","largestBatchId"],WT=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],$2=[...WT,"documentOverlays"],GT=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],zT=GT,W2=[...zT,"indexConfiguration","indexState","indexEntries"];class Hf extends BT{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function ht(n,e){const t=B(n);return wn.M(t.ae,e)}function eI(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function ts(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function KT(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class Ce{constructor(e,t){this.comparator=e,this.root=t||gt.EMPTY}insert(e,t){return new Ce(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,gt.BLACK,null,null))}remove(e){return new Ce(this.comparator,this.root.remove(e,this.comparator).copy(null,null,gt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Mu(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Mu(this.root,e,this.comparator,!1)}getReverseIterator(){return new Mu(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Mu(this.root,e,this.comparator,!0)}}class Mu{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class gt{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??gt.RED,this.left=i??gt.EMPTY,this.right=s??gt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new gt(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return gt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return gt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,gt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,gt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw $();const e=this.left.check();if(e!==this.right.check())throw $();return e+(this.isRed()?0:1)}}gt.EMPTY=null,gt.RED=!0,gt.BLACK=!1;gt.EMPTY=new class{constructor(){this.size=0}get key(){throw $()}get value(){throw $()}get color(){throw $()}get left(){throw $()}get right(){throw $()}copy(e,t,r,i,s){return this}insert(e,t,r){return new gt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Se{constructor(e){this.comparator=e,this.data=new Ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new tI(this.data.getIterator())}getIteratorFrom(e){return new tI(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof Se)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Se(this.comparator);return t.data=e,t}}class tI{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ss(n){return n.hasNext()?n.getNext():void 0}class zt{constructor(e){this.fields=e,e.sort(Le.comparator)}static empty(){return new zt([])}unionWith(e){let t=new Se(Le.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new zt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return no(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class HT extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function G2(){return typeof atob<"u"}class it{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new HT("Invalid base64 string: "+s):s}}(e);return new it(t)}static fromUint8Array(e){const t=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new it(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return ne(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}it.EMPTY_BYTE_STRING=new it("");const z2=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Kr(n){if(z(!!n),typeof n=="string"){let e=0;const t=z2.exec(n);if(z(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:We(n.seconds),nanos:We(n.nanos)}}function We(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Hr(n){return typeof n=="string"?it.fromBase64String(n):it.fromUint8Array(n)}function ch(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function _g(n){const e=n.mapValue.fields.__previous_value__;return ch(e)?_g(e):e}function Qa(n){const e=Kr(n.mapValue.fields.__local_write_time__.timestampValue);return new Fe(e.seconds,e.nanos)}class K2{constructor(e,t,r,i,s,a,l,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=f}}class jr{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new jr("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof jr&&e.projectId===this.projectId&&e.database===this.database}}const Ur={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Yu={nullValue:"NULL_VALUE"};function $i(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ch(n)?4:jT(n)?9007199254740991:10:$()}function Hn(n,e){if(n===e)return!0;const t=$i(n);if(t!==$i(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Qa(n).isEqual(Qa(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=Kr(i.timestampValue),l=Kr(s.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Hr(i.bytesValue).isEqual(Hr(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return We(i.geoPointValue.latitude)===We(s.geoPointValue.latitude)&&We(i.geoPointValue.longitude)===We(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return We(i.integerValue)===We(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=We(i.doubleValue),l=We(s.doubleValue);return a===l?ja(a)===ja(l):isNaN(a)&&isNaN(l)}return!1}(n,e);case 9:return no(n.arrayValue.values||[],e.arrayValue.values||[],Hn);case 10:return function(i,s){const a=i.mapValue.fields||{},l=s.mapValue.fields||{};if(eI(a)!==eI(l))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!Hn(a[h],l[h])))return!1;return!0}(n,e);default:return $()}}function Ya(n,e){return(n.values||[]).find(t=>Hn(t,e))!==void 0}function Qr(n,e){if(n===e)return 0;const t=$i(n),r=$i(e);if(t!==r)return ne(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return ne(n.booleanValue,e.booleanValue);case 2:return function(s,a){const l=We(s.integerValue||s.doubleValue),h=We(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1}(n,e);case 3:return nI(n.timestampValue,e.timestampValue);case 4:return nI(Qa(n),Qa(e));case 5:return ne(n.stringValue,e.stringValue);case 6:return function(s,a){const l=Hr(s),h=Hr(a);return l.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(s,a){const l=s.split("/"),h=a.split("/");for(let f=0;f<l.length&&f<h.length;f++){const p=ne(l[f],h[f]);if(p!==0)return p}return ne(l.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,a){const l=ne(We(s.latitude),We(a.latitude));return l!==0?l:ne(We(s.longitude),We(a.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,a){const l=s.values||[],h=a.values||[];for(let f=0;f<l.length&&f<h.length;++f){const p=Qr(l[f],h[f]);if(p)return p}return ne(l.length,h.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,a){if(s===Ur.mapValue&&a===Ur.mapValue)return 0;if(s===Ur.mapValue)return 1;if(a===Ur.mapValue)return-1;const l=s.fields||{},h=Object.keys(l),f=a.fields||{},p=Object.keys(f);h.sort(),p.sort();for(let m=0;m<h.length&&m<p.length;++m){const I=ne(h[m],p[m]);if(I!==0)return I;const A=Qr(l[h[m]],f[p[m]]);if(A!==0)return A}return ne(h.length,p.length)}(n.mapValue,e.mapValue);default:throw $()}}function nI(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return ne(n,e);const t=Kr(n),r=Kr(e),i=ne(t.seconds,r.seconds);return i!==0?i:ne(t.nanos,r.nanos)}function ro(n){return jf(n)}function jf(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Kr(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Hr(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return F.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=jf(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${jf(t.fields[a])}`;return i+"}"}(n.mapValue):$()}function Wi(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Qf(n){return!!n&&"integerValue"in n}function Ja(n){return!!n&&"arrayValue"in n}function rI(n){return!!n&&"nullValue"in n}function iI(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ju(n){return!!n&&"mapValue"in n}function Aa(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return ts(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Aa(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Aa(n.arrayValue.values[t]);return e}return Object.assign({},n)}function jT(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function H2(n){return"nullValue"in n?Yu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Wi(jr.empty(),F.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:$()}function j2(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Wi(jr.empty(),F.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Ur:$()}function sI(n,e){const t=Qr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function oI(n,e){const t=Qr(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class yt{constructor(e){this.value=e}static empty(){return new yt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ju(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Aa(t)}setAll(e){let t=Le.emptyPath(),r={},i=[];e.forEach((a,l)=>{if(!t.isImmediateParentOf(l)){const h=this.getFieldsMap(t);this.applyChanges(h,r,i),r={},i=[],t=l.popLast()}a?r[l.lastSegment()]=Aa(a):i.push(l.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Ju(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Hn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ju(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){ts(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new yt(Aa(this.value))}}function QT(n){const e=[];return ts(n.fields,(t,r)=>{const i=new Le([t]);if(Ju(r)){const s=QT(r.mapValue).fields;if(s.length===0)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new zt(e)}class Ne{constructor(e,t,r,i,s,a,l){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=l}static newInvalidDocument(e){return new Ne(e,0,K.min(),K.min(),K.min(),yt.empty(),0)}static newFoundDocument(e,t,r,i){return new Ne(e,1,t,K.min(),r,i,0)}static newNoDocument(e,t){return new Ne(e,2,t,K.min(),K.min(),yt.empty(),0)}static newUnknownDocument(e,t){return new Ne(e,3,t,K.min(),K.min(),yt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(K.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=yt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=yt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=K.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Ne&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ne(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Yr{constructor(e,t){this.position=e,this.inclusive=t}}function aI(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],a=n.position[i];if(s.field.isKeyField()?r=F.comparator(F.fromName(a.referenceValue),t.key):r=Qr(a,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function cI(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Hn(n.position[t],e.position[t]))return!1;return!0}class Xa{constructor(e,t="asc"){this.field=e,this.dir=t}}function Q2(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class YT{}class he extends YT{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Y2(e,t,r):t==="array-contains"?new Z2(e,r):t==="in"?new nA(e,r):t==="not-in"?new eU(e,r):t==="array-contains-any"?new tU(e,r):new he(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new J2(e,r):new X2(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Qr(t,this.value)):t!==null&&$i(this.value)===$i(t)&&this.matchesComparison(Qr(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return $()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Te extends YT{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new Te(e,t)}matches(e){return io(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function io(n){return n.op==="and"}function Yf(n){return n.op==="or"}function yg(n){return JT(n)&&io(n)}function JT(n){for(const e of n.filters)if(e instanceof Te)return!1;return!0}function Jf(n){if(n instanceof he)return n.field.canonicalString()+n.op.toString()+ro(n.value);if(yg(n))return n.filters.map(e=>Jf(e)).join(",");{const e=n.filters.map(t=>Jf(t)).join(",");return`${n.op}(${e})`}}function XT(n,e){return n instanceof he?function(r,i){return i instanceof he&&r.op===i.op&&r.field.isEqual(i.field)&&Hn(r.value,i.value)}(n,e):n instanceof Te?function(r,i){return i instanceof Te&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,l)=>s&&XT(a,i.filters[l]),!0):!1}(n,e):void $()}function ZT(n,e){const t=n.filters.concat(e);return Te.create(t,n.op)}function eA(n){return n instanceof he?function(t){return`${t.field.canonicalString()} ${t.op} ${ro(t.value)}`}(n):n instanceof Te?function(t){return t.op.toString()+" {"+t.getFilters().map(eA).join(" ,")+"}"}(n):"Filter"}class Y2 extends he{constructor(e,t,r){super(e,t,r),this.key=F.fromName(r.referenceValue)}matches(e){const t=F.comparator(e.key,this.key);return this.matchesComparison(t)}}class J2 extends he{constructor(e,t){super(e,"in",t),this.keys=tA("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class X2 extends he{constructor(e,t){super(e,"not-in",t),this.keys=tA("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function tA(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>F.fromName(r.referenceValue))}class Z2 extends he{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ja(t)&&Ya(t.arrayValue,this.value)}}class nA extends he{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Ya(this.value.arrayValue,t)}}class eU extends he{constructor(e,t){super(e,"not-in",t)}matches(e){if(Ya(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Ya(this.value.arrayValue,t)}}class tU extends he{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ja(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Ya(this.value.arrayValue,r))}}class nU{constructor(e,t=null,r=[],i=[],s=null,a=null,l=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=l,this.ce=null}}function Xf(n,e=null,t=[],r=[],i=null,s=null,a=null){return new nU(n,e,t,r,i,s,a)}function Gi(n){const e=B(n);if(e.ce===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Jf(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Tc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ro(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ro(r)).join(",")),e.ce=t}return e.ce}function Ac(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Q2(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!XT(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!cI(n.startAt,e.startAt)&&cI(n.endAt,e.endAt)}function _l(n){return F.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function yl(n,e){return n.filters.filter(t=>t instanceof he&&t.field.isEqual(e))}function uI(n,e,t){let r=Yu,i=!0;for(const s of yl(n,e)){let a=Yu,l=!0;switch(s.op){case"<":case"<=":a=H2(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,l=!1;break;case"!=":case"not-in":a=Yu}sI({value:r,inclusive:i},{value:a,inclusive:l})<0&&(r=a,i=l)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];sI({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function lI(n,e,t){let r=Ur,i=!0;for(const s of yl(n,e)){let a=Ur,l=!0;switch(s.op){case">=":case">":a=j2(s.value),l=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,l=!1;break;case"!=":case"not-in":a=Ur}oI({value:r,inclusive:i},{value:a,inclusive:l})>0&&(r=a,i=l)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const a=t.position[s];oI({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}class yr{constructor(e,t=null,r=[],i=[],s=null,a="F",l=null,h=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=l,this.endAt=h,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function rA(n,e,t,r,i,s,a,l){return new yr(n,e,t,r,i,s,a,l)}function To(n){return new yr(n)}function hI(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function vg(n){return n.collectionGroup!==null}function Hs(n){const e=B(n);if(e.le===null){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new Se(Le.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(f=>{f.isInequality()&&(l=l.add(f.field))})}),l})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new Xa(s,r))}),t.has(Le.keyField().canonicalString())||e.le.push(new Xa(Le.keyField(),r))}return e.le}function Lt(n){const e=B(n);return e.he||(e.he=rU(e,Hs(n))),e.he}function rU(n,e){if(n.limitType==="F")return Xf(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new Xa(i.field,s)});const t=n.endAt?new Yr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Yr(n.startAt.position,n.startAt.inclusive):null;return Xf(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Zf(n,e){const t=n.filters.concat([e]);return new yr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function vl(n,e,t){return new yr(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Rc(n,e){return Ac(Lt(n),Lt(e))&&n.limitType===e.limitType}function iA(n){return`${Gi(Lt(n))}|lt:${n.limitType}`}function Ns(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>eA(i)).join(", ")}]`),Tc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>ro(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>ro(i)).join(",")),`Target(${r})`}(Lt(n))}; limitType=${n.limitType})`}function Sc(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):F.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of Hs(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(a,l,h){const f=aI(a,l,h);return a.inclusive?f<=0:f<0}(r.startAt,Hs(r),i)||r.endAt&&!function(a,l,h){const f=aI(a,l,h);return a.inclusive?f>=0:f>0}(r.endAt,Hs(r),i))}(n,e)}function sA(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function oA(n){return(e,t)=>{let r=!1;for(const i of Hs(n)){const s=iU(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function iU(n,e,t){const r=n.field.isKeyField()?F.comparator(e.key,t.key):function(s,a,l){const h=a.data.field(s),f=l.data.field(s);return h!==null&&f!==null?Qr(h,f):$()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return $()}}class ci{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){ts(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return KT(this.inner)}size(){return this.innerSize}}const sU=new Ce(F.comparator);function Kt(){return sU}const aA=new Ce(F.comparator);function ga(...n){let e=aA;for(const t of n)e=e.insert(t.key,t);return e}function cA(n){let e=aA;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Bn(){return Ra()}function uA(){return Ra()}function Ra(){return new ci(n=>n.toString(),(n,e)=>n.isEqual(e))}const oU=new Ce(F.comparator),aU=new Se(F.comparator);function re(...n){let e=aU;for(const t of n)e=e.add(t);return e}const cU=new Se(ne);function Ig(){return cU}function lA(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ja(e)?"-0":e}}function hA(n){return{integerValue:""+n}}function dA(n,e){return qT(e)?hA(e):lA(n,e)}class uh{constructor(){this._=void 0}}function uU(n,e,t){return n instanceof so?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ch(s)&&(s=_g(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(t,e):n instanceof zi?pA(n,e):n instanceof Ki?gA(n,e):function(i,s){const a=fA(i,s),l=dI(a)+dI(i.Ie);return Qf(a)&&Qf(i.Ie)?hA(l):lA(i.serializer,l)}(n,e)}function lU(n,e,t){return n instanceof zi?pA(n,e):n instanceof Ki?gA(n,e):t}function fA(n,e){return n instanceof oo?function(r){return Qf(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class so extends uh{}class zi extends uh{constructor(e){super(),this.elements=e}}function pA(n,e){const t=mA(e);for(const r of n.elements)t.some(i=>Hn(i,r))||t.push(r);return{arrayValue:{values:t}}}class Ki extends uh{constructor(e){super(),this.elements=e}}function gA(n,e){let t=mA(e);for(const r of n.elements)t=t.filter(i=>!Hn(i,r));return{arrayValue:{values:t}}}class oo extends uh{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function dI(n){return We(n.integerValue||n.doubleValue)}function mA(n){return Ja(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class bc{constructor(e,t){this.field=e,this.transform=t}}function hU(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof zi&&i instanceof zi||r instanceof Ki&&i instanceof Ki?no(r.elements,i.elements,Hn):r instanceof oo&&i instanceof oo?Hn(r.Ie,i.Ie):r instanceof so&&i instanceof so}(n.transform,e.transform)}class dU{constructor(e,t){this.version=e,this.transformResults=t}}class Me{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Me}static exists(e){return new Me(void 0,e)}static updateTime(e){return new Me(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Xu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class lh{}function _A(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Ro(n.key,Me.none()):new Ao(n.key,n.data,Me.none());{const t=n.data,r=yt.empty();let i=new Se(Le.comparator);for(let s of e.fields)if(!i.has(s)){let a=t.field(s);a===null&&s.length>1&&(s=s.popLast(),a=t.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new vr(n.key,r,new zt(i.toArray()),Me.none())}}function fU(n,e,t){n instanceof Ao?function(i,s,a){const l=i.value.clone(),h=pI(i.fieldTransforms,s,a.transformResults);l.setAll(h),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(n,e,t):n instanceof vr?function(i,s,a){if(!Xu(i.precondition,s))return void s.convertToUnknownDocument(a.version);const l=pI(i.fieldTransforms,s,a.transformResults),h=s.data;h.setAll(yA(i)),h.setAll(l),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(n,e,t):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,t)}function Sa(n,e,t,r){return n instanceof Ao?function(s,a,l,h){if(!Xu(s.precondition,a))return l;const f=s.value.clone(),p=gI(s.fieldTransforms,h,a);return f.setAll(p),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof vr?function(s,a,l,h){if(!Xu(s.precondition,a))return l;const f=gI(s.fieldTransforms,h,a),p=a.data;return p.setAll(yA(s)),p.setAll(f),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),l===null?null:l.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(m=>m.field))}(n,e,t,r):function(s,a,l){return Xu(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l}(n,e,t)}function pU(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=fA(r.transform,i||null);s!=null&&(t===null&&(t=yt.empty()),t.set(r.field,s))}return t||null}function fI(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&no(r,i,(s,a)=>hU(s,a))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ao extends lh{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class vr extends lh{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function yA(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function pI(n,e,t){const r=new Map;z(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],a=s.transform,l=e.data.field(s.field);r.set(s.field,lU(a,l,t[i]))}return r}function gI(n,e,t){const r=new Map;for(const i of n){const s=i.transform,a=t.data.field(i.field);r.set(i.field,uU(s,a,e))}return r}class Ro extends lh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class wg extends lh{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Eg{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&fU(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Sa(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Sa(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=uA();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let l=this.applyToLocalView(a,s.mutatedFields);l=t.has(i.key)?null:l;const h=_A(a,l);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(K.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),re())}isEqual(e){return this.batchId===e.batchId&&no(this.mutations,e.mutations,(t,r)=>fI(t,r))&&no(this.baseMutations,e.baseMutations,(t,r)=>fI(t,r))}}class Tg{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){z(e.mutations.length===r.length);let i=function(){return oU}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new Tg(e,t,r,i)}}class Ag{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class gU{constructor(e,t){this.count=e,this.unchangedNames=t}}var et,pe;function vA(n){switch(n){default:return $();case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0}}function IA(n){if(n===void 0)return Xe("GRPC error has no .code"),b.UNKNOWN;switch(n){case et.OK:return b.OK;case et.CANCELLED:return b.CANCELLED;case et.UNKNOWN:return b.UNKNOWN;case et.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case et.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case et.INTERNAL:return b.INTERNAL;case et.UNAVAILABLE:return b.UNAVAILABLE;case et.UNAUTHENTICATED:return b.UNAUTHENTICATED;case et.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case et.NOT_FOUND:return b.NOT_FOUND;case et.ALREADY_EXISTS:return b.ALREADY_EXISTS;case et.PERMISSION_DENIED:return b.PERMISSION_DENIED;case et.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case et.ABORTED:return b.ABORTED;case et.OUT_OF_RANGE:return b.OUT_OF_RANGE;case et.UNIMPLEMENTED:return b.UNIMPLEMENTED;case et.DATA_LOSS:return b.DATA_LOSS;default:return $()}}(pe=et||(et={}))[pe.OK=0]="OK",pe[pe.CANCELLED=1]="CANCELLED",pe[pe.UNKNOWN=2]="UNKNOWN",pe[pe.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",pe[pe.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",pe[pe.NOT_FOUND=5]="NOT_FOUND",pe[pe.ALREADY_EXISTS=6]="ALREADY_EXISTS",pe[pe.PERMISSION_DENIED=7]="PERMISSION_DENIED",pe[pe.UNAUTHENTICATED=16]="UNAUTHENTICATED",pe[pe.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",pe[pe.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",pe[pe.ABORTED=10]="ABORTED",pe[pe.OUT_OF_RANGE=11]="OUT_OF_RANGE",pe[pe.UNIMPLEMENTED=12]="UNIMPLEMENTED",pe[pe.INTERNAL=13]="INTERNAL",pe[pe.UNAVAILABLE=14]="UNAVAILABLE",pe[pe.DATA_LOSS=15]="DATA_LOSS";function wA(){return new TextEncoder}const mU=new Ks([4294967295,4294967295],0);function mI(n){const e=wA().encode(n),t=new l2;return t.update(e),new Uint8Array(t.digest())}function _I(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Ks([t,r],0),new Ks([i,s],0)]}class Rg{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ma(`Invalid padding: ${t}`);if(r<0)throw new ma(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ma(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ma(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=Ks.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(Ks.fromNumber(r)));return i.compare(mU)===1&&(i=new Ks([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const t=mI(e),[r,i]=_I(t);for(let s=0;s<this.hashCount;s++){const a=this.de(r,i,s);if(!this.Ae(a))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new Rg(s,i,t);return r.forEach(l=>a.insert(l)),a}insert(e){if(this.Te===0)return;const t=mI(e),[r,i]=_I(t);for(let s=0;s<this.hashCount;s++){const a=this.de(r,i,s);this.Re(a)}}Re(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class ma extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Pc{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Cc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Pc(K.min(),i,new Ce(ne),Kt(),re())}}class Cc{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Cc(r,t,re(),re(),re())}}class Zu{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class EA{constructor(e,t){this.targetId=e,this.fe=t}}class TA{constructor(e,t,r=it.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class yI{constructor(){this.ge=0,this.pe=II(),this.ye=it.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=re(),t=re(),r=re();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:$()}}),new Cc(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=II()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,z(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class _U{constructor(e){this.Le=e,this.ke=new Map,this.qe=Kt(),this.Qe=vI(),this.Ke=new Ce(ne)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:$()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(_l(s))if(r===0){const a=new F(s.path);this.We(t,a,Ne.newNoDocument(a,K.min()))}else z(r===1);else{const a=this.Ze(t);if(a!==r){const l=this.Xe(e),h=l?this.et(l,e,a):1;if(h!==0){this.He(t);const f=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,f)}}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let a,l;try{a=Hr(r).toUint8Array()}catch(h){if(h instanceof HT)return An("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new Rg(a,i,s)}catch(h){return An(h instanceof ma?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.Te===0?null:l}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const a=this.Le.nt(),l=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(l)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,a)=>{const l=this.Ye(a);if(l){if(s.current&&_l(l.target)){const h=new F(l.target.path);this.qe.get(h)!==null||this.st(a,h)||this.We(a,h,Ne.newNoDocument(h,e))}s.De&&(t.set(a,s.ve()),s.Fe())}});let r=re();this.Qe.forEach((s,a)=>{let l=!0;a.forEachWhile(h=>{const f=this.Ye(h);return!f||f.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)}),l&&(r=r.add(s))}),this.qe.forEach((s,a)=>a.setReadTime(e));const i=new Pc(e,t,this.Ke,this.qe,r);return this.qe=Kt(),this.Qe=vI(),this.Ke=new Ce(ne),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new yI,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new Se(ne),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=this.Ye(e)!==null;return t||N("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new yI),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function vI(){return new Ce(F.comparator)}function II(){return new Ce(F.comparator)}const yU=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),vU=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),IU=(()=>({and:"AND",or:"OR"}))();class wU{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ep(n,e){return n.useProto3Json||Tc(e)?e:{value:e}}function ao(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function AA(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function EU(n,e){return ao(n,e.toTimestamp())}function Ze(n){return z(!!n),K.fromTimestamp(function(t){const r=Kr(t);return new Fe(r.seconds,r.nanos)}(n))}function Sg(n,e){return function(r){return new ge(["projects",r.projectId,"databases",r.database])}(n).child("documents").child(e).canonicalString()}function RA(n){const e=ge.fromString(n);return z(VA(e)),e}function Za(n,e){return Sg(n.databaseId,e.path)}function Wn(n,e){const t=RA(e);if(t.get(1)!==n.databaseId.projectId)throw new D(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new D(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new F(bA(t))}function tp(n,e){return Sg(n.databaseId,e)}function SA(n){const e=RA(n);return e.length===4?ge.emptyPath():bA(e)}function ec(n){return new ge(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function bA(n){return z(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function wI(n,e,t){return{name:Za(n,e),fields:t.value.mapValue.fields}}function PA(n,e,t){const r=Wn(n,e.name),i=Ze(e.updateTime),s=e.createTime?Ze(e.createTime):K.min(),a=new yt({mapValue:{fields:e.fields}}),l=Ne.newFoundDocument(r,i,s,a);return t&&l.setHasCommittedMutations(),t?l.setHasCommittedMutations():l}function TU(n,e){return"found"in e?function(r,i){z(!!i.found),i.found.name,i.found.updateTime;const s=Wn(r,i.found.name),a=Ze(i.found.updateTime),l=i.found.createTime?Ze(i.found.createTime):K.min(),h=new yt({mapValue:{fields:i.found.fields}});return Ne.newFoundDocument(s,a,l,h)}(n,e):"missing"in e?function(r,i){z(!!i.missing),z(!!i.readTime);const s=Wn(r,i.missing),a=Ze(i.readTime);return Ne.newNoDocument(s,a)}(n,e):$()}function AU(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(f){return f==="NO_CHANGE"?0:f==="ADD"?1:f==="REMOVE"?2:f==="CURRENT"?3:f==="RESET"?4:$()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(f,p){return f.useProto3Json?(z(p===void 0||typeof p=="string"),it.fromBase64String(p||"")):(z(p===void 0||p instanceof Uint8Array),it.fromUint8Array(p||new Uint8Array))}(n,e.targetChange.resumeToken),a=e.targetChange.cause,l=a&&function(f){const p=f.code===void 0?b.UNKNOWN:IA(f.code);return new D(p,f.message||"")}(a);t=new TA(r,i,s,l||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Wn(n,r.document.name),s=Ze(r.document.updateTime),a=r.document.createTime?Ze(r.document.createTime):K.min(),l=new yt({mapValue:{fields:r.document.fields}}),h=Ne.newFoundDocument(i,s,a,l),f=r.targetIds||[],p=r.removedTargetIds||[];t=new Zu(f,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Wn(n,r.document),s=r.readTime?Ze(r.readTime):K.min(),a=Ne.newNoDocument(i,s),l=r.removedTargetIds||[];t=new Zu([],l,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Wn(n,r.document),s=r.removedTargetIds||[];t=new Zu([],s,i,null)}else{if(!("filter"in e))return $();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,a=new gU(i,s),l=r.targetId;t=new EA(l,a)}}return t}function tc(n,e){let t;if(e instanceof Ao)t={update:wI(n,e.key,e.value)};else if(e instanceof Ro)t={delete:Za(n,e.key)};else if(e instanceof vr)t={update:wI(n,e.key,e.data),updateMask:kU(e.fieldMask)};else{if(!(e instanceof wg))return $();t={verify:Za(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,a){const l=a.transform;if(l instanceof so)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof zi)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Ki)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof oo)return{fieldPath:a.field.canonicalString(),increment:l.Ie};throw $()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:EU(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:$()}(n,e.precondition)),t}function np(n,e){const t=e.currentDocument?function(s){return s.updateTime!==void 0?Me.updateTime(Ze(s.updateTime)):s.exists!==void 0?Me.exists(s.exists):Me.none()}(e.currentDocument):Me.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(a,l){let h=null;if("setToServerValue"in l)z(l.setToServerValue==="REQUEST_TIME"),h=new so;else if("appendMissingElements"in l){const p=l.appendMissingElements.values||[];h=new zi(p)}else if("removeAllFromArray"in l){const p=l.removeAllFromArray.values||[];h=new Ki(p)}else"increment"in l?h=new oo(a,l.increment):$();const f=Le.fromServerFormat(l.fieldPath);return new bc(f,h)}(n,i)):[];if(e.update){e.update.name;const i=Wn(n,e.update.name),s=new yt({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(h){const f=h.fieldPaths||[];return new zt(f.map(p=>Le.fromServerFormat(p)))}(e.updateMask);return new vr(i,s,a,t,r)}return new Ao(i,s,t,r)}if(e.delete){const i=Wn(n,e.delete);return new Ro(i,t)}if(e.verify){const i=Wn(n,e.verify);return new wg(i,t)}return $()}function RU(n,e){return n&&n.length>0?(z(e!==void 0),n.map(t=>function(i,s){let a=i.updateTime?Ze(i.updateTime):Ze(s);return a.isEqual(K.min())&&(a=Ze(s)),new dU(a,i.transformResults||[])}(t,e))):[]}function CA(n,e){return{documents:[tp(n,e.path)]}}function kA(n,e){const t={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(t.parent=tp(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=tp(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(h){if(h.length!==0)return NA(Te.create(h,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(h){if(h.length!==0)return h.map(f=>function(m){return{field:Vs(m.field),direction:bU(m.dir)}}(f))}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const a=ep(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(h){return{before:h.inclusive,values:h.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(h){return{before:!h.inclusive,values:h.position}}(e.endAt)),t}function DA(n){let e=SA(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){z(r===1);const p=t.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let s=[];t.where&&(s=function(m){const I=xA(m);return I instanceof Te&&yg(I)?I.getFilters():[I]}(t.where));let a=[];t.orderBy&&(a=function(m){return m.map(I=>function(L){return new Xa(Os(L.field),function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(L.direction))}(I))}(t.orderBy));let l=null;t.limit&&(l=function(m){let I;return I=typeof m=="object"?m.value:m,Tc(I)?null:I}(t.limit));let h=null;t.startAt&&(h=function(m){const I=!!m.before,A=m.values||[];return new Yr(A,I)}(t.startAt));let f=null;return t.endAt&&(f=function(m){const I=!m.before,A=m.values||[];return new Yr(A,I)}(t.endAt)),rA(e,i,a,s,l,"F",h,f)}function SU(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function xA(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Os(t.unaryFilter.field);return he.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=Os(t.unaryFilter.field);return he.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Os(t.unaryFilter.field);return he.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Os(t.unaryFilter.field);return he.create(a,"!=",{nullValue:"NULL_VALUE"});default:return $()}}(n):n.fieldFilter!==void 0?function(t){return he.create(Os(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return $()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Te.create(t.compositeFilter.filters.map(r=>xA(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return $()}}(t.compositeFilter.op))}(n):$()}function bU(n){return yU[n]}function PU(n){return vU[n]}function CU(n){return IU[n]}function Vs(n){return{fieldPath:n.canonicalString()}}function Os(n){return Le.fromServerFormat(n.fieldPath)}function NA(n){return n instanceof he?function(t){if(t.op==="=="){if(iI(t.value))return{unaryFilter:{field:Vs(t.field),op:"IS_NAN"}};if(rI(t.value))return{unaryFilter:{field:Vs(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(iI(t.value))return{unaryFilter:{field:Vs(t.field),op:"IS_NOT_NAN"}};if(rI(t.value))return{unaryFilter:{field:Vs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Vs(t.field),op:PU(t.op),value:t.value}}}(n):n instanceof Te?function(t){const r=t.getFilters().map(i=>NA(i));return r.length===1?r[0]:{compositeFilter:{op:CU(t.op),filters:r}}}(n):$()}function kU(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function VA(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class cr{constructor(e,t,r,i,s=K.min(),a=K.min(),l=it.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(e){return new cr(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new cr(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new cr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new cr(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class OA{constructor(e){this.ut=e}}function DU(n,e){let t;if(e.document)t=PA(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=F.fromSegments(e.noDocument.path),i=ji(e.noDocument.readTime);t=Ne.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return $();{const r=F.fromSegments(e.unknownDocument.path),i=ji(e.unknownDocument.version);t=Ne.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new Fe(i[0],i[1]);return K.fromTimestamp(s)}(e.readTime)),t}function EI(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Il(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,a){return{name:Za(s,a.key),fields:a.data.value.mapValue.fields,updateTime:ao(s,a.version.toTimestamp()),createTime:ao(s,a.createTime.toTimestamp())}}(n.ut,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Hi(e.version)};else{if(!e.isUnknownDocument())return $();r.unknownDocument={path:t.path.toArray(),version:Hi(e.version)}}return r}function Il(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Hi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ji(n){const e=new Fe(n.seconds,n.nanoseconds);return K.fromTimestamp(e)}function Ai(n,e){const t=(e.baseMutations||[]).map(s=>np(n.ut,s));for(let s=0;s<e.mutations.length-1;++s){const a=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const l=e.mutations[s+1];a.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(s=>np(n.ut,s)),i=Fe.fromMillis(e.localWriteTimeMs);return new Eg(e.batchId,i,t,r)}function _a(n){const e=ji(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?ji(n.lastLimboFreeSnapshotVersion):K.min();let r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return z(s.documents.length===1),Lt(To(SA(s.documents[0])))}(n.query):function(s){return Lt(DA(s))}(n.query),new cr(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,it.fromBase64String(n.resumeToken))}function LA(n,e){const t=Hi(e.snapshotVersion),r=Hi(e.lastLimboFreeSnapshotVersion);let i;i=_l(e.target)?CA(n.ut,e.target):kA(n.ut,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Gi(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function bg(n){const e=DA({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?vl(e,e.limit,"L"):e}function mf(n,e){return new Ag(e.largestBatchId,np(n.ut,e.overlayMutation))}function TI(n,e){const t=e.path.lastSegment();return[n,Ot(e.path.popLast()),t]}function AI(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Hi(r.readTime),documentKey:Ot(r.documentKey.path),largestBatchId:r.largestBatchId}}class xU{getBundleMetadata(e,t){return RI(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:ji(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return RI(e).put(function(i){return{bundleId:i.id,createTime:Hi(Ze(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return SI(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:bg(s.bundledQuery),readTime:ji(s.readTime)}}(r)})}saveNamedQuery(e,t){return SI(e).put(function(i){return{name:i.name,readTime:Hi(Ze(i.readTime)),bundledQuery:i.bundledQuery}}(t))}}function RI(n){return ht(n,"bundles")}function SI(n){return ht(n,"namedQueries")}class hh{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){const r=t.uid||"";return new hh(e,r)}getOverlay(e,t){return ra(e).get(TI(this.userId,t)).next(r=>r?mf(this.serializer,r):null)}getOverlays(e,t){const r=Bn();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,a)=>{const l=new Ag(t,a);i.push(this.lt(e,l))}),R.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(a=>i.add(Ot(a.getCollectionPath())));const s=[];return i.forEach(a=>{const l=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);s.push(ra(e).H("collectionPathOverlayIndex",l))}),R.waitFor(s)}getOverlaysForCollection(e,t,r){const i=Bn(),s=Ot(t),a=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return ra(e).W("collectionPathOverlayIndex",a).next(l=>{for(const h of l){const f=mf(this.serializer,h);i.set(f.getKey(),f)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=Bn();let a;const l=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return ra(e).Y({index:"collectionGroupOverlayIndex",range:l},(h,f,p)=>{const m=mf(this.serializer,f);s.size()<i||m.largestBatchId===a?(s.set(m.getKey(),m),a=m.largestBatchId):p.done()}).next(()=>s)}lt(e,t){return ra(e).put(function(i,s,a){const[l,h,f]=TI(s,a.mutation.key);return{userId:s,collectionPath:h,documentId:f,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:tc(i.ut,a.mutation)}}(this.serializer,this.userId,t))}}function ra(n){return ht(n,"documentOverlays")}class Ri{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(We(e.integerValue));else if("doubleValue"in e){const r=We(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),ja(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Tt(t,20),typeof r=="string"?t.dt(r):(t.dt(`${r.seconds||""}`),t.Et(r.nanos||0))}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(Hr(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?jT(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):$()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),F.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}Ri.St=new Ri;function NU(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function bI(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const a=NU(255&r[s]);if(i+=a,a!==8)break}return i}(n);return Math.ceil(e/8)}class VU{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Bt(e),r=bI(t);this.Lt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Bt(e),r=bI(t);this.Lt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Lt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;t===0?(this.Qt(0),this.Qt(255)):t===255?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;t===0?(this.$t(0),this.$t(255)):t===255?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Lt(1),this.buffer[this.position++]=e}$t(e){this.Lt(1),this.buffer[this.position++]=~e}Lt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class OU{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class LU{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class ia{constructor(){this.Wt=new VU,this.Gt=new OU(this.Wt),this.zt=new LU(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return e===0?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class Si{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Si(this.indexId,this.documentKey,this.arrayValue,r)}}function xr(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=PI(n.arrayValue,e.arrayValue),t!==0?t:(t=PI(n.directionalValue,e.directionalValue),t!==0?t:F.comparator(n.documentKey,e.documentKey)))}function PI(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}class CI{constructor(e){this.Jt=new Se((t,r)=>Le.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(z(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=Kf(e);if(t!==void 0&&!this.tn(t))return!1;const r=Ei(e);let i=new Set,s=0,a=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const l=this.Jt.getIterator().getNext();if(!i.has(l.field.canonicalString())){const h=r[s];if(!this.nn(l,h)||!this.rn(this.Yt[a++],h))return!1}++s}for(;s<r.length;++s){const l=r[s];if(a>=this.Yt.length||!this.rn(this.Yt[a++],l))return!1}return!0}sn(){if(this.Xt)return null;let e=new Se(Le.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new ju(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ju(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ju(r.field,r.dir==="asc"?0:1)));return new ml(ml.UNKNOWN_ID,this.collectionId,t,Ha.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function MA(n){var e,t;if(z(n instanceof he||n instanceof Te),n instanceof he){if(n instanceof nA){const i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>he.create(n.field,"==",s)))||[];return Te.create(i,"or")}return n}const r=n.filters.map(i=>MA(i));return Te.create(r,n.op)}function MU(n){if(n.getFilters().length===0)return[];const e=sp(MA(n));return z(FA(e)),rp(e)||ip(e)?[e]:e.getFilters()}function rp(n){return n instanceof he}function ip(n){return n instanceof Te&&yg(n)}function FA(n){return rp(n)||ip(n)||function(t){if(t instanceof Te&&Yf(t)){for(const r of t.getFilters())if(!rp(r)&&!ip(r))return!1;return!0}return!1}(n)}function sp(n){if(z(n instanceof he||n instanceof Te),n instanceof he)return n;if(n.filters.length===1)return sp(n.filters[0]);const e=n.filters.map(r=>sp(r));let t=Te.create(e,n.op);return t=wl(t),FA(t)?t:(z(t instanceof Te),z(io(t)),z(t.filters.length>1),t.filters.reduce((r,i)=>Pg(r,i)))}function Pg(n,e){let t;return z(n instanceof he||n instanceof Te),z(e instanceof he||e instanceof Te),t=n instanceof he?e instanceof he?function(i,s){return Te.create([i,s],"and")}(n,e):kI(n,e):e instanceof he?kI(e,n):function(i,s){if(z(i.filters.length>0&&s.filters.length>0),io(i)&&io(s))return ZT(i,s.getFilters());const a=Yf(i)?i:s,l=Yf(i)?s:i,h=a.filters.map(f=>Pg(f,l));return Te.create(h,"or")}(n,e),wl(t)}function kI(n,e){if(io(e))return ZT(e,n.getFilters());{const t=e.filters.map(r=>Pg(n,r));return Te.create(t,"or")}}function wl(n){if(z(n instanceof he||n instanceof Te),n instanceof he)return n;const e=n.getFilters();if(e.length===1)return wl(e[0]);if(JT(n))return n;const t=e.map(i=>wl(i)),r=[];return t.forEach(i=>{i instanceof he?r.push(i):i instanceof Te&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:Te.create(r,n.op)}class FU{constructor(){this.on=new Cg}addToCollectionParentIndex(e,t){return this.on.add(t),R.resolve()}getCollectionParents(e,t){return R.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return R.resolve()}deleteFieldIndex(e,t){return R.resolve()}deleteAllFieldIndexes(e){return R.resolve()}createTargetIndexes(e,t){return R.resolve()}getDocumentsMatchingTarget(e,t){return R.resolve(null)}getIndexType(e,t){return R.resolve(0)}getFieldIndexes(e,t){return R.resolve([])}getNextCollectionGroupToUpdate(e){return R.resolve(null)}getMinOffset(e,t){return R.resolve(nn.min())}getMinOffsetFromCollectionGroup(e,t){return R.resolve(nn.min())}updateCollectionGroup(e,t,r){return R.resolve()}updateIndexEntries(e,t){return R.resolve()}}class Cg{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Se(ge.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Se(ge.comparator)).toArray()}}const Fu=new Uint8Array(0);class UU{constructor(e,t){this.user=e,this.databaseId=t,this._n=new Cg,this.an=new ci(r=>Gi(r),(r,i)=>Ac(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:Ot(i)};return DI(e).put(s)}return R.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[LT(t),""],!1,!0);return DI(e).W(i).next(s=>{for(const a of s){if(a.collectionId!==t)break;r.push(Un(a.parent))}return r})}addFieldIndex(e,t){const r=sa(e),i=function(l){return{indexId:l.indexId,collectionGroup:l.collectionGroup,fields:l.fields.map(h=>[h.fieldPath.canonicalString(),h.kind])}}(t);delete i.indexId;const s=r.add(i);if(t.indexState){const a=Ps(e);return s.next(l=>{a.put(AI(l,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=sa(e),i=Ps(e),s=bs(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=sa(e),r=bs(e),i=Ps(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return R.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){const s=new CI(r).sn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=bs(e);let i=!0;const s=new Map;return R.forEach(this.un(t),a=>this.cn(e,a).next(l=>{i&&(i=!!l),s.set(a,l)})).next(()=>{if(i){let a=re();const l=[];return R.forEach(s,(h,f)=>{N("IndexedDbIndexManager",`Using index ${function(j){return`id=${j.indexId}|cg=${j.collectionGroup}|f=${j.fields.map(ye=>`${ye.fieldPath}:${ye.kind}`).join(",")}`}(h)} to execute ${Gi(t)}`);const p=function(j,ye){const de=Kf(ye);if(de===void 0)return null;for(const me of yl(j,de.fieldPath))switch(me.op){case"array-contains-any":return me.value.arrayValue.values||[];case"array-contains":return[me.value]}return null}(f,h),m=function(j,ye){const de=new Map;for(const me of Ei(ye))for(const we of yl(j,me.fieldPath))switch(we.op){case"==":case"in":de.set(me.fieldPath.canonicalString(),we.value);break;case"not-in":case"!=":return de.set(me.fieldPath.canonicalString(),we.value),Array.from(de.values())}return null}(f,h),I=function(j,ye){const de=[];let me=!0;for(const we of Ei(ye)){const Mt=we.kind===0?uI(j,we.fieldPath,j.startAt):lI(j,we.fieldPath,j.startAt);de.push(Mt.value),me&&(me=Mt.inclusive)}return new Yr(de,me)}(f,h),A=function(j,ye){const de=[];let me=!0;for(const we of Ei(ye)){const Mt=we.kind===0?lI(j,we.fieldPath,j.endAt):uI(j,we.fieldPath,j.endAt);de.push(Mt.value),me&&(me=Mt.inclusive)}return new Yr(de,me)}(f,h),L=this.ln(h,f,I),M=this.ln(h,f,A),V=this.hn(h,f,m),Y=this.Pn(h.indexId,p,L,I.inclusive,M,A.inclusive,V);return R.forEach(Y,ae=>r.j(ae,t.limit).next(j=>{j.forEach(ye=>{const de=F.fromSegments(ye.documentKey);a.has(de)||(a=a.add(de),l.push(de))})}))}).next(()=>l)}return R.resolve(null)})}un(e){let t=this.an.get(e);return t||(e.filters.length===0?t=[e]:t=MU(Te.create(e.filters,"and")).map(r=>Xf(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,a,l){const h=(t!=null?t.length:1)*Math.max(r.length,s.length),f=h/(t!=null?t.length:1),p=[];for(let m=0;m<h;++m){const I=t?this.In(t[m/f]):Fu,A=this.Tn(e,I,r[m%f],i),L=this.En(e,I,s[m%f],a),M=l.map(V=>this.Tn(e,I,V,!0));p.push(...this.createRange(A,L,M))}return p}Tn(e,t,r,i){const s=new Si(e,F.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new Si(e,F.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new CI(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const l of s)r.en(l)&&(!a||l.fields.length>a.fields.length)&&(a=l);return a})}getIndexType(e,t){let r=2;const i=this.un(t);return R.forEach(i,s=>this.cn(e,s).next(a=>{a?r!==0&&a.fields.length<function(h){let f=new Se(Le.comparator),p=!1;for(const m of h.filters)for(const I of m.getFlattenedFilters())I.field.isKeyField()||(I.op==="array-contains"||I.op==="array-contains-any"?p=!0:f=f.add(I.field));for(const m of h.orderBy)m.field.isKeyField()||(f=f.add(m.field));return f.size+(p?1:0)}(s)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(t)&&i.length>1&&r===2?1:r)}dn(e,t){const r=new ia;for(const i of Ei(e)){const s=t.data.field(i.fieldPath);if(s==null)return null;const a=r.jt(i.kind);Ri.St.ht(s,a)}return r.Ut()}In(e){const t=new ia;return Ri.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new ia;return Ri.St.ht(Wi(this.databaseId,t),r.jt(function(s){const a=Ei(s);return a.length===0?0:a[a.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(r===null)return[];let i=[];i.push(new ia);let s=0;for(const a of Ei(e)){const l=r[s++];for(const h of i)if(this.Rn(t,a.fieldPath)&&Ja(l))i=this.Vn(i,a,l);else{const f=h.jt(a.kind);Ri.St.ht(l,f)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const a of r.arrayValue.values||[])for(const l of i){const h=new ia;h.seed(l.Ut()),Ri.St.ht(a,h.jt(t.kind)),s.push(h)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof he&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=sa(e),i=Ps(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const a=[];return R.forEach(s,l=>i.get([l.indexId,this.uid]).next(h=>{a.push(function(p,m){const I=m?new Ha(m.sequenceNumber,new nn(ji(m.readTime),new F(Un(m.documentKey)),m.largestBatchId)):Ha.empty(),A=p.fields.map(([L,M])=>new ju(Le.fromServerFormat(L),M));return new ml(p.indexId,p.collectionGroup,A,I)}(l,h))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:ne(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=sa(e),s=Ps(e);return this.fn(e).next(a=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(l=>R.forEach(l,h=>s.put(AI(h.indexId,this.user,a,r)))))}updateIndexEntries(e,t){const r=new Map;return R.forEach(t,(i,s)=>{const a=r.get(i.collectionGroup);return(a?R.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),R.forEach(l,h=>this.gn(e,i,h).next(f=>{const p=this.pn(s,h);return f.isEqual(p)?R.resolve():this.yn(e,s,h,f,p)}))))})}wn(e,t,r,i){return bs(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return bs(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=bs(e);let s=new Se(xr);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(a,l)=>{s=s.add(new Si(r.indexId,t,l.arrayValue,l.directionalValue))}).next(()=>s)}pn(e,t){let r=new Se(xr);const i=this.dn(t,e);if(i==null)return r;const s=Kf(t);if(s!=null){const a=e.data.field(s.fieldPath);if(Ja(a))for(const l of a.arrayValue.values||[])r=r.add(new Si(t.indexId,e.key,this.In(l),i))}else r=r.add(new Si(t.indexId,e.key,Fu,i));return r}yn(e,t,r,i,s){N("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const a=[];return function(h,f,p,m,I){const A=h.getIterator(),L=f.getIterator();let M=Ss(A),V=Ss(L);for(;M||V;){let Y=!1,ae=!1;if(M&&V){const j=p(M,V);j<0?ae=!0:j>0&&(Y=!0)}else M!=null?ae=!0:Y=!0;Y?(m(V),V=Ss(L)):ae?(I(M),M=Ss(A)):(M=Ss(A),V=Ss(L))}}(i,s,xr,l=>{a.push(this.wn(e,t,r,l))},l=>{a.push(this.Sn(e,t,r,l))}),R.waitFor(a)}fn(e){let t=1;return Ps(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((a,l)=>xr(a,l)).filter((a,l,h)=>!l||xr(a,h[l-1])!==0);const i=[];i.push(e);for(const a of r){const l=xr(a,e),h=xr(a,t);if(l===0)i[0]=e.Ht();else if(l>0&&h<0)i.push(a),i.push(a.Ht());else if(h>0)break}i.push(t);const s=[];for(let a=0;a<i.length;a+=2){if(this.bn(i[a],i[a+1]))return[];const l=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Fu,[]],h=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Fu,[]];s.push(IDBKeyRange.bound(l,h))}return s}bn(e,t){return xr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(xI)}getMinOffset(e,t){return R.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||$())).next(xI)}}function DI(n){return ht(n,"collectionParents")}function bs(n){return ht(n,"indexEntries")}function sa(n){return ht(n,"indexConfiguration")}function Ps(n){return ht(n,"indexState")}function xI(n){z(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;gg(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new nn(e.readTime,e.documentKey,t)}const NI={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Wt{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Wt(e,Wt.DEFAULT_COLLECTION_PERCENTILE,Wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function UA(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],a=IDBKeyRange.only(t.batchId);let l=0;const h=r.Y({range:a},(p,m,I)=>(l++,I.delete()));s.push(h.next(()=>{z(l===1)}));const f=[];for(const p of t.mutations){const m=$T(e,p.key.path,t.batchId);s.push(i.delete(m)),f.push(p.key)}return R.waitFor(s).next(()=>f)}function El(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw $();e=n.noDocument}return JSON.stringify(e).length}Wt.DEFAULT_COLLECTION_PERCENTILE=10,Wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Wt.DEFAULT=new Wt(41943040,Wt.DEFAULT_COLLECTION_PERCENTILE,Wt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Wt.DISABLED=new Wt(-1,0,0);class dh{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){z(e.uid!=="");const s=e.isAuthenticated()?e.uid:"";return new dh(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Nr(e).Y({index:"userMutationsIndex",range:r},(i,s,a)=>{t=!1,a.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Ls(e),a=Nr(e);return a.add({}).next(l=>{z(typeof l=="number");const h=new Eg(l,t,r,i),f=function(A,L,M){const V=M.baseMutations.map(ae=>tc(A.ut,ae)),Y=M.mutations.map(ae=>tc(A.ut,ae));return{userId:L,batchId:M.batchId,localWriteTimeMs:M.localWriteTime.toMillis(),baseMutations:V,mutations:Y}}(this.serializer,this.userId,h),p=[];let m=new Se((I,A)=>ne(I.canonicalString(),A.canonicalString()));for(const I of i){const A=$T(this.userId,I.key.path,l);m=m.add(I.key.path.popLast()),p.push(a.put(f)),p.push(s.put(A,b2))}return m.forEach(I=>{p.push(this.indexManager.addToCollectionParentIndex(e,I))}),e.addOnCommittedListener(()=>{this.Dn[l]=h.keys()}),R.waitFor(p).next(()=>h)})}lookupMutationBatch(e,t){return Nr(e).get(t).next(r=>r?(z(r.userId===this.userId),Ai(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?R.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Nr(e).Y({index:"userMutationsIndex",range:i},(a,l,h)=>{l.userId===this.userId&&(z(l.batchId>=r),s=Ai(this.serializer,l)),h.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Nr(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,a)=>{r=s.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Nr(e).W("userMutationsIndex",t).next(r=>r.map(i=>Ai(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Qu(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Ls(e).Y({range:i},(a,l,h)=>{const[f,p,m]=a,I=Un(p);if(f===this.userId&&t.path.isEqual(I))return Nr(e).get(m).next(A=>{if(!A)throw $();z(A.userId===this.userId),s.push(Ai(this.serializer,A))});h.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Se(ne);const i=[];return t.forEach(s=>{const a=Qu(this.userId,s.path),l=IDBKeyRange.lowerBound(a),h=Ls(e).Y({range:l},(f,p,m)=>{const[I,A,L]=f,M=Un(A);I===this.userId&&s.path.isEqual(M)?r=r.add(L):m.done()});i.push(h)}),R.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Qu(this.userId,r),a=IDBKeyRange.lowerBound(s);let l=new Se(ne);return Ls(e).Y({range:a},(h,f,p)=>{const[m,I,A]=h,L=Un(I);m===this.userId&&r.isPrefixOf(L)?L.length===i&&(l=l.add(A)):p.done()}).next(()=>this.vn(e,l))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Nr(e).get(s).next(a=>{if(a===null)throw $();z(a.userId===this.userId),r.push(Ai(this.serializer,a))}))}),R.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return UA(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),R.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return R.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return Ls(e).Y({range:r},(s,a,l)=>{if(s[0]===this.userId){const h=Un(s[1]);i.push(h)}else l.done()}).next(()=>{z(i.length===0)})})}containsKey(e,t){return BA(e,this.userId,t)}Mn(e){return qA(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function BA(n,e,t){const r=Qu(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let a=!1;return Ls(n).Y({range:s,J:!0},(l,h,f)=>{const[p,m,I]=l;p===e&&m===i&&(a=!0),f.done()}).next(()=>a)}function Nr(n){return ht(n,"mutations")}function Ls(n){return ht(n,"documentMutations")}function qA(n){return ht(n,"mutationQueues")}class Qi{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new Qi(0)}static Nn(){return new Qi(-1)}}class BU{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const r=new Qi(t.highestTargetId);return t.highestTargetId=r.next(),this.Ln(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>K.fromTimestamp(new Fe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Ln(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Ln(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Cs(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(z(r.targetCount>0),r.targetCount-=1,this.Ln(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return Cs(e).Y((a,l)=>{const h=_a(l);h.sequenceNumber<=t&&r.get(h.targetId)===null&&(i++,s.push(this.removeTargetData(e,h)))}).next(()=>R.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Cs(e).Y((r,i)=>{const s=_a(i);t(s)})}Bn(e){return VI(e).get("targetGlobalKey").next(t=>(z(t!==null),t))}Ln(e,t){return VI(e).put("targetGlobalKey",t)}kn(e,t){return Cs(e).put(LA(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Gi(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Cs(e).Y({range:i,index:"queryTargetsIndex"},(a,l,h)=>{const f=_a(l);Ac(t,f.target)&&(s=f,h.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Or(e);return t.forEach(a=>{const l=Ot(a.path);i.push(s.put({targetId:r,path:l})),i.push(this.referenceDelegate.addReference(e,r,a))}),R.waitFor(i)}removeMatchingKeys(e,t,r){const i=Or(e);return R.forEach(t,s=>{const a=Ot(s.path);return R.waitFor([i.delete([r,a]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Or(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Or(e);let s=re();return i.Y({range:r,J:!0},(a,l,h)=>{const f=Un(a[1]),p=new F(f);s=s.add(p)}).next(()=>s)}containsKey(e,t){const r=Ot(t.path),i=IDBKeyRange.bound([r],[LT(r)],!1,!0);let s=0;return Or(e).Y({index:"documentTargetsIndex",J:!0,range:i},([a,l],h,f)=>{a!==0&&(s++,f.done())}).next(()=>s>0)}_t(e,t){return Cs(e).get(t).next(r=>r?_a(r):null)}}function Cs(n){return ht(n,"targets")}function VI(n){return ht(n,"targetGlobal")}function Or(n){return ht(n,"targetDocuments")}function OI([n,e],[t,r]){const i=ne(n,t);return i===0?ne(e,r):i}class qU{constructor(e){this.Qn=e,this.buffer=new Se(OI),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();OI(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class $U{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return this.Wn!==null}Gn(e){N("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Wn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){ai(t)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await oi(t)}await this.Gn(3e5)})}}class WU{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return R.resolve(Gt._e);const r=new qU(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(N("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(NI)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),NI):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,a,l,h,f;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(m=>(m>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${m}`),i=this.params.maximumSequenceNumbersToCollect):i=m,a=Date.now(),this.nthSequenceNumber(e,i))).next(m=>(r=m,l=Date.now(),this.removeTargets(e,r,t))).next(m=>(s=m,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(m=>(f=Date.now(),xs()<=ue.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(l-a)+`ms
	Removed ${s} targets in `+(h-l)+`ms
	Removed ${m} documents in `+(f-h)+`ms
Total Duration: ${f-p}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:m})))}}function GU(n,e){return new WU(n,e)}class zU{constructor(e,t){this.db=e,this.garbageCollector=GU(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return Uu(e,r)}removeReference(e,t,r){return Uu(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Uu(e,t)}Xn(e,t){return function(i,s){let a=!1;return qA(i).Z(l=>BA(i,l,s).next(h=>(h&&(a=!0),R.resolve(!h)))).next(()=>a)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(a,l)=>{if(l<=t){const h=this.Xn(e,a).next(f=>{if(!f)return s++,r.getEntry(e,a).next(()=>(r.removeEntry(a,K.min()),Or(e).delete(function(m){return[0,Ot(m.path)]}(a))))});i.push(h)}}).next(()=>R.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Uu(e,t)}Zn(e,t){const r=Or(e);let i,s=Gt._e;return r.Y({index:"documentTargetsIndex"},([a,l],{path:h,sequenceNumber:f})=>{a===0?(s!==Gt._e&&t(new F(Un(i)),s),s=f,i=h):s=Gt._e}).next(()=>{s!==Gt._e&&t(new F(Un(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Uu(n,e){return Or(n).put(function(r,i){return{targetId:0,path:Ot(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}class $A{constructor(){this.changes=new ci(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ne.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?R.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class KU{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ii(e).put(r)}removeEntry(e,t,r){return Ii(e).delete(function(s,a){const l=s.path.toArray();return[l.slice(0,l.length-2),l[l.length-2],Il(a),l[l.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=Ne.newInvalidDocument(t);return Ii(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(oa(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:Ne.newInvalidDocument(t)};return Ii(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(oa(t))},(i,s)=>{r={document:this.tr(t,s),size:El(s)}}).next(()=>r)}getEntries(e,t){let r=Kt();return this.rr(e,t,(i,s)=>{const a=this.tr(i,s);r=r.insert(i,a)}).next(()=>r)}ir(e,t){let r=Kt(),i=new Ce(F.comparator);return this.rr(e,t,(s,a)=>{const l=this.tr(s,a);r=r.insert(s,l),i=i.insert(s,El(a))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return R.resolve();let i=new Se(FI);t.forEach(h=>i=i.add(h));const s=IDBKeyRange.bound(oa(i.first()),oa(i.last())),a=i.getIterator();let l=a.getNext();return Ii(e).Y({index:"documentKeyIndex",range:s},(h,f,p)=>{const m=F.fromSegments([...f.prefixPath,f.collectionGroup,f.documentId]);for(;l&&FI(l,m)<0;)r(l,null),l=a.getNext();l&&l.isEqual(m)&&(r(l,f),l=a.hasNext()?a.getNext():null),l?p.U(oa(l)):p.done()}).next(()=>{for(;l;)r(l,null),l=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const a=t.path,l=[a.popLast().toArray(),a.lastSegment(),Il(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],h=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ii(e).W(IDBKeyRange.bound(l,h,!0)).next(f=>{s==null||s.incrementDocumentReadCount(f.length);let p=Kt();for(const m of f){const I=this.tr(F.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);I.isFoundDocument()&&(Sc(t,I)||i.has(I.key))&&(p=p.insert(I.key,I))}return p})}getAllFromCollectionGroup(e,t,r,i){let s=Kt();const a=MI(t,r),l=MI(t,nn.max());return Ii(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,l,!0)},(h,f,p)=>{const m=this.tr(F.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);s=s.insert(m.key,m),s.size===i&&p.done()}).next(()=>s)}newChangeBuffer(e){return new HU(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return LI(e).get("remoteDocumentGlobalKey").next(t=>(z(!!t),t))}er(e,t){return LI(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=DU(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(K.min())))return r}return Ne.newInvalidDocument(e)}}function WA(n){return new KU(n)}class HU extends $A{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new ci(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new Se((s,a)=>ne(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const l=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,l.readTime)),a.isValidDocument()){const h=EI(this._r.serializer,a);i=i.add(s.path.popLast());const f=El(h);r+=f-l.size,t.push(this._r.addEntry(e,s,h))}else if(r-=l.size,this.trackRemovals){const h=EI(this._r.serializer,a.convertToNoDocument(K.min()));t.push(this._r.addEntry(e,s,h))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),R.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,a)=>{this.ar.set(s,{size:a,readTime:r.get(s).readTime})}),r))}}function LI(n){return ht(n,"remoteDocumentGlobal")}function Ii(n){return ht(n,"remoteDocumentsV14")}function oa(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function MI(n,e){const t=e.documentKey.path.toArray();return[n,Il(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function FI(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=ne(t[s],r[s]),i)return i;return i=ne(t.length,r.length),i||(i=ne(t[t.length-2],r[r.length-2]),i||ne(t[t.length-1],r[r.length-1]))}class jU{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class GA{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Sa(r.mutation,i,zt.empty(),Fe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,re()).next(()=>r))}getLocalViewOfDocuments(e,t,r=re()){const i=Bn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let a=ga();return s.forEach((l,h)=>{a=a.insert(l,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,t){const r=Bn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,re()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,l)=>{t.set(a,l)})})}computeViews(e,t,r,i){let s=Kt();const a=Ra(),l=function(){return Ra()}();return t.forEach((h,f)=>{const p=r.get(f.key);i.has(f.key)&&(p===void 0||p.mutation instanceof vr)?s=s.insert(f.key,f):p!==void 0?(a.set(f.key,p.mutation.getFieldMask()),Sa(p.mutation,f,p.mutation.getFieldMask(),Fe.now())):a.set(f.key,zt.empty())}),this.recalculateAndSaveOverlays(e,s).next(h=>(h.forEach((f,p)=>a.set(f,p)),t.forEach((f,p)=>{var m;return l.set(f,new jU(p,(m=a.get(f))!==null&&m!==void 0?m:null))}),l))}recalculateAndSaveOverlays(e,t){const r=Ra();let i=new Ce((a,l)=>a-l),s=re();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(a=>{for(const l of a)l.keys().forEach(h=>{const f=t.get(h);if(f===null)return;let p=r.get(h)||zt.empty();p=l.applyToLocalView(f,p),r.set(h,p);const m=(i.get(l.batchId)||re()).add(h);i=i.insert(l.batchId,m)})}).next(()=>{const a=[],l=i.getReverseIterator();for(;l.hasNext();){const h=l.getNext(),f=h.key,p=h.value,m=uA();p.forEach(I=>{if(!s.has(I)){const A=_A(t.get(I),r.get(I));A!==null&&m.set(I,A),s=s.add(I)}}),a.push(this.documentOverlayCache.saveOverlays(e,f,m))}return R.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(a){return F.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):vg(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):R.resolve(Bn());let l=-1,h=s;return a.next(f=>R.forEach(f,(p,m)=>(l<m.largestBatchId&&(l=m.largestBatchId),s.get(p)?R.resolve():this.remoteDocumentCache.getEntry(e,p).next(I=>{h=h.insert(p,I)}))).next(()=>this.populateOverlays(e,f,s)).next(()=>this.computeViews(e,h,f,re())).next(p=>({batchId:l,changes:cA(p)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new F(t)).next(r=>{let i=ga();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let a=ga();return this.indexManager.getCollectionParents(e,s).next(l=>R.forEach(l,h=>{const f=function(m,I){return new yr(I,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt)}(t,h.child(s));return this.getDocumentsMatchingCollectionQuery(e,f,r,i).next(p=>{p.forEach((m,I)=>{a=a.insert(m,I)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(a=>{s.forEach((h,f)=>{const p=f.getKey();a.get(p)===null&&(a=a.insert(p,Ne.newInvalidDocument(p)))});let l=ga();return a.forEach((h,f)=>{const p=s.get(h);p!==void 0&&Sa(p.mutation,f,zt.empty(),Fe.now()),Sc(t,f)&&(l=l.insert(h,f))}),l})}}class QU{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return R.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,function(i){return{id:i.id,version:i.version,createTime:Ze(i.createTime)}}(t)),R.resolve()}getNamedQuery(e,t){return R.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,function(i){return{name:i.name,query:bg(i.bundledQuery),readTime:Ze(i.readTime)}}(t)),R.resolve()}}class YU{constructor(){this.overlays=new Ce(F.comparator),this.lr=new Map}getOverlay(e,t){return R.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Bn();return R.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),R.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),R.resolve()}getOverlaysForCollection(e,t,r){const i=Bn(),s=t.length+1,a=new F(t.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const h=l.getNext().value,f=h.getKey();if(!t.isPrefixOf(f.path))break;f.path.length===s&&h.largestBatchId>r&&i.set(h.getKey(),h)}return R.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Ce((f,p)=>f-p);const a=this.overlays.getIterator();for(;a.hasNext();){const f=a.getNext().value;if(f.getKey().getCollectionGroup()===t&&f.largestBatchId>r){let p=s.get(f.largestBatchId);p===null&&(p=Bn(),s=s.insert(f.largestBatchId,p)),p.set(f.getKey(),f)}}const l=Bn(),h=s.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((f,p)=>l.set(f,p)),!(l.size()>=i)););return R.resolve(l)}lt(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Ag(t,r));let s=this.lr.get(t);s===void 0&&(s=re(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class kg{constructor(){this.hr=new Se(ot.Pr),this.Ir=new Se(ot.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new ot(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new ot(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new F(new ge([])),r=new ot(t,e),i=new ot(t,e+1),s=[];return this.Ir.forEachInRange([r,i],a=>{this.dr(a),s.push(a.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new F(new ge([])),r=new ot(t,e),i=new ot(t,e+1);let s=re();return this.Ir.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const t=new ot(e,0),r=this.hr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class ot{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return F.comparator(e.key,t.key)||ne(e.gr,t.gr)}static Tr(e,t){return ne(e.gr,t.gr)||F.comparator(e.key,t.key)}}class JU{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new Se(ot.Pr)}checkEmpty(e){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Eg(s,t,r,i);this.mutationQueue.push(a);for(const l of i)this.yr=this.yr.add(new ot(l.key,s)),this.indexManager.addToCollectionParentIndex(e,l.key.path.popLast());return R.resolve(a)}lookupMutationBatch(e,t){return R.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.Sr(r),s=i<0?0:i;return R.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ot(t,0),i=new ot(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],a=>{const l=this.wr(a.gr);s.push(l)}),R.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Se(ne);return t.forEach(i=>{const s=new ot(i,0),a=new ot(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,a],l=>{r=r.add(l.gr)})}),R.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;F.isDocumentKey(s)||(s=s.child(""));const a=new ot(new F(s),0);let l=new Se(ne);return this.yr.forEachWhile(h=>{const f=h.key.path;return!!r.isPrefixOf(f)&&(f.length===i&&(l=l.add(h.gr)),!0)},a),R.resolve(this.br(l))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){z(this.Dr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return R.forEach(t.mutations,i=>{const s=new ot(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new ot(t,0),i=this.yr.firstAfterOrEqual(r);return R.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,R.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class XU{constructor(e){this.Cr=e,this.docs=function(){return new Ce(F.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,a=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return R.resolve(r?r.document.mutableCopy():Ne.newInvalidDocument(t))}getEntries(e,t){let r=Kt();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ne.newInvalidDocument(i))}),R.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Kt();const a=t.path,l=new F(a.child("")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){const{key:f,value:{document:p}}=h.getNext();if(!a.isPrefixOf(f.path))break;f.path.length>a.length+1||gg(FT(p),r)<=0||(i.has(p.key)||Sc(t,p))&&(s=s.insert(p.key,p.mutableCopy()))}return R.resolve(s)}getAllFromCollectionGroup(e,t,r,i){$()}vr(e,t){return R.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new ZU(this)}getSize(e){return R.resolve(this.size)}}class ZU extends $A{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),R.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class eB{constructor(e){this.persistence=e,this.Fr=new ci(t=>Gi(t),Ac),this.lastRemoteSnapshotVersion=K.min(),this.highestTargetId=0,this.Mr=0,this.Or=new kg,this.targetCount=0,this.Nr=Qi.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),R.resolve()}getLastRemoteSnapshotVersion(e){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return R.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),R.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new Qi(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,R.resolve()}updateTargetData(e,t){return this.kn(t),R.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,R.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((a,l)=>{l.sequenceNumber<=t&&r.get(l.targetId)===null&&(this.Fr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,l.targetId)),i++)}),R.waitFor(s).next(()=>i)}getTargetCount(e){return R.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return R.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),R.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),R.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),R.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return R.resolve(r)}containsKey(e,t){return R.resolve(this.Or.containsKey(t))}}class zA{constructor(e,t){this.Br={},this.overlays={},this.Lr=new Gt(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new eB(this),this.indexManager=new FU,this.remoteDocumentCache=function(i){return new XU(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new OA(t),this.Kr=new QU(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new YU,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new JU(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){N("MemoryPersistence","Starting transaction:",e);const i=new tB(this.Lr.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return R.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}}class tB extends BT{constructor(e){super(),this.currentSequenceNumber=e}}class fh{constructor(e){this.persistence=e,this.Gr=new kg,this.zr=null}static jr(e){return new fh(e)}get Hr(){if(this.zr)return this.zr;throw $()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),R.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),R.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),R.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.Hr,r=>{const i=F.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,K.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return R.or([()=>R.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class nB{constructor(e){this.serializer=e}N(e,t,r,i){const s=new ah("createOrUpgrade",t);r<1&&i>=1&&(function(h){h.createObjectStore("owner")}(e),function(h){h.createObjectStore("mutationQueues",{keyPath:"userId"}),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Zv,{unique:!0}),h.createObjectStore("documentMutations")}(e),UI(e),function(h){h.createObjectStore("remoteDocuments")}(e));let a=R.resolve();return r<3&&i>=3&&(r!==0&&(function(h){h.deleteObjectStore("targetDocuments"),h.deleteObjectStore("targets"),h.deleteObjectStore("targetGlobal")}(e),UI(e)),a=a.next(()=>function(h){const f=h.store("targetGlobal"),p={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:K.min().toTimestamp(),targetCount:0};return f.put("targetGlobalKey",p)}(s))),r<4&&i>=4&&(r!==0&&(a=a.next(()=>function(h,f){return f.store("mutations").W().next(p=>{h.deleteObjectStore("mutations"),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Zv,{unique:!0});const m=f.store("mutations"),I=p.map(A=>m.put(A));return R.waitFor(I)})}(e,s))),a=a.next(()=>{(function(h){h.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(a=a.next(()=>this.Zr(s))),r<6&&i>=6&&(a=a.next(()=>(function(h){h.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(a=a.next(()=>this.ei(s))),r<8&&i>=8&&(a=a.next(()=>this.ti(e,s))),r<9&&i>=9&&(a=a.next(()=>{(function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(a=a.next(()=>this.ni(s))),r<11&&i>=11&&(a=a.next(()=>{(function(h){h.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(h){h.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(a=a.next(()=>{(function(h){const f=h.createObjectStore("documentOverlays",{keyPath:U2});f.createIndex("collectionPathOverlayIndex",B2,{unique:!1}),f.createIndex("collectionGroupOverlayIndex",q2,{unique:!1})})(e)})),r<13&&i>=13&&(a=a.next(()=>function(h){const f=h.createObjectStore("remoteDocumentsV14",{keyPath:P2});f.createIndex("documentKeyIndex",C2),f.createIndex("collectionGroupIndex",k2)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(a=a.next(()=>this.ii(e,s))),r<15&&i>=15&&(a=a.next(()=>function(h){h.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),h.createObjectStore("indexState",{keyPath:O2}).createIndex("sequenceNumberIndex",L2,{unique:!1}),h.createObjectStore("indexEntries",{keyPath:M2}).createIndex("documentKeyIndex",F2,{unique:!1})}(e))),a}Xr(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=El(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>R.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",a).next(l=>R.forEach(l,h=>{z(h.userId===s.userId);const f=Ai(this.serializer,h);return UA(e,s.userId,f).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Y((a,l)=>{const h=new ge(a),f=function(m){return[0,Ot(m)]}(h);s.push(t.get(f).next(p=>p?R.resolve():(m=>t.put({targetId:0,path:Ot(m),sequenceNumber:i.highestListenSequenceNumber}))(h)))}).next(()=>R.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:V2});const r=t.store("collectionParents"),i=new Cg,s=a=>{if(i.add(a)){const l=a.lastSegment(),h=a.popLast();return r.put({collectionId:l,parent:Ot(h)})}};return t.store("remoteDocuments").Y({J:!0},(a,l)=>{const h=new ge(a);return s(h.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([a,l,h],f)=>{const p=Un(l);return s(p.popLast())}))}ni(e){const t=e.store("targets");return t.Y((r,i)=>{const s=_a(i),a=LA(this.serializer,s);return t.put(a)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.Y((s,a)=>{const l=t.store("remoteDocumentsV14"),h=function(m){return m.document?new F(ge.fromString(m.document.name).popFirst(5)):m.noDocument?F.fromSegments(m.noDocument.path):m.unknownDocument?F.fromSegments(m.unknownDocument.path):$()}(a).path.toArray(),f={prefixPath:h.slice(0,h.length-2),collectionGroup:h[h.length-2],documentId:h[h.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(l.put(f))}).next(()=>R.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=WA(this.serializer),s=new zA(fh.jr,this.serializer.ut);return r.W().next(a=>{const l=new Map;return a.forEach(h=>{var f;let p=(f=l.get(h.userId))!==null&&f!==void 0?f:re();Ai(this.serializer,h).keys().forEach(m=>p=p.add(m)),l.set(h.userId,p)}),R.forEach(l,(h,f)=>{const p=new at(f),m=hh.ct(this.serializer,p),I=s.getIndexManager(p),A=dh.ct(p,this.serializer,I,s.referenceDelegate);return new GA(i,A,m,I).recalculateAndSaveOverlaysForDocumentKeys(new Hf(t,Gt._e),h).next()})})}}function UI(n){n.createObjectStore("targetDocuments",{keyPath:x2}).createIndex("documentTargetsIndex",N2,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",D2,{unique:!0}),n.createObjectStore("targetGlobal")}const _f="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Dg{constructor(e,t,r,i,s,a,l,h,f,p,m=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=a,this.document=l,this.oi=f,this._i=p,this.ai=m,this.Lr=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=I=>Promise.resolve(),!Dg.D())throw new D(b.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new zU(this,i),this.Ii=t+"main",this.serializer=new OA(h),this.Ti=new wn(this.Ii,this.ai,new nB(this.serializer)),this.qr=new BU(this.referenceDelegate,this.serializer),this.remoteDocumentCache=WA(this.serializer),this.Kr=new xU,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,p===!1&&Xe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new D(b.FAILED_PRECONDITION,_f);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Lr=new Gt(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){return this.Pi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget(async()=>{this.started&&await this.di()}))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Bu(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(ai(e))return N("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return aa(e).get("owner").next(t=>R.resolve(this.wi(t)))}Si(e){return Bu(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=ht(t,"clientMetadata");return r.W().next(i=>{const s=this.Ci(i,18e5),a=i.filter(l=>s.indexOf(l)===-1);return R.forEach(a,l=>r.delete(l.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Ei)for(const t of e)this.Ei.removeItem(this.vi(t.clientId))}}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?R.resolve(!0):aa(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new D(b.FAILED_PRECONDITION,_f);return!1}}return!(!this.networkEnabled||!this.inForeground)||Bu(e).W().next(r=>this.Ci(r,5e3).find(i=>{if(this.clientId!==i.clientId){const s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,l=this.networkEnabled===i.networkEnabled;if(s||a&&l)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&N("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),await this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Hf(e,Gt._e);return this.pi(t).next(()=>this.Si(t))}),this.Ti.close(),this.Ni()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Bu(e).W().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return dh.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new UU(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return hh.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){N("IndexedDbPersistence","Starting transaction:",e);const i=t==="readonly"?"readonly":"readwrite",s=function(h){return h===15?W2:h===14?zT:h===13?GT:h===12?$2:h===11?WT:void $()}(this.ai);let a;return this.Ti.runTransaction(e,i,s,l=>(a=new Hf(l,this.Lr?this.Lr.next():Gt._e),t==="readwrite-primary"?this.fi(a).next(h=>!!h||this.gi(a)).next(h=>{if(!h)throw Xe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new D(b.FAILED_PRECONDITION,UT);return r(a)}).next(h=>this.yi(a).next(()=>h)):this.Li(a).next(()=>r(a)))).then(l=>(a.raiseOnCommittedEvent(),l))}Li(e){return aa(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new D(b.FAILED_PRECONDITION,_f)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return aa(e).put("owner",t)}static D(){return wn.D()}pi(e){const t=aa(e);return t.get("owner").next(r=>this.wi(r)?(N("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):R.resolve())}Di(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(Xe(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ai(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground=this.document.visibilityState==="visible")}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;Sx()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=((t=this.Ei)===null||t===void 0?void 0:t.getItem(this.vi(e)))!==null;return N("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Xe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){Xe("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function aa(n){return ht(n,"owner")}function Bu(n){return ht(n,"clientMetadata")}function xg(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Ng{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=re(),i=re();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new Ng(e,t.fromCache,r,i)}}class rB{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class KA{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new rB;return this.Hi(e,t,a).next(l=>{if(s.result=l,this.$i)return this.Ji(e,t,a,l.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(xs()<=ue.DEBUG&&N("QueryEngine","SDK will not create cache indexes for query:",Ns(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),R.resolve()):(xs()<=ue.DEBUG&&N("QueryEngine","Query:",Ns(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(xs()<=ue.DEBUG&&N("QueryEngine","The SDK decides to create cache indexes for query:",Ns(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Lt(t))):R.resolve())}zi(e,t){if(hI(t))return R.resolve(null);let r=Lt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=vl(t,null,"F"),r=Lt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=re(...s);return this.Gi.getDocuments(e,a).next(l=>this.indexManager.getMinOffset(e,r).next(h=>{const f=this.Yi(t,l);return this.Zi(t,f,a,h.readTime)?this.zi(e,vl(t,null,"F")):this.Xi(e,f,t,h)}))})))}ji(e,t,r,i){return hI(t)||i.isEqual(K.min())?R.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const a=this.Yi(t,s);return this.Zi(t,a,r,i)?R.resolve(null):(xs()<=ue.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ns(t)),this.Xi(e,a,t,MT(i,-1)).next(l=>l))})}Yi(e,t){let r=new Se(oA(e));return t.forEach((i,s)=>{Sc(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return xs()<=ue.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",Ns(t)),this.Gi.getDocumentsMatchingQuery(e,t,nn.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(a=>{s=s.insert(a.key,a)}),s))}}class iB{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new Ce(ne),this.ns=new ci(s=>Gi(s),Ac),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new GA(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function HA(n,e,t,r){return new iB(n,e,t,r)}async function jA(n,e){const t=B(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],l=[];let h=re();for(const f of i){a.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}for(const f of s){l.push(f.batchId);for(const p of f.mutations)h=h.add(p.key)}return t.localDocuments.getDocuments(r,h).next(f=>({_s:f,removedBatchIds:a,addedBatchIds:l}))})})}function sB(n,e){const t=B(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(l,h,f,p){const m=f.batch,I=m.keys();let A=R.resolve();return I.forEach(L=>{A=A.next(()=>p.getEntry(h,L)).next(M=>{const V=f.docVersions.get(L);z(V!==null),M.version.compareTo(V)<0&&(m.applyToRemoteDocument(M,f),M.isValidDocument()&&(M.setReadTime(f.commitVersion),p.addEntry(M)))})}),A.next(()=>l.mutationQueue.removeMutationBatch(h,m))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(l){let h=re();for(let f=0;f<l.mutationResults.length;++f)l.mutationResults[f].transformResults.length>0&&(h=h.add(l.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function QA(n){const e=B(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function oB(n,e){const t=B(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const l=[];e.targetChanges.forEach((p,m)=>{const I=i.get(m);if(!I)return;l.push(t.qr.removeMatchingKeys(s,p.removedDocuments,m).next(()=>t.qr.addMatchingKeys(s,p.addedDocuments,m)));let A=I.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(m)!==null?A=A.withResumeToken(it.EMPTY_BYTE_STRING,K.min()).withLastLimboFreeSnapshotVersion(K.min()):p.resumeToken.approximateByteSize()>0&&(A=A.withResumeToken(p.resumeToken,r)),i=i.insert(m,A),function(M,V,Y){return M.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-M.snapshotVersion.toMicroseconds()>=3e8?!0:Y.addedDocuments.size+Y.modifiedDocuments.size+Y.removedDocuments.size>0}(I,A,p)&&l.push(t.qr.updateTargetData(s,A))});let h=Kt(),f=re();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&l.push(t.persistence.referenceDelegate.updateLimboDocument(s,p))}),l.push(YA(s,a,e.documentUpdates).next(p=>{h=p.us,f=p.cs})),!r.isEqual(K.min())){const p=t.qr.getLastRemoteSnapshotVersion(s).next(m=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));l.push(p)}return R.waitFor(l).next(()=>a.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,h,f)).next(()=>h)}).then(s=>(t.ts=i,s))}function YA(n,e,t){let r=re(),i=re();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let a=Kt();return t.forEach((l,h)=>{const f=s.get(l);h.isFoundDocument()!==f.isFoundDocument()&&(i=i.add(l)),h.isNoDocument()&&h.version.isEqual(K.min())?(e.removeEntry(l,h.readTime),a=a.insert(l,h)):!f.isValidDocument()||h.version.compareTo(f.version)>0||h.version.compareTo(f.version)===0&&f.hasPendingWrites?(e.addEntry(h),a=a.insert(l,h)):N("LocalStore","Ignoring outdated watch update for ",l,". Current version:",f.version," Watch version:",h.version)}),{us:a,cs:i}})}function aB(n,e){const t=B(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function co(n,e){const t=B(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,R.resolve(i)):t.qr.allocateTargetId(r).next(a=>(i=new cr(e,a,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}async function uo(n,e,t){const r=B(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!ai(a))throw a;N("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}function Tl(n,e,t){const r=B(n);let i=K.min(),s=re();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,f,p){const m=B(h),I=m.ns.get(p);return I!==void 0?R.resolve(m.ts.get(I)):m.qr.getTargetData(f,p)}(r,a,Lt(e)).next(l=>{if(l)return i=l.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(a,l.targetId).next(h=>{s=h})}).next(()=>r.es.getDocumentsMatchingQuery(a,e,t?i:K.min(),t?s:re())).next(l=>(ZA(r,sA(e),l),{documents:l,ls:s})))}function JA(n,e){const t=B(n),r=B(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(a=>a?a.target:null))}function XA(n,e){const t=B(n),r=t.rs.get(e)||K.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,MT(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(ZA(t,e,i),i))}function ZA(n,e,t){let r=n.rs.get(e)||K.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}async function cB(n,e,t,r){const i=B(n);let s=re(),a=Kt();for(const f of t){const p=e.hs(f.metadata.name);f.document&&(s=s.add(p));const m=e.Ps(f);m.setReadTime(e.Is(f.metadata.readTime)),a=a.insert(p,m)}const l=i.ss.newChangeBuffer({trackRemovals:!0}),h=await co(i,function(p){return Lt(To(ge.fromString(`__bundle__/docs/${p}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",f=>YA(f,l,a).next(p=>(l.apply(f),p)).next(p=>i.qr.removeMatchingKeysForTargetId(f,h.targetId).next(()=>i.qr.addMatchingKeys(f,s,h.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(f,p.us,p.cs)).next(()=>p.us)))}async function uB(n,e,t=re()){const r=await co(n,Lt(bg(e.bundledQuery))),i=B(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=Ze(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return i.Kr.saveNamedQuery(s,e);const l=r.withResumeToken(it.EMPTY_BYTE_STRING,a);return i.ts=i.ts.insert(l.targetId,l),i.qr.updateTargetData(s,l).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}function BI(n,e){return`firestore_clients_${n}_${e}`}function qI(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function yf(n,e){return`firestore_targets_${n}_${e}`}class Al{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new D(i.error.code,i.error.message))),a?new Al(e,t,i.state,s):(Xe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ba{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new D(r.error.code,r.error.message))),s?new ba(e,r.state,i):(Xe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Rl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Ig();for(let a=0;i&&a<r.activeTargetIds.length;++a)i=qT(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new Rl(e,s):(Xe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Vg{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Vg(t.clientId,t.onlineState):(Xe("SharedClientState",`Failed to parse online state: ${e}`),null)}}class op{constructor(){this.activeTargetIds=Ig()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class vf{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new Ce(ne),this.started=!1,this.ps=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=BI(this.persistenceKey,this.Rs),this.ws=function(h){return`firestore_sequence_number_${h}`}(this.persistenceKey),this.gs=this.gs.insert(this.Rs,new op),this.Ss=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.Cs=function(h){return`firestore_online_state_${h}`}(this.persistenceKey),this.vs=function(h){return`firestore_bundle_loaded_v2_${h}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Bi();for(const r of e){if(r===this.Rs)continue;const i=this.getItem(BI(this.persistenceKey,r));if(i){const s=Rl.Ts(r,i);s&&(this.gs=this.gs.insert(s.clientId,s))}}this.Fs();const t=this.storage.getItem(this.Cs);if(t){const r=this.Ms(t);r&&this.xs(r)}for(const r of this.ps)this.fs(r);this.ps=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(yf(this.persistenceKey,e));if(r){const i=ba.Ts(e,r);i&&(t=i.state)}}return this.Ls.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Ls.As(e),this.Fs()}isLocalQueryTarget(e){return this.Ls.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(yf(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return N("SharedClientState","READ",e,t),t}setItem(e,t){N("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){N("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){const t=e;if(t.storageArea===this.storage){if(N("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ys)return void Xe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Ss.test(t.key)){if(t.newValue==null){const r=this.Ks(t.key);return this.$s(r,null)}{const r=this.Us(t.key,t.newValue);if(r)return this.$s(r.clientId,r)}}else if(this.bs.test(t.key)){if(t.newValue!==null){const r=this.Ws(t.key,t.newValue);if(r)return this.Gs(r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){const r=this.zs(t.key,t.newValue);if(r)return this.js(r)}}else if(t.key===this.Cs){if(t.newValue!==null){const r=this.Ms(t.newValue);if(r)return this.xs(r)}}else if(t.key===this.ws){const r=function(s){let a=Gt._e;if(s!=null)try{const l=JSON.parse(s);z(typeof l=="number"),a=l}catch(l){Xe("SharedClientState","Failed to read sequence number from WebStorage",l)}return a}(t.newValue);r!==Gt._e&&this.sequenceNumberHandler(r)}else if(t.key===this.vs){const r=this.Hs(t.newValue);await Promise.all(r.map(i=>this.syncEngine.Js(i)))}}}else this.ps.push(t)})}}get Ls(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Ls.Es())}Ns(e,t,r){const i=new Al(this.currentUser,e,t,r),s=qI(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Bs(e){const t=qI(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){const t={clientId:this.Rs,onlineState:e};this.storage.setItem(this.Cs,JSON.stringify(t))}ks(e,t,r){const i=yf(this.persistenceKey,e),s=new ba(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return Rl.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Al.Ts(new at(s),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return ba.Ts(i,t)}Ms(e){return Vg.Ts(e)}Hs(e){return JSON.parse(e)}async Gs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Ys(e.batchId,e.state,e.error);N("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),a=[],l=[];return s.forEach(h=>{i.has(h)||a.push(h)}),i.forEach(h=>{s.has(h)||l.push(h)}),this.syncEngine.Xs(a,l).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=Ig();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class e0{constructor(){this.eo=new op,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new op,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lB{ro(e){}shutdown(){}}class $I{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let qu=null;function If(){return qu===null?qu=function(){return 268435456+Math.round(2147483648*Math.random())}():qu++,"0x"+qu.toString(16)}const hB={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class dB{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}const At="WebChannelConnection";class fB extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.mo=r+"://"+t.host,this.fo=`projects/${i}/databases/${s}`,this.po=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get yo(){return!1}wo(t,r,i,s,a){const l=If(),h=this.So(t,r);N("RestConnection",`Sending RPC '${t}' ${l}:`,h,i);const f={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(f,s,a),this.Do(t,h,f,i).then(p=>(N("RestConnection",`Received RPC '${t}' ${l}: `,p),p),p=>{throw An("RestConnection",`RPC '${t}' ${l} failed with error: `,p,"url: ",h,"request:",i),p})}Co(t,r,i,s,a,l){return this.wo(t,r,i,s,a)}bo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Eo}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,a)=>t[a]=s),i&&i.headers.forEach((s,a)=>t[a]=s)}So(t,r){const i=hB[t];return`${this.mo}/v1/${r}:${i}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,t,r,i){const s=If();return new Promise((a,l)=>{const h=new u2;h.setWithCredentials(!0),h.listenOnce(a2.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case gf.NO_ERROR:const p=h.getResponseJson();N(At,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(p)),a(p);break;case gf.TIMEOUT:N(At,`RPC '${e}' ${s} timed out`),l(new D(b.DEADLINE_EXCEEDED,"Request time out"));break;case gf.HTTP_ERROR:const m=h.getStatus();if(N(At,`RPC '${e}' ${s} failed with status:`,m,"response text:",h.getResponseText()),m>0){let I=h.getResponseJson();Array.isArray(I)&&(I=I[0]);const A=I==null?void 0:I.error;if(A&&A.status&&A.message){const L=function(V){const Y=V.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(Y)>=0?Y:b.UNKNOWN}(A.status);l(new D(L,A.message))}else l(new D(b.UNKNOWN,"Server responded with status "+h.getStatus()))}else l(new D(b.UNAVAILABLE,"Connection failed."));break;default:$()}}finally{N(At,`RPC '${e}' ${s} completed.`)}});const f=JSON.stringify(i);N(At,`RPC '${e}' ${s} sending request:`,i),h.send(t,"POST",f,r,15)})}vo(e,t,r){const i=If(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=s2(),l=o2(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},f=this.longPollingOptions.timeoutSeconds;f!==void 0&&(h.longPollingTimeout=Math.round(1e3*f)),this.useFetchStreams&&(h.useFetchStreams=!0),this.bo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const p=s.join("");N(At,`Creating RPC '${e}' stream ${i}: ${p}`,h);const m=a.createWebChannel(p,h);let I=!1,A=!1;const L=new dB({co:V=>{A?N(At,`Not sending because RPC '${e}' stream ${i} is closed:`,V):(I||(N(At,`Opening RPC '${e}' stream ${i} transport.`),m.open(),I=!0),N(At,`RPC '${e}' stream ${i} sending:`,V),m.send(V))},lo:()=>m.close()}),M=(V,Y,ae)=>{V.listen(Y,j=>{try{ae(j)}catch(ye){setTimeout(()=>{throw ye},0)}})};return M(m,Lu.EventType.OPEN,()=>{A||N(At,`RPC '${e}' stream ${i} transport opened.`)}),M(m,Lu.EventType.CLOSE,()=>{A||(A=!0,N(At,`RPC '${e}' stream ${i} transport closed`),L.Ro())}),M(m,Lu.EventType.ERROR,V=>{A||(A=!0,An(At,`RPC '${e}' stream ${i} transport errored:`,V),L.Ro(new D(b.UNAVAILABLE,"The operation could not be completed")))}),M(m,Lu.EventType.MESSAGE,V=>{var Y;if(!A){const ae=V.data[0];z(!!ae);const j=ae,ye=j.error||((Y=j[0])===null||Y===void 0?void 0:Y.error);if(ye){N(At,`RPC '${e}' stream ${i} received error:`,ye);const de=ye.status;let me=function(Qn){const as=et[Qn];if(as!==void 0)return IA(as)}(de),we=ye.message;me===void 0&&(me=b.INTERNAL,we="Unknown error status: "+de+" with message "+ye.message),A=!0,L.Ro(new D(me,we)),m.close()}else N(At,`RPC '${e}' stream ${i} received:`,ae),L.Vo(ae)}}),M(l,c2.STAT_EVENT,V=>{V.stat===Qv.PROXY?N(At,`RPC '${e}' stream ${i} detected buffering proxy`):V.stat===Qv.NOPROXY&&N(At,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{L.Ao()},0),L}}function t0(){return typeof window<"u"?window:null}function el(){return typeof document<"u"?document:null}function kc(n){return new wU(n,!0)}class Og{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Fo=r,this.Mo=i,this.xo=s,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();const t=Math.floor(this.Oo+this.qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&N("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Oo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){this.No!==null&&(this.No.skipDelay(),this.No=null)}cancel(){this.No!==null&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class n0{constructor(e,t,r,i,s,a,l,h){this.si=e,this.Ko=r,this.$o=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new Og(e,t)}jo(){return this.state===1||this.state===5||this.Ho()}Ho(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Jo()}async stop(){this.jo()&&await this.close(0)}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&this.Wo===null&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}async Xo(){if(this.Ho())return this.close(0)}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}async close(e,t){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,e!==4?this.zo.reset():t&&t.code===b.RESOURCE_EXHAUSTED?(Xe(t.toString()),Xe("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):t&&t.code===b.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.r_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Io(t)}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),t=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Uo===t&&this.s_(r,i)},r=>{e(()=>{const i=new D(b.UNKNOWN,"Fetching auth token failed: "+r.message);return this.o_(i)})})}s_(e,t){const r=this.i_(this.Uo);this.stream=this.__(e,t),this.stream.ho(()=>{r(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(i=>{r(()=>this.o_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Jo(){this.state=5,this.zo.ko(async()=>{this.state=0,this.start()})}o_(e){return N("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return t=>{this.si.enqueueAndForget(()=>this.Uo===e?t():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class pB extends n0{constructor(e,t,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s}__(e,t){return this.connection.vo("Listen",e,t)}onMessage(e){this.zo.reset();const t=AU(this.serializer,e),r=function(s){if(!("targetChange"in s))return K.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?K.min():a.readTime?Ze(a.readTime):K.min()}(e);return this.listener.a_(t,r)}u_(e){const t={};t.database=ec(this.serializer),t.addTarget=function(s,a){let l;const h=a.target;if(l=_l(h)?{documents:CA(s,h)}:{query:kA(s,h)},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=AA(s,a.resumeToken);const f=ep(s,a.expectedCount);f!==null&&(l.expectedCount=f)}else if(a.snapshotVersion.compareTo(K.min())>0){l.readTime=ao(s,a.snapshotVersion.toTimestamp());const f=ep(s,a.expectedCount);f!==null&&(l.expectedCount=f)}return l}(this.serializer,e);const r=SU(this.serializer,e);r&&(t.labels=r),this.e_(t)}c_(e){const t={};t.database=ec(this.serializer),t.removeTarget=e,this.e_(t)}}class gB extends n0{constructor(e,t,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,a),this.serializer=s,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,t){return this.connection.vo("Write",e,t)}onMessage(e){if(z(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();const t=RU(e.writeResults,e.commitTime),r=Ze(e.commitTime);return this.listener.I_(r,t)}return z(!e.writeResults||e.writeResults.length===0),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=ec(this.serializer),this.e_(e)}P_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>tc(this.serializer,r))};this.e_(t)}}class mB extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.d_=!1}A_(){if(this.d_)throw new D(b.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,t,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.wo(e,t,r,i,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new D(b.UNKNOWN,i.toString())})}Co(e,t,r,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(e,t,r,s,a,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new D(b.UNKNOWN,s.toString())})}terminate(){this.d_=!0}}class _B{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){this.V_===0&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){this.state==="Online"?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,e==="Online"&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(Xe(t),this.f_=!1):N("OnlineStateTracker",t)}S_(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}}class yB{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=s,this.F_.ro(a=>{r.enqueueAndForget(async()=>{ui(this)&&(N("RemoteStore","Restarting streams for network reachability change."),await async function(h){const f=B(h);f.C_.add(4),await So(f),f.M_.set("Unknown"),f.C_.delete(4),await Dc(f)}(this))})}),this.M_=new _B(r,i)}}async function Dc(n){if(ui(n))for(const e of n.v_)await e(!0)}async function So(n){for(const e of n.v_)await e(!1)}function ph(n,e){const t=B(n);t.D_.has(e.targetId)||(t.D_.set(e.targetId,e),Fg(t)?Mg(t):Po(t).Ho()&&Lg(t,e))}function nc(n,e){const t=B(n),r=Po(t);t.D_.delete(e),r.Ho()&&r0(t,e),t.D_.size===0&&(r.Ho()?r.Zo():ui(t)&&t.M_.set("Unknown"))}function Lg(n,e){if(n.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(K.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Po(n).u_(e)}function r0(n,e){n.x_.Oe(e),Po(n).c_(e)}function Mg(n){n.x_=new _U({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.D_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),Po(n).start(),n.M_.g_()}function Fg(n){return ui(n)&&!Po(n).jo()&&n.D_.size>0}function ui(n){return B(n).C_.size===0}function i0(n){n.x_=void 0}async function vB(n){n.D_.forEach((e,t)=>{Lg(n,e)})}async function IB(n,e){i0(n),Fg(n)?(n.M_.w_(e),Mg(n)):n.M_.set("Unknown")}async function wB(n,e,t){if(n.M_.set("Online"),e instanceof TA&&e.state===2&&e.cause)try{await async function(i,s){const a=s.cause;for(const l of s.targetIds)i.D_.has(l)&&(await i.remoteSyncer.rejectListen(l,a),i.D_.delete(l),i.x_.removeTarget(l))}(n,e)}catch(r){N("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Sl(n,r)}else if(e instanceof Zu?n.x_.$e(e):e instanceof EA?n.x_.Je(e):n.x_.Ge(e),!t.isEqual(K.min()))try{const r=await QA(n.localStore);t.compareTo(r)>=0&&await function(s,a){const l=s.x_.it(a);return l.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const p=s.D_.get(f);p&&s.D_.set(f,p.withResumeToken(h.resumeToken,a))}}),l.targetMismatches.forEach((h,f)=>{const p=s.D_.get(h);if(!p)return;s.D_.set(h,p.withResumeToken(it.EMPTY_BYTE_STRING,p.snapshotVersion)),r0(s,h);const m=new cr(p.target,h,f,p.sequenceNumber);Lg(s,m)}),s.remoteSyncer.applyRemoteEvent(l)}(n,t)}catch(r){N("RemoteStore","Failed to raise snapshot:",r),await Sl(n,r)}}async function Sl(n,e,t){if(!ai(e))throw e;n.C_.add(1),await So(n),n.M_.set("Offline"),t||(t=()=>QA(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{N("RemoteStore","Retrying IndexedDB access"),await t(),n.C_.delete(1),await Dc(n)})}function s0(n,e){return e().catch(t=>Sl(n,t,e))}async function bo(n){const e=B(n),t=Jr(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;EB(e);)try{const i=await aB(e.localStore,r);if(i===null){e.b_.length===0&&t.Zo();break}r=i.batchId,TB(e,i)}catch(i){await Sl(e,i)}o0(e)&&a0(e)}function EB(n){return ui(n)&&n.b_.length<10}function TB(n,e){n.b_.push(e);const t=Jr(n);t.Ho()&&t.h_&&t.P_(e.mutations)}function o0(n){return ui(n)&&!Jr(n).jo()&&n.b_.length>0}function a0(n){Jr(n).start()}async function AB(n){Jr(n).E_()}async function RB(n){const e=Jr(n);for(const t of n.b_)e.P_(t.mutations)}async function SB(n,e,t){const r=n.b_.shift(),i=Tg.from(r,e,t);await s0(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await bo(n)}async function bB(n,e){e&&Jr(n).h_&&await async function(r,i){if(function(a){return vA(a)&&a!==b.ABORTED}(i.code)){const s=r.b_.shift();Jr(r).Yo(),await s0(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await bo(r)}}(n,e),o0(n)&&a0(n)}async function WI(n,e){const t=B(n);t.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");const r=ui(t);t.C_.add(3),await So(t),r&&t.M_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.C_.delete(3),await Dc(t)}async function ap(n,e){const t=B(n);e?(t.C_.delete(2),await Dc(t)):e||(t.C_.add(2),await So(t),t.M_.set("Unknown"))}function Po(n){return n.O_||(n.O_=function(t,r,i){const s=B(t);return s.A_(),new pB(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:vB.bind(null,n),Io:IB.bind(null,n),a_:wB.bind(null,n)}),n.v_.push(async e=>{e?(n.O_.Yo(),Fg(n)?Mg(n):n.M_.set("Unknown")):(await n.O_.stop(),i0(n))})),n.O_}function Jr(n){return n.N_||(n.N_=function(t,r,i){const s=B(t);return s.A_(),new gB(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:AB.bind(null,n),Io:bB.bind(null,n),T_:RB.bind(null,n),I_:SB.bind(null,n)}),n.v_.push(async e=>{e?(n.N_.Yo(),await bo(n)):(await n.N_.stop(),n.b_.length>0&&(N("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))})),n.N_}class Ug{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new ct,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const a=Date.now()+r,l=new Ug(e,t,a,i,s);return l.start(r),l}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new D(b.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Co(n,e){if(Xe("AsyncQueue",`${e}: ${n}`),ai(n))return new D(b.UNAVAILABLE,`${e}: ${n}`);throw n}class js{constructor(e){this.comparator=e?(t,r)=>e(t,r)||F.comparator(t.key,r.key):(t,r)=>F.comparator(t.key,r.key),this.keyedMap=ga(),this.sortedSet=new Ce(this.comparator)}static emptySet(e){return new js(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof js)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new js;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class GI{constructor(){this.B_=new Ce(F.comparator)}track(e){const t=e.doc.key,r=this.B_.get(t);r?e.type!==0&&r.type===3?this.B_=this.B_.insert(t,e):e.type===3&&r.type!==1?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.B_=this.B_.remove(t):e.type===1&&r.type===2?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):$():this.B_=this.B_.insert(t,e)}L_(){const e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}}class lo{constructor(e,t,r,i,s,a,l,h,f){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=f}static fromInitialDocuments(e,t,r,i,s){const a=[];return t.forEach(l=>{a.push({type:0,doc:l})}),new lo(e,t,js.emptySet(t),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Rc(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class PB{constructor(){this.k_=void 0,this.listeners=[]}}class CB{constructor(){this.queries=new ci(e=>iA(e),Rc),this.onlineState="Unknown",this.q_=new Set}}async function Bg(n,e){const t=B(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new PB),i)try{s.k_=await t.onListen(r)}catch(a){const l=Co(a,`Initialization of query '${Ns(e.query)}' failed`);return void e.onError(l)}t.queries.set(r,s),s.listeners.push(e),e.Q_(t.onlineState),s.k_&&e.K_(s.k_)&&$g(t)}async function qg(n,e){const t=B(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const a=s.listeners.indexOf(e);a>=0&&(s.listeners.splice(a,1),i=s.listeners.length===0)}if(i)return t.queries.delete(r),t.onUnlisten(r)}function kB(n,e){const t=B(n);let r=!1;for(const i of e){const s=i.query,a=t.queries.get(s);if(a){for(const l of a.listeners)l.K_(i)&&(r=!0);a.k_=i}}r&&$g(t)}function DB(n,e,t){const r=B(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function $g(n){n.q_.forEach(e=>{e.next()})}class Wg{constructor(e,t,r){this.query=e,this.U_=t,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=r||{}}K_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new lo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.W_?this.z_(e)&&(this.U_.next(e),t=!0):this.j_(e,this.onlineState)&&(this.H_(e),t=!0),this.G_=e,t}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let t=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),t=!0),t}j_(e,t){if(!e.fromCache)return!0;const r=t!=="Offline";return(!this.options.J_||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}z_(e){if(e.docChanges.length>0)return!0;const t=this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}H_(e){e=lo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}class xB{constructor(e,t){this.Y_=e,this.byteLength=t}Z_(){return"metadata"in this.Y_}}class zI{constructor(e){this.serializer=e}hs(e){return Wn(this.serializer,e)}Ps(e){return e.metadata.exists?PA(this.serializer,e.document,!1):Ne.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return Ze(e)}}class NB{constructor(e,t,r){this.X_=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=c0(e)}ea(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Y_.namedQuery)this.queries.push(e.Y_.namedQuery);else if(e.Y_.documentMetadata){this.documents.push({metadata:e.Y_.documentMetadata}),e.Y_.documentMetadata.exists||++t;const r=ge.fromString(e.Y_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Y_.document&&(this.documents[this.documents.length-1].document=e.Y_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ta(e){const t=new Map,r=new zI(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const a of i.metadata.queries){const l=(t.get(a)||re()).add(s);t.set(a,l)}}return t}async complete(){const e=await cB(this.localStore,new zI(this.serializer),this.documents,this.X_.id),t=this.ta(this.documents);for(const r of this.queries)await uB(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,na:this.collectionGroups,ra:e}}}function c0(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class u0{constructor(e){this.key=e}}class l0{constructor(e){this.key=e}}class h0{constructor(e,t){this.query=e,this.ia=t,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=re(),this.mutatedKeys=re(),this._a=oA(e),this.aa=new js(this._a)}get ua(){return this.ia}ca(e,t){const r=t?t.la:new GI,i=t?t.aa:this.aa;let s=t?t.mutatedKeys:this.mutatedKeys,a=i,l=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,f=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,m)=>{const I=i.get(p),A=Sc(this.query,m)?m:null,L=!!I&&this.mutatedKeys.has(I.key),M=!!A&&(A.hasLocalMutations||this.mutatedKeys.has(A.key)&&A.hasCommittedMutations);let V=!1;I&&A?I.data.isEqual(A.data)?L!==M&&(r.track({type:3,doc:A}),V=!0):this.ha(I,A)||(r.track({type:2,doc:A}),V=!0,(h&&this._a(A,h)>0||f&&this._a(A,f)<0)&&(l=!0)):!I&&A?(r.track({type:0,doc:A}),V=!0):I&&!A&&(r.track({type:1,doc:I}),V=!0,(h||f)&&(l=!0)),V&&(A?(a=a.add(A),s=M?s.add(p):s.delete(p)):(a=a.delete(p),s=s.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),s=s.delete(p.key),r.track({type:1,doc:p})}return{aa:a,la:r,Zi:l,mutatedKeys:s}}ha(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const a=e.la.L_();a.sort((p,m)=>function(A,L){const M=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $()}};return M(A)-M(L)}(p.type,m.type)||this._a(p.doc,m.doc)),this.Pa(r),i=i!=null&&i;const l=t&&!i?this.Ia():[],h=this.oa.size===0&&this.current&&!i?1:0,f=h!==this.sa;return this.sa=h,a.length!==0||f?{snapshot:new lo(this.query,e.aa,s,a,e.mutatedKeys,h===0,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ta:l}:{Ta:l}}Q_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({aa:this.aa,la:new GI,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(t=>this.ia=this.ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ia=this.ia.delete(t)),this.current=e.current)}Ia(){if(!this.current)return[];const e=this.oa;this.oa=re(),this.aa.forEach(r=>{this.Ea(r.key)&&(this.oa=this.oa.add(r.key))});const t=[];return e.forEach(r=>{this.oa.has(r)||t.push(new l0(r))}),this.oa.forEach(r=>{e.has(r)||t.push(new u0(r))}),t}da(e){this.ia=e.ls,this.oa=re();const t=this.ca(e.documents);return this.applyChanges(t,!0)}Aa(){return lo.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,this.sa===0,this.hasCachedResults)}}class VB{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class OB{constructor(e){this.key=e,this.Ra=!1}}class LB{constructor(e,t,r,i,s,a){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Va={},this.ma=new ci(l=>iA(l),Rc),this.fa=new Map,this.ga=new Set,this.pa=new Ce(F.comparator),this.ya=new Map,this.wa=new kg,this.Sa={},this.ba=new Map,this.Da=Qi.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return this.Ca===!0}}async function MB(n,e){const t=jg(n);let r,i;const s=t.ma.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const a=await co(t.localStore,Lt(e)),l=t.sharedClientState.addLocalQueryTarget(a.targetId);r=a.targetId,i=await Gg(t,e,r,l==="current",a.resumeToken),t.isPrimaryClient&&ph(t.remoteStore,a)}return i}async function Gg(n,e,t,r,i){n.va=(m,I,A)=>async function(M,V,Y,ae){let j=V.view.ca(Y);j.Zi&&(j=await Tl(M.localStore,V.query,!1).then(({documents:we})=>V.view.ca(we,j)));const ye=ae&&ae.targetChanges.get(V.targetId),de=ae&&ae.targetMismatches.get(V.targetId)!=null,me=V.view.applyChanges(j,M.isPrimaryClient,ye,de);return cp(M,V.targetId,me.Ta),me.snapshot}(n,m,I,A);const s=await Tl(n.localStore,e,!0),a=new h0(e,s.ls),l=a.ca(s.documents),h=Cc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),f=a.applyChanges(l,n.isPrimaryClient,h);cp(n,t,f.Ta);const p=new VB(e,t,a);return n.ma.set(e,p),n.fa.has(t)?n.fa.get(t).push(e):n.fa.set(t,[e]),f.snapshot}async function FB(n,e){const t=B(n),r=t.ma.get(e),i=t.fa.get(r.targetId);if(i.length>1)return t.fa.set(r.targetId,i.filter(s=>!Rc(s,e))),void t.ma.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||await uo(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),nc(t.remoteStore,r.targetId),ho(t,r.targetId)}).catch(oi)):(ho(t,r.targetId),await uo(t.localStore,r.targetId,!0))}async function UB(n,e,t){const r=Qg(n);try{const i=await function(a,l){const h=B(a),f=Fe.now(),p=l.reduce((A,L)=>A.add(L.key),re());let m,I;return h.persistence.runTransaction("Locally write mutations","readwrite",A=>{let L=Kt(),M=re();return h.ss.getEntries(A,p).next(V=>{L=V,L.forEach((Y,ae)=>{ae.isValidDocument()||(M=M.add(Y))})}).next(()=>h.localDocuments.getOverlayedDocuments(A,L)).next(V=>{m=V;const Y=[];for(const ae of l){const j=pU(ae,m.get(ae.key).overlayedDocument);j!=null&&Y.push(new vr(ae.key,j,QT(j.value.mapValue),Me.exists(!0)))}return h.mutationQueue.addMutationBatch(A,f,Y,l)}).next(V=>{I=V;const Y=V.applyToLocalDocumentSet(m,M);return h.documentOverlayCache.saveOverlays(A,V.batchId,Y)})}).then(()=>({batchId:I.batchId,changes:cA(m)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,l,h){let f=a.Sa[a.currentUser.toKey()];f||(f=new Ce(ne)),f=f.insert(l,h),a.Sa[a.currentUser.toKey()]=f}(r,i.batchId,t),await Ir(r,i.changes),await bo(r.remoteStore)}catch(i){const s=Co(i,"Failed to persist write");t.reject(s)}}async function d0(n,e){const t=B(n);try{const r=await oB(t.localStore,e);e.targetChanges.forEach((i,s)=>{const a=t.ya.get(s);a&&(z(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.Ra=!0:i.modifiedDocuments.size>0?z(a.Ra):i.removedDocuments.size>0&&(z(a.Ra),a.Ra=!1))}),await Ir(t,r,e)}catch(r){await oi(r)}}function KI(n,e,t){const r=B(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.ma.forEach((s,a)=>{const l=a.view.Q_(e);l.snapshot&&i.push(l.snapshot)}),function(a,l){const h=B(a);h.onlineState=l;let f=!1;h.queries.forEach((p,m)=>{for(const I of m.listeners)I.Q_(l)&&(f=!0)}),f&&$g(h)}(r.eventManager,e),i.length&&r.Va.a_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function BB(n,e,t){const r=B(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.ya.get(e),s=i&&i.key;if(s){let a=new Ce(F.comparator);a=a.insert(s,Ne.newNoDocument(s,K.min()));const l=re().add(s),h=new Pc(K.min(),new Map,new Ce(ne),a,l);await d0(r,h),r.pa=r.pa.remove(s),r.ya.delete(e),Hg(r)}else await uo(r.localStore,e,!1).then(()=>ho(r,e,t)).catch(oi)}async function qB(n,e){const t=B(n),r=e.batch.batchId;try{const i=await sB(t.localStore,e);Kg(t,r,null),zg(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Ir(t,i)}catch(i){await oi(i)}}async function $B(n,e,t){const r=B(n);try{const i=await function(a,l){const h=B(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let p;return h.mutationQueue.lookupMutationBatch(f,l).next(m=>(z(m!==null),p=m.keys(),h.mutationQueue.removeMutationBatch(f,m))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,p,l)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,p)).next(()=>h.localDocuments.getDocuments(f,p))})}(r.localStore,e);Kg(r,e,t),zg(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Ir(r,i)}catch(i){await oi(i)}}async function WB(n,e){const t=B(n);ui(t.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(a){const l=B(a);return l.persistence.runTransaction("Get highest unacknowledged batch id","readonly",h=>l.mutationQueue.getHighestUnacknowledgedBatchId(h))}(t.localStore);if(r===-1)return void e.resolve();const i=t.ba.get(r)||[];i.push(e),t.ba.set(r,i)}catch(r){const i=Co(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}function zg(n,e){(n.ba.get(e)||[]).forEach(t=>{t.resolve()}),n.ba.delete(e)}function Kg(n,e,t){const r=B(n);let i=r.Sa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Sa[r.currentUser.toKey()]=i}}function ho(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.fa.get(e))n.ma.delete(r),t&&n.Va.Fa(r,t);n.fa.delete(e),n.isPrimaryClient&&n.wa.Rr(e).forEach(r=>{n.wa.containsKey(r)||f0(n,r)})}function f0(n,e){n.ga.delete(e.path.canonicalString());const t=n.pa.get(e);t!==null&&(nc(n.remoteStore,t),n.pa=n.pa.remove(e),n.ya.delete(t),Hg(n))}function cp(n,e,t){for(const r of t)r instanceof u0?(n.wa.addReference(r.key,e),GB(n,r)):r instanceof l0?(N("SyncEngine","Document no longer in limbo: "+r.key),n.wa.removeReference(r.key,e),n.wa.containsKey(r.key)||f0(n,r.key)):$()}function GB(n,e){const t=e.key,r=t.path.canonicalString();n.pa.get(t)||n.ga.has(r)||(N("SyncEngine","New document in limbo: "+t),n.ga.add(r),Hg(n))}function Hg(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){const e=n.ga.values().next().value;n.ga.delete(e);const t=new F(ge.fromString(e)),r=n.Da.next();n.ya.set(r,new OB(t)),n.pa=n.pa.insert(t,r),ph(n.remoteStore,new cr(Lt(To(t.path)),r,"TargetPurposeLimboResolution",Gt._e))}}async function Ir(n,e,t){const r=B(n),i=[],s=[],a=[];r.ma.isEmpty()||(r.ma.forEach((l,h)=>{a.push(r.va(h,e,t).then(f=>{if((f||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(h.targetId,f!=null&&f.fromCache?"not-current":"current"),f){i.push(f);const p=Ng.Qi(h.targetId,f);s.push(p)}}))}),await Promise.all(a),r.Va.a_(i),await async function(h,f){const p=B(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",m=>R.forEach(f,I=>R.forEach(I.ki,A=>p.persistence.referenceDelegate.addReference(m,I.targetId,A)).next(()=>R.forEach(I.qi,A=>p.persistence.referenceDelegate.removeReference(m,I.targetId,A)))))}catch(m){if(!ai(m))throw m;N("LocalStore","Failed to update sequence numbers: "+m)}for(const m of f){const I=m.targetId;if(!m.fromCache){const A=p.ts.get(I),L=A.snapshotVersion,M=A.withLastLimboFreeSnapshotVersion(L);p.ts=p.ts.insert(I,M)}}}(r.localStore,s))}async function zB(n,e){const t=B(n);if(!t.currentUser.isEqual(e)){N("SyncEngine","User change. New user:",e.toKey());const r=await jA(t.localStore,e);t.currentUser=e,function(s,a){s.ba.forEach(l=>{l.forEach(h=>{h.reject(new D(b.CANCELLED,a))})}),s.ba.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ir(t,r._s)}}function KB(n,e){const t=B(n),r=t.ya.get(e);if(r&&r.Ra)return re().add(r.key);{let i=re();const s=t.fa.get(e);if(!s)return i;for(const a of s){const l=t.ma.get(a);i=i.unionWith(l.view.ua)}return i}}async function HB(n,e){const t=B(n),r=await Tl(t.localStore,e.query,!0),i=e.view.da(r);return t.isPrimaryClient&&cp(t,e.targetId,i.Ta),i}async function jB(n,e){const t=B(n);return XA(t.localStore,e).then(r=>Ir(t,r))}async function QB(n,e,t,r){const i=B(n),s=await function(l,h){const f=B(l),p=B(f.mutationQueue);return f.persistence.runTransaction("Lookup mutation documents","readonly",m=>p.Cn(m,h).next(I=>I?f.localDocuments.getDocuments(m,I):R.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?await bo(i.remoteStore):t==="acknowledged"||t==="rejected"?(Kg(i,e,r||null),zg(i,e),function(l,h){B(B(l).mutationQueue).Fn(h)}(i.localStore,e)):$(),await Ir(i,s)):N("SyncEngine","Cannot apply mutation batch with id: "+e)}async function YB(n,e){const t=B(n);if(jg(t),Qg(t),e===!0&&t.Ca!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),i=await HI(t,r.toArray());t.Ca=!0,await ap(t.remoteStore,!0);for(const s of i)ph(t.remoteStore,s)}else if(e===!1&&t.Ca!==!1){const r=[];let i=Promise.resolve();t.fa.forEach((s,a)=>{t.sharedClientState.isLocalQueryTarget(a)?r.push(a):i=i.then(()=>(ho(t,a),uo(t.localStore,a,!0))),nc(t.remoteStore,a)}),await i,await HI(t,r),function(a){const l=B(a);l.ya.forEach((h,f)=>{nc(l.remoteStore,f)}),l.wa.Vr(),l.ya=new Map,l.pa=new Ce(F.comparator)}(t),t.Ca=!1,await ap(t.remoteStore,!1)}}async function HI(n,e,t){const r=B(n),i=[],s=[];for(const a of e){let l;const h=r.fa.get(a);if(h&&h.length!==0){l=await co(r.localStore,Lt(h[0]));for(const f of h){const p=r.ma.get(f),m=await HB(r,p);m.snapshot&&s.push(m.snapshot)}}else{const f=await JA(r.localStore,a);l=await co(r.localStore,f),await Gg(r,p0(f),a,!1,l.resumeToken)}i.push(l)}return r.Va.a_(s),i}function p0(n){return rA(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function JB(n){return function(t){return B(B(t).persistence).Bi()}(B(n).localStore)}async function XB(n,e,t,r){const i=B(n);if(i.Ca)return void N("SyncEngine","Ignoring unexpected query state notification.");const s=i.fa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const a=await XA(i.localStore,sA(s[0])),l=Pc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",it.EMPTY_BYTE_STRING);await Ir(i,a,l);break}case"rejected":await uo(i.localStore,e,!0),ho(i,e,r);break;default:$()}}async function ZB(n,e,t){const r=jg(n);if(r.Ca){for(const i of e){if(r.fa.has(i)){N("SyncEngine","Adding an already active target "+i);continue}const s=await JA(r.localStore,i),a=await co(r.localStore,s);await Gg(r,p0(s),a.targetId,!1,a.resumeToken),ph(r.remoteStore,a)}for(const i of t)r.fa.has(i)&&await uo(r.localStore,i,!1).then(()=>{nc(r.remoteStore,i),ho(r,i)}).catch(oi)}}function jg(n){const e=B(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=d0.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=KB.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=BB.bind(null,e),e.Va.a_=kB.bind(null,e.eventManager),e.Va.Fa=DB.bind(null,e.eventManager),e}function Qg(n){const e=B(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=qB.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=$B.bind(null,e),e}function eq(n,e,t){const r=B(n);(async function(s,a,l){try{const h=await a.getMetadata();if(await function(A,L){const M=B(A),V=Ze(L.createTime);return M.persistence.runTransaction("hasNewerBundle","readonly",Y=>M.Kr.getBundleMetadata(Y,L.id)).then(Y=>!!Y&&Y.createTime.compareTo(V)>=0)}(s.localStore,h))return await a.close(),l._completeWith(function(A){return{taskState:"Success",documentsLoaded:A.totalDocuments,bytesLoaded:A.totalBytes,totalDocuments:A.totalDocuments,totalBytes:A.totalBytes}}(h)),Promise.resolve(new Set);l._updateProgress(c0(h));const f=new NB(h,s.localStore,a.serializer);let p=await a.Ma();for(;p;){const I=await f.ea(p);I&&l._updateProgress(I),p=await a.Ma()}const m=await f.complete();return await Ir(s,m.ra,void 0),await function(A,L){const M=B(A);return M.persistence.runTransaction("Save bundle","readwrite",V=>M.Kr.saveBundleMetadata(V,L))}(s.localStore,h),l._completeWith(m.progress),Promise.resolve(m.na)}catch(h){return An("SyncEngine",`Loading bundle failed with ${h}`),l._failWith(h),Promise.resolve(new Set)}})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}class up{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=kc(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return HA(this.persistence,new KA,e.initialUser,this.serializer)}createPersistence(e){return new zA(fh.jr,this.serializer)}createSharedClientState(e){return new e0}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class g0 extends up{constructor(e,t,r){super(),this.xa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xa.initialize(this,e),await Qg(this.xa.syncEngine),await bo(this.xa.remoteStore),await this.persistence.mi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return HA(this.persistence,new KA,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new $U(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new R2(t,this.persistence);return new A2(e.asyncQueue,r)}createPersistence(e){const t=xg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Wt.withCacheSize(this.cacheSizeBytes):Wt.DEFAULT;return new Dg(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,t0(),el(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new e0}}class tq extends g0{constructor(e,t){super(e,t,!1),this.xa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xa.syncEngine;this.sharedClientState instanceof vf&&(this.sharedClientState.syncEngine={Ys:QB.bind(null,t),Zs:XB.bind(null,t),Xs:ZB.bind(null,t),Bi:JB.bind(null,t),Js:jB.bind(null,t)},await this.sharedClientState.start()),await this.persistence.mi(async r=>{await YB(this.xa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){const t=t0();if(!vf.D(t))throw new D(b.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=xg(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new vf(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Yg{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>KI(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=zB.bind(null,this.syncEngine),await ap(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new CB}()}createDatastore(e){const t=kc(e.databaseInfo.databaseId),r=function(s){return new fB(s)}(e.databaseInfo);return function(s,a,l,h){return new mB(s,a,l,h)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,a,l){return new yB(r,i,s,a,l)}(this.localStore,this.datastore,e.asyncQueue,t=>KI(this.syncEngine,t,0),function(){return $I.D()?new $I:new lB}())}createSyncEngine(e,t){return function(i,s,a,l,h,f,p){const m=new LB(i,s,a,l,h,f);return p&&(m.Ca=!0),m}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(t){const r=B(t);N("RemoteStore","RemoteStore shutting down."),r.C_.add(5),await So(r),r.F_.shutdown(),r.M_.set("Unknown")}(this.remoteStore)}}function jI(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class gh{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):Xe("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class nq{constructor(e,t){this.Ba=e,this.serializer=t,this.metadata=new ct,this.buffer=new Uint8Array,this.La=function(){return new TextDecoder("utf-8")}(),this.ka().then(r=>{r&&r.Z_()?this.metadata.resolve(r.Y_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Y_)}`))},r=>this.metadata.reject(r))}close(){return this.Ba.cancel()}async getMetadata(){return this.metadata.promise}async Ma(){return await this.getMetadata(),this.ka()}async ka(){const e=await this.qa();if(e===null)return null;const t=this.La.decode(e),r=Number(t);isNaN(r)&&this.Qa(`length string (${t}) is not valid number`);const i=await this.Ka(r);return new xB(JSON.parse(i),e.length+r)}$a(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qa(){for(;this.$a()<0&&!await this.Ua(););if(this.buffer.length===0)return null;const e=this.$a();e<0&&this.Qa("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Ka(e){for(;this.buffer.length<e;)await this.Ua()&&this.Qa("Reached the end of bundle when more is expected.");const t=this.La.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qa(e){throw this.Ba.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ua(){const e=await this.Ba.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class rq{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new D(b.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(i,s){const a=B(i),l=ec(a.serializer)+"/documents",h={documents:s.map(I=>Za(a.serializer,I))},f=await a.Co("BatchGetDocuments",l,h,s.length),p=new Map;f.forEach(I=>{const A=TU(a.serializer,I);p.set(A.key.toString(),A)});const m=[];return s.forEach(I=>{const A=p.get(I.toString());z(!!A),m.push(A)}),m}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Ro(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const i=F.fromPath(r);this.mutations.push(new wg(i,this.precondition(i)))}),await async function(r,i){const s=B(r),a=ec(s.serializer)+"/documents",l={writes:i.map(h=>tc(s.serializer,h))};await s.wo("Commit",a,l)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw $();t=K.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new D(b.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(K.min())?Me.exists(!1):Me.updateTime(t):Me.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(K.min()))throw new D(b.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Me.updateTime(t)}return Me.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class iq{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Wa=r.maxAttempts,this.zo=new Og(this.asyncQueue,"transaction_retry")}run(){this.Wa-=1,this.Ga()}Ga(){this.zo.ko(async()=>{const e=new rq(this.datastore),t=this.za(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.ja(i)}))}).catch(r=>{this.ja(r)})})}za(e){try{const t=this.updateFunction(e);return!Tc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ja(e){this.Wa>0&&this.Ha(e)?(this.Wa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(e)}Ha(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!vA(t)}return!1}}class sq{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=at.UNAUTHENTICATED,this.clientId=OT.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async s=>{N("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(r,s=>(N("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new D(b.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new ct;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Co(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function tl(n,e){n.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");const t=await n.getConfiguration();await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await jA(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function lp(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Jg(n);N("FirestoreClient","Initializing OnlineComponentProvider");const r=await n.getConfiguration();await e.initialize(t,r),n.setCredentialChangeListener(i=>WI(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>WI(e.remoteStore,s)),n._onlineComponents=e}function m0(n){return n.name==="FirebaseError"?n.code===b.FAILED_PRECONDITION||n.code===b.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}async function Jg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){N("FirestoreClient","Using user provided OfflineComponentProvider");try{await tl(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!m0(t))throw t;An("Error using user provided cache. Falling back to memory cache: "+t),await tl(n,new up)}}else N("FirestoreClient","Using default OfflineComponentProvider"),await tl(n,new up);return n._offlineComponents}async function mh(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(N("FirestoreClient","Using user provided OnlineComponentProvider"),await lp(n,n._uninitializedComponentsProvider._online)):(N("FirestoreClient","Using default OnlineComponentProvider"),await lp(n,new Yg))),n._onlineComponents}function _0(n){return Jg(n).then(e=>e.persistence)}function Xg(n){return Jg(n).then(e=>e.localStore)}function y0(n){return mh(n).then(e=>e.remoteStore)}function Zg(n){return mh(n).then(e=>e.syncEngine)}function oq(n){return mh(n).then(e=>e.datastore)}async function fo(n){const e=await mh(n),t=e.eventManager;return t.onListen=MB.bind(null,e.syncEngine),t.onUnlisten=FB.bind(null,e.syncEngine),t}function aq(n){return n.asyncQueue.enqueue(async()=>{const e=await _0(n),t=await y0(n);return e.setNetworkEnabled(!0),function(i){const s=B(i);return s.C_.delete(0),Dc(s)}(t)})}function cq(n){return n.asyncQueue.enqueue(async()=>{const e=await _0(n),t=await y0(n);return e.setNetworkEnabled(!1),async function(i){const s=B(i);s.C_.add(0),await So(s),s.M_.set("Offline")}(t)})}function uq(n,e){const t=new ct;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,a){try{const l=await function(f,p){const m=B(f);return m.persistence.runTransaction("read document","readonly",I=>m.localDocuments.getDocument(I,p))}(i,s);l.isFoundDocument()?a.resolve(l):l.isNoDocument()?a.resolve(null):a.reject(new D(b.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(l){const h=Co(l,`Failed to get document '${s} from cache`);a.reject(h)}}(await Xg(n),e,t)),t.promise}function v0(n,e,t={}){const r=new ct;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,l,h,f){const p=new gh({next:I=>{a.enqueueAndForget(()=>qg(s,m));const A=I.docs.has(l);!A&&I.fromCache?f.reject(new D(b.UNAVAILABLE,"Failed to get document because the client is offline.")):A&&I.fromCache&&h&&h.source==="server"?f.reject(new D(b.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(I)},error:I=>f.reject(I)}),m=new Wg(To(l.path),p,{includeMetadataChanges:!0,J_:!0});return Bg(s,m)}(await fo(n),n.asyncQueue,e,t,r)),r.promise}function lq(n,e){const t=new ct;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,a){try{const l=await Tl(i,s,!0),h=new h0(s,l.ls),f=h.ca(l.documents),p=h.applyChanges(f,!1);a.resolve(p.snapshot)}catch(l){const h=Co(l,`Failed to execute query '${s} against cache`);a.reject(h)}}(await Xg(n),e,t)),t.promise}function I0(n,e,t={}){const r=new ct;return n.asyncQueue.enqueueAndForget(async()=>function(s,a,l,h,f){const p=new gh({next:I=>{a.enqueueAndForget(()=>qg(s,m)),I.fromCache&&h.source==="server"?f.reject(new D(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(I)},error:I=>f.reject(I)}),m=new Wg(l,p,{includeMetadataChanges:!0,J_:!0});return Bg(s,m)}(await fo(n),n.asyncQueue,e,t,r)),r.promise}function hq(n,e){const t=new gh(e);return n.asyncQueue.enqueueAndForget(async()=>function(i,s){B(i).q_.add(s),s.next()}(await fo(n),t)),()=>{t.Na(),n.asyncQueue.enqueueAndForget(async()=>function(i,s){B(i).q_.delete(s)}(await fo(n),t))}}function dq(n,e,t,r){const i=function(a,l){let h;return h=typeof a=="string"?wA().encode(a):a,function(p,m){return new nq(p,m)}(function(p,m){if(p instanceof Uint8Array)return jI(p,m);if(p instanceof ArrayBuffer)return jI(new Uint8Array(p),m);if(p instanceof ReadableStream)return p.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(h),l)}(t,kc(e));n.asyncQueue.enqueueAndForget(async()=>{eq(await Zg(n),i,r)})}function fq(n,e){return n.asyncQueue.enqueue(async()=>function(r,i){const s=B(r);return s.persistence.runTransaction("Get named query","readonly",a=>s.Kr.getNamedQuery(a,i))}(await Xg(n),e))}function w0(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const QI=new Map;function em(n,e,t){if(!t)throw new D(b.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function E0(n,e,t,r){if(e===!0&&r===!0)throw new D(b.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function YI(n){if(!F.isDocumentKey(n))throw new D(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function JI(n){if(F.isDocumentKey(n))throw new D(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function _h(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":$()}function _e(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new D(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=_h(n);throw new D(b.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function T0(n,e){if(e<=0)throw new D(b.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class XI{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new D(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new D(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}E0("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=w0((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new D(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new D(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new D(b.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class xc{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new XI({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new D(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new D(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new XI(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new f2;switch(r.type){case"firstParty":return new _2(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new D(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=QI.get(t);r&&(N("ComponentProvider","Removing Datastore"),QI.delete(t),r.terminate())}(this),Promise.resolve()}}function pq(n,e,t,r={}){var i;const s=(n=_e(n,xc))._getSettings(),a=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&An("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let l,h;if(typeof r.mockUserToken=="string")l=r.mockUserToken,h=at.MOCK_USER;else{l=Tx(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new D(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new at(f)}n._authCredentials=new p2(new VT(l,h))}}let bt=class{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new bt(this.firestore,e,this._query)}},Ue=class{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new dr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ue(this.firestore,e,this._key)}},dr=class extends bt{constructor(e,t,r){super(e,t,To(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ue(this.firestore,null,new F(e))}withConverter(e){return new dr(this.firestore,e,this._path)}};function A0(n,e,...t){if(n=H(n),em("collection","path",e),n instanceof xc){const r=ge.fromString(e,...t);return JI(r),new dr(n,null,r)}{if(!(n instanceof Ue||n instanceof dr))throw new D(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ge.fromString(e,...t));return JI(r),new dr(n.firestore,null,r)}}function gq(n,e){if(n=_e(n,xc),em("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new D(b.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new bt(n,null,function(r){return new yr(ge.emptyPath(),r)}(e))}function rc(n,e,...t){if(n=H(n),arguments.length===1&&(e=OT.newId()),em("doc","path",e),n instanceof xc){const r=ge.fromString(e,...t);return YI(r),new Ue(n,null,new F(r))}{if(!(n instanceof Ue||n instanceof dr))throw new D(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ge.fromString(e,...t));return YI(r),new Ue(n.firestore,n instanceof dr?n.converter:null,new F(r))}}function R0(n,e){return n=H(n),e=H(e),(n instanceof Ue||n instanceof dr)&&(e instanceof Ue||e instanceof dr)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function S0(n,e){return n=H(n),e=H(e),n instanceof bt&&e instanceof bt&&n.firestore===e.firestore&&Rc(n._query,e._query)&&n.converter===e.converter}class mq{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new Og(this,"async_queue_retry"),this.iu=()=>{const t=el();t&&N("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const e=el();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const t=el();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const t=new ct;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}async _u(){if(this.Ya.length!==0){try{await this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(e){if(!ai(e))throw e;N("AsyncQueue","Operation failed with retryable error: "+e)}this.Ya.length>0&&this.zo.ko(()=>this._u())}}ou(e){const t=this.Ja.then(()=>(this.tu=!0,e().catch(r=>{this.eu=r,this.tu=!1;const i=function(a){let l=a.message||"";return a.stack&&(l=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),l}(r);throw Xe("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.tu=!1,r))));return this.Ja=t,t}enqueueAfterDelay(e,t,r){this.su(),this.ru.indexOf(e)>-1&&(t=0);const i=Ug.createAndSchedule(this,e,t,r,s=>this.au(s));return this.Xa.push(i),i}su(){this.eu&&$()}verifyOperationInProgress(){}async uu(){let e;do e=this.Ja,await e;while(e!==this.Ja)}cu(e){for(const t of this.Xa)if(t.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Xa)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){const t=this.Xa.indexOf(e);this.Xa.splice(t,1)}}function hp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}class _q{constructor(){this._progressObserver={},this._taskCompletionResolver=new ct,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const yq=-1;let He=class extends xc{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new mq}(),this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||b0(this),this._firestoreClient.terminate()}};function dt(n){return n._firestoreClient||b0(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function b0(n){var e,t,r;const i=n._freezeSettings(),s=function(l,h,f,p){return new K2(l,h,f,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,w0(p.experimentalLongPollingOptions),p.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new sq(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function vq(n,e){C0(n=_e(n,He));const t=dt(n);if(t._uninitializedComponentsProvider)throw new D(b.FAILED_PRECONDITION,"SDK cache is already specified.");An("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new Yg;return P0(t,i,new g0(i,r.cacheSizeBytes,e==null?void 0:e.forceOwnership))}function Iq(n){C0(n=_e(n,He));const e=dt(n);if(e._uninitializedComponentsProvider)throw new D(b.FAILED_PRECONDITION,"SDK cache is already specified.");An("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new Yg;return P0(e,r,new tq(r,t.cacheSizeBytes))}function P0(n,e,t){const r=new ct;return n.asyncQueue.enqueue(async()=>{try{await tl(n,t),await lp(n,e),r.resolve()}catch(i){const s=i;if(!m0(s))throw s;An("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}}).then(()=>r.promise)}function wq(n){if(n._initialized&&!n._terminated)throw new D(b.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ct;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!wn.D())return Promise.resolve();const i=r+"main";await wn.delete(i)}(xg(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function Eq(n){return function(t){const r=new ct;return t.asyncQueue.enqueueAndForget(async()=>WB(await Zg(t),r)),r.promise}(dt(n=_e(n,He)))}function Tq(n){return aq(dt(n=_e(n,He)))}function Aq(n){return cq(dt(n=_e(n,He)))}function Rq(n,e){const t=dt(n=_e(n,He)),r=new _q;return dq(t,n._databaseId,e,r),r}function Sq(n,e){return fq(dt(n=_e(n,He)),e).then(t=>t?new bt(n,null,t.query):null)}function C0(n){if(n._initialized||n._terminated)throw new D(b.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class jn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new jn(it.fromBase64String(e))}catch(t){throw new D(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new jn(it.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}let Xr=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new D(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Le(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};let ns=class{constructor(e){this._methodName=e}};class yh{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new D(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new D(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return ne(this._lat,e._lat)||ne(this._long,e._long)}}const bq=/^__.*__$/;class Pq{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new vr(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ao(e,this.data,t,this.fieldTransforms)}}class k0{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new vr(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function D0(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $()}}class vh{constructor(e,t,r,i,s,a){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Pu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new vh(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Au(e),i}Ru(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Pu(),i}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return bl(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(e.length===0)throw this.mu("Document fields must not be empty");if(D0(this.Iu)&&bq.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class Cq{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||kc(e)}pu(e,t,r,i=!1){return new vh({Iu:e,methodName:t,gu:r,path:Le.emptyPath(),du:!1,fu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function rs(n){const e=n._freezeSettings(),t=kc(n._databaseId);return new Cq(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ih(n,e,t,r,i,s={}){const a=n.pu(s.merge||s.mergeFields?2:0,e,t,i);im("Data must be an object, but it was:",a,r);const l=V0(r,a);let h,f;if(s.merge)h=new zt(a.fieldMask),f=a.fieldTransforms;else if(s.mergeFields){const p=[];for(const m of s.mergeFields){const I=dp(e,m,t);if(!a.contains(I))throw new D(b.INVALID_ARGUMENT,`Field '${I}' is specified in your field mask but missing from your input data.`);L0(p,I)||p.push(I)}h=new zt(p),f=a.fieldTransforms.filter(m=>h.covers(m.field))}else h=null,f=a.fieldTransforms;return new Pq(new yt(l),h,f)}class Nc extends ns{_toFieldTransform(e){if(e.Iu!==2)throw e.Iu===1?e.mu(`${this._methodName}() can only appear at the top level of your update data`):e.mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Nc}}function x0(n,e,t){return new vh({Iu:3,gu:e.settings.gu,methodName:n._methodName,du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class tm extends ns{_toFieldTransform(e){return new bc(e.path,new so)}isEqual(e){return e instanceof tm}}class kq extends ns{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=x0(this,e,!0),r=this.yu.map(s=>is(s,t)),i=new zi(r);return new bc(e.path,i)}isEqual(e){return this===e}}class Dq extends ns{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=x0(this,e,!0),r=this.yu.map(s=>is(s,t)),i=new Ki(r);return new bc(e.path,i)}isEqual(e){return this===e}}class xq extends ns{constructor(e,t){super(e),this.wu=t}_toFieldTransform(e){const t=new oo(e.serializer,dA(e.serializer,this.wu));return new bc(e.path,t)}isEqual(e){return this===e}}function nm(n,e,t,r){const i=n.pu(1,e,t);im("Data must be an object, but it was:",i,r);const s=[],a=yt.empty();ts(r,(h,f)=>{const p=sm(e,h,t);f=H(f);const m=i.Ru(p);if(f instanceof Nc)s.push(p);else{const I=is(f,m);I!=null&&(s.push(p),a.set(p,I))}});const l=new zt(s);return new k0(a,l,i.fieldTransforms)}function rm(n,e,t,r,i,s){const a=n.pu(1,e,t),l=[dp(e,r,t)],h=[i];if(s.length%2!=0)throw new D(b.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let I=0;I<s.length;I+=2)l.push(dp(e,s[I])),h.push(s[I+1]);const f=[],p=yt.empty();for(let I=l.length-1;I>=0;--I)if(!L0(f,l[I])){const A=l[I];let L=h[I];L=H(L);const M=a.Ru(A);if(L instanceof Nc)f.push(A);else{const V=is(L,M);V!=null&&(f.push(A),p.set(A,V))}}const m=new zt(f);return new k0(p,m,a.fieldTransforms)}function N0(n,e,t,r=!1){return is(t,n.pu(r?4:3,e))}function is(n,e){if(O0(n=H(n)))return im("Unsupported field value:",e,n),V0(n,e);if(n instanceof ns)return function(r,i){if(!D0(i.Iu))throw i.mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.mu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.du&&e.Iu!==4)throw e.mu("Nested arrays are not supported");return function(r,i){const s=[];let a=0;for(const l of r){let h=is(l,i.Vu(a));h==null&&(h={nullValue:"NULL_VALUE"}),s.push(h),a++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=H(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return dA(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=Fe.fromDate(r);return{timestampValue:ao(i.serializer,s)}}if(r instanceof Fe){const s=new Fe(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:ao(i.serializer,s)}}if(r instanceof yh)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof jn)return{bytesValue:AA(i.serializer,r._byteString)};if(r instanceof Ue){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.mu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Sg(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.mu(`Unsupported field value: ${_h(r)}`)}(n,e)}function V0(n,e){const t={};return KT(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ts(n,(r,i)=>{const s=is(i,e.Eu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function O0(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Fe||n instanceof yh||n instanceof jn||n instanceof Ue||n instanceof ns)}function im(n,e,t){if(!O0(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const r=_h(t);throw r==="an object"?e.mu(n+" a custom object"):e.mu(n+" "+r)}}function dp(n,e,t){if((e=H(e))instanceof Xr)return e._internalPath;if(typeof e=="string")return sm(n,e);throw bl("Field path arguments must be of type string or ",n,!1,void 0,t)}const Nq=new RegExp("[~\\*/\\[\\]]");function sm(n,e,t){if(e.search(Nq)>=0)throw bl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Xr(...e.split("."))._internalPath}catch{throw bl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function bl(n,e,t,r,i){const s=r&&!r.isEmpty(),a=i!==void 0;let l=`Function ${e}() called with invalid data`;t&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(s||a)&&(h+=" (found",s&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new D(b.INVALID_ARGUMENT,l+n+h)}function L0(n,e){return n.some(t=>t.isEqual(e))}class ic{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ue(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new Vq(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(wh("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class Vq extends ic{data(){return super.data()}}function wh(n,e){return typeof e=="string"?sm(n,e):e instanceof Xr?e._internalPath:e._delegate._internalPath}function M0(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new D(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class om{}class Vc extends om{}function Vr(n,e,...t){let r=[];e instanceof om&&r.push(e),r=r.concat(t),function(s){const a=s.filter(h=>h instanceof am).length,l=s.filter(h=>h instanceof Eh).length;if(a>1||a>0&&l>0)throw new D(b.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Eh extends Vc{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Eh(e,t,r)}_apply(e){const t=this._parse(e);return U0(e._query,t),new bt(e.firestore,e.converter,Zf(e._query,t))}_parse(e){const t=rs(e.firestore);return function(s,a,l,h,f,p,m){let I;if(f.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new D(b.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){ew(m,p);const A=[];for(const L of m)A.push(ZI(h,s,L));I={arrayValue:{values:A}}}else I=ZI(h,s,m)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||ew(m,p),I=N0(l,a,m,p==="in"||p==="not-in");return he.create(f,p,I)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function Oq(n,e,t){const r=e,i=wh("where",n);return Eh._create(i,r,t)}class am extends om{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new am(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:Te.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let a=i;const l=s.getFlattenedFilters();for(const h of l)U0(a,h),a=Zf(a,h)}(e._query,t),new bt(e.firestore,e.converter,Zf(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class cm extends Vc{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new cm(e,t)}_apply(e){const t=function(i,s,a){if(i.startAt!==null)throw new D(b.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new D(b.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Xa(s,a)}(e._query,this._field,this._direction);return new bt(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new yr(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function Lq(n,e="asc"){const t=e,r=wh("orderBy",n);return cm._create(r,t)}class Th extends Vc{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Th(e,t,r)}_apply(e){return new bt(e.firestore,e.converter,vl(e._query,this._limit,this._limitType))}}function Mq(n){return T0("limit",n),Th._create("limit",n,"F")}function Fq(n){return T0("limitToLast",n),Th._create("limitToLast",n,"L")}class Ah extends Vc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ah(e,t,r)}_apply(e){const t=F0(e,this.type,this._docOrFields,this._inclusive);return new bt(e.firestore,e.converter,function(i,s){return new yr(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}}function Uq(...n){return Ah._create("startAt",n,!0)}function Bq(...n){return Ah._create("startAfter",n,!1)}class Rh extends Vc{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Rh(e,t,r)}_apply(e){const t=F0(e,this.type,this._docOrFields,this._inclusive);return new bt(e.firestore,e.converter,function(i,s){return new yr(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}}function qq(...n){return Rh._create("endBefore",n,!1)}function $q(...n){return Rh._create("endAt",n,!0)}function F0(n,e,t,r){if(t[0]=H(t[0]),t[0]instanceof ic)return function(s,a,l,h,f){if(!h)throw new D(b.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${l}().`);const p=[];for(const m of Hs(s))if(m.field.isKeyField())p.push(Wi(a,h.key));else{const I=h.data.field(m.field);if(ch(I))throw new D(b.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+m.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(I===null){const A=m.field.canonicalString();throw new D(b.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${A}' (used as the orderBy) does not exist.`)}p.push(I)}return new Yr(p,f)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=rs(n.firestore);return function(a,l,h,f,p,m){const I=a.explicitOrderBy;if(p.length>I.length)throw new D(b.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const A=[];for(let L=0;L<p.length;L++){const M=p[L];if(I[L].field.isKeyField()){if(typeof M!="string")throw new D(b.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof M}`);if(!vg(a)&&M.indexOf("/")!==-1)throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${M}' contains a slash.`);const V=a.path.child(ge.fromString(M));if(!F.isDocumentKey(V))throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${V}' is not because it contains an odd number of segments.`);const Y=new F(V);A.push(Wi(l,Y))}else{const V=N0(h,f,M);A.push(V)}}return new Yr(A,m)}(n._query,n.firestore._databaseId,i,e,t,r)}}function ZI(n,e,t){if(typeof(t=H(t))=="string"){if(t==="")throw new D(b.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!vg(e)&&t.indexOf("/")!==-1)throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ge.fromString(t));if(!F.isDocumentKey(r))throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Wi(n,new F(r))}if(t instanceof Ue)return Wi(n,t._key);throw new D(b.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${_h(t)}.`)}function ew(n,e){if(!Array.isArray(n)||n.length===0)throw new D(b.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function U0(n,e){const t=function(i,s){for(const a of i)for(const l of a.getFlattenedFilters())if(s.indexOf(l.op)>=0)return l.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new D(b.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new D(b.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class um{convertValue(e,t="none"){switch($i(e)){case 0:return null;case 1:return e.booleanValue;case 2:return We(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Hr(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw $()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return ts(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new yh(We(e.latitude),We(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=_g(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Qa(e));default:return null}}convertTimestamp(e){const t=Kr(e);return new Fe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ge.fromString(e);z(VA(r));const i=new jr(r.get(1),r.get(3)),s=new F(r.popFirst(5));return i.isEqual(t)||Xe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Sh(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class Wq extends um{constructor(e){super(),this.firestore=e}convertBytes(e){return new jn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ue(this.firestore,null,t)}}class Di{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}let gr=class extends ic{constructor(e,t,r,i,s,a){super(e,t,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Pa(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(wh("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Pa=class extends gr{data(e={}){return super.data(e)}},Zr=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Di(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Pa(this._firestore,this._userDataWriter,r.key,r,new Di(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new D(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(l=>{const h=new Pa(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Di(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(l=>s||l.type!==3).map(l=>{const h=new Pa(i._firestore,i._userDataWriter,l.doc.key,l.doc,new Di(i._snapshot.mutatedKeys.has(l.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,p=-1;return l.type!==0&&(f=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),p=a.indexOf(l.doc.key)),{type:Gq(l.type),doc:h,oldIndex:f,newIndex:p}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Gq(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $()}}function B0(n,e){return n instanceof gr&&e instanceof gr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Zr&&e instanceof Zr&&n._firestore===e._firestore&&S0(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function q0(n){n=_e(n,Ue);const e=_e(n.firestore,He);return v0(dt(e),n._key).then(t=>lm(e,n,t))}class ss extends um{constructor(e){super(),this.firestore=e}convertBytes(e){return new jn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Ue(this.firestore,null,t)}}function zq(n){n=_e(n,Ue);const e=_e(n.firestore,He),t=dt(e),r=new ss(e);return uq(t,n._key).then(i=>new gr(e,r,n._key,i,new Di(i!==null&&i.hasLocalMutations,!0),n.converter))}function Kq(n){n=_e(n,Ue);const e=_e(n.firestore,He);return v0(dt(e),n._key,{source:"server"}).then(t=>lm(e,n,t))}function Hq(n){n=_e(n,bt);const e=_e(n.firestore,He),t=dt(e),r=new ss(e);return M0(n._query),I0(t,n._query).then(i=>new Zr(e,r,n,i))}function jq(n){n=_e(n,bt);const e=_e(n.firestore,He),t=dt(e),r=new ss(e);return lq(t,n._query).then(i=>new Zr(e,r,n,i))}function Qq(n){n=_e(n,bt);const e=_e(n.firestore,He),t=dt(e),r=new ss(e);return I0(t,n._query,{source:"server"}).then(i=>new Zr(e,r,n,i))}function tw(n,e,t){n=_e(n,Ue);const r=_e(n.firestore,He),i=Sh(n.converter,e,t);return Oc(r,[Ih(rs(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Me.none())])}function nw(n,e,t,...r){n=_e(n,Ue);const i=_e(n.firestore,He),s=rs(i);let a;return a=typeof(e=H(e))=="string"||e instanceof Xr?rm(s,"updateDoc",n._key,e,t,r):nm(s,"updateDoc",n._key,e),Oc(i,[a.toMutation(n._key,Me.exists(!0))])}function Yq(n){return Oc(_e(n.firestore,He),[new Ro(n._key,Me.none())])}function Jq(n,e){const t=_e(n.firestore,He),r=rc(n),i=Sh(n.converter,e);return Oc(t,[Ih(rs(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Me.exists(!1))]).then(()=>r)}function $0(n,...e){var t,r,i;n=H(n);let s={includeMetadataChanges:!1},a=0;typeof e[a]!="object"||hp(e[a])||(s=e[a],a++);const l={includeMetadataChanges:s.includeMetadataChanges};if(hp(e[a])){const m=e[a];e[a]=(t=m.next)===null||t===void 0?void 0:t.bind(m),e[a+1]=(r=m.error)===null||r===void 0?void 0:r.bind(m),e[a+2]=(i=m.complete)===null||i===void 0?void 0:i.bind(m)}let h,f,p;if(n instanceof Ue)f=_e(n.firestore,He),p=To(n._key.path),h={next:m=>{e[a]&&e[a](lm(f,n,m))},error:e[a+1],complete:e[a+2]};else{const m=_e(n,bt);f=_e(m.firestore,He),p=m._query;const I=new ss(f);h={next:A=>{e[a]&&e[a](new Zr(f,I,m,A))},error:e[a+1],complete:e[a+2]},M0(n._query)}return function(I,A,L,M){const V=new gh(M),Y=new Wg(A,V,L);return I.asyncQueue.enqueueAndForget(async()=>Bg(await fo(I),Y)),()=>{V.Na(),I.asyncQueue.enqueueAndForget(async()=>qg(await fo(I),Y))}}(dt(f),p,l,h)}function Xq(n,e){return hq(dt(n=_e(n,He)),hp(e)?e:{next:e})}function Oc(n,e){return function(r,i){const s=new ct;return r.asyncQueue.enqueueAndForget(async()=>UB(await Zg(r),i,s)),s.promise}(dt(n),e)}function lm(n,e,t){const r=t.docs.get(e._key),i=new ss(n);return new gr(n,i,e._key,r,new Di(t.hasPendingWrites,t.fromCache),e.converter)}const Zq={maxAttempts:5};let e4=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=rs(e)}set(e,t,r){this._verifyNotCommitted();const i=Lr(e,this._firestore),s=Sh(i.converter,t,r),a=Ih(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,Me.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Lr(e,this._firestore);let a;return a=typeof(t=H(t))=="string"||t instanceof Xr?rm(this._dataReader,"WriteBatch.update",s._key,t,r,i):nm(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(a.toMutation(s._key,Me.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Lr(e,this._firestore);return this._mutations=this._mutations.concat(new Ro(t._key,Me.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new D(b.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Lr(n,e){if((n=H(n)).firestore!==e)throw new D(b.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}let t4=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=rs(t)}get(t){const r=Lr(t,this._firestore),i=new Wq(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return $();const a=s[0];if(a.isFoundDocument())return new ic(this._firestore,i,a.key,a,r.converter);if(a.isNoDocument())return new ic(this._firestore,i,r._key,null,r.converter);throw $()})}set(t,r,i){const s=Lr(t,this._firestore),a=Sh(s.converter,r,i),l=Ih(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,l),this}update(t,r,i,...s){const a=Lr(t,this._firestore);let l;return l=typeof(r=H(r))=="string"||r instanceof Xr?rm(this._dataReader,"Transaction.update",a._key,r,i,s):nm(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,l),this}delete(t){const r=Lr(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Lr(e,this._firestore),r=new ss(this._firestore);return super.get(e).then(i=>new gr(this._firestore,r,t._key,i._document,new Di(!1,!1),t.converter))}};function n4(n,e,t){n=_e(n,He);const r=Object.assign(Object.assign({},Zq),t);return function(s){if(s.maxAttempts<1)throw new D(b.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,a,l){const h=new ct;return s.asyncQueue.enqueueAndForget(async()=>{const f=await oq(s);new iq(s.asyncQueue,f,l,a,h).run()}),h.promise}(dt(n),i=>e(new t4(n,i)),r)}function r4(){return new Nc("deleteField")}function i4(){return new tm("serverTimestamp")}function s4(...n){return new kq("arrayUnion",n)}function o4(...n){return new Dq("arrayRemove",n)}function a4(n){return new xq("increment",n)}(function(e,t=!0){(function(i){Eo=i})(ni),Wr(new zn("firestore",(r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),l=new He(new g2(r.getProvider("auth-internal")),new v2(r.getProvider("app-check-internal")),function(f,p){if(!Object.prototype.hasOwnProperty.apply(f.options,["projectId"]))throw new D(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jr(f.options.projectId,p)}(a,i),a);return s=Object.assign({useFetchStreams:t},s),l._setSettings(s),l},"PUBLIC").setMultipleInstances(!0)),qn(Yv,"4.4.0",e),qn(Yv,"4.4.0","esm2017")})();const c4="@firebase/firestore-compat",u4="0.3.23";function hm(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new D("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function rw(){if(typeof Uint8Array>"u")throw new D("unimplemented","Uint8Arrays are not available in this environment.")}function iw(){if(!G2())throw new D("unimplemented","Blobs are unavailable in Firestore in this environment.")}class sc{constructor(e){this._delegate=e}static fromBase64String(e){return iw(),new sc(jn.fromBase64String(e))}static fromUint8Array(e){return rw(),new sc(jn.fromUint8Array(e))}toBase64(){return iw(),this._delegate.toBase64()}toUint8Array(){return rw(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function fp(n){return l4(n,["next","error","complete"])}function l4(n,e){if(typeof n!="object"||n===null)return!1;const t=n;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}class h4{enableIndexedDbPersistence(e,t){return vq(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return Iq(e._delegate)}clearIndexedDbPersistence(e){return wq(e._delegate)}}class W0{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof jr||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&An("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){pq(this._delegate,e,t,r)}enableNetwork(){return Tq(this._delegate)}disableNetwork(){return Aq(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,E0("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return Eq(this._delegate)}onSnapshotsInSync(e){return Xq(this._delegate,e)}get app(){if(!this._appCompat)throw new D("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new po(this,A0(this._delegate,e))}catch(t){throw xt(t,"collection()","Firestore.collection()")}}doc(e){try{return new fn(this,rc(this._delegate,e))}catch(t){throw xt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Dt(this,gq(this._delegate,e))}catch(t){throw xt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return n4(this._delegate,t=>e(new G0(this,t)))}batch(){return dt(this._delegate),new z0(new e4(this._delegate,e=>Oc(this._delegate,e)))}loadBundle(e){return Rq(this._delegate,e)}namedQuery(e){return Sq(this._delegate,e).then(t=>t?new Dt(this,t):null)}}class bh extends um{constructor(e){super(),this.firestore=e}convertBytes(e){return new sc(new jn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return fn.forKey(t,this.firestore,null)}}function d4(n){h2(n)}class G0{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new bh(e)}get(e){const t=xi(e);return this._delegate.get(t).then(r=>new oc(this._firestore,new gr(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=xi(e);return r?(hm("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=xi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=xi(e);return this._delegate.delete(t),this}}class z0{constructor(e){this._delegate=e}set(e,t,r){const i=xi(e);return r?(hm("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=xi(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=xi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Yi{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Pa(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ac(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Yi.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new Yi(e,new bh(e),t),i.set(t,s)),s}}Yi.INSTANCES=new WeakMap;class fn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new bh(e)}static forPath(e,t,r){if(e.length%2!==0)throw new D("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new fn(t,new Ue(t._delegate,r,new F(e)))}static forKey(e,t,r){return new fn(t,new Ue(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new po(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new po(this.firestore,A0(this._delegate,e))}catch(t){throw xt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=H(e),e instanceof Ue?R0(this._delegate,e):!1}set(e,t){t=hm("DocumentReference.set",t);try{return t?tw(this._delegate,e,t):tw(this._delegate,e)}catch(r){throw xt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?nw(this._delegate,e):nw(this._delegate,e,t,...r)}catch(i){throw xt(i,"updateDoc()","DocumentReference.update()")}}delete(){return Yq(this._delegate)}onSnapshot(...e){const t=K0(e),r=H0(e,i=>new oc(this.firestore,new gr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return $0(this._delegate,t,r)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=zq(this._delegate):(e==null?void 0:e.source)==="server"?t=Kq(this._delegate):t=q0(this._delegate),t.then(r=>new oc(this.firestore,new gr(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new fn(this.firestore,e?this._delegate.withConverter(Yi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function xt(n,e,t){return n.message=n.message.replace(e,t),n}function K0(n){for(const e of n)if(typeof e=="object"&&!fp(e))return e;return{}}function H0(n,e){var t,r;let i;return fp(n[0])?i=n[0]:fp(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}class oc{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new fn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return B0(this._delegate,e._delegate)}}class ac extends oc{data(e){const t=this._delegate.data(e);return this._delegate._converter||d2(t!==void 0),t}}class Dt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new bh(e)}where(e,t,r){try{return new Dt(this.firestore,Vr(this._delegate,Oq(e,t,r)))}catch(i){throw xt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Dt(this.firestore,Vr(this._delegate,Lq(e,t)))}catch(r){throw xt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Dt(this.firestore,Vr(this._delegate,Mq(e)))}catch(t){throw xt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Dt(this.firestore,Vr(this._delegate,Fq(e)))}catch(t){throw xt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Dt(this.firestore,Vr(this._delegate,Uq(...e)))}catch(t){throw xt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Dt(this.firestore,Vr(this._delegate,Bq(...e)))}catch(t){throw xt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Dt(this.firestore,Vr(this._delegate,qq(...e)))}catch(t){throw xt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Dt(this.firestore,Vr(this._delegate,$q(...e)))}catch(t){throw xt(t,"endAt()","Query.endAt()")}}isEqual(e){return S0(this._delegate,e._delegate)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=jq(this._delegate):(e==null?void 0:e.source)==="server"?t=Qq(this._delegate):t=Hq(this._delegate),t.then(r=>new pp(this.firestore,new Zr(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=K0(e),r=H0(e,i=>new pp(this.firestore,new Zr(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return $0(this._delegate,t,r)}withConverter(e){return new Dt(this.firestore,e?this._delegate.withConverter(Yi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class f4{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ac(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class pp{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Dt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ac(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new f4(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new ac(this._firestore,r))})}isEqual(e){return B0(this._delegate,e._delegate)}}class po extends Dt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new fn(this.firestore,e):null}doc(e){try{return e===void 0?new fn(this.firestore,rc(this._delegate)):new fn(this.firestore,rc(this._delegate,e))}catch(t){throw xt(t,"doc()","CollectionReference.doc()")}}add(e){return Jq(this._delegate,e).then(t=>new fn(this.firestore,t))}isEqual(e){return R0(this._delegate,e._delegate)}withConverter(e){return new po(this.firestore,e?this._delegate.withConverter(Yi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function xi(n){return _e(n,Ue)}class dm{constructor(...e){this._delegate=new Xr(...e)}static documentId(){return new dm(Le.keyField().canonicalString())}isEqual(e){return e=H(e),e instanceof Xr?this._delegate._internalPath.isEqual(e._internalPath):!1}}class bi{constructor(e){this._delegate=e}static serverTimestamp(){const e=i4();return e._methodName="FieldValue.serverTimestamp",new bi(e)}static delete(){const e=r4();return e._methodName="FieldValue.delete",new bi(e)}static arrayUnion(...e){const t=s4(...e);return t._methodName="FieldValue.arrayUnion",new bi(t)}static arrayRemove(...e){const t=o4(...e);return t._methodName="FieldValue.arrayRemove",new bi(t)}static increment(e){const t=a4(e);return t._methodName="FieldValue.increment",new bi(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const p4={Firestore:W0,GeoPoint:yh,Timestamp:Fe,Blob:sc,Transaction:G0,WriteBatch:z0,DocumentReference:fn,DocumentSnapshot:oc,Query:Dt,QueryDocumentSnapshot:ac,QuerySnapshot:pp,CollectionReference:po,FieldPath:dm,FieldValue:bi,setLogLevel:d4,CACHE_SIZE_UNLIMITED:yq};function g4(n,e){n.INTERNAL.registerComponent(new zn("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},p4)))}function m4(n){g4(n,(e,t)=>new W0(e,t,new h4)),n.registerVersion(c4,u4)}m4(Gr);const _4={apiKey:"AIzaSyCfFGZC07caKFCARPJmMU-qsuAW8jLIu3E",authDomain:"project-fitness-07.firebaseapp.com",projectId:"project-fitness-07",storageBucket:"project-fitness-07.appspot.com",messagingSenderId:"607206642972",appId:"1:607206642972:web:ea1d5c525a976b668cd6d9"},ei=Gr.initializeApp(_4);async function y4({email:n,password:e,name:t}){await ei.auth().createUserWithEmailAndPassword(n,e),await(await ei.auth().currentUser).updateProfile({displayName:t})}async function v4({email:n,password:e}){try{await ei.auth().signInWithEmailAndPassword(n,e)}catch(t){console.log(t.message)}}async function I4(){await ei.auth().signOut()}const ca={fs:Gr.firestore(),getCurrentUserID:async function(){return new Promise((n,e)=>{ei.auth().onAuthStateChanged(t=>{t?n(t.uid):e("User not authenticated")})})},addData:async function(n,e){const t=await this.getCurrentUserID();this.fs.collection("users").doc(t).set({[n]:e},{merge:!0}).then(()=>!0).catch(r=>(console.error("Error writing document: ",r),!1))},removeData:async function(n){const e=await this.getCurrentUserID();this.fs.collection("users").doc(e).update({[n]:Gr.firestore.FieldValue.delete()},{merge:!0}).then(()=>!0).catch(t=>(console.error("Error writing document: ",t),!1))},getData:async function(){const n=await this.getCurrentUserID(),e=rc(this.fs,"users",n),t=await q0(e);if(t.exists())return t.data();console.error("No such document")}};function Ms(n,e){let t="";for(let r=0;r<n;r+=1)e.classList.contains("workout-cards__wrapper")||e.classList.contains("favorite-cards__wrapper")?t+=`
      <li class='workouts__skeleton-loader'>
        <div class='svg-container'>
          <svg
            role="img"
            width="100%"
            height="135"
            aria-labelledby="loading-aria"
            viewBox="0 0 405 141"
            preserveAspectRatio="none"
          >
            <title id="loading-aria">Loading...</title>
            <rect
              x="0"
              y="0"
              width="100%"
              height="100%"
              clip-path="url(#clip-path)"
              style='fill: url("#fill");'
            ></rect>
            <defs>
              <clipPath id="clip-path">
                  <rect x="9" y="5" rx="10" ry="10" width="81" height="19" />
                  <rect x="107" y="5" rx="3" ry="3" width="19" height="18" />
                  <circle cx="28" cy="67" r="19" />
                  <rect x="311" y="7" rx="4" ry="4" width="58" height="20" />
                  <rect x="381" y="18" rx="0" ry="0" width="40" height="0" />
                  <rect x="74" y="54" rx="0" ry="0" width="192" height="25" />
                  <rect x="6" y="108" rx="0" ry="0" width="123" height="28" />
                  <rect x="164" y="109" rx="0" ry="0" width="122" height="26" />
                  <rect x="314" y="109" rx="0" ry="0" width="77" height="27" />
                  <rect x="379" y="8" rx="7" ry="7" width="19" height="19" />
              </clipPath>
              <linearGradient id="fill">
                <stop
                  offset="0.599964"
                  stop-color="#ecebeb"
                  stop-opacity="1"
                >
                  <animate
                    attributeName="offset"
                    values="-2; -2; 1"
                    keyTimes="0; 0.25; 1"
                    dur="2s"
                    repeatCount="indefinite"
                  ></animate>
                </stop>
                <stop
                  offset="1.59996"
                  stop-color="#ffffff"
                  stop-opacity="1"
                >
                  <animate
                    attributeName="offset"
                    values="-1; -1; 2"
                    keyTimes="0; 0.25; 1"
                    dur="2s"
                    repeatCount="indefinite"
                  ></animate>
                </stop>
                <stop
                  offset="2.59996"
                  stop-color="#ecebeb"
                  stop-opacity="1"
                >
                  <animate
                    attributeName="offset"
                    values="0; 0; 3"
                    keyTimes="0; 0.25; 1"
                    dur="2s"
                    repeatCount="indefinite"
                  ></animate>
                </stop>
              </linearGradient>
            </defs>
          </svg>
        </div>
      </li>
      `:t+=`
      <li class='exercises__skeleton-loader'>
        <div class='card'>
          <div class='cover-image-skeleton'></div>
        </div>
      </li>
      `;return t}function Fs(n,e){n.innerHTML=e}const Qs=document.querySelector(".js-cards"),Ys="/project-fitness-07/";function w4(n){const e=n.map(({filter:t,name:r,imgURL:i})=>`
        <li class="exercise-cards__gallery-link js-card" data-card-name="${r}">
            <div class="exercise-cards__gallery-card">

                <img class="exercise-cards__gallery-image"  src="${i}" alt="${t+"-"+r}" loading="lazy" />
                <div class="exercise-cards__gallery-info">
                    <h3 class="exercise-cards__head3-name">${r}</h3>
                    <p class="exercise-cards__parag-filter">${t}</p>
                </div>
            </div>
        </li>
        `).join("");Qs.insertAdjacentHTML("beforeend",e)}function E4(n){const e=n.map(({_id:t,bodyPart:r,name:i,target:s,burnedCalories:a,time:l,rating:h})=>`
        <li class="workout-cards__gallery-link js-workout-card" data-id="${t}">
            <div class="workout-cards__gallery-card" >
                <div class="workout-cards__first-line-wrapper">
                    <p class="workout-cards__parag-workout">Workout</p>
                    <p class="workout-cards__parag-rating">${Math.round(h*10)/10}</p>
                    <svg class="workout-cards__icon-star">
                        <use href="${Ys}images/icons-sprite.svg#icon-star"></use>
                    </svg>
                    <p class="workout-cards__parag-start">Start</p>
                    <svg class="workout-cards__icon-arrow-up">
                        <use href="${Ys}images/icons-sprite.svg#icon-arrow-up"></use>
                    </svg>
                </div>
                <div class="workout-cards__second-line-wrapper">
                    <div class="workout-cards__wrapper-icon-running-stick">
                        <svg class="workout-cards__icon-running-stick">
                            <use href="${Ys}images/icons-sprite.svg#icon-running-stick"></use>
                        </svg>
                    </div>
                    <h3 class="workout-cards__head3-name">${i}</h3>
                </div>
                <div class="workout-cards__third-line-wrapper">
                  <ul class="workout-cards__list-info">
                    <li class="workout-cards__list-point">
                      <p class="workout-cards__parag-burned-calories">Burned calories:</p>
                      <p class="workout-cards__parag-burned-calories-result">${a} / ${l} min<p>
                    </li>
                    <li class="workout-cards__list-point">
                      <p class="workout-cards__parag-body-part">Body part:</p>
                      <p class="workout-cards__parag-body-part-result">${r}<p>
                    </li>
                    <li class="workout-cards__list-point">
                      <p class="workout-cards__parag-target">Target:</p>
                      <p class="workout-cards__parag-target-result">${s}<p>
                    </li>
                  </ul>
                </div>
            </div>
          </li>
        `).join("");Qs.insertAdjacentHTML("beforeend",e)}function T4(n){const e=n.length;Fs(Qs,Ms(e,Qs));const t=n.map(({_id:r,bodyPart:i,name:s,target:a,burnedCalories:l,time:h})=>`
        <li class="favorite-cards__gallery-link" data-id="${r}">
            <div class="favorite-cards__gallery-card">
                <div class="favorite-cards__first-line-wrapper">
                    <p class="favorite-cards__parag-workout">Workout</p>
<button class="favorite-cards__trash-btn" type="button">
                      <svg class="favorite-cards__icon-trash">
                        <use href="${Ys}images/icons-sprite.svg#icon-trash"></use>
                    </svg>
</button>
                    <p class="favorite-cards__parag-start">Start</p>
                    <svg class="favorite-cards__icon-arrow-up">
                        <use href="${Ys}images/icons-sprite.svg#icon-arrow-up"></use>
                    </svg>
                </div>
                <div class="favorite-cards__second-line-wrapper">
                    <div class="workout-cards__wrapper-icon-running-stick">
                      <svg class="favorite-cards__icon-running-stick">
                          <use href="${Ys}images/icons-sprite.svg#icon-running-stick"></use>
                      </svg>
                    </div>
                    <h3 class="favorite-cards__head3-name">${s}</h3>
                </div>
                <div class="favorite-cards__third-line-wrapper">
                  <ul class="favorite-cards__list-info">
                    <li class="favorite-cards__list-point">
                      <p class="favorite-cards__parag-burned-calories">Burned calories:</p>
                      <p class="favorite-cards__parag-burned-calories-result">${l} / ${h} min<p>
                    </li>
                    <li class="favorite-cards__list-point">
                      <p class="favorite-cards__parag-body-part">Body part:</p>
                      <p class="favorite-cards__parag-body-part-result">${i}<p>
                    </li>
                    <li class="favorite-cards__list-point">
                      <p class="favorite-cards__parag-target">Target:</p>
                      <p class="favorite-cards__parag-target-result">${a}<p>
                    </li>
                  </ul>
                </div>
            </div>
          </li>
        `).join("");Qs.innerHTML=t}function $u(){Qs.innerHTML=""}const Mi={add:function(n,e){return new Promise((t,r)=>{try{ca.addData(n,e),t(!0)}catch{r(!1)}})},get:function(){return new Promise(async(n,e)=>{try{const t=await ca.getData();n(Object.values(t))}catch{e([])}})},idIsFavorite:async function(n){try{return(await this.get()).some(t=>t._id===n)}catch{return!1}},getObjectById:async function(n){try{const t=(await this.get()).find(r=>r._id===n)||null;return t?{...t,isFavorite:!0}:null}catch{return null}},addAndGet:async function(n,e){return new Promise(async(t,r)=>{try{await ca.addData(n,e),setTimeout(async()=>{const i=await ca.getData();t(Object.values(i))},200)}catch{r([])}})},remove:async function(n){return new Promise((e,t)=>{try{ca.removeData(n),e(!0)}catch{t(!1)}})}},Cn=document.querySelector(".js-cards");function j0(n,e){if(e>=768)return n!=3?(Fs(Cn,Ms(10,Cn)),10):(Fs(Cn,Ms(12,Cn)),12);if(e<768){if(n===1)return Fs(Cn,Ms(8,Cn)),8;if(n===2||n===1)return Fs(Cn,Ms(8,Cn)),8}return Fs(Cn,Ms(9,Cn)),9}function Q0(n){const e={filter:"Body%20parts",bodypart:"",keyword:"",muscles:"",equipment:""};for(const t in n)if(n.hasOwnProperty(t)&&n[t]!==e[t])return!0;return!1}function A4(n,e,t,r,i,s){return Q0(r)?(t.bodyPart=r.bodypart,t.searchQuery=r.keyword,t.muscles=r.muscles,t.equipment=r.equipment,i=Pl(n,e,t,s).fetchFilteredExercises()):i=Pl(n,e,t,s).fetchExercise(),i}function R4(n,e,t,r,i,s){return Q0(r)&&(t.filter=r.filter),i=Pl(n,e,t,s).fetchMuscles(),i}function Pl(n,e,t,r){const i=j0(e,r);return t.pageCounter=n,t.limit=i,t}function sw(n){return n.then(e=>e).catch(e=>{throw console.error("Error in getData:",e),e})}function Y0(n,e){const t=document.querySelector(".filters__list .active");if(t){const r=t.id.includes("-")?(t.id.charAt(0).toUpperCase()+t.id.slice(1)).replace("-","%20"):t.id.charAt(0).toUpperCase()+t.id.slice(1);if(r!=n.filter||n.filter===""){n.filter=r;for(const i in n)i!=="filter"&&(n[i]="");e.currentPage=1,e.endPoint=3}}}async function S4({currentPage:n,endPoint:e},t){let r;const i=j0(e,t),s=localStorage.getItem("favoriteData"),a=localStorage.getItem("isDataOld"),l=a?JSON.parse(a):[];if(l||l.length===1)try{const h=await Mi.get();r=ow(h,i),localStorage.setItem("favoriteData",JSON.stringify(h)),s&&localStorage.setItem("isDataOld",JSON.stringify(!1));const f=aw(n,r);return{totalPages:r.totalPages,currentData:f}}catch(h){console.log("Favorite data error: ",h)}else{const h=s?JSON.parse(s):[],f=ow(h,i),p=aw(n,f);return{totalPages:f.totalPages,currentData:p}}}function ow(n,e){const t=n.length;if(t<=e)return{totalPages:1,slicedData:n};if(t>e){const r=Math.ceil(t/e);let i=[];for(let s=0;s<r;s++){const a=s*e,l=(s+1)*e;i.push(n.slice(a,l))}return{totalPages:r,slicedData:i}}}function aw(n,{totalPages:e,slicedData:t}){return e===1?t:t[n-1]}const Re={exerciseWrapper:"js-cards",workoutWrapper:"workout-cards__wrapper",favoriteWrapper:"favorite-cards__wrapper",visuallyHidden:"visually-hidden",emptyParag:"exercise-cards__parag-empty",emptyWrapper:"exercise-cards__wrapper-empty"},Cl={stringHome:`
                <p class="exercise-cards__parag-empty">
                    Sorry, but we don't have anything for you with such filter. Please try another search
                </p>`,stringFavorite:`<p class="exercise-cards__parag-empty">
                        It appears that you haven't added any exercises to your favorites yet. To get started, you can add exercises
                        that you
                        like to your favorites for easier access in the future.
                    </p>`};function kl(n,e){const t=document.querySelector("."+e);if(t)t.innerHTML=n;else return}function qs(n,e){const t=document.querySelector("."+e);if(t)t.classList.add(n);else return}function ks(n,e){const t=document.querySelector("."+e);if(t)t.classList.remove(n);else return}const gp=document.querySelector(".js-pages");function wf(n,e){const t=[];if(e>1){for(let i=n-3;i<=n+3;i++)if(i>0&&i<=e){const s=i===n?"exercise-cards__wrapper-page exercise-cards__current-page":"exercise-cards__wrapper-page js-pages";t.push(`
                    <div class="${s}">
                        <a class="exercise-cards__page js-page" data-page="${i}" href="">
                            ${i}
                        </a>
                    </div>
                `)}gp.innerHTML="";for(const i of t)gp.insertAdjacentHTML("beforeend",i)}}function Wu(){gp.innerHTML=""}function b4(n){n.preventDefault();const{target:e}=n;if(e.classList.contains("js-cards"))return;const t=e.closest(".js-card");if(t)return t.dataset.cardName}function P4(n){n.preventDefault();const{target:e}=n;return e.classList.contains("js-page")?e.closest(".js-page").dataset.page:void 0}function C4(n){n.preventDefault();const{target:e}=n;if(e.classList.contains("js-cards"))return;const t=e.closest(".js-workout-card");if(t)return t.dataset.id}const k4=async function(n){const{_id:e}=n;try{if(await Mi.idIsFavorite(e)){const r=await Mi.remove(e);return localStorage.setItem("isDataOld",JSON.stringify(!0)),!1}else return localStorage.setItem("isDataOld",JSON.stringify(!0)),await Mi.add(e,n)}catch{return!1}},D4=n=>typeof n!="string"?n:n.split(" ").filter(e=>e).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),cw=n=>typeof n!="string"?n:n.charAt(0).toUpperCase()+n.slice(1),x4=n=>typeof n!="string"?n:n.replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase(),N4=n=>{const e=getComputedStyle(document.documentElement).getPropertyValue("--rating-color-inactive"),t=getComputedStyle(document.documentElement).getPropertyValue("--rating-color-active");return`
<!-- DEFINE SVGs -->
<svg height="0" width="0">
  <defs>
    <!-- DEFINE ONE STAR -->
    <symbol viewBox="0 0 32 32" id="iconstar">
      <path
        d="M13.826 3.262c.684-2.106 3.663-2.106 4.348 0l1.932 5.945a2.285 2.285 0 0 0 2.174 1.579h6.251c2.214 0 3.135 2.833 1.344 4.135l-5.057 3.674a2.286 2.286 0 0 0-.83 2.556l1.931 5.945c.684 2.106-1.726 3.857-3.517 2.555l-5.057-3.674a2.286 2.286 0 0 0-2.687 0l-5.057 3.674c-1.791 1.302-4.202-.45-3.517-2.555l1.932-5.945a2.287 2.287 0 0 0-.83-2.556l-5.057-3.674c-1.791-1.302-.871-4.135 1.344-4.135h6.251c.99 0 1.868-.638 2.174-1.579l1.932-5.945z" />
    </symbol>
    <!-- DEFINE PATTERN FOR EMPTY STARS -->
    <pattern id="stars-empty" patternUnits="userSpaceOnUse" width="24" height="24">
      <use x="0" y="0" xlink:href="#iconstar" fill="${e}" height="24" width="24"/>
    </pattern>
    <!-- DEFINE PATTERN FOR FULL STARS -->
    <pattern id="stars-full" patternUnits="userSpaceOnUse" width="24" height="24">
      <use x="0" y="0" xlink:href="#iconstar" fill="${t}" height="24" width="24"/>
    </pattern>
  </defs>
</svg>

<!-- INSERT STARS -->
<svg height="24" viewBox="0 0 120 24" width="120">
  <rect fill="url(#stars-empty)" x="0" y="0" height="24" width="120"/>
  <rect fill="url(#stars-full)" x="0" y="0" height="24" width="${n}%"/>
</svg>
`},J0=document.querySelector(".backdrop");function fm(n){J0.classList.add("open"),n.classList.add("open")}function pm(n){J0.classList.remove("open"),n.classList.remove("open")}const V4="/project-fitness-07/",Ge={exercise:{},ratingText:"Rating",iconStar:`${V4}images/icons-sprite.svg#icon-star`,ratingMax:5,closeKeyBoardBtn:"Escape",beforeOpen:null,afterOpen:null,beforeClose:null,afterClose:null},gm=document.querySelector("form.modal-form"),mm=document.querySelector(".rating-modal-content"),O4=document.querySelector(".rating-close"),X0=document.querySelector(".backdrop"),L4=()=>{const n=[];for(let e=0;e<Ge.ratingMax;e++){let t=Ge.ratingMax-e;n.push(`
        <input type="radio" class="visually-hidden" id="star${t}" name="rating" value="${t}">
        <label class="rating-star" for="star${t}">
            <svg class="rating-star-icon">
                <use href=${Ge.iconStar} />
            </svg>
        </label>
        `)}return`
    <div class="rating-wrapper">
        <p class="rating-text">${Ge.ratingText}</p>
        <div class="rating-stars">
            ${n.join("")}
            <p class="rating-count">0.0</p>
        </div>
    </div>
    `},Z0=n=>{n.key===Ge.closeKeyBoardBtn&&Ph()},eR=n=>{n.target===mm&&Ph()},tR=n=>{_m.forEach(e=>{delete e.dataset.dataChecked}),n.target.dataset.dataChecked="checked",ym.innerHTML=n.target.value},M4=()=>{ym.innerHTML="0.0"};gm.insertAdjacentHTML("afterbegin",L4());const _m=document.querySelectorAll(".rating-stars input"),ym=document.querySelector(".rating-count"),Ph=()=>{Ge.beforeClose&&(Ge.beforeClose(Ge.exercise),Ge.beforeClose=null),_m.forEach(n=>{n.removeEventListener("change",tR)}),pm(mm),document.removeEventListener("keydown",Z0),X0.removeEventListener("click",eR),Ge.afterClose&&(Ge.afterClose(Ge.exercise),Ge.afterClose=null),ym.innerHTML="0.0",gm.reset()},F4=()=>{Ge.beforeOpen&&(Ge.beforeOpen(Ge.exercise),Ge.beforeOpen=null),_m.forEach(n=>{n.addEventListener("change",tR)}),Ge.afterOpen&&(Ge.afterOpen(Ge.exercise),Ge.afterOpen=null),fm(mm),document.addEventListener("keydown",Z0),X0.addEventListener("click",eR)};O4.addEventListener("click",Ph);gm.addEventListener("reset",M4);const mp={modalConfig:Ge,openRatingModal:F4,closeRatingModal:Ph},Js={name:document.querySelector(".js__auth-modal__name__message"),email:document.querySelector(".js__auth-modal__email__message"),password:document.querySelector(".js__auth-modal__password__message")},vm=document.querySelector(".backdrop"),mt={exercise:{},beforeOpen:null,afterOpen:null,beforeClose:null,afterClose:null},Im=document.querySelectorAll(".header__auth_btn"),nR=document.querySelector(".authModal__content"),rR=document.querySelector(".authModal__content .x-button"),Oe=document.querySelector(".authForm"),uw=document.querySelector(".action__text"),ya=document.querySelector(".action__button"),lw=document.querySelector(".authForm__fieldset.username"),hw=document.querySelector(".authForm__title"),dw=document.querySelectorAll(".header__nav-authorized"),fw=document.querySelectorAll(".header__nav__item.auth"),Dl=document.querySelectorAll(".header__logout_btn");let Fi=!0;const Lc=()=>{mt.beforeClose&&(mt.beforeClose(mt.exercise),mt.beforeClose=null),pm(nR),rR.removeEventListener("click",Lc),Im.forEach(n=>n.addEventListener("click",Ch)),document.body.style.overflow="visible",mt.afterClose&&(mt.afterClose(mt.exercise),mt.afterClose=null),vm.removeEventListener("click",wm),document.removeEventListener("keydown",iR)},Ch=()=>{mt.beforeOpen&&(mt.beforeOpen(mt.exercise),mt.beforeOpen=null),fm(nR),rR.addEventListener("click",Lc),Im.forEach(n=>n.removeEventListener("click",Ch)),document.body.style.overflow="hidden",mt.afterOpen&&(mt.afterOpen(mt.exercise),mt.afterOpen=null),vm.addEventListener("click",wm),document.addEventListener("keydown",iR)},_p=()=>{Oe.reset()},U4=async n=>{if(n.preventDefault(),Fi&&(!Oe.elements.name.value||Oe.elements.name.value.length<3)){Js.name.classList.remove("hidden");return}if(!Oe.elements.email.value||!ux(Oe.elements.email.value)){Js.email.classList.remove("hidden");return}if(!Oe.elements.password.value||Oe.elements.password.value.length<6){Js.password.classList.remove("hidden");return}const e=[...Oe.elements].reduce((t,r)=>(r.name&&(t[r.name]=r.value),t),{});Fi&&await y4(e),await v4(e),_p(),Oe.elements.regSubmitBtn.disabled=!0,Lc()},B4=()=>{Fi?(ya.textContent="Registration",lw.classList.add("hidden"),ya.setAttribute("data-action","log_in"),hw.textContent="Log in",uw.textContent="Don't have an account?",_p(),Fi=!1):(ya.textContent="Log in",ya.setAttribute("data-action","reg"),lw.classList.remove("hidden"),hw.textContent="Registration",uw.textContent="Already have an account?",_p(),Fi=!0),Oe.elements.name.toggleAttribute("required")},q4=async()=>{await ei.auth().onAuthStateChanged(n=>{n?(fw.forEach(e=>{e.classList.add("hidden")}),Dl.forEach(e=>{e.classList.add("visible")}),dw.forEach(e=>{e.classList.add("visible")})):(fw.forEach(e=>{e.classList.remove("hidden")}),Dl.forEach(e=>{e.classList.remove("visible")}),dw.forEach(e=>{e.classList.remove("visible")}))})},iR=n=>{n.key==="Escape"&&Lc()},wm=n=>{n.target.classList.contains("backdrop")&&Lc()},$4=async()=>{await I4(),Dl.forEach(n=>{n.classList.add("hidden")}),window.location.pathname="/project-fitness-07/"};vm.addEventListener("click",wm);Im.forEach(n=>n.addEventListener("click",Ch));Oe.addEventListener("submit",U4);ya.addEventListener("click",B4);Dl.forEach(n=>{n.addEventListener("click",$4)});q4();Oe.elements.name.addEventListener("focus",W4);function W4(){Js.name.classList.add("hidden")}Oe.elements.email.addEventListener("focus",G4);function G4(){Js.email.classList.add("hidden")}Oe.elements.password.addEventListener("focus",z4);function z4(){Js.password.classList.add("hidden")}Oe.elements.name.addEventListener("input",Em);Oe.elements.email.addEventListener("input",Em);Oe.elements.password.addEventListener("input",Em);function Em(){Fi&&Oe.elements.name.value&&Oe.elements.email.value&&Oe.elements.password.value||!Fi&&Oe.elements.email.value&&Oe.elements.password.value?Oe.elements.regSubmitBtn.disabled=!1:Oe.elements.regSubmitBtn.disabled=!0}const Xs={modalConfig:mt,openModal:Ch},xl=document.querySelector(".js-cards");async function K4({target:n}){if(n.classList.contains("favorite-cards__trash-btn")){H4(n);return}const e=n.closest("li").dataset.id;if(!e)return;const t=new uc;try{t.id=e;const r=await t.fetchExerciseById();if(!r)throw new Error("Exercise not found!");Mc(r)}catch(r){console.error(r)}}async function H4(n){const e=n.closest("li"),t=e.dataset.id;e.closest("li").remove(),Mi.remove(t),localStorage.setItem("isDataOld",JSON.stringify(!0)),xl.children.length===0&&(qs(Re.emptyWrapper,Re.exerciseWrapper),kl(Cl.stringFavorite,Re.exerciseWrapper))}function j4({_id:n}){document.querySelector('.favorite-cards__gallery-link[data-id="'+n+'"]').closest("li").remove(),localStorage.setItem("isDataOld",JSON.stringify(!0)),xl.children.length===0&&(qs(Re.emptyWrapper,Re.exerciseWrapper),kl(Cl.stringFavorite,Re.exerciseWrapper))}xl?xl.addEventListener("click",K4):console.error("Element with class 'js-cards' not found for workout.");const Tm=document.querySelector(".backdrop"),os=document.querySelector(".modalExercise"),sR=os.querySelector(".js-modal-exit"),pw=os.querySelector(".modalExercise__img-wrapper"),ua=os.querySelector(".exercise-content"),Ds=os.querySelector(".button-box"),Q4="/project-fitness-07/",Y4=5;let J4,ur={};const X4=n=>{const{gifUrl:e,name:t,rating:r,_id:i,isFavorite:s,description:a}=n,l=e$(n);ur=n,os.setAttribute("data-id",i),pw.innerHTML="",pw.insertAdjacentHTML("afterbegin",r$(e,t)),ua.innerHTML="",ua.insertAdjacentHTML("beforeend",t$(t)),ua.insertAdjacentHTML("beforeend",n$(r)),ua.insertAdjacentHTML("beforeend",i$(l)),ua.insertAdjacentHTML("beforeend",s$(a)),uR(s)},oR=n=>{n.key==="Escape"&&Ji()},aR=n=>{n.target===Tm&&Ji()},cR=n=>{const e=ei.auth().currentUser;if(Ji(),!e){Xs.modalConfig.exercise=ur,Xs.modalConfig.afterClose=Mc,Xs.openModal(ur);return}mp.modalConfig.exercise=ur,mp.openRatingModal()},Z4=()=>{document.querySelector(".js-give-rating").removeEventListener("click",cR),Mc(ur)},e$=n=>({bodyPart:n.bodyPart,equipment:n.equipment,rating:n.rating,burnedCalories:n.burnedCalories,time:n.time,popular:n.popularity}),uR=(n=!1)=>{Ds.innerHTML="",n?Ds.insertAdjacentHTML("beforeend",a$()):Ds.insertAdjacentHTML("beforeend",o$()),Ds.insertAdjacentHTML("beforeend",c$());const e=Ds.querySelector(".js-toggle-favorite");Ds.querySelector(".js-give-rating"),e.addEventListener("click",lR),mp.modalConfig.afterClose=Z4,document.querySelector(".js-give-rating").addEventListener("click",cR)},t$=n=>`
    <h3 class="title">${D4(n)}</h3>
  `,n$=n=>{const e=[],t=Math.round(n*10)/10;e.push(`<li class="rating__item value">${t}</li>`);const r=Math.round(n/Y4*100);return e.push(`<li ${N4(r)}</li>`),`<ul class="rating">${e.join("")}</ul>`},r$=(n,e)=>`
    <img src="${n}" alt="${e}"/>
  `,i$=({burnedCalories:n,time:e,...t})=>{const r=[];for(const[i,s]of Object.entries(t)){const a=x4(i),l=cw(a),h=cw(s);r.push(`
      <li class="exercise_details-item">
        <p class="detail-name">${l}</p>
        <p class="detail-value">${h}</p>
      </li>
    `)}return r.push(`
      <li class="exercise_details-item">
        <p class="detail-name">Burned Calories</p>
        <p class="detail-value">${n}/${e} min</p>
      </li>
  `),`<ul class="exercise_details">${r.join("")}</ul>`},s$=n=>`
    <p class="exercise_description">${n}</p>
  `,o$=()=>Am({text:"Add to favorites",iconId:"icon-heart",className:"js-toggle-favorite"}),a$=()=>Am({text:"Remove from favorites",iconId:"icon-trash",className:"js-toggle-favorite"}),c$=()=>Am({text:"Give a rating",className:"js-give-rating ghost"}),Am=({text:n,iconId:e,className:t=""})=>{let r;return e&&(r=`
      <svg class="btn-icon">
        <use href=${Q4}images/icons-sprite.svg#${e} />
      </svg>
    `),`
    <button id="js-toggle-favorite" type="button" class="button ${t}">
      <span>${n}</span>
      ${e?r:""}
    </button>
  `},Ji=()=>{pm(os),sR.removeEventListener("click",Ji),document.body.style.overflow="visible";const n="js-toggle-favorite";try{document.getElementById(n).removeEventListener("click",J4),document.removeEventListener("keydown",oR),Tm.removeEventListener("click",aR)}catch{console.error(`${n} not found!`)}},Mc=async n=>{const{_id:e}=n;n.isFavorite=await Mi.idIsFavorite(e),X4(n),fm(os),sR.addEventListener("click",Ji),document.body.style.overflow="hidden",document.addEventListener("keydown",oR),Tm.addEventListener("click",aR)},lR=async n=>{if(!ei.auth().currentUser){Ji(),Xs.modalConfig.exercise=ur,Xs.modalConfig.afterClose=Mc,Xs.openModal(ur);return}const{target:t}=n;try{window.location.pathname.includes("favorites")&&(Ji(),j4(ur));const r=await k4(ur);t.removeEventListener("click",lR),uR(r)}catch(r){console.error(r)}},Gu=document.querySelector(".exercise-cards__wrapper");function u$(n,e){e>=375&&e<768&&n===2?Gu.style.height="1268px":e>1440&&n===1?Gu.style.height="487px":e>=768&&n===2?Gu.style.height="833px":Gu.style.height=""}var la=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},cc={},l$={get exports(){return cc},set exports(n){cc=n}};(function(n,e){(function(){var t,r="4.17.21",i=200,s="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",a="Expected a function",l="Invalid `variable` option passed into `_.template`",h="__lodash_hash_undefined__",f=500,p="__lodash_placeholder__",m=1,I=2,A=4,L=1,M=2,V=1,Y=2,ae=4,j=8,ye=16,de=32,me=64,we=128,Mt=256,Qn=512,as=30,gR="...",mR=800,_R=16,Rm=1,yR=2,vR=3,li=1/0,wr=9007199254740991,IR=17976931348623157e292,Fc=0/0,Rn=4294967295,wR=Rn-1,ER=Rn>>>1,TR=[["ary",we],["bind",V],["bindKey",Y],["curry",j],["curryRight",ye],["flip",Qn],["partial",de],["partialRight",me],["rearg",Mt]],cs="[object Arguments]",Uc="[object Array]",AR="[object AsyncFunction]",ko="[object Boolean]",Do="[object Date]",RR="[object DOMException]",Bc="[object Error]",qc="[object Function]",Sm="[object GeneratorFunction]",gn="[object Map]",xo="[object Number]",SR="[object Null]",Yn="[object Object]",bm="[object Promise]",bR="[object Proxy]",No="[object RegExp]",mn="[object Set]",Vo="[object String]",$c="[object Symbol]",PR="[object Undefined]",Oo="[object WeakMap]",CR="[object WeakSet]",Lo="[object ArrayBuffer]",us="[object DataView]",kh="[object Float32Array]",Dh="[object Float64Array]",xh="[object Int8Array]",Nh="[object Int16Array]",Vh="[object Int32Array]",Oh="[object Uint8Array]",Lh="[object Uint8ClampedArray]",Mh="[object Uint16Array]",Fh="[object Uint32Array]",kR=/\b__p \+= '';/g,DR=/\b(__p \+=) '' \+/g,xR=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Pm=/&(?:amp|lt|gt|quot|#39);/g,Cm=/[&<>"']/g,NR=RegExp(Pm.source),VR=RegExp(Cm.source),OR=/<%-([\s\S]+?)%>/g,LR=/<%([\s\S]+?)%>/g,km=/<%=([\s\S]+?)%>/g,MR=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,FR=/^\w*$/,UR=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Uh=/[\\^$.*+?()[\]{}|]/g,BR=RegExp(Uh.source),Bh=/^\s+/,qR=/\s/,$R=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,WR=/\{\n\/\* \[wrapped with (.+)\] \*/,GR=/,? & /,zR=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,KR=/[()=,{}\[\]\/\s]/,HR=/\\(\\)?/g,jR=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Dm=/\w*$/,QR=/^[-+]0x[0-9a-f]+$/i,YR=/^0b[01]+$/i,JR=/^\[object .+?Constructor\]$/,XR=/^0o[0-7]+$/i,ZR=/^(?:0|[1-9]\d*)$/,eS=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Wc=/($^)/,tS=/['\n\r\u2028\u2029\\]/g,Gc="\\ud800-\\udfff",nS="\\u0300-\\u036f",rS="\\ufe20-\\ufe2f",iS="\\u20d0-\\u20ff",xm=nS+rS+iS,Nm="\\u2700-\\u27bf",Vm="a-z\\xdf-\\xf6\\xf8-\\xff",sS="\\xac\\xb1\\xd7\\xf7",oS="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",aS="\\u2000-\\u206f",cS=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Om="A-Z\\xc0-\\xd6\\xd8-\\xde",Lm="\\ufe0e\\ufe0f",Mm=sS+oS+aS+cS,qh="['’]",uS="["+Gc+"]",Fm="["+Mm+"]",zc="["+xm+"]",Um="\\d+",lS="["+Nm+"]",Bm="["+Vm+"]",qm="[^"+Gc+Mm+Um+Nm+Vm+Om+"]",$h="\\ud83c[\\udffb-\\udfff]",hS="(?:"+zc+"|"+$h+")",$m="[^"+Gc+"]",Wh="(?:\\ud83c[\\udde6-\\uddff]){2}",Gh="[\\ud800-\\udbff][\\udc00-\\udfff]",ls="["+Om+"]",Wm="\\u200d",Gm="(?:"+Bm+"|"+qm+")",dS="(?:"+ls+"|"+qm+")",zm="(?:"+qh+"(?:d|ll|m|re|s|t|ve))?",Km="(?:"+qh+"(?:D|LL|M|RE|S|T|VE))?",Hm=hS+"?",jm="["+Lm+"]?",fS="(?:"+Wm+"(?:"+[$m,Wh,Gh].join("|")+")"+jm+Hm+")*",pS="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",gS="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Qm=jm+Hm+fS,mS="(?:"+[lS,Wh,Gh].join("|")+")"+Qm,_S="(?:"+[$m+zc+"?",zc,Wh,Gh,uS].join("|")+")",yS=RegExp(qh,"g"),vS=RegExp(zc,"g"),zh=RegExp($h+"(?="+$h+")|"+_S+Qm,"g"),IS=RegExp([ls+"?"+Bm+"+"+zm+"(?="+[Fm,ls,"$"].join("|")+")",dS+"+"+Km+"(?="+[Fm,ls+Gm,"$"].join("|")+")",ls+"?"+Gm+"+"+zm,ls+"+"+Km,gS,pS,Um,mS].join("|"),"g"),wS=RegExp("["+Wm+Gc+xm+Lm+"]"),ES=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,TS=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],AS=-1,ke={};ke[kh]=ke[Dh]=ke[xh]=ke[Nh]=ke[Vh]=ke[Oh]=ke[Lh]=ke[Mh]=ke[Fh]=!0,ke[cs]=ke[Uc]=ke[Lo]=ke[ko]=ke[us]=ke[Do]=ke[Bc]=ke[qc]=ke[gn]=ke[xo]=ke[Yn]=ke[No]=ke[mn]=ke[Vo]=ke[Oo]=!1;var Pe={};Pe[cs]=Pe[Uc]=Pe[Lo]=Pe[us]=Pe[ko]=Pe[Do]=Pe[kh]=Pe[Dh]=Pe[xh]=Pe[Nh]=Pe[Vh]=Pe[gn]=Pe[xo]=Pe[Yn]=Pe[No]=Pe[mn]=Pe[Vo]=Pe[$c]=Pe[Oh]=Pe[Lh]=Pe[Mh]=Pe[Fh]=!0,Pe[Bc]=Pe[qc]=Pe[Oo]=!1;var RS={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},SS={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},bS={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},PS={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},CS=parseFloat,kS=parseInt,Ym=typeof la=="object"&&la&&la.Object===Object&&la,DS=typeof self=="object"&&self&&self.Object===Object&&self,ft=Ym||DS||Function("return this")(),Kh=e&&!e.nodeType&&e,hi=Kh&&!0&&n&&!n.nodeType&&n,Jm=hi&&hi.exports===Kh,Hh=Jm&&Ym.process,rn=function(){try{var E=hi&&hi.require&&hi.require("util").types;return E||Hh&&Hh.binding&&Hh.binding("util")}catch{}}(),Xm=rn&&rn.isArrayBuffer,Zm=rn&&rn.isDate,e_=rn&&rn.isMap,t_=rn&&rn.isRegExp,n_=rn&&rn.isSet,r_=rn&&rn.isTypedArray;function Ht(E,P,S){switch(S.length){case 0:return E.call(P);case 1:return E.call(P,S[0]);case 2:return E.call(P,S[0],S[1]);case 3:return E.call(P,S[0],S[1],S[2])}return E.apply(P,S)}function xS(E,P,S,W){for(var ee=-1,ve=E==null?0:E.length;++ee<ve;){var nt=E[ee];P(W,nt,S(nt),E)}return W}function sn(E,P){for(var S=-1,W=E==null?0:E.length;++S<W&&P(E[S],S,E)!==!1;);return E}function NS(E,P){for(var S=E==null?0:E.length;S--&&P(E[S],S,E)!==!1;);return E}function i_(E,P){for(var S=-1,W=E==null?0:E.length;++S<W;)if(!P(E[S],S,E))return!1;return!0}function Er(E,P){for(var S=-1,W=E==null?0:E.length,ee=0,ve=[];++S<W;){var nt=E[S];P(nt,S,E)&&(ve[ee++]=nt)}return ve}function Kc(E,P){var S=E==null?0:E.length;return!!S&&hs(E,P,0)>-1}function jh(E,P,S){for(var W=-1,ee=E==null?0:E.length;++W<ee;)if(S(P,E[W]))return!0;return!1}function Ve(E,P){for(var S=-1,W=E==null?0:E.length,ee=Array(W);++S<W;)ee[S]=P(E[S],S,E);return ee}function Tr(E,P){for(var S=-1,W=P.length,ee=E.length;++S<W;)E[ee+S]=P[S];return E}function Qh(E,P,S,W){var ee=-1,ve=E==null?0:E.length;for(W&&ve&&(S=E[++ee]);++ee<ve;)S=P(S,E[ee],ee,E);return S}function VS(E,P,S,W){var ee=E==null?0:E.length;for(W&&ee&&(S=E[--ee]);ee--;)S=P(S,E[ee],ee,E);return S}function Yh(E,P){for(var S=-1,W=E==null?0:E.length;++S<W;)if(P(E[S],S,E))return!0;return!1}var OS=Jh("length");function LS(E){return E.split("")}function MS(E){return E.match(zR)||[]}function s_(E,P,S){var W;return S(E,function(ee,ve,nt){if(P(ee,ve,nt))return W=ve,!1}),W}function Hc(E,P,S,W){for(var ee=E.length,ve=S+(W?1:-1);W?ve--:++ve<ee;)if(P(E[ve],ve,E))return ve;return-1}function hs(E,P,S){return P===P?QS(E,P,S):Hc(E,o_,S)}function FS(E,P,S,W){for(var ee=S-1,ve=E.length;++ee<ve;)if(W(E[ee],P))return ee;return-1}function o_(E){return E!==E}function a_(E,P){var S=E==null?0:E.length;return S?Zh(E,P)/S:Fc}function Jh(E){return function(P){return P==null?t:P[E]}}function Xh(E){return function(P){return E==null?t:E[P]}}function c_(E,P,S,W,ee){return ee(E,function(ve,nt,be){S=W?(W=!1,ve):P(S,ve,nt,be)}),S}function US(E,P){var S=E.length;for(E.sort(P);S--;)E[S]=E[S].value;return E}function Zh(E,P){for(var S,W=-1,ee=E.length;++W<ee;){var ve=P(E[W]);ve!==t&&(S=S===t?ve:S+ve)}return S}function ed(E,P){for(var S=-1,W=Array(E);++S<E;)W[S]=P(S);return W}function BS(E,P){return Ve(P,function(S){return[S,E[S]]})}function u_(E){return E&&E.slice(0,f_(E)+1).replace(Bh,"")}function jt(E){return function(P){return E(P)}}function td(E,P){return Ve(P,function(S){return E[S]})}function Mo(E,P){return E.has(P)}function l_(E,P){for(var S=-1,W=E.length;++S<W&&hs(P,E[S],0)>-1;);return S}function h_(E,P){for(var S=E.length;S--&&hs(P,E[S],0)>-1;);return S}function qS(E,P){for(var S=E.length,W=0;S--;)E[S]===P&&++W;return W}var $S=Xh(RS),WS=Xh(SS);function GS(E){return"\\"+PS[E]}function zS(E,P){return E==null?t:E[P]}function ds(E){return wS.test(E)}function KS(E){return ES.test(E)}function HS(E){for(var P,S=[];!(P=E.next()).done;)S.push(P.value);return S}function nd(E){var P=-1,S=Array(E.size);return E.forEach(function(W,ee){S[++P]=[ee,W]}),S}function d_(E,P){return function(S){return E(P(S))}}function Ar(E,P){for(var S=-1,W=E.length,ee=0,ve=[];++S<W;){var nt=E[S];(nt===P||nt===p)&&(E[S]=p,ve[ee++]=S)}return ve}function jc(E){var P=-1,S=Array(E.size);return E.forEach(function(W){S[++P]=W}),S}function jS(E){var P=-1,S=Array(E.size);return E.forEach(function(W){S[++P]=[W,W]}),S}function QS(E,P,S){for(var W=S-1,ee=E.length;++W<ee;)if(E[W]===P)return W;return-1}function YS(E,P,S){for(var W=S+1;W--;)if(E[W]===P)return W;return W}function fs(E){return ds(E)?XS(E):OS(E)}function _n(E){return ds(E)?ZS(E):LS(E)}function f_(E){for(var P=E.length;P--&&qR.test(E.charAt(P)););return P}var JS=Xh(bS);function XS(E){for(var P=zh.lastIndex=0;zh.test(E);)++P;return P}function ZS(E){return E.match(zh)||[]}function eb(E){return E.match(IS)||[]}var tb=function E(P){P=P==null?ft:ps.defaults(ft.Object(),P,ps.pick(ft,TS));var S=P.Array,W=P.Date,ee=P.Error,ve=P.Function,nt=P.Math,be=P.Object,rd=P.RegExp,nb=P.String,on=P.TypeError,Qc=S.prototype,rb=ve.prototype,gs=be.prototype,Yc=P["__core-js_shared__"],Jc=rb.toString,Ee=gs.hasOwnProperty,ib=0,p_=function(){var o=/[^.]+$/.exec(Yc&&Yc.keys&&Yc.keys.IE_PROTO||"");return o?"Symbol(src)_1."+o:""}(),Xc=gs.toString,sb=Jc.call(be),ob=ft._,ab=rd("^"+Jc.call(Ee).replace(Uh,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Zc=Jm?P.Buffer:t,Rr=P.Symbol,eu=P.Uint8Array,g_=Zc?Zc.allocUnsafe:t,tu=d_(be.getPrototypeOf,be),m_=be.create,__=gs.propertyIsEnumerable,nu=Qc.splice,y_=Rr?Rr.isConcatSpreadable:t,Fo=Rr?Rr.iterator:t,di=Rr?Rr.toStringTag:t,ru=function(){try{var o=_i(be,"defineProperty");return o({},"",{}),o}catch{}}(),cb=P.clearTimeout!==ft.clearTimeout&&P.clearTimeout,ub=W&&W.now!==ft.Date.now&&W.now,lb=P.setTimeout!==ft.setTimeout&&P.setTimeout,iu=nt.ceil,su=nt.floor,id=be.getOwnPropertySymbols,hb=Zc?Zc.isBuffer:t,v_=P.isFinite,db=Qc.join,fb=d_(be.keys,be),rt=nt.max,Et=nt.min,pb=W.now,gb=P.parseInt,I_=nt.random,mb=Qc.reverse,sd=_i(P,"DataView"),Uo=_i(P,"Map"),od=_i(P,"Promise"),ms=_i(P,"Set"),Bo=_i(P,"WeakMap"),qo=_i(be,"create"),ou=Bo&&new Bo,_s={},_b=yi(sd),yb=yi(Uo),vb=yi(od),Ib=yi(ms),wb=yi(Bo),au=Rr?Rr.prototype:t,$o=au?au.valueOf:t,w_=au?au.toString:t;function _(o){if($e(o)&&!te(o)&&!(o instanceof le)){if(o instanceof an)return o;if(Ee.call(o,"__wrapped__"))return Ey(o)}return new an(o)}var ys=function(){function o(){}return function(c){if(!Be(c))return{};if(m_)return m_(c);o.prototype=c;var u=new o;return o.prototype=t,u}}();function cu(){}function an(o,c){this.__wrapped__=o,this.__actions__=[],this.__chain__=!!c,this.__index__=0,this.__values__=t}_.templateSettings={escape:OR,evaluate:LR,interpolate:km,variable:"",imports:{_}},_.prototype=cu.prototype,_.prototype.constructor=_,an.prototype=ys(cu.prototype),an.prototype.constructor=an;function le(o){this.__wrapped__=o,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Rn,this.__views__=[]}function Eb(){var o=new le(this.__wrapped__);return o.__actions__=Ft(this.__actions__),o.__dir__=this.__dir__,o.__filtered__=this.__filtered__,o.__iteratees__=Ft(this.__iteratees__),o.__takeCount__=this.__takeCount__,o.__views__=Ft(this.__views__),o}function Tb(){if(this.__filtered__){var o=new le(this);o.__dir__=-1,o.__filtered__=!0}else o=this.clone(),o.__dir__*=-1;return o}function Ab(){var o=this.__wrapped__.value(),c=this.__dir__,u=te(o),d=c<0,g=u?o.length:0,y=LP(0,g,this.__views__),v=y.start,w=y.end,T=w-v,C=d?w:v-1,k=this.__iteratees__,x=k.length,U=0,G=Et(T,this.__takeCount__);if(!u||!d&&g==T&&G==T)return z_(o,this.__actions__);var J=[];e:for(;T--&&U<G;){C+=c;for(var se=-1,X=o[C];++se<x;){var ce=k[se],fe=ce.iteratee,Jt=ce.type,kt=fe(X);if(Jt==yR)X=kt;else if(!kt){if(Jt==Rm)continue e;break e}}J[U++]=X}return J}le.prototype=ys(cu.prototype),le.prototype.constructor=le;function fi(o){var c=-1,u=o==null?0:o.length;for(this.clear();++c<u;){var d=o[c];this.set(d[0],d[1])}}function Rb(){this.__data__=qo?qo(null):{},this.size=0}function Sb(o){var c=this.has(o)&&delete this.__data__[o];return this.size-=c?1:0,c}function bb(o){var c=this.__data__;if(qo){var u=c[o];return u===h?t:u}return Ee.call(c,o)?c[o]:t}function Pb(o){var c=this.__data__;return qo?c[o]!==t:Ee.call(c,o)}function Cb(o,c){var u=this.__data__;return this.size+=this.has(o)?0:1,u[o]=qo&&c===t?h:c,this}fi.prototype.clear=Rb,fi.prototype.delete=Sb,fi.prototype.get=bb,fi.prototype.has=Pb,fi.prototype.set=Cb;function Jn(o){var c=-1,u=o==null?0:o.length;for(this.clear();++c<u;){var d=o[c];this.set(d[0],d[1])}}function kb(){this.__data__=[],this.size=0}function Db(o){var c=this.__data__,u=uu(c,o);if(u<0)return!1;var d=c.length-1;return u==d?c.pop():nu.call(c,u,1),--this.size,!0}function xb(o){var c=this.__data__,u=uu(c,o);return u<0?t:c[u][1]}function Nb(o){return uu(this.__data__,o)>-1}function Vb(o,c){var u=this.__data__,d=uu(u,o);return d<0?(++this.size,u.push([o,c])):u[d][1]=c,this}Jn.prototype.clear=kb,Jn.prototype.delete=Db,Jn.prototype.get=xb,Jn.prototype.has=Nb,Jn.prototype.set=Vb;function Xn(o){var c=-1,u=o==null?0:o.length;for(this.clear();++c<u;){var d=o[c];this.set(d[0],d[1])}}function Ob(){this.size=0,this.__data__={hash:new fi,map:new(Uo||Jn),string:new fi}}function Lb(o){var c=wu(this,o).delete(o);return this.size-=c?1:0,c}function Mb(o){return wu(this,o).get(o)}function Fb(o){return wu(this,o).has(o)}function Ub(o,c){var u=wu(this,o),d=u.size;return u.set(o,c),this.size+=u.size==d?0:1,this}Xn.prototype.clear=Ob,Xn.prototype.delete=Lb,Xn.prototype.get=Mb,Xn.prototype.has=Fb,Xn.prototype.set=Ub;function pi(o){var c=-1,u=o==null?0:o.length;for(this.__data__=new Xn;++c<u;)this.add(o[c])}function Bb(o){return this.__data__.set(o,h),this}function qb(o){return this.__data__.has(o)}pi.prototype.add=pi.prototype.push=Bb,pi.prototype.has=qb;function yn(o){var c=this.__data__=new Jn(o);this.size=c.size}function $b(){this.__data__=new Jn,this.size=0}function Wb(o){var c=this.__data__,u=c.delete(o);return this.size=c.size,u}function Gb(o){return this.__data__.get(o)}function zb(o){return this.__data__.has(o)}function Kb(o,c){var u=this.__data__;if(u instanceof Jn){var d=u.__data__;if(!Uo||d.length<i-1)return d.push([o,c]),this.size=++u.size,this;u=this.__data__=new Xn(d)}return u.set(o,c),this.size=u.size,this}yn.prototype.clear=$b,yn.prototype.delete=Wb,yn.prototype.get=Gb,yn.prototype.has=zb,yn.prototype.set=Kb;function E_(o,c){var u=te(o),d=!u&&vi(o),g=!u&&!d&&kr(o),y=!u&&!d&&!g&&Es(o),v=u||d||g||y,w=v?ed(o.length,nb):[],T=w.length;for(var C in o)(c||Ee.call(o,C))&&!(v&&(C=="length"||g&&(C=="offset"||C=="parent")||y&&(C=="buffer"||C=="byteLength"||C=="byteOffset")||nr(C,T)))&&w.push(C);return w}function T_(o){var c=o.length;return c?o[_d(0,c-1)]:t}function Hb(o,c){return Eu(Ft(o),gi(c,0,o.length))}function jb(o){return Eu(Ft(o))}function ad(o,c,u){(u!==t&&!vn(o[c],u)||u===t&&!(c in o))&&Zn(o,c,u)}function Wo(o,c,u){var d=o[c];(!(Ee.call(o,c)&&vn(d,u))||u===t&&!(c in o))&&Zn(o,c,u)}function uu(o,c){for(var u=o.length;u--;)if(vn(o[u][0],c))return u;return-1}function Qb(o,c,u,d){return Sr(o,function(g,y,v){c(d,g,u(g),v)}),d}function A_(o,c){return o&&bn(c,st(c),o)}function Yb(o,c){return o&&bn(c,Bt(c),o)}function Zn(o,c,u){c=="__proto__"&&ru?ru(o,c,{configurable:!0,enumerable:!0,value:u,writable:!0}):o[c]=u}function cd(o,c){for(var u=-1,d=c.length,g=S(d),y=o==null;++u<d;)g[u]=y?t:$d(o,c[u]);return g}function gi(o,c,u){return o===o&&(u!==t&&(o=o<=u?o:u),c!==t&&(o=o>=c?o:c)),o}function cn(o,c,u,d,g,y){var v,w=c&m,T=c&I,C=c&A;if(u&&(v=g?u(o,d,g,y):u(o)),v!==t)return v;if(!Be(o))return o;var k=te(o);if(k){if(v=FP(o),!w)return Ft(o,v)}else{var x=Tt(o),U=x==qc||x==Sm;if(kr(o))return j_(o,w);if(x==Yn||x==cs||U&&!g){if(v=T||U?{}:fy(o),!w)return T?bP(o,Yb(v,o)):SP(o,A_(v,o))}else{if(!Pe[x])return g?o:{};v=UP(o,x,w)}}y||(y=new yn);var G=y.get(o);if(G)return G;y.set(o,v),$y(o)?o.forEach(function(X){v.add(cn(X,c,u,X,o,y))}):By(o)&&o.forEach(function(X,ce){v.set(ce,cn(X,c,u,ce,o,y))});var J=C?T?Pd:bd:T?Bt:st,se=k?t:J(o);return sn(se||o,function(X,ce){se&&(ce=X,X=o[ce]),Wo(v,ce,cn(X,c,u,ce,o,y))}),v}function Jb(o){var c=st(o);return function(u){return R_(u,o,c)}}function R_(o,c,u){var d=u.length;if(o==null)return!d;for(o=be(o);d--;){var g=u[d],y=c[g],v=o[g];if(v===t&&!(g in o)||!y(v))return!1}return!0}function S_(o,c,u){if(typeof o!="function")throw new on(a);return Yo(function(){o.apply(t,u)},c)}function Go(o,c,u,d){var g=-1,y=Kc,v=!0,w=o.length,T=[],C=c.length;if(!w)return T;u&&(c=Ve(c,jt(u))),d?(y=jh,v=!1):c.length>=i&&(y=Mo,v=!1,c=new pi(c));e:for(;++g<w;){var k=o[g],x=u==null?k:u(k);if(k=d||k!==0?k:0,v&&x===x){for(var U=C;U--;)if(c[U]===x)continue e;T.push(k)}else y(c,x,d)||T.push(k)}return T}var Sr=Z_(Sn),b_=Z_(ld,!0);function Xb(o,c){var u=!0;return Sr(o,function(d,g,y){return u=!!c(d,g,y),u}),u}function lu(o,c,u){for(var d=-1,g=o.length;++d<g;){var y=o[d],v=c(y);if(v!=null&&(w===t?v===v&&!Yt(v):u(v,w)))var w=v,T=y}return T}function Zb(o,c,u,d){var g=o.length;for(u=ie(u),u<0&&(u=-u>g?0:g+u),d=d===t||d>g?g:ie(d),d<0&&(d+=g),d=u>d?0:Gy(d);u<d;)o[u++]=c;return o}function P_(o,c){var u=[];return Sr(o,function(d,g,y){c(d,g,y)&&u.push(d)}),u}function pt(o,c,u,d,g){var y=-1,v=o.length;for(u||(u=qP),g||(g=[]);++y<v;){var w=o[y];c>0&&u(w)?c>1?pt(w,c-1,u,d,g):Tr(g,w):d||(g[g.length]=w)}return g}var ud=ey(),C_=ey(!0);function Sn(o,c){return o&&ud(o,c,st)}function ld(o,c){return o&&C_(o,c,st)}function hu(o,c){return Er(c,function(u){return rr(o[u])})}function mi(o,c){c=Pr(c,o);for(var u=0,d=c.length;o!=null&&u<d;)o=o[Pn(c[u++])];return u&&u==d?o:t}function k_(o,c,u){var d=c(o);return te(o)?d:Tr(d,u(o))}function Pt(o){return o==null?o===t?PR:SR:di&&di in be(o)?OP(o):jP(o)}function hd(o,c){return o>c}function eP(o,c){return o!=null&&Ee.call(o,c)}function tP(o,c){return o!=null&&c in be(o)}function nP(o,c,u){return o>=Et(c,u)&&o<rt(c,u)}function dd(o,c,u){for(var d=u?jh:Kc,g=o[0].length,y=o.length,v=y,w=S(y),T=1/0,C=[];v--;){var k=o[v];v&&c&&(k=Ve(k,jt(c))),T=Et(k.length,T),w[v]=!u&&(c||g>=120&&k.length>=120)?new pi(v&&k):t}k=o[0];var x=-1,U=w[0];e:for(;++x<g&&C.length<T;){var G=k[x],J=c?c(G):G;if(G=u||G!==0?G:0,!(U?Mo(U,J):d(C,J,u))){for(v=y;--v;){var se=w[v];if(!(se?Mo(se,J):d(o[v],J,u)))continue e}U&&U.push(J),C.push(G)}}return C}function rP(o,c,u,d){return Sn(o,function(g,y,v){c(d,u(g),y,v)}),d}function zo(o,c,u){c=Pr(c,o),o=_y(o,c);var d=o==null?o:o[Pn(ln(c))];return d==null?t:Ht(d,o,u)}function D_(o){return $e(o)&&Pt(o)==cs}function iP(o){return $e(o)&&Pt(o)==Lo}function sP(o){return $e(o)&&Pt(o)==Do}function Ko(o,c,u,d,g){return o===c?!0:o==null||c==null||!$e(o)&&!$e(c)?o!==o&&c!==c:oP(o,c,u,d,Ko,g)}function oP(o,c,u,d,g,y){var v=te(o),w=te(c),T=v?Uc:Tt(o),C=w?Uc:Tt(c);T=T==cs?Yn:T,C=C==cs?Yn:C;var k=T==Yn,x=C==Yn,U=T==C;if(U&&kr(o)){if(!kr(c))return!1;v=!0,k=!1}if(U&&!k)return y||(y=new yn),v||Es(o)?ly(o,c,u,d,g,y):NP(o,c,T,u,d,g,y);if(!(u&L)){var G=k&&Ee.call(o,"__wrapped__"),J=x&&Ee.call(c,"__wrapped__");if(G||J){var se=G?o.value():o,X=J?c.value():c;return y||(y=new yn),g(se,X,u,d,y)}}return U?(y||(y=new yn),VP(o,c,u,d,g,y)):!1}function aP(o){return $e(o)&&Tt(o)==gn}function fd(o,c,u,d){var g=u.length,y=g,v=!d;if(o==null)return!y;for(o=be(o);g--;){var w=u[g];if(v&&w[2]?w[1]!==o[w[0]]:!(w[0]in o))return!1}for(;++g<y;){w=u[g];var T=w[0],C=o[T],k=w[1];if(v&&w[2]){if(C===t&&!(T in o))return!1}else{var x=new yn;if(d)var U=d(C,k,T,o,c,x);if(!(U===t?Ko(k,C,L|M,d,x):U))return!1}}return!0}function x_(o){if(!Be(o)||WP(o))return!1;var c=rr(o)?ab:JR;return c.test(yi(o))}function cP(o){return $e(o)&&Pt(o)==No}function uP(o){return $e(o)&&Tt(o)==mn}function lP(o){return $e(o)&&Pu(o.length)&&!!ke[Pt(o)]}function N_(o){return typeof o=="function"?o:o==null?qt:typeof o=="object"?te(o)?L_(o[0],o[1]):O_(o):tv(o)}function pd(o){if(!Qo(o))return fb(o);var c=[];for(var u in be(o))Ee.call(o,u)&&u!="constructor"&&c.push(u);return c}function hP(o){if(!Be(o))return HP(o);var c=Qo(o),u=[];for(var d in o)d=="constructor"&&(c||!Ee.call(o,d))||u.push(d);return u}function gd(o,c){return o<c}function V_(o,c){var u=-1,d=Ut(o)?S(o.length):[];return Sr(o,function(g,y,v){d[++u]=c(g,y,v)}),d}function O_(o){var c=kd(o);return c.length==1&&c[0][2]?gy(c[0][0],c[0][1]):function(u){return u===o||fd(u,o,c)}}function L_(o,c){return xd(o)&&py(c)?gy(Pn(o),c):function(u){var d=$d(u,o);return d===t&&d===c?Wd(u,o):Ko(c,d,L|M)}}function du(o,c,u,d,g){o!==c&&ud(c,function(y,v){if(g||(g=new yn),Be(y))dP(o,c,v,u,du,d,g);else{var w=d?d(Vd(o,v),y,v+"",o,c,g):t;w===t&&(w=y),ad(o,v,w)}},Bt)}function dP(o,c,u,d,g,y,v){var w=Vd(o,u),T=Vd(c,u),C=v.get(T);if(C){ad(o,u,C);return}var k=y?y(w,T,u+"",o,c,v):t,x=k===t;if(x){var U=te(T),G=!U&&kr(T),J=!U&&!G&&Es(T);k=T,U||G||J?te(w)?k=w:Ye(w)?k=Ft(w):G?(x=!1,k=j_(T,!0)):J?(x=!1,k=Q_(T,!0)):k=[]:Jo(T)||vi(T)?(k=w,vi(w)?k=zy(w):(!Be(w)||rr(w))&&(k=fy(T))):x=!1}x&&(v.set(T,k),g(k,T,d,y,v),v.delete(T)),ad(o,u,k)}function M_(o,c){var u=o.length;if(u)return c+=c<0?u:0,nr(c,u)?o[c]:t}function F_(o,c,u){c.length?c=Ve(c,function(y){return te(y)?function(v){return mi(v,y.length===1?y[0]:y)}:y}):c=[qt];var d=-1;c=Ve(c,jt(Q()));var g=V_(o,function(y,v,w){var T=Ve(c,function(C){return C(y)});return{criteria:T,index:++d,value:y}});return US(g,function(y,v){return RP(y,v,u)})}function fP(o,c){return U_(o,c,function(u,d){return Wd(o,d)})}function U_(o,c,u){for(var d=-1,g=c.length,y={};++d<g;){var v=c[d],w=mi(o,v);u(w,v)&&Ho(y,Pr(v,o),w)}return y}function pP(o){return function(c){return mi(c,o)}}function md(o,c,u,d){var g=d?FS:hs,y=-1,v=c.length,w=o;for(o===c&&(c=Ft(c)),u&&(w=Ve(o,jt(u)));++y<v;)for(var T=0,C=c[y],k=u?u(C):C;(T=g(w,k,T,d))>-1;)w!==o&&nu.call(w,T,1),nu.call(o,T,1);return o}function B_(o,c){for(var u=o?c.length:0,d=u-1;u--;){var g=c[u];if(u==d||g!==y){var y=g;nr(g)?nu.call(o,g,1):Id(o,g)}}return o}function _d(o,c){return o+su(I_()*(c-o+1))}function gP(o,c,u,d){for(var g=-1,y=rt(iu((c-o)/(u||1)),0),v=S(y);y--;)v[d?y:++g]=o,o+=u;return v}function yd(o,c){var u="";if(!o||c<1||c>wr)return u;do c%2&&(u+=o),c=su(c/2),c&&(o+=o);while(c);return u}function oe(o,c){return Od(my(o,c,qt),o+"")}function mP(o){return T_(Ts(o))}function _P(o,c){var u=Ts(o);return Eu(u,gi(c,0,u.length))}function Ho(o,c,u,d){if(!Be(o))return o;c=Pr(c,o);for(var g=-1,y=c.length,v=y-1,w=o;w!=null&&++g<y;){var T=Pn(c[g]),C=u;if(T==="__proto__"||T==="constructor"||T==="prototype")return o;if(g!=v){var k=w[T];C=d?d(k,T,w):t,C===t&&(C=Be(k)?k:nr(c[g+1])?[]:{})}Wo(w,T,C),w=w[T]}return o}var q_=ou?function(o,c){return ou.set(o,c),o}:qt,yP=ru?function(o,c){return ru(o,"toString",{configurable:!0,enumerable:!1,value:zd(c),writable:!0})}:qt;function vP(o){return Eu(Ts(o))}function un(o,c,u){var d=-1,g=o.length;c<0&&(c=-c>g?0:g+c),u=u>g?g:u,u<0&&(u+=g),g=c>u?0:u-c>>>0,c>>>=0;for(var y=S(g);++d<g;)y[d]=o[d+c];return y}function IP(o,c){var u;return Sr(o,function(d,g,y){return u=c(d,g,y),!u}),!!u}function fu(o,c,u){var d=0,g=o==null?d:o.length;if(typeof c=="number"&&c===c&&g<=ER){for(;d<g;){var y=d+g>>>1,v=o[y];v!==null&&!Yt(v)&&(u?v<=c:v<c)?d=y+1:g=y}return g}return vd(o,c,qt,u)}function vd(o,c,u,d){var g=0,y=o==null?0:o.length;if(y===0)return 0;c=u(c);for(var v=c!==c,w=c===null,T=Yt(c),C=c===t;g<y;){var k=su((g+y)/2),x=u(o[k]),U=x!==t,G=x===null,J=x===x,se=Yt(x);if(v)var X=d||J;else C?X=J&&(d||U):w?X=J&&U&&(d||!G):T?X=J&&U&&!G&&(d||!se):G||se?X=!1:X=d?x<=c:x<c;X?g=k+1:y=k}return Et(y,wR)}function $_(o,c){for(var u=-1,d=o.length,g=0,y=[];++u<d;){var v=o[u],w=c?c(v):v;if(!u||!vn(w,T)){var T=w;y[g++]=v===0?0:v}}return y}function W_(o){return typeof o=="number"?o:Yt(o)?Fc:+o}function Qt(o){if(typeof o=="string")return o;if(te(o))return Ve(o,Qt)+"";if(Yt(o))return w_?w_.call(o):"";var c=o+"";return c=="0"&&1/o==-li?"-0":c}function br(o,c,u){var d=-1,g=Kc,y=o.length,v=!0,w=[],T=w;if(u)v=!1,g=jh;else if(y>=i){var C=c?null:DP(o);if(C)return jc(C);v=!1,g=Mo,T=new pi}else T=c?[]:w;e:for(;++d<y;){var k=o[d],x=c?c(k):k;if(k=u||k!==0?k:0,v&&x===x){for(var U=T.length;U--;)if(T[U]===x)continue e;c&&T.push(x),w.push(k)}else g(T,x,u)||(T!==w&&T.push(x),w.push(k))}return w}function Id(o,c){return c=Pr(c,o),o=_y(o,c),o==null||delete o[Pn(ln(c))]}function G_(o,c,u,d){return Ho(o,c,u(mi(o,c)),d)}function pu(o,c,u,d){for(var g=o.length,y=d?g:-1;(d?y--:++y<g)&&c(o[y],y,o););return u?un(o,d?0:y,d?y+1:g):un(o,d?y+1:0,d?g:y)}function z_(o,c){var u=o;return u instanceof le&&(u=u.value()),Qh(c,function(d,g){return g.func.apply(g.thisArg,Tr([d],g.args))},u)}function wd(o,c,u){var d=o.length;if(d<2)return d?br(o[0]):[];for(var g=-1,y=S(d);++g<d;)for(var v=o[g],w=-1;++w<d;)w!=g&&(y[g]=Go(y[g]||v,o[w],c,u));return br(pt(y,1),c,u)}function K_(o,c,u){for(var d=-1,g=o.length,y=c.length,v={};++d<g;){var w=d<y?c[d]:t;u(v,o[d],w)}return v}function Ed(o){return Ye(o)?o:[]}function Td(o){return typeof o=="function"?o:qt}function Pr(o,c){return te(o)?o:xd(o,c)?[o]:wy(Ie(o))}var wP=oe;function Cr(o,c,u){var d=o.length;return u=u===t?d:u,!c&&u>=d?o:un(o,c,u)}var H_=cb||function(o){return ft.clearTimeout(o)};function j_(o,c){if(c)return o.slice();var u=o.length,d=g_?g_(u):new o.constructor(u);return o.copy(d),d}function Ad(o){var c=new o.constructor(o.byteLength);return new eu(c).set(new eu(o)),c}function EP(o,c){var u=c?Ad(o.buffer):o.buffer;return new o.constructor(u,o.byteOffset,o.byteLength)}function TP(o){var c=new o.constructor(o.source,Dm.exec(o));return c.lastIndex=o.lastIndex,c}function AP(o){return $o?be($o.call(o)):{}}function Q_(o,c){var u=c?Ad(o.buffer):o.buffer;return new o.constructor(u,o.byteOffset,o.length)}function Y_(o,c){if(o!==c){var u=o!==t,d=o===null,g=o===o,y=Yt(o),v=c!==t,w=c===null,T=c===c,C=Yt(c);if(!w&&!C&&!y&&o>c||y&&v&&T&&!w&&!C||d&&v&&T||!u&&T||!g)return 1;if(!d&&!y&&!C&&o<c||C&&u&&g&&!d&&!y||w&&u&&g||!v&&g||!T)return-1}return 0}function RP(o,c,u){for(var d=-1,g=o.criteria,y=c.criteria,v=g.length,w=u.length;++d<v;){var T=Y_(g[d],y[d]);if(T){if(d>=w)return T;var C=u[d];return T*(C=="desc"?-1:1)}}return o.index-c.index}function J_(o,c,u,d){for(var g=-1,y=o.length,v=u.length,w=-1,T=c.length,C=rt(y-v,0),k=S(T+C),x=!d;++w<T;)k[w]=c[w];for(;++g<v;)(x||g<y)&&(k[u[g]]=o[g]);for(;C--;)k[w++]=o[g++];return k}function X_(o,c,u,d){for(var g=-1,y=o.length,v=-1,w=u.length,T=-1,C=c.length,k=rt(y-w,0),x=S(k+C),U=!d;++g<k;)x[g]=o[g];for(var G=g;++T<C;)x[G+T]=c[T];for(;++v<w;)(U||g<y)&&(x[G+u[v]]=o[g++]);return x}function Ft(o,c){var u=-1,d=o.length;for(c||(c=S(d));++u<d;)c[u]=o[u];return c}function bn(o,c,u,d){var g=!u;u||(u={});for(var y=-1,v=c.length;++y<v;){var w=c[y],T=d?d(u[w],o[w],w,u,o):t;T===t&&(T=o[w]),g?Zn(u,w,T):Wo(u,w,T)}return u}function SP(o,c){return bn(o,Dd(o),c)}function bP(o,c){return bn(o,hy(o),c)}function gu(o,c){return function(u,d){var g=te(u)?xS:Qb,y=c?c():{};return g(u,o,Q(d,2),y)}}function vs(o){return oe(function(c,u){var d=-1,g=u.length,y=g>1?u[g-1]:t,v=g>2?u[2]:t;for(y=o.length>3&&typeof y=="function"?(g--,y):t,v&&Ct(u[0],u[1],v)&&(y=g<3?t:y,g=1),c=be(c);++d<g;){var w=u[d];w&&o(c,w,d,y)}return c})}function Z_(o,c){return function(u,d){if(u==null)return u;if(!Ut(u))return o(u,d);for(var g=u.length,y=c?g:-1,v=be(u);(c?y--:++y<g)&&d(v[y],y,v)!==!1;);return u}}function ey(o){return function(c,u,d){for(var g=-1,y=be(c),v=d(c),w=v.length;w--;){var T=v[o?w:++g];if(u(y[T],T,y)===!1)break}return c}}function PP(o,c,u){var d=c&V,g=jo(o);function y(){var v=this&&this!==ft&&this instanceof y?g:o;return v.apply(d?u:this,arguments)}return y}function ty(o){return function(c){c=Ie(c);var u=ds(c)?_n(c):t,d=u?u[0]:c.charAt(0),g=u?Cr(u,1).join(""):c.slice(1);return d[o]()+g}}function Is(o){return function(c){return Qh(Zy(Xy(c).replace(yS,"")),o,"")}}function jo(o){return function(){var c=arguments;switch(c.length){case 0:return new o;case 1:return new o(c[0]);case 2:return new o(c[0],c[1]);case 3:return new o(c[0],c[1],c[2]);case 4:return new o(c[0],c[1],c[2],c[3]);case 5:return new o(c[0],c[1],c[2],c[3],c[4]);case 6:return new o(c[0],c[1],c[2],c[3],c[4],c[5]);case 7:return new o(c[0],c[1],c[2],c[3],c[4],c[5],c[6])}var u=ys(o.prototype),d=o.apply(u,c);return Be(d)?d:u}}function CP(o,c,u){var d=jo(o);function g(){for(var y=arguments.length,v=S(y),w=y,T=ws(g);w--;)v[w]=arguments[w];var C=y<3&&v[0]!==T&&v[y-1]!==T?[]:Ar(v,T);if(y-=C.length,y<u)return oy(o,c,mu,g.placeholder,t,v,C,t,t,u-y);var k=this&&this!==ft&&this instanceof g?d:o;return Ht(k,this,v)}return g}function ny(o){return function(c,u,d){var g=be(c);if(!Ut(c)){var y=Q(u,3);c=st(c),u=function(w){return y(g[w],w,g)}}var v=o(c,u,d);return v>-1?g[y?c[v]:v]:t}}function ry(o){return tr(function(c){var u=c.length,d=u,g=an.prototype.thru;for(o&&c.reverse();d--;){var y=c[d];if(typeof y!="function")throw new on(a);if(g&&!v&&Iu(y)=="wrapper")var v=new an([],!0)}for(d=v?d:u;++d<u;){y=c[d];var w=Iu(y),T=w=="wrapper"?Cd(y):t;T&&Nd(T[0])&&T[1]==(we|j|de|Mt)&&!T[4].length&&T[9]==1?v=v[Iu(T[0])].apply(v,T[3]):v=y.length==1&&Nd(y)?v[w]():v.thru(y)}return function(){var C=arguments,k=C[0];if(v&&C.length==1&&te(k))return v.plant(k).value();for(var x=0,U=u?c[x].apply(this,C):k;++x<u;)U=c[x].call(this,U);return U}})}function mu(o,c,u,d,g,y,v,w,T,C){var k=c&we,x=c&V,U=c&Y,G=c&(j|ye),J=c&Qn,se=U?t:jo(o);function X(){for(var ce=arguments.length,fe=S(ce),Jt=ce;Jt--;)fe[Jt]=arguments[Jt];if(G)var kt=ws(X),Xt=qS(fe,kt);if(d&&(fe=J_(fe,d,g,G)),y&&(fe=X_(fe,y,v,G)),ce-=Xt,G&&ce<C){var Je=Ar(fe,kt);return oy(o,c,mu,X.placeholder,u,fe,Je,w,T,C-ce)}var In=x?u:this,sr=U?In[o]:o;return ce=fe.length,w?fe=QP(fe,w):J&&ce>1&&fe.reverse(),k&&T<ce&&(fe.length=T),this&&this!==ft&&this instanceof X&&(sr=se||jo(sr)),sr.apply(In,fe)}return X}function iy(o,c){return function(u,d){return rP(u,o,c(d),{})}}function _u(o,c){return function(u,d){var g;if(u===t&&d===t)return c;if(u!==t&&(g=u),d!==t){if(g===t)return d;typeof u=="string"||typeof d=="string"?(u=Qt(u),d=Qt(d)):(u=W_(u),d=W_(d)),g=o(u,d)}return g}}function Rd(o){return tr(function(c){return c=Ve(c,jt(Q())),oe(function(u){var d=this;return o(c,function(g){return Ht(g,d,u)})})})}function yu(o,c){c=c===t?" ":Qt(c);var u=c.length;if(u<2)return u?yd(c,o):c;var d=yd(c,iu(o/fs(c)));return ds(c)?Cr(_n(d),0,o).join(""):d.slice(0,o)}function kP(o,c,u,d){var g=c&V,y=jo(o);function v(){for(var w=-1,T=arguments.length,C=-1,k=d.length,x=S(k+T),U=this&&this!==ft&&this instanceof v?y:o;++C<k;)x[C]=d[C];for(;T--;)x[C++]=arguments[++w];return Ht(U,g?u:this,x)}return v}function sy(o){return function(c,u,d){return d&&typeof d!="number"&&Ct(c,u,d)&&(u=d=t),c=ir(c),u===t?(u=c,c=0):u=ir(u),d=d===t?c<u?1:-1:ir(d),gP(c,u,d,o)}}function vu(o){return function(c,u){return typeof c=="string"&&typeof u=="string"||(c=hn(c),u=hn(u)),o(c,u)}}function oy(o,c,u,d,g,y,v,w,T,C){var k=c&j,x=k?v:t,U=k?t:v,G=k?y:t,J=k?t:y;c|=k?de:me,c&=~(k?me:de),c&ae||(c&=~(V|Y));var se=[o,c,g,G,x,J,U,w,T,C],X=u.apply(t,se);return Nd(o)&&yy(X,se),X.placeholder=d,vy(X,o,c)}function Sd(o){var c=nt[o];return function(u,d){if(u=hn(u),d=d==null?0:Et(ie(d),292),d&&v_(u)){var g=(Ie(u)+"e").split("e"),y=c(g[0]+"e"+(+g[1]+d));return g=(Ie(y)+"e").split("e"),+(g[0]+"e"+(+g[1]-d))}return c(u)}}var DP=ms&&1/jc(new ms([,-0]))[1]==li?function(o){return new ms(o)}:jd;function ay(o){return function(c){var u=Tt(c);return u==gn?nd(c):u==mn?jS(c):BS(c,o(c))}}function er(o,c,u,d,g,y,v,w){var T=c&Y;if(!T&&typeof o!="function")throw new on(a);var C=d?d.length:0;if(C||(c&=~(de|me),d=g=t),v=v===t?v:rt(ie(v),0),w=w===t?w:ie(w),C-=g?g.length:0,c&me){var k=d,x=g;d=g=t}var U=T?t:Cd(o),G=[o,c,u,d,g,k,x,y,v,w];if(U&&KP(G,U),o=G[0],c=G[1],u=G[2],d=G[3],g=G[4],w=G[9]=G[9]===t?T?0:o.length:rt(G[9]-C,0),!w&&c&(j|ye)&&(c&=~(j|ye)),!c||c==V)var J=PP(o,c,u);else c==j||c==ye?J=CP(o,c,w):(c==de||c==(V|de))&&!g.length?J=kP(o,c,u,d):J=mu.apply(t,G);var se=U?q_:yy;return vy(se(J,G),o,c)}function cy(o,c,u,d){return o===t||vn(o,gs[u])&&!Ee.call(d,u)?c:o}function uy(o,c,u,d,g,y){return Be(o)&&Be(c)&&(y.set(c,o),du(o,c,t,uy,y),y.delete(c)),o}function xP(o){return Jo(o)?t:o}function ly(o,c,u,d,g,y){var v=u&L,w=o.length,T=c.length;if(w!=T&&!(v&&T>w))return!1;var C=y.get(o),k=y.get(c);if(C&&k)return C==c&&k==o;var x=-1,U=!0,G=u&M?new pi:t;for(y.set(o,c),y.set(c,o);++x<w;){var J=o[x],se=c[x];if(d)var X=v?d(se,J,x,c,o,y):d(J,se,x,o,c,y);if(X!==t){if(X)continue;U=!1;break}if(G){if(!Yh(c,function(ce,fe){if(!Mo(G,fe)&&(J===ce||g(J,ce,u,d,y)))return G.push(fe)})){U=!1;break}}else if(!(J===se||g(J,se,u,d,y))){U=!1;break}}return y.delete(o),y.delete(c),U}function NP(o,c,u,d,g,y,v){switch(u){case us:if(o.byteLength!=c.byteLength||o.byteOffset!=c.byteOffset)return!1;o=o.buffer,c=c.buffer;case Lo:return!(o.byteLength!=c.byteLength||!y(new eu(o),new eu(c)));case ko:case Do:case xo:return vn(+o,+c);case Bc:return o.name==c.name&&o.message==c.message;case No:case Vo:return o==c+"";case gn:var w=nd;case mn:var T=d&L;if(w||(w=jc),o.size!=c.size&&!T)return!1;var C=v.get(o);if(C)return C==c;d|=M,v.set(o,c);var k=ly(w(o),w(c),d,g,y,v);return v.delete(o),k;case $c:if($o)return $o.call(o)==$o.call(c)}return!1}function VP(o,c,u,d,g,y){var v=u&L,w=bd(o),T=w.length,C=bd(c),k=C.length;if(T!=k&&!v)return!1;for(var x=T;x--;){var U=w[x];if(!(v?U in c:Ee.call(c,U)))return!1}var G=y.get(o),J=y.get(c);if(G&&J)return G==c&&J==o;var se=!0;y.set(o,c),y.set(c,o);for(var X=v;++x<T;){U=w[x];var ce=o[U],fe=c[U];if(d)var Jt=v?d(fe,ce,U,c,o,y):d(ce,fe,U,o,c,y);if(!(Jt===t?ce===fe||g(ce,fe,u,d,y):Jt)){se=!1;break}X||(X=U=="constructor")}if(se&&!X){var kt=o.constructor,Xt=c.constructor;kt!=Xt&&"constructor"in o&&"constructor"in c&&!(typeof kt=="function"&&kt instanceof kt&&typeof Xt=="function"&&Xt instanceof Xt)&&(se=!1)}return y.delete(o),y.delete(c),se}function tr(o){return Od(my(o,t,Ry),o+"")}function bd(o){return k_(o,st,Dd)}function Pd(o){return k_(o,Bt,hy)}var Cd=ou?function(o){return ou.get(o)}:jd;function Iu(o){for(var c=o.name+"",u=_s[c],d=Ee.call(_s,c)?u.length:0;d--;){var g=u[d],y=g.func;if(y==null||y==o)return g.name}return c}function ws(o){var c=Ee.call(_,"placeholder")?_:o;return c.placeholder}function Q(){var o=_.iteratee||Kd;return o=o===Kd?N_:o,arguments.length?o(arguments[0],arguments[1]):o}function wu(o,c){var u=o.__data__;return $P(c)?u[typeof c=="string"?"string":"hash"]:u.map}function kd(o){for(var c=st(o),u=c.length;u--;){var d=c[u],g=o[d];c[u]=[d,g,py(g)]}return c}function _i(o,c){var u=zS(o,c);return x_(u)?u:t}function OP(o){var c=Ee.call(o,di),u=o[di];try{o[di]=t;var d=!0}catch{}var g=Xc.call(o);return d&&(c?o[di]=u:delete o[di]),g}var Dd=id?function(o){return o==null?[]:(o=be(o),Er(id(o),function(c){return __.call(o,c)}))}:Qd,hy=id?function(o){for(var c=[];o;)Tr(c,Dd(o)),o=tu(o);return c}:Qd,Tt=Pt;(sd&&Tt(new sd(new ArrayBuffer(1)))!=us||Uo&&Tt(new Uo)!=gn||od&&Tt(od.resolve())!=bm||ms&&Tt(new ms)!=mn||Bo&&Tt(new Bo)!=Oo)&&(Tt=function(o){var c=Pt(o),u=c==Yn?o.constructor:t,d=u?yi(u):"";if(d)switch(d){case _b:return us;case yb:return gn;case vb:return bm;case Ib:return mn;case wb:return Oo}return c});function LP(o,c,u){for(var d=-1,g=u.length;++d<g;){var y=u[d],v=y.size;switch(y.type){case"drop":o+=v;break;case"dropRight":c-=v;break;case"take":c=Et(c,o+v);break;case"takeRight":o=rt(o,c-v);break}}return{start:o,end:c}}function MP(o){var c=o.match(WR);return c?c[1].split(GR):[]}function dy(o,c,u){c=Pr(c,o);for(var d=-1,g=c.length,y=!1;++d<g;){var v=Pn(c[d]);if(!(y=o!=null&&u(o,v)))break;o=o[v]}return y||++d!=g?y:(g=o==null?0:o.length,!!g&&Pu(g)&&nr(v,g)&&(te(o)||vi(o)))}function FP(o){var c=o.length,u=new o.constructor(c);return c&&typeof o[0]=="string"&&Ee.call(o,"index")&&(u.index=o.index,u.input=o.input),u}function fy(o){return typeof o.constructor=="function"&&!Qo(o)?ys(tu(o)):{}}function UP(o,c,u){var d=o.constructor;switch(c){case Lo:return Ad(o);case ko:case Do:return new d(+o);case us:return EP(o,u);case kh:case Dh:case xh:case Nh:case Vh:case Oh:case Lh:case Mh:case Fh:return Q_(o,u);case gn:return new d;case xo:case Vo:return new d(o);case No:return TP(o);case mn:return new d;case $c:return AP(o)}}function BP(o,c){var u=c.length;if(!u)return o;var d=u-1;return c[d]=(u>1?"& ":"")+c[d],c=c.join(u>2?", ":" "),o.replace($R,`{
/* [wrapped with `+c+`] */
`)}function qP(o){return te(o)||vi(o)||!!(y_&&o&&o[y_])}function nr(o,c){var u=typeof o;return c=c??wr,!!c&&(u=="number"||u!="symbol"&&ZR.test(o))&&o>-1&&o%1==0&&o<c}function Ct(o,c,u){if(!Be(u))return!1;var d=typeof c;return(d=="number"?Ut(u)&&nr(c,u.length):d=="string"&&c in u)?vn(u[c],o):!1}function xd(o,c){if(te(o))return!1;var u=typeof o;return u=="number"||u=="symbol"||u=="boolean"||o==null||Yt(o)?!0:FR.test(o)||!MR.test(o)||c!=null&&o in be(c)}function $P(o){var c=typeof o;return c=="string"||c=="number"||c=="symbol"||c=="boolean"?o!=="__proto__":o===null}function Nd(o){var c=Iu(o),u=_[c];if(typeof u!="function"||!(c in le.prototype))return!1;if(o===u)return!0;var d=Cd(u);return!!d&&o===d[0]}function WP(o){return!!p_&&p_ in o}var GP=Yc?rr:Yd;function Qo(o){var c=o&&o.constructor,u=typeof c=="function"&&c.prototype||gs;return o===u}function py(o){return o===o&&!Be(o)}function gy(o,c){return function(u){return u==null?!1:u[o]===c&&(c!==t||o in be(u))}}function zP(o){var c=Su(o,function(d){return u.size===f&&u.clear(),d}),u=c.cache;return c}function KP(o,c){var u=o[1],d=c[1],g=u|d,y=g<(V|Y|we),v=d==we&&u==j||d==we&&u==Mt&&o[7].length<=c[8]||d==(we|Mt)&&c[7].length<=c[8]&&u==j;if(!(y||v))return o;d&V&&(o[2]=c[2],g|=u&V?0:ae);var w=c[3];if(w){var T=o[3];o[3]=T?J_(T,w,c[4]):w,o[4]=T?Ar(o[3],p):c[4]}return w=c[5],w&&(T=o[5],o[5]=T?X_(T,w,c[6]):w,o[6]=T?Ar(o[5],p):c[6]),w=c[7],w&&(o[7]=w),d&we&&(o[8]=o[8]==null?c[8]:Et(o[8],c[8])),o[9]==null&&(o[9]=c[9]),o[0]=c[0],o[1]=g,o}function HP(o){var c=[];if(o!=null)for(var u in be(o))c.push(u);return c}function jP(o){return Xc.call(o)}function my(o,c,u){return c=rt(c===t?o.length-1:c,0),function(){for(var d=arguments,g=-1,y=rt(d.length-c,0),v=S(y);++g<y;)v[g]=d[c+g];g=-1;for(var w=S(c+1);++g<c;)w[g]=d[g];return w[c]=u(v),Ht(o,this,w)}}function _y(o,c){return c.length<2?o:mi(o,un(c,0,-1))}function QP(o,c){for(var u=o.length,d=Et(c.length,u),g=Ft(o);d--;){var y=c[d];o[d]=nr(y,u)?g[y]:t}return o}function Vd(o,c){if(!(c==="constructor"&&typeof o[c]=="function")&&c!="__proto__")return o[c]}var yy=Iy(q_),Yo=lb||function(o,c){return ft.setTimeout(o,c)},Od=Iy(yP);function vy(o,c,u){var d=c+"";return Od(o,BP(d,YP(MP(d),u)))}function Iy(o){var c=0,u=0;return function(){var d=pb(),g=_R-(d-u);if(u=d,g>0){if(++c>=mR)return arguments[0]}else c=0;return o.apply(t,arguments)}}function Eu(o,c){var u=-1,d=o.length,g=d-1;for(c=c===t?d:c;++u<c;){var y=_d(u,g),v=o[y];o[y]=o[u],o[u]=v}return o.length=c,o}var wy=zP(function(o){var c=[];return o.charCodeAt(0)===46&&c.push(""),o.replace(UR,function(u,d,g,y){c.push(g?y.replace(HR,"$1"):d||u)}),c});function Pn(o){if(typeof o=="string"||Yt(o))return o;var c=o+"";return c=="0"&&1/o==-li?"-0":c}function yi(o){if(o!=null){try{return Jc.call(o)}catch{}try{return o+""}catch{}}return""}function YP(o,c){return sn(TR,function(u){var d="_."+u[0];c&u[1]&&!Kc(o,d)&&o.push(d)}),o.sort()}function Ey(o){if(o instanceof le)return o.clone();var c=new an(o.__wrapped__,o.__chain__);return c.__actions__=Ft(o.__actions__),c.__index__=o.__index__,c.__values__=o.__values__,c}function JP(o,c,u){(u?Ct(o,c,u):c===t)?c=1:c=rt(ie(c),0);var d=o==null?0:o.length;if(!d||c<1)return[];for(var g=0,y=0,v=S(iu(d/c));g<d;)v[y++]=un(o,g,g+=c);return v}function XP(o){for(var c=-1,u=o==null?0:o.length,d=0,g=[];++c<u;){var y=o[c];y&&(g[d++]=y)}return g}function ZP(){var o=arguments.length;if(!o)return[];for(var c=S(o-1),u=arguments[0],d=o;d--;)c[d-1]=arguments[d];return Tr(te(u)?Ft(u):[u],pt(c,1))}var eC=oe(function(o,c){return Ye(o)?Go(o,pt(c,1,Ye,!0)):[]}),tC=oe(function(o,c){var u=ln(c);return Ye(u)&&(u=t),Ye(o)?Go(o,pt(c,1,Ye,!0),Q(u,2)):[]}),nC=oe(function(o,c){var u=ln(c);return Ye(u)&&(u=t),Ye(o)?Go(o,pt(c,1,Ye,!0),t,u):[]});function rC(o,c,u){var d=o==null?0:o.length;return d?(c=u||c===t?1:ie(c),un(o,c<0?0:c,d)):[]}function iC(o,c,u){var d=o==null?0:o.length;return d?(c=u||c===t?1:ie(c),c=d-c,un(o,0,c<0?0:c)):[]}function sC(o,c){return o&&o.length?pu(o,Q(c,3),!0,!0):[]}function oC(o,c){return o&&o.length?pu(o,Q(c,3),!0):[]}function aC(o,c,u,d){var g=o==null?0:o.length;return g?(u&&typeof u!="number"&&Ct(o,c,u)&&(u=0,d=g),Zb(o,c,u,d)):[]}function Ty(o,c,u){var d=o==null?0:o.length;if(!d)return-1;var g=u==null?0:ie(u);return g<0&&(g=rt(d+g,0)),Hc(o,Q(c,3),g)}function Ay(o,c,u){var d=o==null?0:o.length;if(!d)return-1;var g=d-1;return u!==t&&(g=ie(u),g=u<0?rt(d+g,0):Et(g,d-1)),Hc(o,Q(c,3),g,!0)}function Ry(o){var c=o==null?0:o.length;return c?pt(o,1):[]}function cC(o){var c=o==null?0:o.length;return c?pt(o,li):[]}function uC(o,c){var u=o==null?0:o.length;return u?(c=c===t?1:ie(c),pt(o,c)):[]}function lC(o){for(var c=-1,u=o==null?0:o.length,d={};++c<u;){var g=o[c];d[g[0]]=g[1]}return d}function Sy(o){return o&&o.length?o[0]:t}function hC(o,c,u){var d=o==null?0:o.length;if(!d)return-1;var g=u==null?0:ie(u);return g<0&&(g=rt(d+g,0)),hs(o,c,g)}function dC(o){var c=o==null?0:o.length;return c?un(o,0,-1):[]}var fC=oe(function(o){var c=Ve(o,Ed);return c.length&&c[0]===o[0]?dd(c):[]}),pC=oe(function(o){var c=ln(o),u=Ve(o,Ed);return c===ln(u)?c=t:u.pop(),u.length&&u[0]===o[0]?dd(u,Q(c,2)):[]}),gC=oe(function(o){var c=ln(o),u=Ve(o,Ed);return c=typeof c=="function"?c:t,c&&u.pop(),u.length&&u[0]===o[0]?dd(u,t,c):[]});function mC(o,c){return o==null?"":db.call(o,c)}function ln(o){var c=o==null?0:o.length;return c?o[c-1]:t}function _C(o,c,u){var d=o==null?0:o.length;if(!d)return-1;var g=d;return u!==t&&(g=ie(u),g=g<0?rt(d+g,0):Et(g,d-1)),c===c?YS(o,c,g):Hc(o,o_,g,!0)}function yC(o,c){return o&&o.length?M_(o,ie(c)):t}var vC=oe(by);function by(o,c){return o&&o.length&&c&&c.length?md(o,c):o}function IC(o,c,u){return o&&o.length&&c&&c.length?md(o,c,Q(u,2)):o}function wC(o,c,u){return o&&o.length&&c&&c.length?md(o,c,t,u):o}var EC=tr(function(o,c){var u=o==null?0:o.length,d=cd(o,c);return B_(o,Ve(c,function(g){return nr(g,u)?+g:g}).sort(Y_)),d});function TC(o,c){var u=[];if(!(o&&o.length))return u;var d=-1,g=[],y=o.length;for(c=Q(c,3);++d<y;){var v=o[d];c(v,d,o)&&(u.push(v),g.push(d))}return B_(o,g),u}function Ld(o){return o==null?o:mb.call(o)}function AC(o,c,u){var d=o==null?0:o.length;return d?(u&&typeof u!="number"&&Ct(o,c,u)?(c=0,u=d):(c=c==null?0:ie(c),u=u===t?d:ie(u)),un(o,c,u)):[]}function RC(o,c){return fu(o,c)}function SC(o,c,u){return vd(o,c,Q(u,2))}function bC(o,c){var u=o==null?0:o.length;if(u){var d=fu(o,c);if(d<u&&vn(o[d],c))return d}return-1}function PC(o,c){return fu(o,c,!0)}function CC(o,c,u){return vd(o,c,Q(u,2),!0)}function kC(o,c){var u=o==null?0:o.length;if(u){var d=fu(o,c,!0)-1;if(vn(o[d],c))return d}return-1}function DC(o){return o&&o.length?$_(o):[]}function xC(o,c){return o&&o.length?$_(o,Q(c,2)):[]}function NC(o){var c=o==null?0:o.length;return c?un(o,1,c):[]}function VC(o,c,u){return o&&o.length?(c=u||c===t?1:ie(c),un(o,0,c<0?0:c)):[]}function OC(o,c,u){var d=o==null?0:o.length;return d?(c=u||c===t?1:ie(c),c=d-c,un(o,c<0?0:c,d)):[]}function LC(o,c){return o&&o.length?pu(o,Q(c,3),!1,!0):[]}function MC(o,c){return o&&o.length?pu(o,Q(c,3)):[]}var FC=oe(function(o){return br(pt(o,1,Ye,!0))}),UC=oe(function(o){var c=ln(o);return Ye(c)&&(c=t),br(pt(o,1,Ye,!0),Q(c,2))}),BC=oe(function(o){var c=ln(o);return c=typeof c=="function"?c:t,br(pt(o,1,Ye,!0),t,c)});function qC(o){return o&&o.length?br(o):[]}function $C(o,c){return o&&o.length?br(o,Q(c,2)):[]}function WC(o,c){return c=typeof c=="function"?c:t,o&&o.length?br(o,t,c):[]}function Md(o){if(!(o&&o.length))return[];var c=0;return o=Er(o,function(u){if(Ye(u))return c=rt(u.length,c),!0}),ed(c,function(u){return Ve(o,Jh(u))})}function Py(o,c){if(!(o&&o.length))return[];var u=Md(o);return c==null?u:Ve(u,function(d){return Ht(c,t,d)})}var GC=oe(function(o,c){return Ye(o)?Go(o,c):[]}),zC=oe(function(o){return wd(Er(o,Ye))}),KC=oe(function(o){var c=ln(o);return Ye(c)&&(c=t),wd(Er(o,Ye),Q(c,2))}),HC=oe(function(o){var c=ln(o);return c=typeof c=="function"?c:t,wd(Er(o,Ye),t,c)}),jC=oe(Md);function QC(o,c){return K_(o||[],c||[],Wo)}function YC(o,c){return K_(o||[],c||[],Ho)}var JC=oe(function(o){var c=o.length,u=c>1?o[c-1]:t;return u=typeof u=="function"?(o.pop(),u):t,Py(o,u)});function Cy(o){var c=_(o);return c.__chain__=!0,c}function XC(o,c){return c(o),o}function Tu(o,c){return c(o)}var ZC=tr(function(o){var c=o.length,u=c?o[0]:0,d=this.__wrapped__,g=function(y){return cd(y,o)};return c>1||this.__actions__.length||!(d instanceof le)||!nr(u)?this.thru(g):(d=d.slice(u,+u+(c?1:0)),d.__actions__.push({func:Tu,args:[g],thisArg:t}),new an(d,this.__chain__).thru(function(y){return c&&!y.length&&y.push(t),y}))});function e1(){return Cy(this)}function t1(){return new an(this.value(),this.__chain__)}function n1(){this.__values__===t&&(this.__values__=Wy(this.value()));var o=this.__index__>=this.__values__.length,c=o?t:this.__values__[this.__index__++];return{done:o,value:c}}function r1(){return this}function i1(o){for(var c,u=this;u instanceof cu;){var d=Ey(u);d.__index__=0,d.__values__=t,c?g.__wrapped__=d:c=d;var g=d;u=u.__wrapped__}return g.__wrapped__=o,c}function s1(){var o=this.__wrapped__;if(o instanceof le){var c=o;return this.__actions__.length&&(c=new le(this)),c=c.reverse(),c.__actions__.push({func:Tu,args:[Ld],thisArg:t}),new an(c,this.__chain__)}return this.thru(Ld)}function o1(){return z_(this.__wrapped__,this.__actions__)}var a1=gu(function(o,c,u){Ee.call(o,u)?++o[u]:Zn(o,u,1)});function c1(o,c,u){var d=te(o)?i_:Xb;return u&&Ct(o,c,u)&&(c=t),d(o,Q(c,3))}function u1(o,c){var u=te(o)?Er:P_;return u(o,Q(c,3))}var l1=ny(Ty),h1=ny(Ay);function d1(o,c){return pt(Au(o,c),1)}function f1(o,c){return pt(Au(o,c),li)}function p1(o,c,u){return u=u===t?1:ie(u),pt(Au(o,c),u)}function ky(o,c){var u=te(o)?sn:Sr;return u(o,Q(c,3))}function Dy(o,c){var u=te(o)?NS:b_;return u(o,Q(c,3))}var g1=gu(function(o,c,u){Ee.call(o,u)?o[u].push(c):Zn(o,u,[c])});function m1(o,c,u,d){o=Ut(o)?o:Ts(o),u=u&&!d?ie(u):0;var g=o.length;return u<0&&(u=rt(g+u,0)),Cu(o)?u<=g&&o.indexOf(c,u)>-1:!!g&&hs(o,c,u)>-1}var _1=oe(function(o,c,u){var d=-1,g=typeof c=="function",y=Ut(o)?S(o.length):[];return Sr(o,function(v){y[++d]=g?Ht(c,v,u):zo(v,c,u)}),y}),y1=gu(function(o,c,u){Zn(o,u,c)});function Au(o,c){var u=te(o)?Ve:V_;return u(o,Q(c,3))}function v1(o,c,u,d){return o==null?[]:(te(c)||(c=c==null?[]:[c]),u=d?t:u,te(u)||(u=u==null?[]:[u]),F_(o,c,u))}var I1=gu(function(o,c,u){o[u?0:1].push(c)},function(){return[[],[]]});function w1(o,c,u){var d=te(o)?Qh:c_,g=arguments.length<3;return d(o,Q(c,4),u,g,Sr)}function E1(o,c,u){var d=te(o)?VS:c_,g=arguments.length<3;return d(o,Q(c,4),u,g,b_)}function T1(o,c){var u=te(o)?Er:P_;return u(o,bu(Q(c,3)))}function A1(o){var c=te(o)?T_:mP;return c(o)}function R1(o,c,u){(u?Ct(o,c,u):c===t)?c=1:c=ie(c);var d=te(o)?Hb:_P;return d(o,c)}function S1(o){var c=te(o)?jb:vP;return c(o)}function b1(o){if(o==null)return 0;if(Ut(o))return Cu(o)?fs(o):o.length;var c=Tt(o);return c==gn||c==mn?o.size:pd(o).length}function P1(o,c,u){var d=te(o)?Yh:IP;return u&&Ct(o,c,u)&&(c=t),d(o,Q(c,3))}var C1=oe(function(o,c){if(o==null)return[];var u=c.length;return u>1&&Ct(o,c[0],c[1])?c=[]:u>2&&Ct(c[0],c[1],c[2])&&(c=[c[0]]),F_(o,pt(c,1),[])}),Ru=ub||function(){return ft.Date.now()};function k1(o,c){if(typeof c!="function")throw new on(a);return o=ie(o),function(){if(--o<1)return c.apply(this,arguments)}}function xy(o,c,u){return c=u?t:c,c=o&&c==null?o.length:c,er(o,we,t,t,t,t,c)}function Ny(o,c){var u;if(typeof c!="function")throw new on(a);return o=ie(o),function(){return--o>0&&(u=c.apply(this,arguments)),o<=1&&(c=t),u}}var Fd=oe(function(o,c,u){var d=V;if(u.length){var g=Ar(u,ws(Fd));d|=de}return er(o,d,c,u,g)}),Vy=oe(function(o,c,u){var d=V|Y;if(u.length){var g=Ar(u,ws(Vy));d|=de}return er(c,d,o,u,g)});function Oy(o,c,u){c=u?t:c;var d=er(o,j,t,t,t,t,t,c);return d.placeholder=Oy.placeholder,d}function Ly(o,c,u){c=u?t:c;var d=er(o,ye,t,t,t,t,t,c);return d.placeholder=Ly.placeholder,d}function My(o,c,u){var d,g,y,v,w,T,C=0,k=!1,x=!1,U=!0;if(typeof o!="function")throw new on(a);c=hn(c)||0,Be(u)&&(k=!!u.leading,x="maxWait"in u,y=x?rt(hn(u.maxWait)||0,c):y,U="trailing"in u?!!u.trailing:U);function G(Je){var In=d,sr=g;return d=g=t,C=Je,v=o.apply(sr,In),v}function J(Je){return C=Je,w=Yo(ce,c),k?G(Je):v}function se(Je){var In=Je-T,sr=Je-C,nv=c-In;return x?Et(nv,y-sr):nv}function X(Je){var In=Je-T,sr=Je-C;return T===t||In>=c||In<0||x&&sr>=y}function ce(){var Je=Ru();if(X(Je))return fe(Je);w=Yo(ce,se(Je))}function fe(Je){return w=t,U&&d?G(Je):(d=g=t,v)}function Jt(){w!==t&&H_(w),C=0,d=T=g=w=t}function kt(){return w===t?v:fe(Ru())}function Xt(){var Je=Ru(),In=X(Je);if(d=arguments,g=this,T=Je,In){if(w===t)return J(T);if(x)return H_(w),w=Yo(ce,c),G(T)}return w===t&&(w=Yo(ce,c)),v}return Xt.cancel=Jt,Xt.flush=kt,Xt}var D1=oe(function(o,c){return S_(o,1,c)}),x1=oe(function(o,c,u){return S_(o,hn(c)||0,u)});function N1(o){return er(o,Qn)}function Su(o,c){if(typeof o!="function"||c!=null&&typeof c!="function")throw new on(a);var u=function(){var d=arguments,g=c?c.apply(this,d):d[0],y=u.cache;if(y.has(g))return y.get(g);var v=o.apply(this,d);return u.cache=y.set(g,v)||y,v};return u.cache=new(Su.Cache||Xn),u}Su.Cache=Xn;function bu(o){if(typeof o!="function")throw new on(a);return function(){var c=arguments;switch(c.length){case 0:return!o.call(this);case 1:return!o.call(this,c[0]);case 2:return!o.call(this,c[0],c[1]);case 3:return!o.call(this,c[0],c[1],c[2])}return!o.apply(this,c)}}function V1(o){return Ny(2,o)}var O1=wP(function(o,c){c=c.length==1&&te(c[0])?Ve(c[0],jt(Q())):Ve(pt(c,1),jt(Q()));var u=c.length;return oe(function(d){for(var g=-1,y=Et(d.length,u);++g<y;)d[g]=c[g].call(this,d[g]);return Ht(o,this,d)})}),Ud=oe(function(o,c){var u=Ar(c,ws(Ud));return er(o,de,t,c,u)}),Fy=oe(function(o,c){var u=Ar(c,ws(Fy));return er(o,me,t,c,u)}),L1=tr(function(o,c){return er(o,Mt,t,t,t,c)});function M1(o,c){if(typeof o!="function")throw new on(a);return c=c===t?c:ie(c),oe(o,c)}function F1(o,c){if(typeof o!="function")throw new on(a);return c=c==null?0:rt(ie(c),0),oe(function(u){var d=u[c],g=Cr(u,0,c);return d&&Tr(g,d),Ht(o,this,g)})}function U1(o,c,u){var d=!0,g=!0;if(typeof o!="function")throw new on(a);return Be(u)&&(d="leading"in u?!!u.leading:d,g="trailing"in u?!!u.trailing:g),My(o,c,{leading:d,maxWait:c,trailing:g})}function B1(o){return xy(o,1)}function q1(o,c){return Ud(Td(c),o)}function $1(){if(!arguments.length)return[];var o=arguments[0];return te(o)?o:[o]}function W1(o){return cn(o,A)}function G1(o,c){return c=typeof c=="function"?c:t,cn(o,A,c)}function z1(o){return cn(o,m|A)}function K1(o,c){return c=typeof c=="function"?c:t,cn(o,m|A,c)}function H1(o,c){return c==null||R_(o,c,st(c))}function vn(o,c){return o===c||o!==o&&c!==c}var j1=vu(hd),Q1=vu(function(o,c){return o>=c}),vi=D_(function(){return arguments}())?D_:function(o){return $e(o)&&Ee.call(o,"callee")&&!__.call(o,"callee")},te=S.isArray,Y1=Xm?jt(Xm):iP;function Ut(o){return o!=null&&Pu(o.length)&&!rr(o)}function Ye(o){return $e(o)&&Ut(o)}function J1(o){return o===!0||o===!1||$e(o)&&Pt(o)==ko}var kr=hb||Yd,X1=Zm?jt(Zm):sP;function Z1(o){return $e(o)&&o.nodeType===1&&!Jo(o)}function ek(o){if(o==null)return!0;if(Ut(o)&&(te(o)||typeof o=="string"||typeof o.splice=="function"||kr(o)||Es(o)||vi(o)))return!o.length;var c=Tt(o);if(c==gn||c==mn)return!o.size;if(Qo(o))return!pd(o).length;for(var u in o)if(Ee.call(o,u))return!1;return!0}function tk(o,c){return Ko(o,c)}function nk(o,c,u){u=typeof u=="function"?u:t;var d=u?u(o,c):t;return d===t?Ko(o,c,t,u):!!d}function Bd(o){if(!$e(o))return!1;var c=Pt(o);return c==Bc||c==RR||typeof o.message=="string"&&typeof o.name=="string"&&!Jo(o)}function rk(o){return typeof o=="number"&&v_(o)}function rr(o){if(!Be(o))return!1;var c=Pt(o);return c==qc||c==Sm||c==AR||c==bR}function Uy(o){return typeof o=="number"&&o==ie(o)}function Pu(o){return typeof o=="number"&&o>-1&&o%1==0&&o<=wr}function Be(o){var c=typeof o;return o!=null&&(c=="object"||c=="function")}function $e(o){return o!=null&&typeof o=="object"}var By=e_?jt(e_):aP;function ik(o,c){return o===c||fd(o,c,kd(c))}function sk(o,c,u){return u=typeof u=="function"?u:t,fd(o,c,kd(c),u)}function ok(o){return qy(o)&&o!=+o}function ak(o){if(GP(o))throw new ee(s);return x_(o)}function ck(o){return o===null}function uk(o){return o==null}function qy(o){return typeof o=="number"||$e(o)&&Pt(o)==xo}function Jo(o){if(!$e(o)||Pt(o)!=Yn)return!1;var c=tu(o);if(c===null)return!0;var u=Ee.call(c,"constructor")&&c.constructor;return typeof u=="function"&&u instanceof u&&Jc.call(u)==sb}var qd=t_?jt(t_):cP;function lk(o){return Uy(o)&&o>=-wr&&o<=wr}var $y=n_?jt(n_):uP;function Cu(o){return typeof o=="string"||!te(o)&&$e(o)&&Pt(o)==Vo}function Yt(o){return typeof o=="symbol"||$e(o)&&Pt(o)==$c}var Es=r_?jt(r_):lP;function hk(o){return o===t}function dk(o){return $e(o)&&Tt(o)==Oo}function fk(o){return $e(o)&&Pt(o)==CR}var pk=vu(gd),gk=vu(function(o,c){return o<=c});function Wy(o){if(!o)return[];if(Ut(o))return Cu(o)?_n(o):Ft(o);if(Fo&&o[Fo])return HS(o[Fo]());var c=Tt(o),u=c==gn?nd:c==mn?jc:Ts;return u(o)}function ir(o){if(!o)return o===0?o:0;if(o=hn(o),o===li||o===-li){var c=o<0?-1:1;return c*IR}return o===o?o:0}function ie(o){var c=ir(o),u=c%1;return c===c?u?c-u:c:0}function Gy(o){return o?gi(ie(o),0,Rn):0}function hn(o){if(typeof o=="number")return o;if(Yt(o))return Fc;if(Be(o)){var c=typeof o.valueOf=="function"?o.valueOf():o;o=Be(c)?c+"":c}if(typeof o!="string")return o===0?o:+o;o=u_(o);var u=YR.test(o);return u||XR.test(o)?kS(o.slice(2),u?2:8):QR.test(o)?Fc:+o}function zy(o){return bn(o,Bt(o))}function mk(o){return o?gi(ie(o),-wr,wr):o===0?o:0}function Ie(o){return o==null?"":Qt(o)}var _k=vs(function(o,c){if(Qo(c)||Ut(c)){bn(c,st(c),o);return}for(var u in c)Ee.call(c,u)&&Wo(o,u,c[u])}),Ky=vs(function(o,c){bn(c,Bt(c),o)}),ku=vs(function(o,c,u,d){bn(c,Bt(c),o,d)}),yk=vs(function(o,c,u,d){bn(c,st(c),o,d)}),vk=tr(cd);function Ik(o,c){var u=ys(o);return c==null?u:A_(u,c)}var wk=oe(function(o,c){o=be(o);var u=-1,d=c.length,g=d>2?c[2]:t;for(g&&Ct(c[0],c[1],g)&&(d=1);++u<d;)for(var y=c[u],v=Bt(y),w=-1,T=v.length;++w<T;){var C=v[w],k=o[C];(k===t||vn(k,gs[C])&&!Ee.call(o,C))&&(o[C]=y[C])}return o}),Ek=oe(function(o){return o.push(t,uy),Ht(Hy,t,o)});function Tk(o,c){return s_(o,Q(c,3),Sn)}function Ak(o,c){return s_(o,Q(c,3),ld)}function Rk(o,c){return o==null?o:ud(o,Q(c,3),Bt)}function Sk(o,c){return o==null?o:C_(o,Q(c,3),Bt)}function bk(o,c){return o&&Sn(o,Q(c,3))}function Pk(o,c){return o&&ld(o,Q(c,3))}function Ck(o){return o==null?[]:hu(o,st(o))}function kk(o){return o==null?[]:hu(o,Bt(o))}function $d(o,c,u){var d=o==null?t:mi(o,c);return d===t?u:d}function Dk(o,c){return o!=null&&dy(o,c,eP)}function Wd(o,c){return o!=null&&dy(o,c,tP)}var xk=iy(function(o,c,u){c!=null&&typeof c.toString!="function"&&(c=Xc.call(c)),o[c]=u},zd(qt)),Nk=iy(function(o,c,u){c!=null&&typeof c.toString!="function"&&(c=Xc.call(c)),Ee.call(o,c)?o[c].push(u):o[c]=[u]},Q),Vk=oe(zo);function st(o){return Ut(o)?E_(o):pd(o)}function Bt(o){return Ut(o)?E_(o,!0):hP(o)}function Ok(o,c){var u={};return c=Q(c,3),Sn(o,function(d,g,y){Zn(u,c(d,g,y),d)}),u}function Lk(o,c){var u={};return c=Q(c,3),Sn(o,function(d,g,y){Zn(u,g,c(d,g,y))}),u}var Mk=vs(function(o,c,u){du(o,c,u)}),Hy=vs(function(o,c,u,d){du(o,c,u,d)}),Fk=tr(function(o,c){var u={};if(o==null)return u;var d=!1;c=Ve(c,function(y){return y=Pr(y,o),d||(d=y.length>1),y}),bn(o,Pd(o),u),d&&(u=cn(u,m|I|A,xP));for(var g=c.length;g--;)Id(u,c[g]);return u});function Uk(o,c){return jy(o,bu(Q(c)))}var Bk=tr(function(o,c){return o==null?{}:fP(o,c)});function jy(o,c){if(o==null)return{};var u=Ve(Pd(o),function(d){return[d]});return c=Q(c),U_(o,u,function(d,g){return c(d,g[0])})}function qk(o,c,u){c=Pr(c,o);var d=-1,g=c.length;for(g||(g=1,o=t);++d<g;){var y=o==null?t:o[Pn(c[d])];y===t&&(d=g,y=u),o=rr(y)?y.call(o):y}return o}function $k(o,c,u){return o==null?o:Ho(o,c,u)}function Wk(o,c,u,d){return d=typeof d=="function"?d:t,o==null?o:Ho(o,c,u,d)}var Qy=ay(st),Yy=ay(Bt);function Gk(o,c,u){var d=te(o),g=d||kr(o)||Es(o);if(c=Q(c,4),u==null){var y=o&&o.constructor;g?u=d?new y:[]:Be(o)?u=rr(y)?ys(tu(o)):{}:u={}}return(g?sn:Sn)(o,function(v,w,T){return c(u,v,w,T)}),u}function zk(o,c){return o==null?!0:Id(o,c)}function Kk(o,c,u){return o==null?o:G_(o,c,Td(u))}function Hk(o,c,u,d){return d=typeof d=="function"?d:t,o==null?o:G_(o,c,Td(u),d)}function Ts(o){return o==null?[]:td(o,st(o))}function jk(o){return o==null?[]:td(o,Bt(o))}function Qk(o,c,u){return u===t&&(u=c,c=t),u!==t&&(u=hn(u),u=u===u?u:0),c!==t&&(c=hn(c),c=c===c?c:0),gi(hn(o),c,u)}function Yk(o,c,u){return c=ir(c),u===t?(u=c,c=0):u=ir(u),o=hn(o),nP(o,c,u)}function Jk(o,c,u){if(u&&typeof u!="boolean"&&Ct(o,c,u)&&(c=u=t),u===t&&(typeof c=="boolean"?(u=c,c=t):typeof o=="boolean"&&(u=o,o=t)),o===t&&c===t?(o=0,c=1):(o=ir(o),c===t?(c=o,o=0):c=ir(c)),o>c){var d=o;o=c,c=d}if(u||o%1||c%1){var g=I_();return Et(o+g*(c-o+CS("1e-"+((g+"").length-1))),c)}return _d(o,c)}var Xk=Is(function(o,c,u){return c=c.toLowerCase(),o+(u?Jy(c):c)});function Jy(o){return Gd(Ie(o).toLowerCase())}function Xy(o){return o=Ie(o),o&&o.replace(eS,$S).replace(vS,"")}function Zk(o,c,u){o=Ie(o),c=Qt(c);var d=o.length;u=u===t?d:gi(ie(u),0,d);var g=u;return u-=c.length,u>=0&&o.slice(u,g)==c}function eD(o){return o=Ie(o),o&&VR.test(o)?o.replace(Cm,WS):o}function tD(o){return o=Ie(o),o&&BR.test(o)?o.replace(Uh,"\\$&"):o}var nD=Is(function(o,c,u){return o+(u?"-":"")+c.toLowerCase()}),rD=Is(function(o,c,u){return o+(u?" ":"")+c.toLowerCase()}),iD=ty("toLowerCase");function sD(o,c,u){o=Ie(o),c=ie(c);var d=c?fs(o):0;if(!c||d>=c)return o;var g=(c-d)/2;return yu(su(g),u)+o+yu(iu(g),u)}function oD(o,c,u){o=Ie(o),c=ie(c);var d=c?fs(o):0;return c&&d<c?o+yu(c-d,u):o}function aD(o,c,u){o=Ie(o),c=ie(c);var d=c?fs(o):0;return c&&d<c?yu(c-d,u)+o:o}function cD(o,c,u){return u||c==null?c=0:c&&(c=+c),gb(Ie(o).replace(Bh,""),c||0)}function uD(o,c,u){return(u?Ct(o,c,u):c===t)?c=1:c=ie(c),yd(Ie(o),c)}function lD(){var o=arguments,c=Ie(o[0]);return o.length<3?c:c.replace(o[1],o[2])}var hD=Is(function(o,c,u){return o+(u?"_":"")+c.toLowerCase()});function dD(o,c,u){return u&&typeof u!="number"&&Ct(o,c,u)&&(c=u=t),u=u===t?Rn:u>>>0,u?(o=Ie(o),o&&(typeof c=="string"||c!=null&&!qd(c))&&(c=Qt(c),!c&&ds(o))?Cr(_n(o),0,u):o.split(c,u)):[]}var fD=Is(function(o,c,u){return o+(u?" ":"")+Gd(c)});function pD(o,c,u){return o=Ie(o),u=u==null?0:gi(ie(u),0,o.length),c=Qt(c),o.slice(u,u+c.length)==c}function gD(o,c,u){var d=_.templateSettings;u&&Ct(o,c,u)&&(c=t),o=Ie(o),c=ku({},c,d,cy);var g=ku({},c.imports,d.imports,cy),y=st(g),v=td(g,y),w,T,C=0,k=c.interpolate||Wc,x="__p += '",U=rd((c.escape||Wc).source+"|"+k.source+"|"+(k===km?jR:Wc).source+"|"+(c.evaluate||Wc).source+"|$","g"),G="//# sourceURL="+(Ee.call(c,"sourceURL")?(c.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++AS+"]")+`
`;o.replace(U,function(X,ce,fe,Jt,kt,Xt){return fe||(fe=Jt),x+=o.slice(C,Xt).replace(tS,GS),ce&&(w=!0,x+=`' +
__e(`+ce+`) +
'`),kt&&(T=!0,x+=`';
`+kt+`;
__p += '`),fe&&(x+=`' +
((__t = (`+fe+`)) == null ? '' : __t) +
'`),C=Xt+X.length,X}),x+=`';
`;var J=Ee.call(c,"variable")&&c.variable;if(!J)x=`with (obj) {
`+x+`
}
`;else if(KR.test(J))throw new ee(l);x=(T?x.replace(kR,""):x).replace(DR,"$1").replace(xR,"$1;"),x="function("+(J||"obj")+`) {
`+(J?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(w?", __e = _.escape":"")+(T?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+x+`return __p
}`;var se=ev(function(){return ve(y,G+"return "+x).apply(t,v)});if(se.source=x,Bd(se))throw se;return se}function mD(o){return Ie(o).toLowerCase()}function _D(o){return Ie(o).toUpperCase()}function yD(o,c,u){if(o=Ie(o),o&&(u||c===t))return u_(o);if(!o||!(c=Qt(c)))return o;var d=_n(o),g=_n(c),y=l_(d,g),v=h_(d,g)+1;return Cr(d,y,v).join("")}function vD(o,c,u){if(o=Ie(o),o&&(u||c===t))return o.slice(0,f_(o)+1);if(!o||!(c=Qt(c)))return o;var d=_n(o),g=h_(d,_n(c))+1;return Cr(d,0,g).join("")}function ID(o,c,u){if(o=Ie(o),o&&(u||c===t))return o.replace(Bh,"");if(!o||!(c=Qt(c)))return o;var d=_n(o),g=l_(d,_n(c));return Cr(d,g).join("")}function wD(o,c){var u=as,d=gR;if(Be(c)){var g="separator"in c?c.separator:g;u="length"in c?ie(c.length):u,d="omission"in c?Qt(c.omission):d}o=Ie(o);var y=o.length;if(ds(o)){var v=_n(o);y=v.length}if(u>=y)return o;var w=u-fs(d);if(w<1)return d;var T=v?Cr(v,0,w).join(""):o.slice(0,w);if(g===t)return T+d;if(v&&(w+=T.length-w),qd(g)){if(o.slice(w).search(g)){var C,k=T;for(g.global||(g=rd(g.source,Ie(Dm.exec(g))+"g")),g.lastIndex=0;C=g.exec(k);)var x=C.index;T=T.slice(0,x===t?w:x)}}else if(o.indexOf(Qt(g),w)!=w){var U=T.lastIndexOf(g);U>-1&&(T=T.slice(0,U))}return T+d}function ED(o){return o=Ie(o),o&&NR.test(o)?o.replace(Pm,JS):o}var TD=Is(function(o,c,u){return o+(u?" ":"")+c.toUpperCase()}),Gd=ty("toUpperCase");function Zy(o,c,u){return o=Ie(o),c=u?t:c,c===t?KS(o)?eb(o):MS(o):o.match(c)||[]}var ev=oe(function(o,c){try{return Ht(o,t,c)}catch(u){return Bd(u)?u:new ee(u)}}),AD=tr(function(o,c){return sn(c,function(u){u=Pn(u),Zn(o,u,Fd(o[u],o))}),o});function RD(o){var c=o==null?0:o.length,u=Q();return o=c?Ve(o,function(d){if(typeof d[1]!="function")throw new on(a);return[u(d[0]),d[1]]}):[],oe(function(d){for(var g=-1;++g<c;){var y=o[g];if(Ht(y[0],this,d))return Ht(y[1],this,d)}})}function SD(o){return Jb(cn(o,m))}function zd(o){return function(){return o}}function bD(o,c){return o==null||o!==o?c:o}var PD=ry(),CD=ry(!0);function qt(o){return o}function Kd(o){return N_(typeof o=="function"?o:cn(o,m))}function kD(o){return O_(cn(o,m))}function DD(o,c){return L_(o,cn(c,m))}var xD=oe(function(o,c){return function(u){return zo(u,o,c)}}),ND=oe(function(o,c){return function(u){return zo(o,u,c)}});function Hd(o,c,u){var d=st(c),g=hu(c,d);u==null&&!(Be(c)&&(g.length||!d.length))&&(u=c,c=o,o=this,g=hu(c,st(c)));var y=!(Be(u)&&"chain"in u)||!!u.chain,v=rr(o);return sn(g,function(w){var T=c[w];o[w]=T,v&&(o.prototype[w]=function(){var C=this.__chain__;if(y||C){var k=o(this.__wrapped__),x=k.__actions__=Ft(this.__actions__);return x.push({func:T,args:arguments,thisArg:o}),k.__chain__=C,k}return T.apply(o,Tr([this.value()],arguments))})}),o}function VD(){return ft._===this&&(ft._=ob),this}function jd(){}function OD(o){return o=ie(o),oe(function(c){return M_(c,o)})}var LD=Rd(Ve),MD=Rd(i_),FD=Rd(Yh);function tv(o){return xd(o)?Jh(Pn(o)):pP(o)}function UD(o){return function(c){return o==null?t:mi(o,c)}}var BD=sy(),qD=sy(!0);function Qd(){return[]}function Yd(){return!1}function $D(){return{}}function WD(){return""}function GD(){return!0}function zD(o,c){if(o=ie(o),o<1||o>wr)return[];var u=Rn,d=Et(o,Rn);c=Q(c),o-=Rn;for(var g=ed(d,c);++u<o;)c(u);return g}function KD(o){return te(o)?Ve(o,Pn):Yt(o)?[o]:Ft(wy(Ie(o)))}function HD(o){var c=++ib;return Ie(o)+c}var jD=_u(function(o,c){return o+c},0),QD=Sd("ceil"),YD=_u(function(o,c){return o/c},1),JD=Sd("floor");function XD(o){return o&&o.length?lu(o,qt,hd):t}function ZD(o,c){return o&&o.length?lu(o,Q(c,2),hd):t}function ex(o){return a_(o,qt)}function tx(o,c){return a_(o,Q(c,2))}function nx(o){return o&&o.length?lu(o,qt,gd):t}function rx(o,c){return o&&o.length?lu(o,Q(c,2),gd):t}var ix=_u(function(o,c){return o*c},1),sx=Sd("round"),ox=_u(function(o,c){return o-c},0);function ax(o){return o&&o.length?Zh(o,qt):0}function cx(o,c){return o&&o.length?Zh(o,Q(c,2)):0}return _.after=k1,_.ary=xy,_.assign=_k,_.assignIn=Ky,_.assignInWith=ku,_.assignWith=yk,_.at=vk,_.before=Ny,_.bind=Fd,_.bindAll=AD,_.bindKey=Vy,_.castArray=$1,_.chain=Cy,_.chunk=JP,_.compact=XP,_.concat=ZP,_.cond=RD,_.conforms=SD,_.constant=zd,_.countBy=a1,_.create=Ik,_.curry=Oy,_.curryRight=Ly,_.debounce=My,_.defaults=wk,_.defaultsDeep=Ek,_.defer=D1,_.delay=x1,_.difference=eC,_.differenceBy=tC,_.differenceWith=nC,_.drop=rC,_.dropRight=iC,_.dropRightWhile=sC,_.dropWhile=oC,_.fill=aC,_.filter=u1,_.flatMap=d1,_.flatMapDeep=f1,_.flatMapDepth=p1,_.flatten=Ry,_.flattenDeep=cC,_.flattenDepth=uC,_.flip=N1,_.flow=PD,_.flowRight=CD,_.fromPairs=lC,_.functions=Ck,_.functionsIn=kk,_.groupBy=g1,_.initial=dC,_.intersection=fC,_.intersectionBy=pC,_.intersectionWith=gC,_.invert=xk,_.invertBy=Nk,_.invokeMap=_1,_.iteratee=Kd,_.keyBy=y1,_.keys=st,_.keysIn=Bt,_.map=Au,_.mapKeys=Ok,_.mapValues=Lk,_.matches=kD,_.matchesProperty=DD,_.memoize=Su,_.merge=Mk,_.mergeWith=Hy,_.method=xD,_.methodOf=ND,_.mixin=Hd,_.negate=bu,_.nthArg=OD,_.omit=Fk,_.omitBy=Uk,_.once=V1,_.orderBy=v1,_.over=LD,_.overArgs=O1,_.overEvery=MD,_.overSome=FD,_.partial=Ud,_.partialRight=Fy,_.partition=I1,_.pick=Bk,_.pickBy=jy,_.property=tv,_.propertyOf=UD,_.pull=vC,_.pullAll=by,_.pullAllBy=IC,_.pullAllWith=wC,_.pullAt=EC,_.range=BD,_.rangeRight=qD,_.rearg=L1,_.reject=T1,_.remove=TC,_.rest=M1,_.reverse=Ld,_.sampleSize=R1,_.set=$k,_.setWith=Wk,_.shuffle=S1,_.slice=AC,_.sortBy=C1,_.sortedUniq=DC,_.sortedUniqBy=xC,_.split=dD,_.spread=F1,_.tail=NC,_.take=VC,_.takeRight=OC,_.takeRightWhile=LC,_.takeWhile=MC,_.tap=XC,_.throttle=U1,_.thru=Tu,_.toArray=Wy,_.toPairs=Qy,_.toPairsIn=Yy,_.toPath=KD,_.toPlainObject=zy,_.transform=Gk,_.unary=B1,_.union=FC,_.unionBy=UC,_.unionWith=BC,_.uniq=qC,_.uniqBy=$C,_.uniqWith=WC,_.unset=zk,_.unzip=Md,_.unzipWith=Py,_.update=Kk,_.updateWith=Hk,_.values=Ts,_.valuesIn=jk,_.without=GC,_.words=Zy,_.wrap=q1,_.xor=zC,_.xorBy=KC,_.xorWith=HC,_.zip=jC,_.zipObject=QC,_.zipObjectDeep=YC,_.zipWith=JC,_.entries=Qy,_.entriesIn=Yy,_.extend=Ky,_.extendWith=ku,Hd(_,_),_.add=jD,_.attempt=ev,_.camelCase=Xk,_.capitalize=Jy,_.ceil=QD,_.clamp=Qk,_.clone=W1,_.cloneDeep=z1,_.cloneDeepWith=K1,_.cloneWith=G1,_.conformsTo=H1,_.deburr=Xy,_.defaultTo=bD,_.divide=YD,_.endsWith=Zk,_.eq=vn,_.escape=eD,_.escapeRegExp=tD,_.every=c1,_.find=l1,_.findIndex=Ty,_.findKey=Tk,_.findLast=h1,_.findLastIndex=Ay,_.findLastKey=Ak,_.floor=JD,_.forEach=ky,_.forEachRight=Dy,_.forIn=Rk,_.forInRight=Sk,_.forOwn=bk,_.forOwnRight=Pk,_.get=$d,_.gt=j1,_.gte=Q1,_.has=Dk,_.hasIn=Wd,_.head=Sy,_.identity=qt,_.includes=m1,_.indexOf=hC,_.inRange=Yk,_.invoke=Vk,_.isArguments=vi,_.isArray=te,_.isArrayBuffer=Y1,_.isArrayLike=Ut,_.isArrayLikeObject=Ye,_.isBoolean=J1,_.isBuffer=kr,_.isDate=X1,_.isElement=Z1,_.isEmpty=ek,_.isEqual=tk,_.isEqualWith=nk,_.isError=Bd,_.isFinite=rk,_.isFunction=rr,_.isInteger=Uy,_.isLength=Pu,_.isMap=By,_.isMatch=ik,_.isMatchWith=sk,_.isNaN=ok,_.isNative=ak,_.isNil=uk,_.isNull=ck,_.isNumber=qy,_.isObject=Be,_.isObjectLike=$e,_.isPlainObject=Jo,_.isRegExp=qd,_.isSafeInteger=lk,_.isSet=$y,_.isString=Cu,_.isSymbol=Yt,_.isTypedArray=Es,_.isUndefined=hk,_.isWeakMap=dk,_.isWeakSet=fk,_.join=mC,_.kebabCase=nD,_.last=ln,_.lastIndexOf=_C,_.lowerCase=rD,_.lowerFirst=iD,_.lt=pk,_.lte=gk,_.max=XD,_.maxBy=ZD,_.mean=ex,_.meanBy=tx,_.min=nx,_.minBy=rx,_.stubArray=Qd,_.stubFalse=Yd,_.stubObject=$D,_.stubString=WD,_.stubTrue=GD,_.multiply=ix,_.nth=yC,_.noConflict=VD,_.noop=jd,_.now=Ru,_.pad=sD,_.padEnd=oD,_.padStart=aD,_.parseInt=cD,_.random=Jk,_.reduce=w1,_.reduceRight=E1,_.repeat=uD,_.replace=lD,_.result=qk,_.round=sx,_.runInContext=E,_.sample=A1,_.size=b1,_.snakeCase=hD,_.some=P1,_.sortedIndex=RC,_.sortedIndexBy=SC,_.sortedIndexOf=bC,_.sortedLastIndex=PC,_.sortedLastIndexBy=CC,_.sortedLastIndexOf=kC,_.startCase=fD,_.startsWith=pD,_.subtract=ox,_.sum=ax,_.sumBy=cx,_.template=gD,_.times=zD,_.toFinite=ir,_.toInteger=ie,_.toLength=Gy,_.toLower=mD,_.toNumber=hn,_.toSafeInteger=mk,_.toString=Ie,_.toUpper=_D,_.trim=yD,_.trimEnd=vD,_.trimStart=ID,_.truncate=wD,_.unescape=ED,_.uniqueId=HD,_.upperCase=TD,_.upperFirst=Gd,_.each=ky,_.eachRight=Dy,_.first=Sy,Hd(_,function(){var o={};return Sn(_,function(c,u){Ee.call(_.prototype,u)||(o[u]=c)}),o}(),{chain:!1}),_.VERSION=r,sn(["bind","bindKey","curry","curryRight","partial","partialRight"],function(o){_[o].placeholder=_}),sn(["drop","take"],function(o,c){le.prototype[o]=function(u){u=u===t?1:rt(ie(u),0);var d=this.__filtered__&&!c?new le(this):this.clone();return d.__filtered__?d.__takeCount__=Et(u,d.__takeCount__):d.__views__.push({size:Et(u,Rn),type:o+(d.__dir__<0?"Right":"")}),d},le.prototype[o+"Right"]=function(u){return this.reverse()[o](u).reverse()}}),sn(["filter","map","takeWhile"],function(o,c){var u=c+1,d=u==Rm||u==vR;le.prototype[o]=function(g){var y=this.clone();return y.__iteratees__.push({iteratee:Q(g,3),type:u}),y.__filtered__=y.__filtered__||d,y}}),sn(["head","last"],function(o,c){var u="take"+(c?"Right":"");le.prototype[o]=function(){return this[u](1).value()[0]}}),sn(["initial","tail"],function(o,c){var u="drop"+(c?"":"Right");le.prototype[o]=function(){return this.__filtered__?new le(this):this[u](1)}}),le.prototype.compact=function(){return this.filter(qt)},le.prototype.find=function(o){return this.filter(o).head()},le.prototype.findLast=function(o){return this.reverse().find(o)},le.prototype.invokeMap=oe(function(o,c){return typeof o=="function"?new le(this):this.map(function(u){return zo(u,o,c)})}),le.prototype.reject=function(o){return this.filter(bu(Q(o)))},le.prototype.slice=function(o,c){o=ie(o);var u=this;return u.__filtered__&&(o>0||c<0)?new le(u):(o<0?u=u.takeRight(-o):o&&(u=u.drop(o)),c!==t&&(c=ie(c),u=c<0?u.dropRight(-c):u.take(c-o)),u)},le.prototype.takeRightWhile=function(o){return this.reverse().takeWhile(o).reverse()},le.prototype.toArray=function(){return this.take(Rn)},Sn(le.prototype,function(o,c){var u=/^(?:filter|find|map|reject)|While$/.test(c),d=/^(?:head|last)$/.test(c),g=_[d?"take"+(c=="last"?"Right":""):c],y=d||/^find/.test(c);g&&(_.prototype[c]=function(){var v=this.__wrapped__,w=d?[1]:arguments,T=v instanceof le,C=w[0],k=T||te(v),x=function(ce){var fe=g.apply(_,Tr([ce],w));return d&&U?fe[0]:fe};k&&u&&typeof C=="function"&&C.length!=1&&(T=k=!1);var U=this.__chain__,G=!!this.__actions__.length,J=y&&!U,se=T&&!G;if(!y&&k){v=se?v:new le(this);var X=o.apply(v,w);return X.__actions__.push({func:Tu,args:[x],thisArg:t}),new an(X,U)}return J&&se?o.apply(this,w):(X=this.thru(x),J?d?X.value()[0]:X.value():X)})}),sn(["pop","push","shift","sort","splice","unshift"],function(o){var c=Qc[o],u=/^(?:push|sort|unshift)$/.test(o)?"tap":"thru",d=/^(?:pop|shift)$/.test(o);_.prototype[o]=function(){var g=arguments;if(d&&!this.__chain__){var y=this.value();return c.apply(te(y)?y:[],g)}return this[u](function(v){return c.apply(te(v)?v:[],g)})}}),Sn(le.prototype,function(o,c){var u=_[c];if(u){var d=u.name+"";Ee.call(_s,d)||(_s[d]=[]),_s[d].push({name:c,func:u})}}),_s[mu(t,Y).name]=[{name:"wrapper",func:t}],le.prototype.clone=Eb,le.prototype.reverse=Tb,le.prototype.value=Ab,_.prototype.at=ZC,_.prototype.chain=e1,_.prototype.commit=t1,_.prototype.next=n1,_.prototype.plant=i1,_.prototype.reverse=s1,_.prototype.toJSON=_.prototype.valueOf=_.prototype.value=o1,_.prototype.first=_.prototype.head,Fo&&(_.prototype[Fo]=r1),_},ps=tb();hi?((hi.exports=ps)._=ps,Kh._=ps):ft._=ps}).call(la)})(l$,cc);const hR=cc;function h$(){return Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)}const dR=document.querySelector(".search__wrapper"),gw=document.querySelector(".search__input"),Nl=document.querySelector(".filters__list"),yp=document.querySelector(".filters__category"),d$=hR.debounce(m$,500);async function f$(n){try{const e=await n.fetchFilters(),r=[...new Set(e.map(({filter:i})=>i))].map((i,s)=>{const a=i.toLowerCase().split(" ").join("-");return s===0?`<li id=${a} class="filters__item active">${i}</li>`:`<li id=${a} class="filters__item">${i}</li>`}).join("");Nl.insertAdjacentHTML("afterbegin",r),ti()}catch(e){console.log("Error fetching filters:",e)}}function p$(n){const e=n.charAt(0).toUpperCase()+n.slice(1,n.length);yp.innerHTML=`<div>/</div>${e}`,yp.classList.add("active"),dR.classList.add("active")}function g$(){yp.classList.remove("active"),dR.classList.remove("active")}async function m$(n){const e=n.target.value.toLowerCase().trim();kn.keyword=e,ti()}function _$(n){const e=n.target,t=n.target.id;e.classList.contains("active")&&(Y0({filter:t,bodypart:"",keyword:"",muscles:"",equipment:""},De),ti()),[...Nl.children].forEach(r=>{r.classList.remove("active")}),e.classList.add("active"),g$(),De.currentPage=1,ti()}function y$(){if(De.endPoint!=1){const n=new uc;f$(n)}}gw&&gw.addEventListener("input",d$);Nl&&Nl.addEventListener("click",_$);function fR(n){document.querySelector(n).scrollIntoView({behavior:"smooth"})}window.addEventListener("resize",hR.debounce(ti,1e3));const v$=1440;let kn={filter:"Muscles",bodypart:"",keyword:"",muscles:"",equipment:""};const De={currentPage:1,endPoint:3},Gn={cardsLinks:null,pageLinks:null,workoutLinks:null};async function ti(){document.querySelector(".exercise-cards__section").offsetHeight;const e=new uc,t=h$();let r,i;Y0(kn,De),qs(Re.visuallyHidden,Re.emptyParag),ks(Re.emptyWrapper,Re.exerciseWrapper),u$(De.endPoint,t);try{switch(De.endPoint){case 1:if(qs(Re.favoriteWrapper,Re.exerciseWrapper),ks(Re.workoutWrapper,Re.exerciseWrapper),r=await S4(De,t),r.currentData.length<1)throw new Error("No data");$u(),Wu(),T4(r.currentData),t<v$&&wf(De.currentPage,r.totalPages),Ef(De.endPoint);break;case 2:if(ks(Re.favoriteWrapper,Re.exerciseWrapper),qs(Re.workoutWrapper,Re.exerciseWrapper),fR(".exercises"),i=A4(De.currentPage,De.endPoint,e,kn,i,t),r=await sw(i),r.length<1)throw new Error("No data");$u(),Wu(),E4(r),wf(De.currentPage,e.maxPages),Ef(De.endPoint),T$();break;case 3:ks(Re.workoutWrapper,Re.exerciseWrapper),ks(Re.favoriteWrapper,Re.exerciseWrapper),i=R4(De.currentPage,De.endPoint,e,kn,i,t),r=await sw(i),$u(),Wu(),w4(r),wf(De.currentPage,e.maxPages),I$(),Ef(De.endPoint);break}}catch{$u(),Wu(),qs(Re.emptyWrapper,Re.exerciseWrapper),De.endPoint!=1?kl(Cl.stringHome,Re.exerciseWrapper):kl(Cl.stringFavorite,Re.exerciseWrapper),ks(Re.visuallyHidden,Re.emptyParag)}}function I$(){Gn.cardsLinks=document.querySelector(".js-cards"),Gn.cardsLinks?Gn.cardsLinks.addEventListener("click",pR):console.error("Element with class 'js-cards' not found.")}function pR(n){const e=b4(n);p$(e),w$(e),e!=null&&(kn.filter==="Muscles"?(De.endPoint=2,kn.muscles=e):kn.filter==="Body%20parts"?(De.endPoint=2,kn.bodypart=e):kn.filter==="Equipment"&&(De.endPoint=2,kn.equipment=e)),Gn.cardsLinks.removeEventListener("click",pR),De.currentPage=1,ti()}function w$(n){return n.includes(" ")?n.replace(" ","%20"):n}function Ef(){Gn.pageLinks=document.querySelector(".js-pages"),Gn.pageLinks?Gn.pageLinks.addEventListener("click",E$):console.error("Element with class 'js-pages' not found.")}function E$(n){const e=P4(n);console.log("clicked page:",e),fR(window.location.href.includes("/favorites")?".favorites":".exercises"),De.currentPage!=e&&e!=null&&(De.currentPage=+e,ti())}function T$(){Gn.workoutLinks=document.querySelector(".js-cards"),Gn.workoutLinks?Gn.workoutLinks.addEventListener("click",A$):console.error("Element with class 'js-cards' not found for workout.")}async function A$(n){const e=C4(n);if(!e)return;const t=new uc;try{t.id=e;const r=await t.fetchExerciseById();if(cc.isEmpty(r))throw new Error("Exercise not found!");r.isFavorite=await Mi.idIsFavorite(e),Mc(r)}catch(r){console.error(r)}}function R$(){window.location.href.includes("/favorite")?(De.endPoint=1,ti()):y$()}R$();document.querySelectorAll(".header__nav");const S$=document.querySelectorAll("section"),b$=n=>{const e={rootMargin:"100px",threshold:.2},t=(i,s)=>{i.forEach(({isIntersecting:a,target:l})=>{a&&(l.classList.add("appear"),s.unobserve(l))})},r=new IntersectionObserver(t,e);n.forEach(i=>r.observe(i))};setTimeout(()=>{b$(S$)},250);export{ei as d,mp as r,I4 as s};
