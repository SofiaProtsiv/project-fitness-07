import{A as rf}from"./index-090ffe9b.js";import"./index-8dce45e2.js";import"./quotes-0316cfc1.js";const sf=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},q_=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=n[t++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=n[t++],o=n[t++],a=n[t++],c=((i&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[r++]=String.fromCharCode(55296+(c>>10)),e[r++]=String.fromCharCode(56320+(c&1023))}else{const s=n[t++],o=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63)}}return e.join("")},of={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const s=n[i],o=i+1<n.length,a=o?n[i+1]:0,c=i+2<n.length,u=c?n[i+2]:0,l=s>>2,h=(s&3)<<4|a>>4;let d=(a&15)<<2|u>>6,f=u&63;c||(f=64,o||(d=64)),r.push(t[l],t[h],t[d],t[f])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(sf(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):q_(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const s=t[n.charAt(i++)],a=i<n.length?t[n.charAt(i)]:0;++i;const u=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,s==null||a==null||u==null||h==null)throw new $_;const d=s<<2|a>>4;if(r.push(d),u!==64){const f=a<<4&240|u>>2;if(r.push(f),h!==64){const w=u<<6&192|h;r.push(w)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class $_ extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const j_=function(n){const e=sf(n);return of.encodeByteArray(e,!0)},ro=function(n){return j_(n).replace(/\./g,"")},af=function(n){try{return of.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function io(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!z_(t)||(n[t]=io(n[t],e[t]));return n}function z_(n){return n!=="__proto__"}function W_(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const G_=()=>W_().__FIREBASE_DEFAULTS__,K_=()=>{if(typeof process>"u"||typeof process.env>"u")return;const n={}.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},H_=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&af(n[1]);return e&&JSON.parse(e)},Yc=()=>{try{return G_()||K_()||H_()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},cf=()=>{var n;return(n=Yc())===null||n===void 0?void 0:n.config},Q_=n=>{var e;return(e=Yc())===null||e===void 0?void 0:e[`_${n}`]};class Y_{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}function J_(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",i=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n),a="";return[ro(JSON.stringify(t)),ro(JSON.stringify(o)),a].join(".")}function Z(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function X_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Z())}function Jc(){var n;const e=(n=Yc())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Z_(){return typeof self=="object"&&self.self===self}function uf(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Xc(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function lf(){const n=Z();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function ey(){return!Jc()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Ti(){try{return typeof indexedDB=="object"}catch{return!1}}function ty(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}const ny="FirebaseError";class Ne extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=ny,Object.setPrototypeOf(this,Ne.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Bn.prototype.create)}}class Bn{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?ry(s,r):"Error",a=`${this.serviceName}: ${o} (${i}).`;return new Ne(i,a,r)}}function ry(n,e){return n.replace(iy,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const iy=/\{\$([^}]+)}/g;function Kl(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function sy(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function nc(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const s=n[i],o=e[i];if(Hl(s)&&Hl(o)){if(!nc(s,o))return!1}else if(s!==o)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function Hl(n){return n!==null&&typeof n=="object"}function kr(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function sr(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function si(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function hf(n,e){const t=new oy(n,e);return t.subscribe.bind(t)}class oy{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");ay(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=Va),i.error===void 0&&(i.error=Va),i.complete===void 0&&(i.complete=Va);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ay(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function Va(){}function P(n){return n&&n._delegate?n._delegate:n}class dt{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const hn="[DEFAULT]";class cy{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Y_;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ly(e))try{this.getOrInitializeService({instanceIdentifier:hn})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=hn){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=hn){return this.instances.has(e)}getOptions(e=hn){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[s,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(s);r===a&&o.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const o=this.instances.get(i);return o&&e(o,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:uy(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=hn){return this.component?this.component.multipleInstances?e:hn:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function uy(n){return n===hn?void 0:n}function ly(n){return n.instantiationMode==="EAGER"}class hy{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new cy(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Zc=[];var x;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(x||(x={}));const df={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},dy=x.INFO,fy={[x.DEBUG]:"log",[x.VERBOSE]:"log",[x.INFO]:"info",[x.WARN]:"warn",[x.ERROR]:"error"},py=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=fy[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Oo{constructor(e){this.name=e,this._logLevel=dy,this._logHandler=py,this._userLogHandler=null,Zc.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in x))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?df[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,x.DEBUG,...e),this._logHandler(this,x.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,x.VERBOSE,...e),this._logHandler(this,x.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,x.INFO,...e),this._logHandler(this,x.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,x.WARN,...e),this._logHandler(this,x.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,x.ERROR,...e),this._logHandler(this,x.ERROR,...e)}}function my(n){Zc.forEach(e=>{e.setLogLevel(n)})}function gy(n,e){for(const t of Zc){let r=null;e&&e.level&&(r=df[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(i,s,...o)=>{const a=o.map(c=>{if(c==null)return null;if(typeof c=="string")return c;if(typeof c=="number"||typeof c=="boolean")return c.toString();if(c instanceof Error)return c.message;try{return JSON.stringify(c)}catch{return null}}).filter(c=>c).join(" ");s>=(r??i.logLevel)&&n({level:x[s].toLowerCase(),message:a,args:o,type:i.name})}}}const _y=(n,e)=>e.some(t=>n instanceof t);let Ql,Yl;function yy(){return Ql||(Ql=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function vy(){return Yl||(Yl=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ff=new WeakMap,rc=new WeakMap,pf=new WeakMap,Na=new WeakMap,eu=new WeakMap;function Iy(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(qt(n.result)),i()},o=()=>{r(n.error),i()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ff.set(t,n)}).catch(()=>{}),eu.set(e,n),e}function wy(n){if(rc.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),i()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});rc.set(n,e)}let ic={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return rc.get(n);if(e==="objectStoreNames")return n.objectStoreNames||pf.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return qt(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Ey(n){ic=n(ic)}function Ty(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(xa(this),e,...t);return pf.set(r,e.sort?e.sort():[e]),qt(r)}:vy().includes(n)?function(...e){return n.apply(xa(this),e),qt(ff.get(this))}:function(...e){return qt(n.apply(xa(this),e))}}function Ay(n){return typeof n=="function"?Ty(n):(n instanceof IDBTransaction&&wy(n),_y(n,yy())?new Proxy(n,ic):n)}function qt(n){if(n instanceof IDBRequest)return Iy(n);if(Na.has(n))return Na.get(n);const e=Ay(n);return e!==n&&(Na.set(n,e),eu.set(e,n)),e}const xa=n=>eu.get(n);function Ry(n,e,{blocked:t,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(n,e),a=qt(o);return r&&o.addEventListener("upgradeneeded",c=>{r(qt(o.result),c.oldVersion,c.newVersion,qt(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),i&&c.addEventListener("versionchange",u=>i(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const by=["get","getKey","getAll","getAllKeys","count"],Sy=["put","add","delete","clear"],Oa=new Map;function Jl(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Oa.get(e))return Oa.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=Sy.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||by.includes(t)))return;const s=async function(o,...a){const c=this.transaction(o,i?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),i&&c.done]))[0]};return Oa.set(e,s),s}Ey(n=>({...n,get:(e,t,r)=>Jl(e,t)||n.get(e,t,r),has:(e,t)=>!!Jl(e,t)||n.has(e,t)}));class Py{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Cy(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Cy(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const sc="@firebase/app",Xl="0.9.25";const Sn=new Oo("@firebase/app"),ky="@firebase/app-compat",Dy="@firebase/analytics-compat",Vy="@firebase/analytics",Ny="@firebase/app-check-compat",xy="@firebase/app-check",Oy="@firebase/auth",Ly="@firebase/auth-compat",My="@firebase/database",Fy="@firebase/database-compat",Uy="@firebase/functions",By="@firebase/functions-compat",qy="@firebase/installations",$y="@firebase/installations-compat",jy="@firebase/messaging",zy="@firebase/messaging-compat",Wy="@firebase/performance",Gy="@firebase/performance-compat",Ky="@firebase/remote-config",Hy="@firebase/remote-config-compat",Qy="@firebase/storage",Yy="@firebase/storage-compat",Jy="@firebase/firestore",Xy="@firebase/firestore-compat",Zy="firebase",ev="10.7.1";const $t="[DEFAULT]",tv={[sc]:"fire-core",[ky]:"fire-core-compat",[Vy]:"fire-analytics",[Dy]:"fire-analytics-compat",[xy]:"fire-app-check",[Ny]:"fire-app-check-compat",[Oy]:"fire-auth",[Ly]:"fire-auth-compat",[My]:"fire-rtdb",[Fy]:"fire-rtdb-compat",[Uy]:"fire-fn",[By]:"fire-fn-compat",[qy]:"fire-iid",[$y]:"fire-iid-compat",[jy]:"fire-fcm",[zy]:"fire-fcm-compat",[Wy]:"fire-perf",[Gy]:"fire-perf-compat",[Ky]:"fire-rc",[Hy]:"fire-rc-compat",[Qy]:"fire-gcs",[Yy]:"fire-gcs-compat",[Jy]:"fire-fst",[Xy]:"fire-fst-compat","fire-js":"fire-js",[Zy]:"fire-js-all"};const jt=new Map,Ai=new Map;function so(n,e){try{n.container.addComponent(e)}catch(t){Sn.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function mf(n,e){n.container.addOrOverwriteComponent(e)}function zt(n){const e=n.name;if(Ai.has(e))return Sn.debug(`There were multiple attempts to register component ${e}.`),!1;Ai.set(e,n);for(const t of jt.values())so(t,n);return!0}function gf(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function nv(n,e,t=$t){gf(n,e).clearInstance(t)}function rv(){Ai.clear()}const iv={["no-app"]:"No Firebase App '{$appName}' has been created - call initializeApp() first",["bad-app-name"]:"Illegal App name: '{$appName}",["duplicate-app"]:"Firebase App named '{$appName}' already exists with different options or config",["app-deleted"]:"Firebase App named '{$appName}' already deleted",["no-options"]:"Need to provide options, when not being deployed to hosting via source.",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance.",["invalid-log-argument"]:"First argument to `onLog` must be null or a function.",["idb-open"]:"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",["idb-get"]:"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",["idb-set"]:"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",["idb-delete"]:"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."},It=new Bn("app","Firebase",iv);let sv=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new dt("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw It.create("app-deleted",{appName:this._name})}};const tn=ev;function tu(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:$t,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw It.create("bad-app-name",{appName:String(i)});if(t||(t=cf()),!t)throw It.create("no-options");const s=jt.get(i);if(s){if(nc(t,s.options)&&nc(r,s.config))return s;throw It.create("duplicate-app",{appName:i})}const o=new hy(i);for(const c of Ai.values())o.addComponent(c);const a=new sv(t,r,o);return jt.set(i,a),a}function ov(n=$t){const e=jt.get(n);if(!e&&n===$t&&cf())return tu();if(!e)throw It.create("no-app",{appName:n});return e}function av(){return Array.from(jt.values())}async function _f(n){const e=n.name;jt.has(e)&&(jt.delete(e),await Promise.all(n.container.getProviders().map(t=>t.delete())),n.isDeleted=!0)}function ct(n,e,t){var r;let i=(r=tv[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const a=[`Unable to register library "${i}" with version "${e}":`];s&&a.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Sn.warn(a.join(" "));return}zt(new dt(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function yf(n,e){if(n!==null&&typeof n!="function")throw It.create("invalid-log-argument");gy(n,e)}function vf(n){my(n)}const cv="firebase-heartbeat-database",uv=1,Ri="firebase-heartbeat-store";let La=null;function If(){return La||(La=Ry(cv,uv,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Ri)}}}).catch(n=>{throw It.create("idb-open",{originalErrorMessage:n.message})})),La}async function lv(n){try{return await(await If()).transaction(Ri).objectStore(Ri).get(wf(n))}catch(e){if(e instanceof Ne)Sn.warn(e.message);else{const t=It.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Sn.warn(t.message)}}}async function Zl(n,e){try{const r=(await If()).transaction(Ri,"readwrite");await r.objectStore(Ri).put(e,wf(n)),await r.done}catch(t){if(t instanceof Ne)Sn.warn(t.message);else{const r=It.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Sn.warn(r.message)}}}function wf(n){return`${n.name}!${n.options.appId}`}const hv=1024,dv=30*24*60*60*1e3;class fv{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new mv(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=eh();if(!(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null))&&!(this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s)))return this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=dv}),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var e;if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=eh(),{heartbeatsToSend:r,unsentEntries:i}=pv(this._heartbeatsCache.heartbeats),s=ro(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function eh(){return new Date().toISOString().substring(0,10)}function pv(n,e=hv){const t=[];let r=n.slice();for(const i of n){const s=t.find(o=>o.agent===i.agent);if(s){if(s.dates.push(i.date),th(t)>e){s.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),th(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class mv{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Ti()?ty().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await lv(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Zl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return Zl(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function th(n){return ro(JSON.stringify({version:2,heartbeats:n})).length}function gv(n){zt(new dt("platform-logger",e=>new Py(e),"PRIVATE")),zt(new dt("heartbeat",e=>new fv(e),"PRIVATE")),ct(sc,Xl,n),ct(sc,Xl,"esm2017"),ct("fire-js","")}gv("");const _v=Object.freeze(Object.defineProperty({__proto__:null,SDK_VERSION:tn,_DEFAULT_ENTRY_NAME:$t,_addComponent:so,_addOrOverwriteComponent:mf,_apps:jt,_clearComponents:rv,_components:Ai,_getProvider:gf,_registerComponent:zt,_removeServiceInstance:nv,deleteApp:_f,getApp:ov,getApps:av,initializeApp:tu,onLog:yf,registerVersion:ct,setLogLevel:vf,FirebaseError:Ne},Symbol.toStringTag,{value:"Module"}));class yv{constructor(e,t){this._delegate=e,this.firebase=t,so(e,new dt("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),_f(this._delegate)))}_getService(e,t=$t){var r;this._delegate.checkDestroyed();const i=this._delegate.container.getProvider(e);return!i.isInitialized()&&((r=i.getComponent())===null||r===void 0?void 0:r.instantiationMode)==="EXPLICIT"&&i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=$t){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){so(this._delegate,e)}_addOrOverwriteComponent(e){mf(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}const vv={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance."},nh=new Bn("app-compat","Firebase",vv);function Iv(n){const e={},t={__esModule:!0,initializeApp:s,app:i,registerVersion:ct,setLogLevel:vf,onLog:yf,apps:null,SDK_VERSION:tn,INTERNAL:{registerComponent:a,removeApp:r,useAsService:c,modularAPIs:_v}};t.default=t,Object.defineProperty(t,"apps",{get:o});function r(u){delete e[u]}function i(u){if(u=u||$t,!Kl(e,u))throw nh.create("no-app",{appName:u});return e[u]}i.App=n;function s(u,l={}){const h=tu(u,l);if(Kl(e,h.name))return e[h.name];const d=new n(h,t);return e[h.name]=d,d}function o(){return Object.keys(e).map(u=>e[u])}function a(u){const l=u.name,h=l.replace("-compat","");if(zt(u)&&u.type==="PUBLIC"){const d=(f=i())=>{if(typeof f[h]!="function")throw nh.create("invalid-app-argument",{appName:l});return f[h]()};u.serviceProps!==void 0&&io(d,u.serviceProps),t[h]=d,n.prototype[h]=function(...f){return this._getService.bind(this,l).apply(this,u.multipleInstances?f:[])}}return u.type==="PUBLIC"?t[h]:null}function c(u,l){return l==="serverAuth"?null:l}return t}function Ef(){const n=Iv(yv);n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:Ef,extendNamespace:e,createSubscribe:hf,ErrorFactory:Bn,deepExtend:io});function e(t){io(n,t)}return n}const wv=Ef();const rh=new Oo("@firebase/app-compat"),Ev="@firebase/app-compat",Tv="0.2.25";function Av(n){ct(Ev,Tv,n)}if(Z_()&&self.firebase!==void 0){rh.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const n=self.firebase.SDK_VERSION;n&&n.indexOf("LITE")>=0&&rh.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Wt=wv;Av();var Rv="firebase",bv="10.7.1";Wt.registerVersion(Rv,bv,"app-compat");function nu(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}const Kr={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},Hn={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};function Sv(){return{["admin-restricted-operation"]:"This operation is restricted to administrators only.",["argument-error"]:"",["app-not-authorized"]:"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.",["app-not-installed"]:"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.",["captcha-check-failed"]:"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.",["code-expired"]:"The SMS code has expired. Please re-send the verification code to try again.",["cordova-not-ready"]:"Cordova framework is not ready.",["cors-unsupported"]:"This browser is not supported.",["credential-already-in-use"]:"This credential is already associated with a different user account.",["custom-token-mismatch"]:"The custom token corresponds to a different audience.",["requires-recent-login"]:"This operation is sensitive and requires recent authentication. Log in again before retrying this request.",["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.",["dynamic-link-not-activated"]:"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.",["email-change-needs-verification"]:"Multi-factor users must always have a verified email.",["email-already-in-use"]:"The email address is already in use by another account.",["emulator-config-failed"]:'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',["expired-action-code"]:"The action code has expired.",["cancelled-popup-request"]:"This operation has been cancelled due to another conflicting popup being opened.",["internal-error"]:"An internal AuthError has occurred.",["invalid-app-credential"]:"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.",["invalid-app-id"]:"The mobile app identifier is not registed for the current project.",["invalid-user-token"]:"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.",["invalid-auth-event"]:"An internal AuthError has occurred.",["invalid-verification-code"]:"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.",["invalid-continue-uri"]:"The continue URL provided in the request is invalid.",["invalid-cordova-configuration"]:"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.",["invalid-custom-token"]:"The custom token format is incorrect. Please check the documentation.",["invalid-dynamic-link-domain"]:"The provided dynamic link domain is not configured or authorized for the current project.",["invalid-email"]:"The email address is badly formatted.",["invalid-emulator-scheme"]:"Emulator URL must start with a valid scheme (http:// or https://).",["invalid-api-key"]:"Your API key is invalid, please check you have copied it correctly.",["invalid-cert-hash"]:"The SHA-1 certificate hash provided is invalid.",["invalid-credential"]:"The supplied auth credential is incorrect, malformed or has expired.",["invalid-message-payload"]:"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-multi-factor-session"]:"The request does not contain a valid proof of first factor successful sign-in.",["invalid-oauth-provider"]:"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.",["invalid-oauth-client-id"]:"The OAuth client ID provided is either invalid or does not match the specified API key.",["unauthorized-domain"]:"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.",["invalid-action-code"]:"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.",["wrong-password"]:"The password is invalid or the user does not have a password.",["invalid-persistence-type"]:"The specified persistence type is invalid. It can only be local, session or none.",["invalid-phone-number"]:"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].",["invalid-provider-id"]:"The specified provider ID is invalid.",["invalid-recipient-email"]:"The email corresponding to this action failed to send as the provided recipient email address is invalid.",["invalid-sender"]:"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-verification-id"]:"The verification ID used to create the phone auth credential is invalid.",["invalid-tenant-id"]:"The Auth instance's tenant ID is invalid.",["login-blocked"]:"Login blocked by user-provided method: {$originalMessage}",["missing-android-pkg-name"]:"An Android Package Name must be provided if the Android App is required to be installed.",["auth-domain-config-required"]:"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.",["missing-app-credential"]:"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.",["missing-verification-code"]:"The phone auth credential was created with an empty SMS verification code.",["missing-continue-uri"]:"A continue URL must be provided in the request.",["missing-iframe-start"]:"An internal AuthError has occurred.",["missing-ios-bundle-id"]:"An iOS Bundle ID must be provided if an App Store ID is provided.",["missing-or-invalid-nonce"]:"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.",["missing-password"]:"A non-empty password must be provided",["missing-multi-factor-info"]:"No second factor identifier is provided.",["missing-multi-factor-session"]:"The request is missing proof of first factor successful sign-in.",["missing-phone-number"]:"To send verification codes, provide a phone number for the recipient.",["missing-verification-id"]:"The phone auth credential was created with an empty verification ID.",["app-deleted"]:"This instance of FirebaseApp has been deleted.",["multi-factor-info-not-found"]:"The user does not have a second factor matching the identifier provided.",["multi-factor-auth-required"]:"Proof of ownership of a second factor is required to complete sign-in.",["account-exists-with-different-credential"]:"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.",["network-request-failed"]:"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.",["no-auth-event"]:"An internal AuthError has occurred.",["no-such-provider"]:"User was not linked to an account with the given provider.",["null-user"]:"A null user object was provided as the argument for an operation which requires a non-null user object.",["operation-not-allowed"]:"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.",["operation-not-supported-in-this-environment"]:'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',["popup-blocked"]:"Unable to establish a connection with the popup. It may have been blocked by the browser.",["popup-closed-by-user"]:"The popup has been closed by the user before finalizing the operation.",["provider-already-linked"]:"User can only be linked to one identity for the given provider.",["quota-exceeded"]:"The project's quota for this operation has been exceeded.",["redirect-cancelled-by-user"]:"The redirect operation has been cancelled by the user before finalizing.",["redirect-operation-pending"]:"A redirect sign-in operation is already pending.",["rejected-credential"]:"The request contains malformed or mismatching credentials.",["second-factor-already-in-use"]:"The second factor is already enrolled on this account.",["maximum-second-factor-count-exceeded"]:"The maximum allowed number of second factors on a user has been exceeded.",["tenant-id-mismatch"]:"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.",["user-token-expired"]:"The user's credential is no longer valid. The user must sign in again.",["too-many-requests"]:"We have blocked all requests from this device due to unusual activity. Try again later.",["unauthorized-continue-uri"]:"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.",["unsupported-first-factor"]:"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.",["unsupported-persistence-type"]:"The current environment does not support the specified persistence type.",["unsupported-tenant-operation"]:"This operation is not supported in a multi-tenant context.",["unverified-email"]:"The operation requires a verified email.",["user-cancelled"]:"The user did not grant your application the permissions it requested.",["user-not-found"]:"There is no user record corresponding to this identifier. The user may have been deleted.",["user-disabled"]:"The user account has been disabled by an administrator.",["user-mismatch"]:"The supplied credentials do not correspond to the previously signed in user.",["user-signed-out"]:"",["weak-password"]:"The password must be 6 characters long or more.",["web-storage-unsupported"]:"This browser is not supported or 3rd party cookies and data may be disabled.",["already-initialized"]:"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.",["missing-recaptcha-token"]:"The reCAPTCHA token is missing when sending request to the backend.",["invalid-recaptcha-token"]:"The reCAPTCHA token is invalid when sending request to the backend.",["invalid-recaptcha-action"]:"The reCAPTCHA action is invalid when sending request to the backend.",["recaptcha-not-enabled"]:"reCAPTCHA Enterprise integration is not enabled for this project.",["missing-client-type"]:"The reCAPTCHA client type is missing when sending request to the backend.",["missing-recaptcha-version"]:"The reCAPTCHA version is missing when sending request to the backend.",["invalid-req-type"]:"Invalid request parameters.",["invalid-recaptcha-version"]:"The reCAPTCHA version is invalid when sending request to the backend.",["unsupported-password-policy-schema-version"]:"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.",["password-does-not-meet-requirements"]:"The password does not meet the requirements."}}function Tf(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Pv=Sv,Cv=Tf,Af=new Bn("auth","Firebase",Tf());const oo=new Oo("@firebase/auth");function kv(n,...e){oo.logLevel<=x.WARN&&oo.warn(`Auth (${tn}): ${n}`,...e)}function zs(n,...e){oo.logLevel<=x.ERROR&&oo.error(`Auth (${tn}): ${n}`,...e)}function Ae(n,...e){throw ru(n,...e)}function Ee(n,...e){return ru(n,...e)}function Rf(n,e,t){const r=Object.assign(Object.assign({},Cv()),{[e]:t});return new Bn("auth","Firebase",r).create(e,{appName:n.name})}function Dr(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Ae(n,"argument-error"),Rf(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function ru(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Af.create(n,...e)}function y(n,e,...t){if(!n)throw ru(e,...t)}function rt(n){const e="INTERNAL ASSERTION FAILED: "+n;throw zs(e),new Error(e)}function Qe(n,e){n||rt(e)}function bi(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function iu(){return ih()==="http:"||ih()==="https:"}function ih(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function Dv(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(iu()||uf()||"connection"in navigator)?navigator.onLine:!0}function Vv(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class rs{constructor(e,t){this.shortDelay=e,this.longDelay=t,Qe(t>e,"Short delay should be less than long delay!"),this.isMobile=X_()||Xc()}get(){return Dv()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function su(n,e){Qe(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}class bf{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;rt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;rt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;rt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Nv={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const xv=new rs(3e4,6e4);function ie(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function se(n,e,t,r,i={}){return Sf(n,i,async()=>{let s={},o={};r&&(e==="GET"?o=r:s={body:JSON.stringify(r)});const a=kr(Object.assign({key:n.config.apiKey},o)).slice(1),c=await n._getAdditionalHeaders();return c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode),bf.fetch()(Pf(n,n.config.apiHost,t,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},s))})}async function Sf(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},Nv),e);try{const i=new Lv(n),s=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const o=await s.json();if("needConfirmation"in o)throw oi(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{const a=s.ok?o.errorMessage:o.error.message,[c,u]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw oi(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw oi(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw oi(n,"user-disabled",o);const l=r[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw Rf(n,l,u);Ae(n,l)}}catch(i){if(i instanceof Ne)throw i;Ae(n,"network-request-failed",{message:String(i)})}}async function bt(n,e,t,r,i={}){const s=await se(n,e,t,r,i);return"mfaPendingCredential"in s&&Ae(n,"multi-factor-auth-required",{_serverResponse:s}),s}function Pf(n,e,t,r){const i=`${e}${t}?${r}`;return n.config.emulator?su(n.config,i):`${n.config.apiScheme}://${i}`}function Ov(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Lv{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(Ee(this.auth,"network-request-failed")),xv.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function oi(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=Ee(n,e,r);return i.customData._tokenResponse=t,i}function sh(n){return n!==void 0&&n.getResponse!==void 0}function oh(n){return n!==void 0&&n.enterprise!==void 0}class Mv{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Ov(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}}async function Fv(n){return(await se(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function Uv(n,e){return se(n,"GET","/v2/recaptchaConfig",ie(n,e))}async function Bv(n,e){return se(n,"POST","/v1/accounts:delete",e)}async function qv(n,e){return se(n,"POST","/v1/accounts:update",e)}async function $v(n,e){return se(n,"POST","/v1/accounts:lookup",e)}function fi(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function jv(n,e=!1){const t=P(n),r=await t.getIdToken(e),i=Lo(r);y(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const s=typeof i.firebase=="object"?i.firebase:void 0,o=s==null?void 0:s.sign_in_provider;return{claims:i,token:r,authTime:fi(Ma(i.auth_time)),issuedAtTime:fi(Ma(i.iat)),expirationTime:fi(Ma(i.exp)),signInProvider:o||null,signInSecondFactor:(s==null?void 0:s.sign_in_second_factor)||null}}function Ma(n){return Number(n)*1e3}function Lo(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return zs("JWT malformed, contained fewer than 3 sections"),null;try{const i=af(t);return i?JSON.parse(i):(zs("Failed to decode base64 JWT payload"),null)}catch(i){return zs("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function zv(n){const e=Lo(n);return y(e,"internal-error"),y(typeof e.exp<"u","internal-error"),y(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function Tt(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Ne&&Wv(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Wv({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Gv{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Cf{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=fi(this.lastLoginAt),this.creationTime=fi(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Si(n){var e;const t=n.auth,r=await n.getIdToken(),i=await Tt(n,$v(t,{idToken:r}));y(i==null?void 0:i.users.length,t,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Qv(s.providerUserInfo):[],a=Hv(n.providerData,o),c=n.isAnonymous,u=!(n.email&&s.passwordHash)&&!(a!=null&&a.length),l=c?u:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new Cf(s.createdAt,s.lastLoginAt),isAnonymous:l};Object.assign(n,h)}async function Kv(n){const e=P(n);await Si(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function Hv(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function Qv(n){return n.map(e=>{var{providerId:t}=e,r=nu(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}async function Yv(n,e){const t=await Sf(n,{},async()=>{const r=kr({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:s}=n.config,o=Pf(n,i,"/v1/token",`key=${s}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",bf.fetch()(o,{method:"POST",headers:a,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function Jv(n,e){return se(n,"POST","/v2/accounts:revokeToken",ie(n,e))}class Pi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){y(e.idToken,"internal-error"),y(typeof e.idToken<"u","internal-error"),y(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):zv(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return y(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:s}=await Yv(e,t);this.updateTokensAndExpiration(r,i,Number(s))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:s}=t,o=new Pi;return r&&(y(typeof r=="string","internal-error",{appName:e}),o.refreshToken=r),i&&(y(typeof i=="string","internal-error",{appName:e}),o.accessToken=i),s&&(y(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Pi,this.toJSON())}_performRefresh(){return rt("not implemented")}}function Vt(n,e){y(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Tn{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,s=nu(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Gv(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Cf(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await Tt(this,this.stsTokenManager.getToken(this.auth,e));return y(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return jv(this,e)}reload(){return Kv(this)}_assign(e){this!==e&&(y(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Tn(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){y(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Si(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Tt(this,Bv(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,s,o,a,c,u,l;const h=(r=t.displayName)!==null&&r!==void 0?r:void 0,d=(i=t.email)!==null&&i!==void 0?i:void 0,f=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,w=(o=t.photoURL)!==null&&o!==void 0?o:void 0,E=(a=t.tenantId)!==null&&a!==void 0?a:void 0,I=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,D=(u=t.createdAt)!==null&&u!==void 0?u:void 0,L=(l=t.lastLoginAt)!==null&&l!==void 0?l:void 0,{uid:N,emailVerified:W,isAnonymous:H,providerData:j,stsTokenManager:le}=t;y(N&&le,e,"internal-error");const Dt=Pi.fromJSON(this.name,le);y(typeof N=="string",e,"internal-error"),Vt(h,e.name),Vt(d,e.name),y(typeof W=="boolean",e,"internal-error"),y(typeof H=="boolean",e,"internal-error"),Vt(f,e.name),Vt(w,e.name),Vt(E,e.name),Vt(I,e.name),Vt(D,e.name),Vt(L,e.name);const Gr=new Tn({uid:N,auth:e,email:d,emailVerified:W,displayName:h,isAnonymous:H,photoURL:w,phoneNumber:f,tenantId:E,stsTokenManager:Dt,createdAt:D,lastLoginAt:L});return j&&Array.isArray(j)&&(Gr.providerData=j.map(Ds=>Object.assign({},Ds))),I&&(Gr._redirectEventId=I),Gr}static async _fromIdTokenResponse(e,t,r=!1){const i=new Pi;i.updateFromServerResponse(t);const s=new Tn({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Si(s),s}}const ah=new Map;function $e(n){Qe(n instanceof Function,"Expected a class definition");let e=ah.get(n);return e?(Qe(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,ah.set(n,e),e)}class kf{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}kf.type="NONE";const mr=kf;function An(n,e,t){return`firebase:${n}:${e}:${t}`}class ar{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:s}=this.auth;this.fullUserKey=An(this.userKey,i.apiKey,s),this.fullPersistenceKey=An("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Tn._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new ar($e(mr),e,r);const i=(await Promise.all(t.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let s=i[0]||$e(mr);const o=An(r,e.config.apiKey,e.name);let a=null;for(const u of t)try{const l=await u._get(o);if(l){const h=Tn._fromJSON(e,l);u!==s&&(a=h),s=u;break}}catch{}const c=i.filter(u=>u._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new ar(s,e,r):(s=c[0],a&&await s._set(o,a.toJSON()),await Promise.all(t.map(async u=>{if(u!==s)try{await u._remove(o)}catch{}})),new ar(s,e,r))}}function ch(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(Nf(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(Df(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(xf(e))return"Blackberry";if(Of(e))return"Webos";if(ou(e))return"Safari";if((e.includes("chrome/")||Vf(e))&&!e.includes("edge/"))return"Chrome";if(is(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function Df(n=Z()){return/firefox\//i.test(n)}function ou(n=Z()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function Vf(n=Z()){return/crios\//i.test(n)}function Nf(n=Z()){return/iemobile/i.test(n)}function is(n=Z()){return/android/i.test(n)}function xf(n=Z()){return/blackberry/i.test(n)}function Of(n=Z()){return/webos/i.test(n)}function Vr(n=Z()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Xv(n=Z()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function Zv(n=Z()){var e;return Vr(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function eI(){return lf()&&document.documentMode===10}function Lf(n=Z()){return Vr(n)||is(n)||Of(n)||xf(n)||/windows phone/i.test(n)||Nf(n)}function tI(){try{return!!(window&&window!==window.top)}catch{return!1}}function Mf(n,e=[]){let t;switch(n){case"Browser":t=ch(Z());break;case"Worker":t=`${ch(Z())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${tn}/${r}`}class nI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=s=>new Promise((o,a)=>{try{const c=e(s);o(c)}catch(c){a(c)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}async function rI(n,e={}){return se(n,"GET","/v2/passwordPolicy",ie(n,e))}const iI=6;class sI{constructor(e){var t,r,i,s;const o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:iI,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,s,o,a;const c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(r=c.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(i=c.containsLowercaseLetter)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class oI{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new uh(this),this.idTokenSubscription=new uh(this),this.beforeStateQueue=new nI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Af,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=$e(t)),this._initializationPromise=this.queue(async()=>{var r,i;if(!this._deleted&&(this.persistenceManager=await ar.create(this,e),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((i=this.currentUser)===null||i===void 0?void 0:i.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;const r=await this.assertedPersistence.getCurrentUser();let i=r,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=i==null?void 0:i._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(i=c.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(o){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return y(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Si(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Vv()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?P(e):null;return t&&y(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&y(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence($e(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await rI(this),t=new sI(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new Bn("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await Jv(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&$e(e)||this._popupRedirectResolver;y(t,this,"argument-error"),this.redirectPersistenceManager=await ar.create(this,[$e(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const s=typeof t=="function"?t:t.next.bind(t);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(y(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){const c=e.addObserver(t,r,i);return()=>{o=!0,c()}}else{const c=e.addObserver(t);return()=>{o=!0,c()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return y(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Mf(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&kv(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function te(n){return P(n)}class uh{constructor(e){this.auth=e,this.observer=null,this.addObserver=hf(t=>this.observer=t)}get next(){return y(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function aI(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function au(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const s=Ee("internal-error");s.customData=i,t(s)},r.type="text/javascript",r.charset="UTF-8",aI().appendChild(r)})}function Ff(n){return`__${n}${Math.floor(Math.random()*1e6)}`}const cI="https://www.google.com/recaptcha/enterprise.js?render=",uI="recaptcha-enterprise",lI="NO_RECAPTCHA";class hI{constructor(e){this.type=uI,this.auth=te(e)}async verify(e="verify",t=!1){async function r(s){if(!t){if(s.tenantId==null&&s._agentRecaptchaConfig!=null)return s._agentRecaptchaConfig.siteKey;if(s.tenantId!=null&&s._tenantRecaptchaConfigs[s.tenantId]!==void 0)return s._tenantRecaptchaConfigs[s.tenantId].siteKey}return new Promise(async(o,a)=>{Uv(s,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(c=>{if(c.recaptchaKey===void 0)a(new Error("recaptcha Enterprise site key undefined"));else{const u=new Mv(c);return s.tenantId==null?s._agentRecaptchaConfig=u:s._tenantRecaptchaConfigs[s.tenantId]=u,o(u.siteKey)}}).catch(c=>{a(c)})})}function i(s,o,a){const c=window.grecaptcha;oh(c)?c.enterprise.ready(()=>{c.enterprise.execute(s,{action:e}).then(u=>{o(u)}).catch(()=>{o(lI)})}):a(Error("No reCAPTCHA enterprise script loaded."))}return new Promise((s,o)=>{r(this.auth).then(a=>{if(!t&&oh(window.grecaptcha))i(a,s,o);else{if(typeof window>"u"){o(new Error("RecaptchaVerifier is only supported in browser"));return}au(cI+a).then(()=>{i(a,s,o)}).catch(c=>{o(c)})}}).catch(a=>{o(a)})})}}async function lh(n,e,t,r=!1){const i=new hI(n);let s;try{s=await i.verify(t)}catch{s=await i.verify(t,!0)}const o=Object.assign({},e);return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Ci(n,e,t,r){var i;if(!((i=n._getRecaptchaConfig())===null||i===void 0)&&i.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await lh(n,e,t,t==="getOobCode");return r(n,s)}else return r(n,e).catch(async s=>{if(s.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const o=await lh(n,e,t,t==="getOobCode");return r(n,o)}else return Promise.reject(s)})}function dI(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map($e);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function fI(n,e,t){const r=te(n);y(r._canInitEmulator,r,"emulator-config-failed"),y(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!!(t!=null&&t.disableWarnings),s=Uf(e),{host:o,port:a}=pI(e),c=a===null?"":`:${a}`;r.config.emulator={url:`${s}//${o}${c}/`},r.settings.appVerificationDisabledForTesting=!0,r.emulatorConfig=Object.freeze({host:o,port:a,protocol:s.replace(":",""),options:Object.freeze({disableWarnings:i})}),i||mI()}function Uf(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function pI(n){const e=Uf(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const s=i[1];return{host:s,port:hh(r.substr(s.length+1))}}else{const[s,o]=r.split(":");return{host:s,port:hh(o)}}}function hh(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function mI(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Nr{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return rt("not implemented")}_getIdTokenResponse(e){return rt("not implemented")}_linkToIdToken(e,t){return rt("not implemented")}_getReauthenticationResolver(e){return rt("not implemented")}}async function Bf(n,e){return se(n,"POST","/v1/accounts:resetPassword",ie(n,e))}async function gI(n,e){return se(n,"POST","/v1/accounts:update",e)}async function _I(n,e){return se(n,"POST","/v1/accounts:signUp",e)}async function yI(n,e){return se(n,"POST","/v1/accounts:update",ie(n,e))}async function vI(n,e){return bt(n,"POST","/v1/accounts:signInWithPassword",ie(n,e))}async function Mo(n,e){return se(n,"POST","/v1/accounts:sendOobCode",ie(n,e))}async function II(n,e){return Mo(n,e)}async function wI(n,e){return Mo(n,e)}async function EI(n,e){return Mo(n,e)}async function TI(n,e){return Mo(n,e)}async function AI(n,e){return bt(n,"POST","/v1/accounts:signInWithEmailLink",ie(n,e))}async function RI(n,e){return bt(n,"POST","/v1/accounts:signInWithEmailLink",ie(n,e))}class ki extends Nr{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new ki(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new ki(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ci(e,t,"signInWithPassword",vI);case"emailLink":return AI(e,{email:this._email,oobCode:this._password});default:Ae(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ci(e,r,"signUpPassword",_I);case"emailLink":return RI(e,{idToken:t,email:this._email,oobCode:this._password});default:Ae(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function wt(n,e){return bt(n,"POST","/v1/accounts:signInWithIdp",ie(n,e))}const bI="http://localhost";class ft extends Nr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ft(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ae("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,s=nu(t,["providerId","signInMethod"]);if(!r||!i)return null;const o=new ft(r,i);return o.idToken=s.idToken||void 0,o.accessToken=s.accessToken||void 0,o.secret=s.secret,o.nonce=s.nonce,o.pendingToken=s.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return wt(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,wt(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,wt(e,t)}buildRequest(){const e={requestUri:bI,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=kr(t)}return e}}async function SI(n,e){return se(n,"POST","/v1/accounts:sendVerificationCode",ie(n,e))}async function PI(n,e){return bt(n,"POST","/v1/accounts:signInWithPhoneNumber",ie(n,e))}async function CI(n,e){const t=await bt(n,"POST","/v1/accounts:signInWithPhoneNumber",ie(n,e));if(t.temporaryProof)throw oi(n,"account-exists-with-different-credential",t);return t}const kI={USER_NOT_FOUND:"user-not-found"};async function DI(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return bt(n,"POST","/v1/accounts:signInWithPhoneNumber",ie(n,t),kI)}class Rn extends Nr{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Rn({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Rn({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return PI(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return CI(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return DI(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s}=e;return!r&&!t&&!i&&!s?null:new Rn({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:s})}}function VI(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function NI(n){const e=sr(si(n)).link,t=e?sr(si(e)).deep_link_id:null,r=sr(si(n)).deep_link_id;return(r?sr(si(r)).link:null)||r||t||e||n}class Fo{constructor(e){var t,r,i,s,o,a;const c=sr(si(e)),u=(t=c.apiKey)!==null&&t!==void 0?t:null,l=(r=c.oobCode)!==null&&r!==void 0?r:null,h=VI((i=c.mode)!==null&&i!==void 0?i:null);y(u&&l&&h,"argument-error"),this.apiKey=u,this.operation=h,this.code=l,this.continueUrl=(s=c.continueUrl)!==null&&s!==void 0?s:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=NI(e);try{return new Fo(t)}catch{return null}}}class nn{constructor(){this.providerId=nn.PROVIDER_ID}static credential(e,t){return ki._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Fo.parseLink(t);return y(r,"argument-error"),ki._fromEmailAndCode(e,r.code,r.tenantId)}}nn.PROVIDER_ID="password";nn.EMAIL_PASSWORD_SIGN_IN_METHOD="password";nn.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class St{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class xr extends St{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class cr extends xr{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return y("providerId"in t&&"signInMethod"in t,"argument-error"),ft._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return y(e.idToken||e.accessToken,"argument-error"),ft._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return cr.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return cr.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:i,pendingToken:s,nonce:o,providerId:a}=e;if(!r&&!i&&!t&&!s||!a)return null;try{return new cr(a)._credential({idToken:t,accessToken:r,nonce:o,pendingToken:s})}catch{return null}}}class Xe extends xr{constructor(){super("facebook.com")}static credential(e){return ft._fromParams({providerId:Xe.PROVIDER_ID,signInMethod:Xe.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xe.credentialFromTaggedObject(e)}static credentialFromError(e){return Xe.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xe.credential(e.oauthAccessToken)}catch{return null}}}Xe.FACEBOOK_SIGN_IN_METHOD="facebook.com";Xe.PROVIDER_ID="facebook.com";class Ze extends xr{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ft._fromParams({providerId:Ze.PROVIDER_ID,signInMethod:Ze.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ze.credentialFromTaggedObject(e)}static credentialFromError(e){return Ze.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ze.credential(t,r)}catch{return null}}}Ze.GOOGLE_SIGN_IN_METHOD="google.com";Ze.PROVIDER_ID="google.com";class et extends xr{constructor(){super("github.com")}static credential(e){return ft._fromParams({providerId:et.PROVIDER_ID,signInMethod:et.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return et.credentialFromTaggedObject(e)}static credentialFromError(e){return et.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return et.credential(e.oauthAccessToken)}catch{return null}}}et.GITHUB_SIGN_IN_METHOD="github.com";et.PROVIDER_ID="github.com";const xI="http://localhost";class gr extends Nr{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return wt(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,wt(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,wt(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,pendingToken:s}=t;return!r||!i||!s||r!==i?null:new gr(r,s)}static _create(e,t){return new gr(e,t)}buildRequest(){return{requestUri:xI,returnSecureToken:!0,pendingToken:this.pendingToken}}}const OI="saml.";class ao extends St{constructor(e){y(e.startsWith(OI),"argument-error"),super(e)}static credentialFromResult(e){return ao.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return ao.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=gr.fromJSON(e);return y(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return gr._create(r,t)}catch{return null}}}class tt extends xr{constructor(){super("twitter.com")}static credential(e,t){return ft._fromParams({providerId:tt.PROVIDER_ID,signInMethod:tt.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return tt.credentialFromTaggedObject(e)}static credentialFromError(e){return tt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return tt.credential(t,r)}catch{return null}}}tt.TWITTER_SIGN_IN_METHOD="twitter.com";tt.PROVIDER_ID="twitter.com";async function qf(n,e){return bt(n,"POST","/v1/accounts:signUp",ie(n,e))}class Ke{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const s=await Tn._fromIdTokenResponse(e,r,i),o=dh(r);return new Ke({user:s,providerId:o,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=dh(r);return new Ke({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function dh(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}async function LI(n){var e;const t=te(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Ke({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await qf(t,{returnSecureToken:!0}),i=await Ke._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(i.user),i}class co extends Ne{constructor(e,t,r,i){var s;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,co.prototype),this.customData={appName:e.name,tenantId:(s=e.tenantId)!==null&&s!==void 0?s:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new co(e,t,r,i)}}function $f(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(s=>{throw s.code==="auth/multi-factor-auth-required"?co._fromErrorAndOperation(n,s,e,r):s})}function jf(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}async function MI(n,e){const t=P(n);await Uo(!0,t,e);const{providerUserInfo:r}=await qv(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),i=jf(r||[]);return t.providerData=t.providerData.filter(s=>i.has(s.providerId)),i.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function cu(n,e,t=!1){const r=await Tt(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ke._forOperation(n,"link",r)}async function Uo(n,e,t){await Si(e);const r=jf(e.providerData),i=n===!1?"provider-already-linked":"no-such-provider";y(r.has(t)===n,e.auth,i)}async function zf(n,e,t=!1){const{auth:r}=n,i="reauthenticate";try{const s=await Tt(n,$f(r,i,e,n),t);y(s.idToken,r,"internal-error");const o=Lo(s.idToken);y(o,r,"internal-error");const{sub:a}=o;return y(n.uid===a,r,"user-mismatch"),Ke._forOperation(n,i,s)}catch(s){throw(s==null?void 0:s.code)==="auth/user-not-found"&&Ae(r,"user-mismatch"),s}}async function Wf(n,e,t=!1){const r="signIn",i=await $f(n,r,e),s=await Ke._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(s.user),s}async function Bo(n,e){return Wf(te(n),e)}async function Gf(n,e){const t=P(n);return await Uo(!1,t,e.providerId),cu(t,e)}async function Kf(n,e){return zf(P(n),e)}async function FI(n,e){return bt(n,"POST","/v1/accounts:signInWithCustomToken",ie(n,e))}async function UI(n,e){const t=te(n),r=await FI(t,{token:e,returnSecureToken:!0}),i=await Ke._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(i.user),i}class ss{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?uu._fromServerResponse(e,t):"totpInfo"in t?lu._fromServerResponse(e,t):Ae(e,"internal-error")}}class uu extends ss{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new uu(t)}}class lu extends ss{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new lu(t)}}function qo(n,e,t){var r;y(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),y(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(y(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(y(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}async function hu(n){const e=te(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function BI(n,e,t){const r=te(n),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&qo(r,i,t),await Ci(r,i,"getOobCode",wI)}async function qI(n,e,t){await Bf(P(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&hu(n),r})}async function $I(n,e){await yI(P(n),{oobCode:e})}async function Hf(n,e){const t=P(n),r=await Bf(t,{oobCode:e}),i=r.requestType;switch(y(i,t,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":y(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":y(r.mfaInfo,t,"internal-error");default:y(r.email,t,"internal-error")}let s=null;return r.mfaInfo&&(s=ss._fromServerResponse(te(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:s},operation:i}}async function jI(n,e){const{data:t}=await Hf(P(n),e);return t.email}async function zI(n,e,t){const r=te(n),o=await Ci(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",qf).catch(c=>{throw c.code==="auth/password-does-not-meet-requirements"&&hu(n),c}),a=await Ke._fromIdTokenResponse(r,"signIn",o);return await r._updateCurrentUser(a.user),a}function WI(n,e,t){return Bo(P(n),nn.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&hu(n),r})}async function GI(n,e,t){const r=te(n),i={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function s(o,a){y(a.handleCodeInApp,r,"argument-error"),a&&qo(r,o,a)}s(i,t),await Ci(r,i,"getOobCode",EI)}function KI(n,e){const t=Fo.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function HI(n,e,t){const r=P(n),i=nn.credentialWithLink(e,t||bi());return y(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Bo(r,i)}async function QI(n,e){return se(n,"POST","/v1/accounts:createAuthUri",ie(n,e))}async function YI(n,e){const t=iu()?bi():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:i}=await QI(P(n),r);return i||[]}async function JI(n,e){const t=P(n),i={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&qo(t.auth,i,e);const{email:s}=await II(t.auth,i);s!==n.email&&await n.reload()}async function XI(n,e,t){const r=P(n),s={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&qo(r.auth,s,t);const{email:o}=await TI(r.auth,s);o!==n.email&&await n.reload()}async function ZI(n,e){return se(n,"POST","/v1/accounts:update",e)}async function ew(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=P(n),s={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Tt(r,ZI(r.auth,s));r.displayName=o.displayName||null,r.photoURL=o.photoUrl||null;const a=r.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=r.displayName,a.photoURL=r.photoURL),await r._updateTokensIfNecessary(o)}function tw(n,e){return Qf(P(n),e,null)}function nw(n,e){return Qf(P(n),null,e)}async function Qf(n,e,t){const{auth:r}=n,s={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(s.email=e),t&&(s.password=t);const o=await Tt(n,gI(r,s));await n._updateTokensIfNecessary(o,!0)}function rw(n){var e,t;if(!n)return null;const{providerId:r}=n,i=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},s=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const o=(t=(e=Lo(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new ur(s,a)}}if(!r)return null;switch(r){case"facebook.com":return new iw(s,i);case"github.com":return new sw(s,i);case"google.com":return new ow(s,i);case"twitter.com":return new aw(s,i,n.screenName||null);case"custom":case"anonymous":return new ur(s,null);default:return new ur(s,r,i)}}class ur{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class Yf extends ur{constructor(e,t,r,i){super(e,t,r),this.username=i}}class iw extends ur{constructor(e,t){super(e,"facebook.com",t)}}class sw extends Yf{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class ow extends ur{constructor(e,t){super(e,"google.com",t)}}class aw extends Yf{constructor(e,t,r){super(e,"twitter.com",t,r)}}function cw(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:rw(t)}class yn{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new yn("enroll",e,t)}static _fromMfaPendingCredential(e){return new yn("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return yn._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return yn._fromIdtoken(e.multiFactorSession.idToken)}return null}}class du{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=te(e),i=t.customData._serverResponse,s=(i.mfaInfo||[]).map(a=>ss._fromServerResponse(r,a));y(i.mfaPendingCredential,r,"internal-error");const o=yn._fromMfaPendingCredential(i.mfaPendingCredential);return new du(o,s,async a=>{const c=await a._process(r,o);delete i.mfaInfo,delete i.mfaPendingCredential;const u=Object.assign(Object.assign({},i),{idToken:c.idToken,refreshToken:c.refreshToken});switch(t.operationType){case"signIn":const l=await Ke._fromIdTokenResponse(r,t.operationType,u);return await r._updateCurrentUser(l.user),l;case"reauthenticate":return y(t.user,r,"internal-error"),Ke._forOperation(t.user,t.operationType,u);default:Ae(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function uw(n,e){var t;const r=P(n),i=e;return y(e.customData.operationType,r,"argument-error"),y((t=i.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),du._fromError(r,i)}function lw(n,e){return se(n,"POST","/v2/accounts/mfaEnrollment:start",ie(n,e))}function hw(n,e){return se(n,"POST","/v2/accounts/mfaEnrollment:finalize",ie(n,e))}function dw(n,e){return se(n,"POST","/v2/accounts/mfaEnrollment:withdraw",ie(n,e))}class fu{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>ss._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new fu(e)}async getSession(){return yn._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,i=await this.getSession(),s=await Tt(this.user,r._process(this.user.auth,i,t));return await this.user._updateTokensIfNecessary(s),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const i=await Tt(this.user,dw(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:s})=>s!==t),await this.user._updateTokensIfNecessary(i),await this.user.reload()}catch(i){throw i}}}const Fa=new WeakMap;function fw(n){const e=P(n);return Fa.has(e)||Fa.set(e,fu._fromUser(e)),Fa.get(e)}const uo="__sak";class Jf{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(uo,"1"),this.storage.removeItem(uo),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}function pw(){const n=Z();return ou(n)||Vr(n)}const mw=1e3,gw=10;class Xf extends Jf{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=pw()&&tI(),this.fallbackToPolling=Lf(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const r=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(r);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(r,e.newValue):this.storage.removeItem(r);else if(this.localCache[r]===e.newValue&&!t)return}const i=()=>{const o=this.storage.getItem(r);!t&&this.localCache[r]===o||this.notifyListeners(r,o)},s=this.storage.getItem(r);eI()&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,gw):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},mw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Xf.type="LOCAL";const pu=Xf;class Zf extends Jf{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Zf.type="SESSION";const Pn=Zf;function _w(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}class $o{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new $o(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:s}=t.data,o=this.handlersMap[i];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const a=Array.from(o).map(async u=>u(t.origin,s)),c=await _w(a);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}$o.receivers=[];function os(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}class yw{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,o;return new Promise((a,c)=>{const u=os("",20);i.port1.start();const l=setTimeout(()=>{c(new Error("unsupported_event"))},r);o={messageChannel:i,onMessage(h){const d=h;if(d.data.eventId===u)switch(d.data.status){case"ack":clearTimeout(l),s=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(s),a(d.data.response);break;default:clearTimeout(l),clearTimeout(s),c(new Error("invalid_response"));break}}},this.handlers.add(o),i.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:u,data:t},[i.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function ue(){return window}function vw(n){ue().location.href=n}function mu(){return typeof ue().WorkerGlobalScope<"u"&&typeof ue().importScripts=="function"}async function Iw(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function ww(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Ew(){return mu()?self:null}const ep="firebaseLocalStorageDb",Tw=1,lo="firebaseLocalStorage",tp="fbase_key";class as{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function jo(n,e){return n.transaction([lo],e?"readwrite":"readonly").objectStore(lo)}function Aw(){const n=indexedDB.deleteDatabase(ep);return new as(n).toPromise()}function oc(){const n=indexedDB.open(ep,Tw);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(lo,{keyPath:tp})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(lo)?e(r):(r.close(),await Aw(),e(await oc()))})})}async function fh(n,e,t){const r=jo(n,!0).put({[tp]:e,value:t});return new as(r).toPromise()}async function Rw(n,e){const t=jo(n,!1).get(e),r=await new as(t).toPromise();return r===void 0?null:r.value}function ph(n,e){const t=jo(n,!0).delete(e);return new as(t).toPromise()}const bw=800,Sw=3;class np{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await oc(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>Sw)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return mu()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=$o._getInstance(Ew()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Iw(),!this.activeServiceWorker)return;this.sender=new yw(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||ww()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await oc();return await fh(e,uo,"1"),await ph(e,uo),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>fh(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Rw(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>ph(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const s=jo(i,!1).getAll();return new as(s).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:s}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),bw)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}np.type="LOCAL";const Di=np;function Pw(n,e){return se(n,"POST","/v2/accounts/mfaSignIn:start",ie(n,e))}function Cw(n,e){return se(n,"POST","/v2/accounts/mfaSignIn:finalize",ie(n,e))}const kw=500,Dw=6e4,Vs=1e12;class Vw{constructor(e){this.auth=e,this.counter=Vs,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new Nw(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Vs;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Vs;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Vs;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class Nw{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const i=typeof e=="string"?document.getElementById(e):e;y(i,"argument-error",{appName:t}),this.container=i,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=xw(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},Dw)},kw))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function xw(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const Ua=Ff("rcb"),Ow=new rs(3e4,6e4),Lw="https://www.google.com/recaptcha/api.js?";class Mw{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=ue().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return y(Fw(t),e,"argument-error"),this.shouldResolveImmediately(t)&&sh(ue().grecaptcha)?Promise.resolve(ue().grecaptcha):new Promise((r,i)=>{const s=ue().setTimeout(()=>{i(Ee(e,"network-request-failed"))},Ow.get());ue()[Ua]=()=>{ue().clearTimeout(s),delete ue()[Ua];const a=ue().grecaptcha;if(!a||!sh(a)){i(Ee(e,"internal-error"));return}const c=a.render;a.render=(u,l)=>{const h=c(u,l);return this.counter++,h},this.hostLanguage=t,r(a)};const o=`${Lw}?${kr({onload:Ua,render:"explicit",hl:t})}`;au(o).catch(()=>{clearTimeout(s),i(Ee(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=ue().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function Fw(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class Uw{async load(e){return new Vw(e)}clearedOneInstance(){}}const rp="recaptcha",Bw={theme:"light",type:"image"};let qw=class{constructor(e,t,r=Object.assign({},Bw)){this.parameters=r,this.type=rp,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=te(e),this.isInvisible=this.parameters.size==="invisible",y(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const i=typeof t=="string"?document.getElementById(t):t;y(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Uw:new Mw,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(i=>{const s=o=>{o&&(this.tokenChangeListeners.delete(s),i(o))};this.tokenChangeListeners.add(s),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){y(!this.parameters.sitekey,this.auth,"argument-error"),y(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),y(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=ue()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){y(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){y(iu()&&!mu(),this.auth,"internal-error"),await $w(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await Fv(this.auth);y(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return y(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function $w(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}class gu{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Rn._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function jw(n,e,t){const r=te(n),i=await zo(r,e,P(t));return new gu(i,s=>Bo(r,s))}async function zw(n,e,t){const r=P(n);await Uo(!1,r,"phone");const i=await zo(r.auth,e,P(t));return new gu(i,s=>Gf(r,s))}async function Ww(n,e,t){const r=P(n),i=await zo(r.auth,e,P(t));return new gu(i,s=>Kf(r,s))}async function zo(n,e,t){var r;const i=await t.verify();try{y(typeof i=="string",n,"argument-error"),y(t.type===rp,n,"argument-error");let s;if(typeof e=="string"?s={phoneNumber:e}:s=e,"session"in s){const o=s.session;if("phoneNumber"in s)return y(o.type==="enroll",n,"internal-error"),(await lw(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,recaptchaToken:i}})).phoneSessionInfo.sessionInfo;{y(o.type==="signin",n,"internal-error");const a=((r=s.multiFactorHint)===null||r===void 0?void 0:r.uid)||s.multiFactorUid;return y(a,n,"missing-multi-factor-info"),(await Pw(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:i}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await SI(n,{phoneNumber:s.phoneNumber,recaptchaToken:i});return o}}finally{t._reset()}}async function Gw(n,e){await cu(P(n),e)}let ut=class{constructor(e){this.providerId=ut.PROVIDER_ID,this.auth=te(e)}verifyPhoneNumber(e,t){return zo(this.auth,e,P(t))}static credential(e,t){return Rn._fromVerification(e,t)}static credentialFromResult(e){const t=e;return ut.credentialFromTaggedObject(t)}static credentialFromError(e){return ut.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Rn._fromTokenResponse(t,r):null}};ut.PROVIDER_ID="phone";ut.PHONE_SIGN_IN_METHOD="phone";function qn(n,e){return e?$e(e):(y(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class _u extends Nr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return wt(e,this._buildIdpRequest())}_linkToIdToken(e,t){return wt(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return wt(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Kw(n){return Wf(n.auth,new _u(n),n.bypassAuthState)}function Hw(n){const{auth:e,user:t}=n;return y(t,e,"internal-error"),zf(t,new _u(n),n.bypassAuthState)}async function Qw(n){const{auth:e,user:t}=n;return y(t,e,"internal-error"),cu(t,new _u(n),n.bypassAuthState)}class ip{constructor(e,t,r,i,s=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:s,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:r,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(u){this.reject(u)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Kw;case"linkViaPopup":case"linkViaRedirect":return Qw;case"reauthViaPopup":case"reauthViaRedirect":return Hw;default:Ae(this.auth,"internal-error")}}resolve(e){Qe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qe(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Yw=new rs(2e3,1e4);async function Jw(n,e,t){const r=te(n);Dr(n,e,St);const i=qn(r,t);return new _t(r,"signInViaPopup",e,i).executeNotNull()}async function Xw(n,e,t){const r=P(n);Dr(r.auth,e,St);const i=qn(r.auth,t);return new _t(r.auth,"reauthViaPopup",e,i,r).executeNotNull()}async function Zw(n,e,t){const r=P(n);Dr(r.auth,e,St);const i=qn(r.auth,t);return new _t(r.auth,"linkViaPopup",e,i,r).executeNotNull()}class _t extends ip{constructor(e,t,r,i,s){super(e,t,i,s),this.provider=r,this.authWindow=null,this.pollId=null,_t.currentPopupAction&&_t.currentPopupAction.cancel(),_t.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return y(e,this.auth,"internal-error"),e}async onExecution(){Qe(this.filter.length===1,"Popup operations only handle one event");const e=os();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(Ee(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(Ee(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,_t.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(Ee(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Yw.get())};e()}}_t.currentPopupAction=null;const eE="pendingRedirect",pi=new Map;class tE extends ip{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=pi.get(this.auth._key());if(!e){try{const r=await nE(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}pi.set(this.auth._key(),e)}return this.bypassAuthState||pi.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nE(n,e){const t=op(e),r=sp(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}async function yu(n,e){return sp(n)._set(op(e),"true")}function rE(){pi.clear()}function vu(n,e){pi.set(n._key(),e)}function sp(n){return $e(n._redirectPersistence)}function op(n){return An(eE,n.config.apiKey,n.name)}function iE(n,e,t){return sE(n,e,t)}async function sE(n,e,t){const r=te(n);Dr(n,e,St),await r._initializationPromise;const i=qn(r,t);return await yu(i,r),i._openRedirect(r,e,"signInViaRedirect")}function oE(n,e,t){return aE(n,e,t)}async function aE(n,e,t){const r=P(n);Dr(r.auth,e,St),await r.auth._initializationPromise;const i=qn(r.auth,t);await yu(i,r.auth);const s=await ap(r);return i._openRedirect(r.auth,e,"reauthViaRedirect",s)}function cE(n,e,t){return uE(n,e,t)}async function uE(n,e,t){const r=P(n);Dr(r.auth,e,St),await r.auth._initializationPromise;const i=qn(r.auth,t);await Uo(!1,r,e.providerId),await yu(i,r.auth);const s=await ap(r);return i._openRedirect(r.auth,e,"linkViaRedirect",s)}async function lE(n,e){return await te(n)._initializationPromise,Wo(n,e,!1)}async function Wo(n,e,t=!1){const r=te(n),i=qn(r,e),o=await new tE(r,i,t).execute();return o&&!t&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,e)),o}async function ap(n){const e=os(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}const hE=10*60*1e3;class cp{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!dE(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!up(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(Ee(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=hE&&this.cachedEventUids.clear(),this.cachedEventUids.has(mh(e))}saveEventToCache(e){this.cachedEventUids.add(mh(e)),this.lastProcessedEventTime=Date.now()}}function mh(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function up({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function dE(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return up(n);default:return!1}}async function lp(n,e={}){return se(n,"GET","/v1/projects",e)}const fE=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,pE=/^https?/;async function mE(n){if(n.config.emulator)return;const{authorizedDomains:e}=await lp(n);for(const t of e)try{if(gE(t))return}catch{}Ae(n,"unauthorized-domain")}function gE(n){const e=bi(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===r}if(!pE.test(t))return!1;if(fE.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}const _E=new rs(3e4,6e4);function gh(){const n=ue().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function yE(n){return new Promise((e,t)=>{var r,i,s;function o(){gh(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{gh(),t(Ee(n,"network-request-failed"))},timeout:_E.get()})}if(!((i=(r=ue().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((s=ue().gapi)===null||s===void 0)&&s.load)o();else{const a=Ff("iframefcb");return ue()[a]=()=>{gapi.load?o():t(Ee(n,"network-request-failed"))},au(`https://apis.google.com/js/api.js?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw Ws=null,e})}let Ws=null;function vE(n){return Ws=Ws||yE(n),Ws}const IE=new rs(5e3,15e3),wE="__/auth/iframe",EE="emulator/auth/iframe",TE={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},AE=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function RE(n){const e=n.config;y(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?su(e,EE):`https://${n.config.authDomain}/${wE}`,r={apiKey:e.apiKey,appName:n.name,v:tn},i=AE.get(n.config.apiHost);i&&(r.eid=i);const s=n._getFrameworks();return s.length&&(r.fw=s.join(",")),`${t}?${kr(r).slice(1)}`}async function bE(n){const e=await vE(n),t=ue().gapi;return y(t,n,"internal-error"),e.open({where:document.body,url:RE(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:TE,dontclear:!0},r=>new Promise(async(i,s)=>{await r.restyle({setHideOnLeave:!1});const o=Ee(n,"network-request-failed"),a=ue().setTimeout(()=>{s(o)},IE.get());function c(){ue().clearTimeout(a),i(r)}r.ping(c).then(c,()=>{s(o)})}))}const SE={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},PE=500,CE=600,kE="_blank",DE="http://localhost";class _h{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function VE(n,e,t,r=PE,i=CE){const s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString();let a="";const c=Object.assign(Object.assign({},SE),{width:r.toString(),height:i.toString(),top:s,left:o}),u=Z().toLowerCase();t&&(a=Vf(u)?kE:t),Df(u)&&(e=e||DE,c.scrollbars="yes");const l=Object.entries(c).reduce((d,[f,w])=>`${d}${f}=${w},`,"");if(Zv(u)&&a!=="_self")return NE(e||"",a),new _h(null);const h=window.open(e||"",a,l);y(h,n,"popup-blocked");try{h.focus()}catch{}return new _h(h)}function NE(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}const xE="__/auth/handler",OE="emulator/auth/handler",LE=encodeURIComponent("fac");async function ac(n,e,t,r,i,s){y(n.config.authDomain,n,"auth-domain-config-required"),y(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:tn,eventId:i};if(e instanceof St){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",sy(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[l,h]of Object.entries(s||{}))o[l]=h}if(e instanceof xr){const l=e.getScopes().filter(h=>h!=="");l.length>0&&(o.scopes=l.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const l of Object.keys(a))a[l]===void 0&&delete a[l];const c=await n._getAppCheckToken(),u=c?`#${LE}=${encodeURIComponent(c)}`:"";return`${ME(n)}?${kr(a).slice(1)}${u}`}function ME({config:n}){return n.emulator?su(n,OE):`https://${n.authDomain}/${xE}`}const Ba="webStorageSupport";class FE{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Pn,this._completeRedirectFn=Wo,this._overrideRedirectResult=vu}async _openPopup(e,t,r,i){var s;Qe((s=this.eventManagers[e._key()])===null||s===void 0?void 0:s.manager,"_initialize() not called before _openPopup()");const o=await ac(e,t,r,bi(),i);return VE(e,o,os())}async _openRedirect(e,t,r,i){await this._originValidation(e);const s=await ac(e,t,r,bi(),i);return vw(s),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:s}=this.eventManagers[t];return i?Promise.resolve(i):(Qe(s,"If manager is not set, promise should be"),s)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await bE(e),r=new cp(e);return t.register("authEvent",i=>(y(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Ba,{type:Ba},i=>{var s;const o=(s=i==null?void 0:i[0])===null||s===void 0?void 0:s[Ba];o!==void 0&&t(!!o),Ae(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=mE(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return Lf()||ou()||Vr()}}const UE=FE;class BE{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return rt("unexpected MultiFactorSessionType")}}}class Iu extends BE{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Iu(e)}_finalizeEnroll(e,t,r){return hw(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return Cw(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class hp{constructor(){}static assertion(e){return Iu._fromCredential(e)}}hp.FACTOR_ID="phone";var yh="@firebase/auth",vh="1.5.1";class qE{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){y(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function $E(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function jE(n){zt(new dt("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=r.options;y(o&&!o.includes(":"),"invalid-api-key",{appName:r.name});const c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Mf(n)},u=new oI(r,i,s,c);return dI(u,t),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),zt(new dt("auth-internal",e=>{const t=te(e.getProvider("auth").getImmediate());return(r=>new qE(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ct(yh,vh,$E(n)),ct(yh,vh,"esm2017")}const zE=5*60;Q_("authIdTokenMaxAge");jE("Browser");function Cn(){return window}const WE=2e3;async function GE(n,e,t){var r;const{BuildInfo:i}=Cn();Qe(e.sessionId,"AuthEvent did not contain a session ID");const s=await JE(e.sessionId),o={};return Vr()?o.ibi=i.packageName:is()?o.apn=i.packageName:Ae(n,"operation-not-supported-in-this-environment"),i.displayName&&(o.appDisplayName=i.displayName),o.sessionId=s,ac(n,t,e.type,void 0,(r=e.eventId)!==null&&r!==void 0?r:void 0,o)}async function KE(n){const{BuildInfo:e}=Cn(),t={};Vr()?t.iosBundleId=e.packageName:is()?t.androidPackageName=e.packageName:Ae(n,"operation-not-supported-in-this-environment"),await lp(n,t)}function HE(n){const{cordova:e}=Cn();return new Promise(t=>{e.plugins.browsertab.isAvailable(r=>{let i=null;r?e.plugins.browsertab.openUrl(n):i=e.InAppBrowser.open(n,Xv()?"_blank":"_system","location=yes"),t(i)})})}async function QE(n,e,t){const{cordova:r}=Cn();let i=()=>{};try{await new Promise((s,o)=>{let a=null;function c(){var h;s();const d=(h=r.plugins.browsertab)===null||h===void 0?void 0:h.close;typeof d=="function"&&d(),typeof(t==null?void 0:t.close)=="function"&&t.close()}function u(){a||(a=window.setTimeout(()=>{o(Ee(n,"redirect-cancelled-by-user"))},WE))}function l(){(document==null?void 0:document.visibilityState)==="visible"&&u()}e.addPassiveListener(c),document.addEventListener("resume",u,!1),is()&&document.addEventListener("visibilitychange",l,!1),i=()=>{e.removePassiveListener(c),document.removeEventListener("resume",u,!1),document.removeEventListener("visibilitychange",l,!1),a&&window.clearTimeout(a)}})}finally{i()}}function YE(n){var e,t,r,i,s,o,a,c,u,l;const h=Cn();y(typeof((e=h==null?void 0:h.universalLinks)===null||e===void 0?void 0:e.subscribe)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),y(typeof((t=h==null?void 0:h.BuildInfo)===null||t===void 0?void 0:t.packageName)<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),y(typeof((s=(i=(r=h==null?void 0:h.cordova)===null||r===void 0?void 0:r.plugins)===null||i===void 0?void 0:i.browsertab)===null||s===void 0?void 0:s.openUrl)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),y(typeof((c=(a=(o=h==null?void 0:h.cordova)===null||o===void 0?void 0:o.plugins)===null||a===void 0?void 0:a.browsertab)===null||c===void 0?void 0:c.isAvailable)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),y(typeof((l=(u=h==null?void 0:h.cordova)===null||u===void 0?void 0:u.InAppBrowser)===null||l===void 0?void 0:l.open)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function JE(n){const e=XE(n),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")}function XE(n){if(Qe(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return new TextEncoder().encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}const ZE=20;class eT extends cp{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function tT(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:iT(),postBody:null,tenantId:n.tenantId,error:Ee(n,"no-auth-event")}}function nT(n,e){return cc()._set(uc(n),e)}async function Ih(n){const e=await cc()._get(uc(n));return e&&await cc()._remove(uc(n)),e}function rT(n,e){var t,r;const i=oT(e);if(i.includes("/__/auth/callback")){const s=Gs(i),o=s.firebaseError?sT(decodeURIComponent(s.firebaseError)):null,a=(r=(t=o==null?void 0:o.code)===null||t===void 0?void 0:t.split("auth/"))===null||r===void 0?void 0:r[1],c=a?Ee(a):null;return c?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:c,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:i,postBody:null}}return null}function iT(){const n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<ZE;t++){const r=Math.floor(Math.random()*e.length);n.push(e.charAt(r))}return n.join("")}function cc(){return $e(pu)}function uc(n){return An("authEvent",n.config.apiKey,n.name)}function sT(n){try{return JSON.parse(n)}catch{return null}}function oT(n){const e=Gs(n),t=e.link?decodeURIComponent(e.link):void 0,r=Gs(t).link,i=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return Gs(i).link||i||r||t||n}function Gs(n){if(!(n!=null&&n.includes("?")))return{};const[e,...t]=n.split("?");return sr(t.join("?"))}const aT=500;class cT{constructor(){this._redirectPersistence=Pn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Wo,this._overrideRedirectResult=vu}async _initialize(e){const t=e._key();let r=this.eventManagers.get(t);return r||(r=new eT(e),this.eventManagers.set(t,r),this.attachCallbackListeners(e,r)),r}_openPopup(e){Ae(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,r,i){YE(e);const s=await this._initialize(e);await s.initialized(),s.resetRedirect(),rE(),await this._originValidation(e);const o=tT(e,r,i);await nT(e,o);const a=await GE(e,o,t),c=await HE(a);return QE(e,s,c)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=KE(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:r,handleOpenURL:i,BuildInfo:s}=Cn(),o=setTimeout(async()=>{await Ih(e),t.onEvent(wh())},aT),a=async l=>{clearTimeout(o);const h=await Ih(e);let d=null;h&&(l!=null&&l.url)&&(d=rT(h,l.url)),t.onEvent(d||wh())};typeof r<"u"&&typeof r.subscribe=="function"&&r.subscribe(null,a);const c=i,u=`${s.packageName.toLowerCase()}://`;Cn().handleOpenURL=async l=>{if(l.toLowerCase().startsWith(u)&&a({url:l}),typeof c=="function")try{c(l)}catch(h){console.error(h)}}}}const uT=cT;function wh(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Ee("no-auth-event")}}function lT(n,e){te(n)._logFramework(e)}var hT="@firebase/auth-compat",dT="0.5.1";const fT=1e3;function mi(){var n;return((n=self==null?void 0:self.location)===null||n===void 0?void 0:n.protocol)||null}function pT(){return mi()==="http:"||mi()==="https:"}function dp(n=Z()){return!!((mi()==="file:"||mi()==="ionic:"||mi()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function mT(){return Xc()||Jc()}function gT(){return lf()&&(document==null?void 0:document.documentMode)===11}function _T(n=Z()){return/Edge\/\d+/.test(n)}function yT(n=Z()){return gT()||_T(n)}function fp(){try{const n=self.localStorage,e=os();if(n)return n.setItem(e,"1"),n.removeItem(e),yT()?Ti():!0}catch{return wu()&&Ti()}return!1}function wu(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function qa(){return(pT()||uf()||dp())&&!mT()&&fp()&&!wu()}function pp(){return dp()&&typeof document<"u"}async function vT(){return pp()?new Promise(n=>{const e=setTimeout(()=>{n(!1)},fT);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1}function IT(){return typeof window<"u"?window:null}const qe={LOCAL:"local",NONE:"none",SESSION:"session"},Hr=y,mp="persistence";function wT(n,e){if(Hr(Object.values(qe).includes(e),n,"invalid-persistence-type"),Xc()){Hr(e!==qe.SESSION,n,"unsupported-persistence-type");return}if(Jc()){Hr(e===qe.NONE,n,"unsupported-persistence-type");return}if(wu()){Hr(e===qe.NONE||e===qe.LOCAL&&Ti(),n,"unsupported-persistence-type");return}Hr(e===qe.NONE||fp(),n,"unsupported-persistence-type")}async function lc(n){await n._initializationPromise;const e=gp(),t=An(mp,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistence())}function ET(n,e){const t=gp();if(!t)return[];const r=An(mp,n,e);switch(t.getItem(r)){case qe.NONE:return[mr];case qe.LOCAL:return[Di,Pn];case qe.SESSION:return[Pn];default:return[]}}function gp(){var n;try{return((n=IT())===null||n===void 0?void 0:n.sessionStorage)||null}catch{return null}}const TT=y;class Ft{constructor(){this.browserResolver=$e(UE),this.cordovaResolver=$e(uT),this.underlyingResolver=null,this._redirectPersistence=Pn,this._completeRedirectFn=Wo,this._overrideRedirectResult=vu}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,r,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,r,i)}async _openRedirect(e,t,r,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,r,i)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return pp()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return TT(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await vT();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}function _p(n){return n.unwrap()}function AT(n){return n.wrapped()}function RT(n){return yp(n)}function bT(n,e){var t;const r=(t=e.customData)===null||t===void 0?void 0:t._tokenResponse;if((e==null?void 0:e.code)==="auth/multi-factor-auth-required"){const i=e;i.resolver=new ST(n,uw(n,e))}else if(r){const i=yp(e),s=e;i&&(s.credential=i,s.tenantId=r.tenantId||void 0,s.email=r.email||void 0,s.phoneNumber=r.phoneNumber||void 0)}}function yp(n){const{_tokenResponse:e}=n instanceof Ne?n.customData:n;if(!e)return null;if(!(n instanceof Ne)&&"temporaryProof"in e&&"phoneNumber"in e)return ut.credentialFromResult(n);const t=e.providerId;if(!t||t===Kr.PASSWORD)return null;let r;switch(t){case Kr.GOOGLE:r=Ze;break;case Kr.FACEBOOK:r=Xe;break;case Kr.GITHUB:r=et;break;case Kr.TWITTER:r=tt;break;default:const{oauthIdToken:i,oauthAccessToken:s,oauthTokenSecret:o,pendingToken:a,nonce:c}=e;return!s&&!o&&!i&&!a?null:a?t.startsWith("saml.")?gr._create(t,a):ft._fromParams({providerId:t,signInMethod:t,pendingToken:a,idToken:i,accessToken:s}):new cr(t).credential({idToken:i,accessToken:s,rawNonce:c})}return n instanceof Ne?r.credentialFromError(n):r.credentialFromResult(n)}function Le(n,e){return e.catch(t=>{throw t instanceof Ne&&bT(n,t),t}).then(t=>{const r=t.operationType,i=t.user;return{operationType:r,credential:RT(t),additionalUserInfo:cw(t),user:Ut.getOrCreate(i)}})}async function hc(n,e){const t=await e;return{verificationId:t.verificationId,confirm:r=>Le(n,t.confirm(r))}}class ST{constructor(e,t){this.resolver=t,this.auth=AT(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Le(_p(this.auth),this.resolver.resolveSignIn(e))}}let Ut=class{constructor(e){this._delegate=e,this.multiFactor=fw(e)}static getOrCreate(e){return Ut.USER_MAP.has(e)||Ut.USER_MAP.set(e,new Ut(e)),Ut.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Le(this.auth,Gf(this._delegate,e))}async linkWithPhoneNumber(e,t){return hc(this.auth,zw(this._delegate,e,t))}async linkWithPopup(e){return Le(this.auth,Zw(this._delegate,e,Ft))}async linkWithRedirect(e){return await lc(te(this.auth)),cE(this._delegate,e,Ft)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Le(this.auth,Kf(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return hc(this.auth,Ww(this._delegate,e,t))}reauthenticateWithPopup(e){return Le(this.auth,Xw(this._delegate,e,Ft))}async reauthenticateWithRedirect(e){return await lc(te(this.auth)),oE(this._delegate,e,Ft)}sendEmailVerification(e){return JI(this._delegate,e)}async unlink(e){return await MI(this._delegate,e),this}updateEmail(e){return tw(this._delegate,e)}updatePassword(e){return nw(this._delegate,e)}updatePhoneNumber(e){return Gw(this._delegate,e)}updateProfile(e){return ew(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return XI(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}};Ut.USER_MAP=new WeakMap;const Qr=y;class dc{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:r}=e.options;Qr(r,"invalid-api-key",{appName:e.name}),Qr(r,"invalid-api-key",{appName:e.name});const i=typeof window<"u"?Ft:void 0;this._delegate=t.initialize({options:{persistence:PT(r,e.name),popupRedirectResolver:i}}),this._delegate._updateErrorMap(Pv),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Ut.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){fI(this._delegate,e,t)}applyActionCode(e){return $I(this._delegate,e)}checkActionCode(e){return Hf(this._delegate,e)}confirmPasswordReset(e,t){return qI(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Le(this._delegate,zI(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return YI(this._delegate,e)}isSignInWithEmailLink(e){return KI(this._delegate,e)}async getRedirectResult(){Qr(qa(),this._delegate,"operation-not-supported-in-this-environment");const e=await lE(this._delegate,Ft);return e?Le(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){lT(this._delegate,e)}onAuthStateChanged(e,t,r){const{next:i,error:s,complete:o}=Eh(e,t,r);return this._delegate.onAuthStateChanged(i,s,o)}onIdTokenChanged(e,t,r){const{next:i,error:s,complete:o}=Eh(e,t,r);return this._delegate.onIdTokenChanged(i,s,o)}sendSignInLinkToEmail(e,t){return GI(this._delegate,e,t)}sendPasswordResetEmail(e,t){return BI(this._delegate,e,t||void 0)}async setPersistence(e){wT(this._delegate,e);let t;switch(e){case qe.SESSION:t=Pn;break;case qe.LOCAL:t=await $e(Di)._isAvailable()?Di:pu;break;case qe.NONE:t=mr;break;default:return Ae("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Le(this._delegate,LI(this._delegate))}signInWithCredential(e){return Le(this._delegate,Bo(this._delegate,e))}signInWithCustomToken(e){return Le(this._delegate,UI(this._delegate,e))}signInWithEmailAndPassword(e,t){return Le(this._delegate,WI(this._delegate,e,t))}signInWithEmailLink(e,t){return Le(this._delegate,HI(this._delegate,e,t))}signInWithPhoneNumber(e,t){return hc(this._delegate,jw(this._delegate,e,t))}async signInWithPopup(e){return Qr(qa(),this._delegate,"operation-not-supported-in-this-environment"),Le(this._delegate,Jw(this._delegate,e,Ft))}async signInWithRedirect(e){return Qr(qa(),this._delegate,"operation-not-supported-in-this-environment"),await lc(this._delegate),iE(this._delegate,e,Ft)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return jI(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}dc.Persistence=qe;function Eh(n,e,t){let r=n;typeof n!="function"&&({next:r,error:e,complete:t}=n);const i=r;return{next:o=>i(o&&Ut.getOrCreate(o)),error:e,complete:t}}function PT(n,e){const t=ET(n,e);if(typeof self<"u"&&!t.includes(Di)&&t.push(Di),typeof window<"u")for(const r of[pu,Pn])t.includes(r)||t.push(r);return t.includes(mr)||t.push(mr),t}class Eu{constructor(){this.providerId="phone",this._delegate=new ut(_p(Wt.auth()))}static credential(e,t){return ut.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Eu.PHONE_SIGN_IN_METHOD=ut.PHONE_SIGN_IN_METHOD;Eu.PROVIDER_ID=ut.PROVIDER_ID;const CT=y;class kT{constructor(e,t,r=Wt.app()){var i;CT((i=r.options)===null||i===void 0?void 0:i.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new qw(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}const DT="auth-compat";function VT(n){n.INTERNAL.registerComponent(new dt(DT,e=>{const t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("auth");return new dc(t,r)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Hn.EMAIL_SIGNIN,PASSWORD_RESET:Hn.PASSWORD_RESET,RECOVER_EMAIL:Hn.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Hn.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Hn.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Hn.VERIFY_EMAIL}},EmailAuthProvider:nn,FacebookAuthProvider:Xe,GithubAuthProvider:et,GoogleAuthProvider:Ze,OAuthProvider:cr,SAMLAuthProvider:ao,PhoneAuthProvider:Eu,PhoneMultiFactorGenerator:hp,RecaptchaVerifier:kT,TwitterAuthProvider:tt,Auth:dc,AuthCredential:Nr,Error:Ne}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(hT,dT)}VT(Wt);var NT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},A,Tu=Tu||{},C=NT||self;function Go(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function cs(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function xT(n){return Object.prototype.hasOwnProperty.call(n,$a)&&n[$a]||(n[$a]=++OT)}var $a="closure_uid_"+(1e9*Math.random()>>>0),OT=0;function LT(n,e,t){return n.call.apply(n.bind,arguments)}function MT(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Se(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Se=LT:Se=MT,Se.apply(null,arguments)}function Ns(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function ge(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function rn(){this.s=this.s,this.o=this.o}var FT=0;rn.prototype.s=!1;rn.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),FT!=0)&&xT(this)};rn.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const vp=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Au(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Th(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(Go(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function Pe(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Pe.prototype.h=function(){this.defaultPrevented=!0};var UT=function(){if(!C.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{const t=()=>{};C.addEventListener("test",t,e),C.removeEventListener("test",t,e)}catch{}return n}();function Vi(n){return/^[\s\xa0]*$/.test(n)}function Ko(){var n=C.navigator;return n&&(n=n.userAgent)?n:""}function nt(n){return Ko().indexOf(n)!=-1}function Ru(n){return Ru[" "](n),n}Ru[" "]=function(){};function BT(n,e){var t=VA;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var qT=nt("Opera"),_r=nt("Trident")||nt("MSIE"),Ip=nt("Edge"),fc=Ip||_r,wp=nt("Gecko")&&!(Ko().toLowerCase().indexOf("webkit")!=-1&&!nt("Edge"))&&!(nt("Trident")||nt("MSIE"))&&!nt("Edge"),$T=Ko().toLowerCase().indexOf("webkit")!=-1&&!nt("Edge");function Ep(){var n=C.document;return n?n.documentMode:void 0}var pc;e:{var ja="",za=function(){var n=Ko();if(wp)return/rv:([^\);]+)(\)|;)/.exec(n);if(Ip)return/Edge\/([\d\.]+)/.exec(n);if(_r)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if($T)return/WebKit\/(\S+)/.exec(n);if(qT)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(za&&(ja=za?za[1]:""),_r){var Wa=Ep();if(Wa!=null&&Wa>parseFloat(ja)){pc=String(Wa);break e}}pc=ja}var mc;if(C.document&&_r){var Ah=Ep();mc=Ah||parseInt(pc,10)||void 0}else mc=void 0;var jT=mc;function Ni(n,e){if(Pe.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(wp){e:{try{Ru(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:zT[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Ni.$.h.call(this)}}ge(Ni,Pe);var zT={2:"touch",3:"pen",4:"mouse"};Ni.prototype.h=function(){Ni.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var us="closure_listenable_"+(1e6*Math.random()|0),WT=0;function GT(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++WT,this.fa=this.ia=!1}function Ho(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function bu(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function KT(n,e){for(const t in n)e.call(void 0,n[t],t,n)}function Tp(n){const e={};for(const t in n)e[t]=n[t];return e}const Rh="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ap(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<Rh.length;s++)t=Rh[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Qo(n){this.src=n,this.g={},this.h=0}Qo.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=_c(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new GT(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function gc(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=vp(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Ho(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function _c(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var Su="closure_lm_"+(1e6*Math.random()|0),Ga={};function Rp(n,e,t,r,i){if(r&&r.once)return Sp(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Rp(n,e[s],t,r,i);return null}return t=ku(t),n&&n[us]?n.O(e,t,cs(r)?!!r.capture:!!r,i):bp(n,e,t,!1,r,i)}function bp(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=cs(i)?!!i.capture:!!i,a=Cu(n);if(a||(n[Su]=a=new Qo(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=HT(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)UT||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Cp(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function HT(){function n(t){return e.call(n.src,n.listener,t)}const e=QT;return n}function Sp(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Sp(n,e[s],t,r,i);return null}return t=ku(t),n&&n[us]?n.P(e,t,cs(r)?!!r.capture:!!r,i):bp(n,e,t,!0,r,i)}function Pp(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Pp(n,e[s],t,r,i);else r=cs(r)?!!r.capture:!!r,t=ku(t),n&&n[us]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=_c(s,t,r,i),-1<t&&(Ho(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=Cu(n))&&(e=n.g[e.toString()],n=-1,e&&(n=_c(e,t,r,i)),(t=-1<n?e[n]:null)&&Pu(t))}function Pu(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[us])gc(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Cp(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Cu(e))?(gc(t,n),t.h==0&&(t.src=null,e[Su]=null)):Ho(n)}}}function Cp(n){return n in Ga?Ga[n]:Ga[n]="on"+n}function QT(n,e){if(n.fa)n=!0;else{e=new Ni(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Pu(n),n=t.call(r,e)}return n}function Cu(n){return n=n[Su],n instanceof Qo?n:null}var Ka="__closure_events_fn_"+(1e9*Math.random()>>>0);function ku(n){return typeof n=="function"?n:(n[Ka]||(n[Ka]=function(e){return n.handleEvent(e)}),n[Ka])}function me(){rn.call(this),this.i=new Qo(this),this.S=this,this.J=null}ge(me,rn);me.prototype[us]=!0;me.prototype.removeEventListener=function(n,e,t,r){Pp(this,n,e,t,r)};function Te(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new Pe(e,n);else if(e instanceof Pe)e.target=e.target||n;else{var i=e;e=new Pe(r,n),Ap(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=xs(o,r,!0,e)&&i}if(o=e.g=n,i=xs(o,r,!0,e)&&i,i=xs(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=xs(o,r,!1,e)&&i}me.prototype.N=function(){if(me.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Ho(t[r]);delete n.g[e],n.h--}}this.J=null};me.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};me.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function xs(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,c=o.la||o.src;o.ia&&gc(n.i,o),i=a.call(c,r)!==!1&&i}}return i&&!r.defaultPrevented}var Du=C.JSON.stringify;class YT{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}function JT(){var n=Vu;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class XT{constructor(){this.h=this.g=null}add(e,t){const r=kp.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}}var kp=new YT(()=>new ZT,n=>n.reset());class ZT{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function eA(n){var e=1;n=n.split(":");const t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function tA(n){C.setTimeout(()=>{throw n},0)}let xi,Oi=!1,Vu=new XT,Dp=()=>{const n=C.Promise.resolve(void 0);xi=()=>{n.then(nA)}};var nA=()=>{for(var n;n=JT();){try{n.h.call(n.g)}catch(t){tA(t)}var e=kp;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Oi=!1};function Yo(n,e){me.call(this),this.h=n||1,this.g=e||C,this.j=Se(this.qb,this),this.l=Date.now()}ge(Yo,me);A=Yo.prototype;A.ga=!1;A.T=null;A.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Te(this,"tick"),this.ga&&(Nu(this),this.start()))}};A.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Nu(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}A.N=function(){Yo.$.N.call(this),Nu(this),delete this.g};function xu(n,e,t){if(typeof n=="function")t&&(n=Se(n,t));else if(n&&typeof n.handleEvent=="function")n=Se(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:C.setTimeout(n,e||0)}function Vp(n){n.g=xu(()=>{n.g=null,n.i&&(n.i=!1,Vp(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class rA extends rn{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:Vp(this)}N(){super.N(),this.g&&(C.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Li(n){rn.call(this),this.h=n,this.g={}}ge(Li,rn);var bh=[];function Np(n,e,t,r){Array.isArray(t)||(t&&(bh[0]=t.toString()),t=bh);for(var i=0;i<t.length;i++){var s=Rp(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function xp(n){bu(n.g,function(e,t){this.g.hasOwnProperty(t)&&Pu(e)},n),n.g={}}Li.prototype.N=function(){Li.$.N.call(this),xp(this)};Li.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Jo(){this.g=!0}Jo.prototype.Ea=function(){this.g=!1};function iA(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var l=u[0];u=u[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+u+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function sA(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function or(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+aA(n,t)+(r?" "+r:"")})}function oA(n,e){n.info(function(){return"TIMEOUT: "+e})}Jo.prototype.info=function(){};function aA(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return Du(t)}catch{return e}}var $n={},Sh=null;function Xo(){return Sh=Sh||new me}$n.Ta="serverreachability";function Op(n){Pe.call(this,$n.Ta,n)}ge(Op,Pe);function Mi(n){const e=Xo();Te(e,new Op(e))}$n.STAT_EVENT="statevent";function Lp(n,e){Pe.call(this,$n.STAT_EVENT,n),this.stat=e}ge(Lp,Pe);function Ve(n){const e=Xo();Te(e,new Lp(e,n))}$n.Ua="timingevent";function Mp(n,e){Pe.call(this,$n.Ua,n),this.size=e}ge(Mp,Pe);function ls(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return C.setTimeout(function(){n()},e)}var Zo={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},Fp={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Ou(){}Ou.prototype.h=null;function Ph(n){return n.h||(n.h=n.i())}function Up(){}var hs={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Lu(){Pe.call(this,"d")}ge(Lu,Pe);function Mu(){Pe.call(this,"c")}ge(Mu,Pe);var yc;function ea(){}ge(ea,Ou);ea.prototype.g=function(){return new XMLHttpRequest};ea.prototype.i=function(){return{}};yc=new ea;function ds(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Li(this),this.P=cA,n=fc?125:void 0,this.V=new Yo(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new Bp}function Bp(){this.i=null,this.g="",this.h=!1}var cA=45e3,qp={},vc={};A=ds.prototype;A.setTimeout=function(n){this.P=n};function Ic(n,e,t){n.L=1,n.A=na(At(e)),n.u=t,n.S=!0,$p(n,null)}function $p(n,e){n.G=Date.now(),fs(n),n.B=At(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),Yp(t.i,"t",r),n.o=0,t=n.l.J,n.h=new Bp,n.g=_m(n.l,t?e:null,!n.u),0<n.O&&(n.M=new rA(Se(n.Pa,n,n.g),n.O)),Np(n.U,n.g,"readystatechange",n.nb),e=n.I?Tp(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Mi(),iA(n.j,n.v,n.B,n.m,n.W,n.u)}A.nb=function(n){n=n.target;const e=this.M;e&&it(n)==3?e.l():this.Pa(n)};A.Pa=function(n){try{if(n==this.g)e:{const l=it(this.g);var e=this.g.Ia();const h=this.g.da();if(!(3>l)&&(l!=3||fc||this.g&&(this.h.h||this.g.ja()||Vh(this.g)))){this.J||l!=4||e==7||(e==8||0>=h?Mi(3):Mi(2)),ta(this);var t=this.g.da();this.ca=t;t:if(jp(this)){var r=Vh(this.g);n="";var i=r.length,s=it(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){vn(this),gi(this);var o="";break t}this.h.i=new C.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,sA(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Vi(a)){var u=a;break t}}u=null}if(t=u)or(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,wc(this,t);else{this.i=!1,this.s=3,Ve(12),vn(this),gi(this);break e}}this.S?(zp(this,l,o),fc&&this.i&&l==3&&(Np(this.U,this.V,"tick",this.mb),this.V.start())):(or(this.j,this.m,o,null),wc(this,o)),l==4&&vn(this),this.i&&!this.J&&(l==4?fm(this.l,this):(this.i=!1,fs(this)))}else CA(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Ve(12)):(this.s=0,Ve(13)),vn(this),gi(this)}}}catch{}finally{}};function jp(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function zp(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=uA(n,t),i==vc){e==4&&(n.s=4,Ve(14),r=!1),or(n.j,n.m,null,"[Incomplete Response]");break}else if(i==qp){n.s=4,Ve(15),or(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else or(n.j,n.m,i,null),wc(n,i);jp(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Ve(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),ju(e),e.M=!0,Ve(11))):(or(n.j,n.m,t,"[Invalid Chunked Response]"),vn(n),gi(n))}A.mb=function(){if(this.g){var n=it(this.g),e=this.g.ja();this.o<e.length&&(ta(this),zp(this,n,e),this.i&&n!=4&&fs(this))}};function uA(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?vc:(t=Number(e.substring(t,r)),isNaN(t)?qp:(r+=1,r+t>e.length?vc:(e=e.slice(r,r+t),n.o=r+t,e)))}A.cancel=function(){this.J=!0,vn(this)};function fs(n){n.Y=Date.now()+n.P,Wp(n,n.P)}function Wp(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=ls(Se(n.lb,n),e)}function ta(n){n.C&&(C.clearTimeout(n.C),n.C=null)}A.lb=function(){this.C=null;const n=Date.now();0<=n-this.Y?(oA(this.j,this.B),this.L!=2&&(Mi(),Ve(17)),vn(this),this.s=2,gi(this)):Wp(this,this.Y-n)};function gi(n){n.l.H==0||n.J||fm(n.l,n)}function vn(n){ta(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Nu(n.V),xp(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function wc(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Ec(t.i,n))){if(!n.K&&Ec(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)po(t),oa(t);else break e;$u(t),Ve(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=ls(Se(t.ib,t),6e3));if(1>=Zp(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else In(t,11)}else if((n.K||t.g==n)&&po(t),!Vi(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(t.V=u[0],u=u[1],t.H==2)if(u[0]=="c"){t.K=u[1],t.pa=u[2];const l=u[3];l!=null&&(t.ra=l,t.l.info("VER="+t.ra));const h=u[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));const d=u[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;const f=n.g;if(f){const w=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(w){var s=r.i;s.g||w.indexOf("spdy")==-1&&w.indexOf("quic")==-1&&w.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Fu(s,s.h),s.h=null))}if(r.F){const E=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;E&&(r.Da=E,G(r.I,r.F,E))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=gm(r,r.J?r.pa:null,r.Y),o.K){em(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(ta(a),fs(a)),r.g=o}else hm(r);0<t.j.length&&aa(t)}else u[0]!="stop"&&u[0]!="close"||In(t,7);else t.H==3&&(u[0]=="stop"||u[0]=="close"?u[0]=="stop"?In(t,7):qu(t):u[0]!="noop"&&t.h&&t.h.Aa(u),t.A=0)}}Mi(4)}catch{}}function lA(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Go(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function hA(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Go(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}function Gp(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Go(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=hA(n),r=lA(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var Kp=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function dA(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function bn(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof bn){this.h=n.h,ho(this,n.j),this.s=n.s,this.g=n.g,fo(this,n.m),this.l=n.l;var e=n.i,t=new Fi;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Ch(this,t),this.o=n.o}else n&&(e=String(n).match(Kp))?(this.h=!1,ho(this,e[1]||"",!0),this.s=ai(e[2]||""),this.g=ai(e[3]||"",!0),fo(this,e[4]),this.l=ai(e[5]||"",!0),Ch(this,e[6]||"",!0),this.o=ai(e[7]||"")):(this.h=!1,this.i=new Fi(null,this.h))}bn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(ci(e,kh,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(ci(e,kh,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(ci(t,t.charAt(0)=="/"?mA:pA,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",ci(t,_A)),n.join("")};function At(n){return new bn(n)}function ho(n,e,t){n.j=t?ai(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function fo(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Ch(n,e,t){e instanceof Fi?(n.i=e,yA(n.i,n.h)):(t||(e=ci(e,gA)),n.i=new Fi(e,n.h))}function G(n,e,t){n.i.set(e,t)}function na(n){return G(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function ai(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function ci(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,fA),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function fA(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var kh=/[#\/\?@]/g,pA=/[#\?:]/g,mA=/[#\?]/g,gA=/[#\?@]/g,_A=/#/g;function Fi(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function sn(n){n.g||(n.g=new Map,n.h=0,n.i&&dA(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}A=Fi.prototype;A.add=function(n,e){sn(this),this.i=null,n=Or(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function Hp(n,e){sn(n),e=Or(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Qp(n,e){return sn(n),e=Or(n,e),n.g.has(e)}A.forEach=function(n,e){sn(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};A.ta=function(){sn(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};A.Z=function(n){sn(this);let e=[];if(typeof n=="string")Qp(this,n)&&(e=e.concat(this.g.get(Or(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};A.set=function(n,e){return sn(this),this.i=null,n=Or(this,n),Qp(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};A.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function Yp(n,e,t){Hp(n,e),0<t.length&&(n.i=null,n.g.set(Or(n,e),Au(t)),n.h+=t.length)}A.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function Or(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function yA(n,e){e&&!n.j&&(sn(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(Hp(this,r),Yp(this,i,t))},n)),n.j=e}var vA=class{constructor(n,e){this.g=n,this.map=e}};function Jp(n){this.l=n||IA,C.PerformanceNavigationTiming?(n=C.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(C.g&&C.g.Ka&&C.g.Ka()&&C.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var IA=10;function Xp(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function Zp(n){return n.h?1:n.g?n.g.size:0}function Ec(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Fu(n,e){n.g?n.g.add(e):n.h=e}function em(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}Jp.prototype.cancel=function(){if(this.i=tm(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function tm(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const t of n.g.values())e=e.concat(t.F);return e}return Au(n.i)}var wA=class{stringify(n){return C.JSON.stringify(n,void 0)}parse(n){return C.JSON.parse(n,void 0)}};function EA(){this.g=new wA}function TA(n,e,t){const r=t||"";try{Gp(n,function(i,s){let o=i;cs(i)&&(o=Du(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function AA(n,e){const t=new Jo;if(C.Image){const r=new Image;r.onload=Ns(Os,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ns(Os,t,r,"TestLoadImage: error",!1,e),r.onabort=Ns(Os,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ns(Os,t,r,"TestLoadImage: timeout",!1,e),C.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function Os(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function ra(n){this.l=n.ec||null,this.j=n.ob||!1}ge(ra,Ou);ra.prototype.g=function(){return new ia(this.l,this.j)};ra.prototype.i=function(n){return function(){return n}}({});function ia(n,e){me.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Uu,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}ge(ia,me);var Uu=0;A=ia.prototype;A.open=function(n,e){if(this.readyState!=Uu)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Ui(this)};A.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||C).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};A.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ps(this)),this.readyState=Uu};A.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Ui(this)),this.g&&(this.readyState=3,Ui(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof C.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;nm(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function nm(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}A.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?ps(this):Ui(this),this.readyState==3&&nm(this)}};A.Za=function(n){this.g&&(this.response=this.responseText=n,ps(this))};A.Ya=function(n){this.g&&(this.response=n,ps(this))};A.ka=function(){this.g&&ps(this)};function ps(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Ui(n)}A.setRequestHeader=function(n,e){this.v.append(n,e)};A.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};A.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Ui(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(ia.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var RA=C.JSON.parse;function ne(n){me.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=rm,this.L=this.M=!1}ge(ne,me);var rm="",bA=/^https?$/i,SA=["POST","PUT"];A=ne.prototype;A.Oa=function(n){this.M=n};A.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():yc.g(),this.C=this.u?Ph(this.u):Ph(yc),this.g.onreadystatechange=Se(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){Dh(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(const s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=C.FormData&&n instanceof C.FormData,!(0<=vp(SA,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{om(this),0<this.B&&((this.L=PA(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Se(this.ua,this)):this.A=xu(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Dh(this,s)}};function PA(n){return _r&&typeof n.timeout=="number"&&n.ontimeout!==void 0}A.ua=function(){typeof Tu<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Te(this,"timeout"),this.abort(8))};function Dh(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,im(n),sa(n)}function im(n){n.F||(n.F=!0,Te(n,"complete"),Te(n,"error"))}A.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Te(this,"complete"),Te(this,"abort"),sa(this))};A.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),sa(this,!0)),ne.$.N.call(this)};A.La=function(){this.s||(this.G||this.v||this.l?sm(this):this.kb())};A.kb=function(){sm(this)};function sm(n){if(n.h&&typeof Tu<"u"&&(!n.C[1]||it(n)!=4||n.da()!=2)){if(n.v&&it(n)==4)xu(n.La,0,n);else if(Te(n,"readystatechange"),it(n)==4){n.h=!1;try{const o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(Kp)[1]||null;!i&&C.self&&C.self.location&&(i=C.self.location.protocol.slice(0,-1)),r=!bA.test(i?i.toLowerCase():"")}t=r}if(t)Te(n,"complete"),Te(n,"success");else{n.m=6;try{var s=2<it(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",im(n)}}finally{sa(n)}}}}function sa(n,e){if(n.g){om(n);const t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||Te(n,"ready");try{t.onreadystatechange=r}catch{}}}function om(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(C.clearTimeout(n.A),n.A=null)}A.isActive=function(){return!!this.g};function it(n){return n.g?n.g.readyState:0}A.da=function(){try{return 2<it(this)?this.g.status:-1}catch{return-1}};A.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};A.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),RA(e)}};function Vh(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case rm:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function CA(n){const e={};n=(n.g&&2<=it(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Vi(n[r]))continue;var t=eA(n[r]);const i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();const s=e[i]||[];e[i]=s,s.push(t)}KT(e,function(r){return r.join(", ")})}A.Ia=function(){return this.m};A.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function am(n){let e="";return bu(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function Bu(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=am(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):G(n,e,t))}function Yr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function cm(n){this.Ga=0,this.j=[],this.l=new Jo,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Yr("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Yr("baseRetryDelayMs",5e3,n),this.hb=Yr("retryDelaySeedMs",1e4,n),this.eb=Yr("forwardChannelMaxRetries",2,n),this.xa=Yr("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new Jp(n&&n.concurrentRequestLimit),this.Ja=new EA,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}A=cm.prototype;A.ra=8;A.H=1;function qu(n){if(um(n),n.H==3){var e=n.W++,t=At(n.I);if(G(t,"SID",n.K),G(t,"RID",e),G(t,"TYPE","terminate"),ms(n,t),e=new ds(n,n.l,e),e.L=2,e.A=na(At(t)),t=!1,C.navigator&&C.navigator.sendBeacon)try{t=C.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&C.Image&&(new Image().src=e.A,t=!0),t||(e.g=_m(e.l,null),e.g.ha(e.A)),e.G=Date.now(),fs(e)}mm(n)}function oa(n){n.g&&(ju(n),n.g.cancel(),n.g=null)}function um(n){oa(n),n.u&&(C.clearTimeout(n.u),n.u=null),po(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&C.clearTimeout(n.m),n.m=null)}function aa(n){if(!Xp(n.i)&&!n.m){n.m=!0;var e=n.Na;xi||Dp(),Oi||(xi(),Oi=!0),Vu.add(e,n),n.C=0}}function kA(n,e){return Zp(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=ls(Se(n.Na,n,e),pm(n,n.C)),n.C++,!0)}A.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;const i=new ds(this,this.l,n);let s=this.s;if(this.U&&(s?(s=Tp(s),Ap(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=lm(this,i,e),t=At(this.I),G(t,"RID",n),G(t,"CVER",22),this.F&&G(t,"X-HTTP-Session-Id",this.F),ms(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(am(s)))+"&"+e:this.o&&Bu(t,this.o,s)),Fu(this.i,i),this.bb&&G(t,"TYPE","init"),this.P?(G(t,"$req",e),G(t,"SID","null"),i.aa=!0,Ic(i,t,null)):Ic(i,t,e),this.H=2}}else this.H==3&&(n?Nh(this,n):this.j.length==0||Xp(this.i)||Nh(this))};function Nh(n,e){var t;e?t=e.m:t=n.W++;const r=At(n.I);G(r,"SID",n.K),G(r,"RID",t),G(r,"AID",n.V),ms(n,r),n.o&&n.s&&Bu(r,n.o,n.s),t=new ds(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=lm(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Fu(n.i,t),Ic(t,r,e)}function ms(n,e){n.na&&bu(n.na,function(t,r){G(e,r,t)}),n.h&&Gp({},function(t,r){G(e,r,t)})}function lm(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Se(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){const o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let c=0;c<t;c++){let u=i[c].g;const l=i[c].map;if(u-=s,0>u)s=Math.max(0,i[c].g-100),a=!1;else try{TA(l,o,"req"+u+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function hm(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;xi||Dp(),Oi||(xi(),Oi=!0),Vu.add(e,n),n.A=0}}function $u(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=ls(Se(n.Ma,n),pm(n,n.A)),n.A++,!0)}A.Ma=function(){if(this.u=null,dm(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=ls(Se(this.jb,this),n)}};A.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Ve(10),oa(this),dm(this))};function ju(n){n.B!=null&&(C.clearTimeout(n.B),n.B=null)}function dm(n){n.g=new ds(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=At(n.wa);G(e,"RID","rpc"),G(e,"SID",n.K),G(e,"AID",n.V),G(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&G(e,"TO",n.qa),G(e,"TYPE","xmlhttp"),ms(n,e),n.o&&n.s&&Bu(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=na(At(e)),t.u=null,t.S=!0,$p(t,n)}A.ib=function(){this.v!=null&&(this.v=null,oa(this),$u(this),Ve(19))};function po(n){n.v!=null&&(C.clearTimeout(n.v),n.v=null)}function fm(n,e){var t=null;if(n.g==e){po(n),ju(n),n.g=null;var r=2}else if(Ec(n.i,e))t=e.F,em(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=Xo(),Te(r,new Mp(r,t)),aa(n)}else hm(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&kA(n,e)||r==2&&$u(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:In(n,5);break;case 4:In(n,10);break;case 3:In(n,6);break;default:In(n,2)}}}function pm(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function In(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=Se(n.pb,n);t||(t=new bn("//www.google.com/images/cleardot.gif"),C.location&&C.location.protocol=="http"||ho(t,"https"),na(t)),AA(t.toString(),r)}else Ve(2);n.H=0,n.h&&n.h.za(e),mm(n),um(n)}A.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Ve(2)):(this.l.info("Failed to ping google.com"),Ve(1))};function mm(n){if(n.H=0,n.ma=[],n.h){const e=tm(n.i);(e.length!=0||n.j.length!=0)&&(Th(n.ma,e),Th(n.ma,n.j),n.i.i.length=0,Au(n.j),n.j.length=0),n.h.ya()}}function gm(n,e,t){var r=t instanceof bn?At(t):new bn(t);if(r.g!="")e&&(r.g=e+"."+r.g),fo(r,r.m);else{var i=C.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new bn(null);r&&ho(s,r),e&&(s.g=e),i&&fo(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&G(r,t,e),G(r,"VER",n.ra),ms(n,r),r}function _m(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new ne(new ra({ob:t})):new ne(n.va),e.Oa(n.J),e}A.isActive=function(){return!!this.h&&this.h.isActive(this)};function ym(){}A=ym.prototype;A.Ba=function(){};A.Aa=function(){};A.za=function(){};A.ya=function(){};A.isActive=function(){return!0};A.Va=function(){};function mo(){if(_r&&!(10<=Number(jT)))throw Error("Environmental error: no available transport.")}mo.prototype.g=function(n,e){return new je(n,e)};function je(n,e){me.call(this),this.g=new cm(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Vi(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Vi(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new Lr(this)}ge(je,me);je.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Ve(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=gm(n,null,n.Y),aa(n)};je.prototype.close=function(){qu(this.g)};je.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=Du(n),n=t);e.j.push(new vA(e.fb++,n)),e.H==3&&aa(e)};je.prototype.N=function(){this.g.h=null,delete this.j,qu(this.g),delete this.g,je.$.N.call(this)};function vm(n){Lu.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}ge(vm,Lu);function Im(){Mu.call(this),this.status=1}ge(Im,Mu);function Lr(n){this.g=n}ge(Lr,ym);Lr.prototype.Ba=function(){Te(this.g,"a")};Lr.prototype.Aa=function(n){Te(this.g,new vm(n))};Lr.prototype.za=function(n){Te(this.g,new Im)};Lr.prototype.ya=function(){Te(this.g,"b")};function DA(){this.blockSize=-1}function Ye(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}ge(Ye,DA);Ye.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Ha(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}Ye.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)Ha(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Ha(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Ha(this,r),i=0;break}}this.h=i,this.i+=e};Ye.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function q(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var VA={};function zu(n){return-128<=n&&128>n?BT(n,function(e){return new q([e|0],0>e?-1:0)}):new q([n|0],0>n?-1:0)}function st(n){if(isNaN(n)||!isFinite(n))return lr;if(0>n)return Ie(st(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=Tc;return new q(e,0)}function wm(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return Ie(wm(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=st(Math.pow(e,8)),r=lr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=st(Math.pow(e,s)),r=r.R(s).add(st(o))):(r=r.R(t),r=r.add(st(o)))}return r}var Tc=4294967296,lr=zu(0),Ac=zu(1),xh=zu(16777216);A=q.prototype;A.ea=function(){if(We(this))return-Ie(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:Tc+r)*e,e*=Tc}return n};A.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(yt(this))return"0";if(We(this))return"-"+Ie(this).toString(n);for(var e=st(Math.pow(n,6)),t=this,r="";;){var i=_o(t,e).g;t=go(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,yt(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};A.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function yt(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function We(n){return n.h==-1}A.X=function(n){return n=go(this,n),We(n)?-1:yt(n)?0:1};function Ie(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new q(t,~n.h).add(Ac)}A.abs=function(){return We(this)?Ie(this):this};A.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new q(t,t[t.length-1]&-2147483648?-1:0)};function go(n,e){return n.add(Ie(e))}A.R=function(n){if(yt(this)||yt(n))return lr;if(We(this))return We(n)?Ie(this).R(Ie(n)):Ie(Ie(this).R(n));if(We(n))return Ie(this.R(Ie(n)));if(0>this.X(xh)&&0>n.X(xh))return st(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,c=n.D(i)&65535;t[2*r+2*i]+=o*c,Ls(t,2*r+2*i),t[2*r+2*i+1]+=s*c,Ls(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,Ls(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,Ls(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new q(t,0)};function Ls(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Jr(n,e){this.g=n,this.h=e}function _o(n,e){if(yt(e))throw Error("division by zero");if(yt(n))return new Jr(lr,lr);if(We(n))return e=_o(Ie(n),e),new Jr(Ie(e.g),Ie(e.h));if(We(e))return e=_o(n,Ie(e)),new Jr(Ie(e.g),e.h);if(30<n.g.length){if(We(n)||We(e))throw Error("slowDivide_ only works with positive integers.");for(var t=Ac,r=e;0>=r.X(n);)t=Oh(t),r=Oh(r);var i=Qn(t,1),s=Qn(r,1);for(r=Qn(r,2),t=Qn(t,2);!yt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Qn(r,1),t=Qn(t,1)}return e=go(n,i.R(e)),new Jr(i,e)}for(i=lr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=st(t),o=s.R(e);We(o)||0<o.X(n);)t-=r,s=st(t),o=s.R(e);yt(s)&&(s=Ac),i=i.add(s),n=go(n,o)}return new Jr(i,n)}A.gb=function(n){return _o(this,n).h};A.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new q(t,this.h&n.h)};A.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new q(t,this.h|n.h)};A.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new q(t,this.h^n.h)};function Oh(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new q(t,n.h)}function Qn(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new q(i,n.h)}mo.prototype.createWebChannel=mo.prototype.g;je.prototype.send=je.prototype.u;je.prototype.open=je.prototype.m;je.prototype.close=je.prototype.close;Zo.NO_ERROR=0;Zo.TIMEOUT=8;Zo.HTTP_ERROR=6;Fp.COMPLETE="complete";Up.EventType=hs;hs.OPEN="a";hs.CLOSE="b";hs.ERROR="c";hs.MESSAGE="d";me.prototype.listen=me.prototype.O;ne.prototype.listenOnce=ne.prototype.P;ne.prototype.getLastError=ne.prototype.Sa;ne.prototype.getLastErrorCode=ne.prototype.Ia;ne.prototype.getStatus=ne.prototype.da;ne.prototype.getResponseJson=ne.prototype.Wa;ne.prototype.getResponseText=ne.prototype.ja;ne.prototype.send=ne.prototype.ha;ne.prototype.setWithCredentials=ne.prototype.Oa;Ye.prototype.digest=Ye.prototype.l;Ye.prototype.reset=Ye.prototype.reset;Ye.prototype.update=Ye.prototype.j;q.prototype.add=q.prototype.add;q.prototype.multiply=q.prototype.R;q.prototype.modulo=q.prototype.gb;q.prototype.compare=q.prototype.X;q.prototype.toNumber=q.prototype.ea;q.prototype.toString=q.prototype.toString;q.prototype.getBits=q.prototype.D;q.fromNumber=st;q.fromString=wm;var NA=function(){return new mo},xA=function(){return Xo()},Qa=Zo,OA=Fp,LA=$n,Lh={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ms=Up,MA=ne,FA=Ye,hr=q;const Mh="@firebase/firestore";class fe{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}fe.UNAUTHENTICATED=new fe(null),fe.GOOGLE_CREDENTIALS=new fe("google-credentials-uid"),fe.FIRST_PARTY=new fe("first-party-uid"),fe.MOCK_USER=new fe("mock-user");let Mr="10.7.0";const Gt=new Oo("@firebase/firestore");function er(){return Gt.logLevel}function UA(n){Gt.setLogLevel(n)}function _(n,...e){if(Gt.logLevel<=x.DEBUG){const t=e.map(Wu);Gt.debug(`Firestore (${Mr}): ${n}`,...t)}}function oe(n,...e){if(Gt.logLevel<=x.ERROR){const t=e.map(Wu);Gt.error(`Firestore (${Mr}): ${n}`,...t)}}function Je(n,...e){if(Gt.logLevel<=x.WARN){const t=e.map(Wu);Gt.warn(`Firestore (${Mr}): ${n}`,...t)}}function Wu(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function R(n="Unexpected state"){const e=`FIRESTORE (${Mr}) INTERNAL ASSERTION FAILED: `+n;throw oe(e),new Error(e)}function b(n,e){n||R()}function BA(n,e){n||R()}function T(n,e){return n}const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class g extends Ne{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class pe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Em{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class qA{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(fe.UNAUTHENTICATED))}shutdown(){}}class $A{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class jA{constructor(e){this.t=e,this.currentUser=fe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i;const i=c=>this.i!==r?(r=this.i,t(c)):Promise.resolve();let s=new pe;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new pe,e.enqueueRetryable(()=>i(this.currentUser))};const o=()=>{const c=s;e.enqueueRetryable(async()=>{await c.promise,await i(this.currentUser)})},a=c=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new pe)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(b(typeof r.accessToken=="string"),new Em(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return b(e===null||typeof e=="string"),new fe(e)}}class zA{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=fe.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class WA{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new zA(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(fe.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class GA{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class KA{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){const r=s=>{s.error!=null&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const o=s.token!==this.R;return this.R=s.token,_("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(b(typeof t.token=="string"),this.R=t.token,new GA(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function HA(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Tm{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=HA(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function k(n,e){return n<e?-1:n>e?1:0}function yr(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Am(n){return n+"\0"}class J{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new g(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new g(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new g(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new g(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return J.fromMillis(Date.now())}static fromDate(e){return J.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new J(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?k(this.nanoseconds,e.nanoseconds):k(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class S{constructor(e){this.timestamp=e}static fromTimestamp(e){return new S(e)}static min(){return new S(new J(0,0))}static max(){return new S(new J(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Bi{constructor(e,t,r){t===void 0?t=0:t>e.length&&R(),r===void 0?r=e.length-t:r>e.length-t&&R(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return Bi.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Bi?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class F extends Bi{construct(e,t,r){return new F(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new g(m.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new F(t)}static emptyPath(){return new F([])}}const QA=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Q extends Bi{construct(e,t,r){return new Q(e,t,r)}static isValidIdentifier(e){return QA.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Q.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new Q(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(r.length===0)throw new g(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let o=!1;for(;i<e.length;){const a=e[i];if(a==="\\"){if(i+1===e.length)throw new g(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[i+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new g(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=c,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new g(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Q(t)}static emptyPath(){return new Q([])}}class v{constructor(e){this.path=e}static fromPath(e){return new v(F.fromString(e))}static fromName(e){return new v(F.fromString(e).popFirst(5))}static empty(){return new v(F.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&F.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return F.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new v(new F(e.slice()))}}class yo{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Rc(n){return n.fields.find(e=>e.kind===2)}function dn(n){return n.fields.filter(e=>e.kind!==2)}yo.UNKNOWN_ID=-1;class Ks{constructor(e,t){this.fieldPath=e,this.kind=t}}class qi{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new qi(0,ze.min())}}function Rm(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=S.fromTimestamp(r===1e9?new J(t+1,0):new J(t,r));return new ze(i,v.empty(),e)}function bm(n){return new ze(n.readTime,n.key,-1)}class ze{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new ze(S.min(),v.empty(),-1)}static max(){return new ze(S.max(),v.empty(),-1)}}function Gu(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=v.comparator(n.documentKey,e.documentKey),t!==0?t:k(n.largestBatchId,e.largestBatchId))}const Sm="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Pm{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function on(n){if(n.code!==m.FAILED_PRECONDITION||n.message!==Sm)throw n;_("LocalStore","Unexpectedly lost primary lease")}class p{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&R(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new p((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof p?t:p.resolve(t)}catch(t){return p.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):p.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):p.reject(t)}static resolve(e){return new p((t,r)=>{t(e)})}static reject(e){return new p((t,r)=>{r(e)})}static waitFor(e){return new p((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},c=>r(c))}),o=!0,s===i&&t()})}static or(e){let t=p.resolve(!1);for(const r of e)t=t.next(i=>i?p.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new p((r,i)=>{const s=e.length,o=new Array(s);let a=0;for(let c=0;c<s;c++){const u=c;t(e[u]).next(l=>{o[u]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new p((r,i)=>{const s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}}class ca{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new pe,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new _i(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=Ku(r.target.error);this.V.reject(new _i(e,i))}}static open(e,t,r,i){try{return new ca(t,e.transaction(i,r))}catch(s){throw new _i(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(_("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new JA(t)}}class He{constructor(e,t,r){this.name=e,this.version=t,this.p=r,He.S(Z())===12.2&&oe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return _("SimpleDb","Removing database:",e),fn(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Ti())return!1;if(He.C())return!0;const e=Z(),t=He.S(e),r=0<t&&t<10,i=He.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,t){return e.store(t)}static S(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}async O(e){return this.db||(_("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{const o=s.target.result;t(o)},i.onblocked=()=>{r(new _i(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{const o=s.target.error;o.name==="VersionError"?r(new g(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new g(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new _i(e,o))},i.onupgradeneeded=s=>{_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{_("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,r,i){const s=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.O(e);const a=ca.open(this.db,e,s?"readonly":"readwrite",r),c=i(a).next(u=>(a.g(),u)).catch(u=>(a.abort(u),p.reject(u))).toPromise();return c.catch(()=>{}),await a.m,c}catch(a){const c=a,u=c.name!=="FirebaseError"&&o<3;if(_("SimpleDb","Transaction failed with error:",c.message,"Retrying:",u),this.close(),!u)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}class YA{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return fn(this.k.delete())}}class _i extends g{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function an(n){return n.name==="IndexedDbTransactionError"}class JA{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(_("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),fn(r)}add(e){return _("SimpleDb","ADD",this.store.name,e,e),fn(this.store.add(e))}get(e){return fn(this.store.get(e)).next(t=>(t===void 0&&(t=null),_("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return _("SimpleDb","DELETE",this.store.name,e),fn(this.store.delete(e))}count(){return _("SimpleDb","COUNT",this.store.name),fn(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||typeof this.store.getAll!="function"){const i=this.cursor(r),s=[];return this.G(i,(o,a)=>{s.push(a)}).next(()=>s)}{const i=this.store.getAll(r.range);return new p((s,o)=>{i.onerror=a=>{o(a.target.error)},i.onsuccess=a=>{s(a.target.result)}})}}j(e,t){const r=this.store.getAll(e,t===null?void 0:t);return new p((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){_("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.J=!1;const i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.G(i,t)}Z(e){const t=this.cursor({});return new p((r,i)=>{t.onerror=s=>{const o=Ku(s.target.error);i(o)},t.onsuccess=s=>{const o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){const r=[];return new p((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void i();const c=new YA(a),u=t(a.primaryKey,a.value,c);if(u instanceof p){const l=u.catch(h=>(c.done(),p.reject(h)));r.push(l)}c.isDone?i():c.$===null?a.continue():a.continue(c.$)}}).next(()=>p.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function fn(n){return new p((e,t)=>{n.onsuccess=r=>{const i=r.target.result;e(i)},n.onerror=r=>{const i=Ku(r.target.error);t(i)}})}let Fh=!1;function Ku(n){const e=He.S(Z());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new g("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Fh||(Fh=!0,setTimeout(()=>{throw r},0)),r}}return n}class XA{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(e){_("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{_("IndexBackiller",`Documents written: ${await this.X.te()}`)}catch(t){an(t)?_("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await on(t)}await this.ee(6e4)})}}class ZA{constructor(e,t){this.localStore=e,this.persistence=t}async te(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ne(t,e))}ne(e,t){const r=new Set;let i=t,s=!0;return p.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return _("IndexBackiller",`Processing collection: ${o}`),this.re(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ie(i,s)).next(a=>(_("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{const o=bm(s);Gu(o,r)>0&&(r=o)}),new ze(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}class Fe{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.se(r),this.oe=r=>t.writeSequenceNumber(r))}se(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.oe&&this.oe(e),e}}Fe._e=-1;function gs(n){return n==null}function $i(n){return n===0&&1/n==-1/0}function Cm(n){return typeof n=="number"&&Number.isInteger(n)&&!$i(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function xe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Uh(e)),e=eR(n.get(t),e);return Uh(e)}function eR(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function Uh(n){return n+""}function ot(n){const e=n.length;if(b(e>=2),e===2)return b(n.charAt(0)===""&&n.charAt(1)===""),F.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const o=n.indexOf("",s);switch((o<0||o>t)&&R(),n.charAt(o+1)){case"":const a=n.substring(s,o);let c;i.length===0?c=a:(i+=a,c=i,i=""),r.push(c);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:R()}s=o+2}return new F(r)}const Bh=["userId","batchId"];function Hs(n,e){return[n,xe(e)]}function km(n,e,t){return[n,xe(e),t]}const tR={},nR=["prefixPath","collectionGroup","readTime","documentId"],rR=["prefixPath","collectionGroup","documentId"],iR=["collectionGroup","readTime","prefixPath","documentId"],sR=["canonicalId","targetId"],oR=["targetId","path"],aR=["path","targetId"],cR=["collectionId","parent"],uR=["indexId","uid"],lR=["uid","sequenceNumber"],hR=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],dR=["indexId","uid","orderedDocumentKey"],fR=["userId","collectionPath","documentId"],pR=["userId","collectionPath","largestBatchId"],mR=["userId","collectionGroup","largestBatchId"],Dm=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],gR=[...Dm,"documentOverlays"],Vm=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Nm=Vm,_R=[...Nm,"indexConfiguration","indexState","indexEntries"];class bc extends Pm{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}}function _e(n,e){const t=T(n);return He.M(t.ae,e)}function qh(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function jn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function xm(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}class z{constructor(e,t){this.comparator=e,this.root=t||ve.EMPTY}insert(e,t){return new z(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ve.BLACK,null,null))}remove(e){return new z(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ve.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Fs(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Fs(this.root,e,this.comparator,!1)}getReverseIterator(){return new Fs(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Fs(this.root,e,this.comparator,!0)}}class Fs{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ve{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??ve.RED,this.left=i??ve.EMPTY,this.right=s??ve.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new ve(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ve.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return ve.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ve.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ve.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw R();const e=this.left.check();if(e!==this.right.check())throw R();return e+(this.isRed()?0:1)}}ve.EMPTY=null,ve.RED=!0,ve.BLACK=!1;ve.EMPTY=new class{constructor(){this.size=0}get key(){throw R()}get value(){throw R()}get color(){throw R()}get left(){throw R()}get right(){throw R()}copy(e,t,r,i,s){return this}insert(e,t,r){return new ve(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ${constructor(e){this.comparator=e,this.data=new z(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new $h(this.data.getIterator())}getIteratorFrom(e){return new $h(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof $)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new $(this.comparator);return t.data=e,t}}class $h{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Yn(n){return n.hasNext()?n.getNext():void 0}class Ue{constructor(e){this.fields=e,e.sort(Q.comparator)}static empty(){return new Ue([])}unionWith(e){let t=new $(Q.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Ue(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return yr(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Om extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}function yR(){return typeof atob<"u"}class he{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new Om("Invalid base64 string: "+s):s}}(e);return new he(t)}static fromUint8Array(e){const t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new he(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return k(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}he.EMPTY_BYTE_STRING=new he("");const vR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Kt(n){if(b(!!n),typeof n=="string"){let e=0;const t=vR.exec(n);if(b(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ee(n.seconds),nanos:ee(n.nanos)}}function ee(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ht(n){return typeof n=="string"?he.fromBase64String(n):he.fromUint8Array(n)}function ua(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Hu(n){const e=n.mapValue.fields.__previous_value__;return ua(e)?Hu(e):e}function ji(n){const e=Kt(n.mapValue.fields.__local_write_time__.timestampValue);return new J(e.seconds,e.nanos)}class IR{constructor(e,t,r,i,s,o,a,c,u){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=c,this.useFetchStreams=u}}class Qt{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new Qt("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof Qt&&e.projectId===this.projectId&&e.database===this.database}}const Bt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Qs={nullValue:"NULL_VALUE"};function kn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?ua(n)?4:Lm(n)?9007199254740991:10:R()}function pt(n,e){if(n===e)return!0;const t=kn(n);if(t!==kn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ji(n).isEqual(ji(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const o=Kt(i.timestampValue),a=Kt(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Ht(i.bytesValue).isEqual(Ht(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return ee(i.geoPointValue.latitude)===ee(s.geoPointValue.latitude)&&ee(i.geoPointValue.longitude)===ee(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ee(i.integerValue)===ee(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const o=ee(i.doubleValue),a=ee(s.doubleValue);return o===a?$i(o)===$i(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return yr(n.arrayValue.values||[],e.arrayValue.values||[],pt);case 10:return function(i,s){const o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(qh(o)!==qh(a))return!1;for(const c in o)if(o.hasOwnProperty(c)&&(a[c]===void 0||!pt(o[c],a[c])))return!1;return!0}(n,e);default:return R()}}function zi(n,e){return(n.values||[]).find(t=>pt(t,e))!==void 0}function Yt(n,e){if(n===e)return 0;const t=kn(n),r=kn(e);if(t!==r)return k(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return k(n.booleanValue,e.booleanValue);case 2:return function(s,o){const a=ee(s.integerValue||s.doubleValue),c=ee(o.integerValue||o.doubleValue);return a<c?-1:a>c?1:a===c?0:isNaN(a)?isNaN(c)?0:-1:1}(n,e);case 3:return jh(n.timestampValue,e.timestampValue);case 4:return jh(ji(n),ji(e));case 5:return k(n.stringValue,e.stringValue);case 6:return function(s,o){const a=Ht(s),c=Ht(o);return a.compareTo(c)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){const a=s.split("/"),c=o.split("/");for(let u=0;u<a.length&&u<c.length;u++){const l=k(a[u],c[u]);if(l!==0)return l}return k(a.length,c.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){const a=k(ee(s.latitude),ee(o.latitude));return a!==0?a:k(ee(s.longitude),ee(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){const a=s.values||[],c=o.values||[];for(let u=0;u<a.length&&u<c.length;++u){const l=Yt(a[u],c[u]);if(l)return l}return k(a.length,c.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Bt.mapValue&&o===Bt.mapValue)return 0;if(s===Bt.mapValue)return 1;if(o===Bt.mapValue)return-1;const a=s.fields||{},c=Object.keys(a),u=o.fields||{},l=Object.keys(u);c.sort(),l.sort();for(let h=0;h<c.length&&h<l.length;++h){const d=k(c[h],l[h]);if(d!==0)return d;const f=Yt(a[c[h]],u[l[h]]);if(f!==0)return f}return k(c.length,l.length)}(n.mapValue,e.mapValue);default:throw R()}}function jh(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return k(n,e);const t=Kt(n),r=Kt(e),i=k(t.seconds,r.seconds);return i!==0?i:k(t.nanos,r.nanos)}function vr(n){return Sc(n)}function Sc(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Kt(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Ht(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return v.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(const s of t.values||[])i?i=!1:r+=",",r+=Sc(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let i="{",s=!0;for(const o of r)s?s=!1:i+=",",i+=`${o}:${Sc(t.fields[o])}`;return i+"}"}(n.mapValue):R()}function Dn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Pc(n){return!!n&&"integerValue"in n}function Wi(n){return!!n&&"arrayValue"in n}function zh(n){return!!n&&"nullValue"in n}function Wh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ys(n){return!!n&&"mapValue"in n}function yi(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return jn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=yi(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=yi(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Lm(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function wR(n){return"nullValue"in n?Qs:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Dn(Qt.empty(),v.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:R()}function ER(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Dn(Qt.empty(),v.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Bt:R()}function Gh(n,e){const t=Yt(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Kh(n,e){const t=Yt(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class we{constructor(e){this.value=e}static empty(){return new we({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ys(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=yi(t)}setAll(e){let t=Q.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=yi(o):i.push(a.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Ys(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return pt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ys(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){jn(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new we(yi(this.value))}}function Mm(n){const e=[];return jn(n.fields,(t,r)=>{const i=new Q([t]);if(Ys(r)){const s=Mm(r.mapValue).fields;if(s.length===0)e.push(i);else for(const o of s)e.push(i.child(o))}else e.push(i)}),new Ue(e)}class K{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new K(e,0,S.min(),S.min(),S.min(),we.empty(),0)}static newFoundDocument(e,t,r,i){return new K(e,1,t,S.min(),r,i,0)}static newNoDocument(e,t){return new K(e,2,t,S.min(),S.min(),we.empty(),0)}static newUnknownDocument(e,t){return new K(e,3,t,S.min(),S.min(),we.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(S.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=we.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=we.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=S.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof K&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new K(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Jt{constructor(e,t){this.position=e,this.inclusive=t}}function Hh(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],o=n.position[i];if(s.field.isKeyField()?r=v.comparator(v.fromName(o.referenceValue),t.key):r=Yt(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function Qh(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!pt(n.position[t],e.position[t]))return!1;return!0}class Gi{constructor(e,t="asc"){this.field=e,this.dir=t}}function TR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Fm{}class O extends Fm{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new AR(e,t,r):t==="array-contains"?new SR(e,r):t==="in"?new zm(e,r):t==="not-in"?new PR(e,r):t==="array-contains-any"?new CR(e,r):new O(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new RR(e,r):new bR(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Yt(t,this.value)):t!==null&&kn(this.value)===kn(t)&&this.matchesComparison(Yt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return R()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class B extends Fm{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new B(e,t)}matches(e){return Ir(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Ir(n){return n.op==="and"}function Cc(n){return n.op==="or"}function Qu(n){return Um(n)&&Ir(n)}function Um(n){for(const e of n.filters)if(e instanceof B)return!1;return!0}function kc(n){if(n instanceof O)return n.field.canonicalString()+n.op.toString()+vr(n.value);if(Qu(n))return n.filters.map(e=>kc(e)).join(",");{const e=n.filters.map(t=>kc(t)).join(",");return`${n.op}(${e})`}}function Bm(n,e){return n instanceof O?function(r,i){return i instanceof O&&r.op===i.op&&r.field.isEqual(i.field)&&pt(r.value,i.value)}(n,e):n instanceof B?function(r,i){return i instanceof B&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&Bm(o,i.filters[a]),!0):!1}(n,e):void R()}function qm(n,e){const t=n.filters.concat(e);return B.create(t,n.op)}function $m(n){return n instanceof O?function(t){return`${t.field.canonicalString()} ${t.op} ${vr(t.value)}`}(n):n instanceof B?function(t){return t.op.toString()+" {"+t.getFilters().map($m).join(" ,")+"}"}(n):"Filter"}class AR extends O{constructor(e,t,r){super(e,t,r),this.key=v.fromName(r.referenceValue)}matches(e){const t=v.comparator(e.key,this.key);return this.matchesComparison(t)}}class RR extends O{constructor(e,t){super(e,"in",t),this.keys=jm("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class bR extends O{constructor(e,t){super(e,"not-in",t),this.keys=jm("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function jm(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>v.fromName(r.referenceValue))}class SR extends O{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Wi(t)&&zi(t.arrayValue,this.value)}}class zm extends O{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&zi(this.value.arrayValue,t)}}class PR extends O{constructor(e,t){super(e,"not-in",t)}matches(e){if(zi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!zi(this.value.arrayValue,t)}}class CR extends O{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Wi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>zi(this.value.arrayValue,r))}}class kR{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}}function Dc(n,e=null,t=[],r=[],i=null,s=null,o=null){return new kR(n,e,t,r,i,s,o)}function Vn(n){const e=T(n);if(e.ce===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>kc(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),gs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>vr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>vr(r)).join(",")),e.ce=t}return e.ce}function _s(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!TR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Bm(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Qh(n.startAt,e.startAt)&&Qh(n.endAt,e.endAt)}function vo(n){return v.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Io(n,e){return n.filters.filter(t=>t instanceof O&&t.field.isEqual(e))}function Yh(n,e,t){let r=Qs,i=!0;for(const s of Io(n,e)){let o=Qs,a=!0;switch(s.op){case"<":case"<=":o=wR(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=Qs}Gh({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Gh({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function Jh(n,e,t){let r=Bt,i=!0;for(const s of Io(n,e)){let o=Bt,a=!0;switch(s.op){case">=":case">":o=ER(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Bt}Kh({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const o=t.position[s];Kh({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}class Pt{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=c,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Wm(n,e,t,r,i,s,o,a){return new Pt(n,e,t,r,i,s,o,a)}function Fr(n){return new Pt(n)}function Xh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Yu(n){return n.collectionGroup!==null}function dr(n){const e=T(n);if(e.le===null){e.le=[];const t=new Set;for(const s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new $(Q.comparator);return o.filters.forEach(c=>{c.getFlattenedFilters().forEach(u=>{u.isInequality()&&(a=a.add(u.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new Gi(s,r))}),t.has(Q.keyField().canonicalString())||e.le.push(new Gi(Q.keyField(),r))}return e.le}function Oe(n){const e=T(n);return e.he||(e.he=DR(e,dr(n))),e.he}function DR(n,e){if(n.limitType==="F")return Dc(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new Gi(i.field,s)});const t=n.endAt?new Jt(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Jt(n.startAt.position,n.startAt.inclusive):null;return Dc(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function Vc(n,e){const t=n.filters.concat([e]);return new Pt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function wo(n,e,t){return new Pt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function ys(n,e){return _s(Oe(n),Oe(e))&&n.limitType===e.limitType}function Gm(n){return`${Vn(Oe(n))}|lt:${n.limitType}`}function tr(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>$m(i)).join(", ")}]`),gs(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>vr(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>vr(i)).join(",")),`Target(${r})`}(Oe(n))}; limitType=${n.limitType})`}function vs(n,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):v.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(const s of dr(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,c){const u=Hh(o,a,c);return o.inclusive?u<=0:u<0}(r.startAt,dr(r),i)||r.endAt&&!function(o,a,c){const u=Hh(o,a,c);return o.inclusive?u>=0:u>0}(r.endAt,dr(r),i))}(n,e)}function Km(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Hm(n){return(e,t)=>{let r=!1;for(const i of dr(n)){const s=VR(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function VR(n,e,t){const r=n.field.isKeyField()?v.comparator(e.key,t.key):function(s,o,a){const c=o.data.field(s),u=a.data.field(s);return c!==null&&u!==null?Yt(c,u):R()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return R()}}class cn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){jn(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return xm(this.inner)}size(){return this.innerSize}}const NR=new z(v.comparator);function Be(){return NR}const Qm=new z(v.comparator);function ui(...n){let e=Qm;for(const t of n)e=e.insert(t.key,t);return e}function Ym(n){let e=Qm;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function at(){return vi()}function Jm(){return vi()}function vi(){return new cn(n=>n.toString(),(n,e)=>n.isEqual(e))}const xR=new z(v.comparator),OR=new $(v.comparator);function V(...n){let e=OR;for(const t of n)e=e.add(t);return e}const LR=new $(k);function Ju(){return LR}function Xm(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$i(e)?"-0":e}}function Zm(n){return{integerValue:""+n}}function eg(n,e){return Cm(e)?Zm(e):Xm(n,e)}class la{constructor(){this._=void 0}}function MR(n,e,t){return n instanceof wr?function(i,s){const o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&ua(s)&&(s=Hu(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Nn?ng(n,e):n instanceof xn?rg(n,e):function(i,s){const o=tg(i,s),a=Zh(o)+Zh(i.Ie);return Pc(o)&&Pc(i.Ie)?Zm(a):Xm(i.serializer,a)}(n,e)}function FR(n,e,t){return n instanceof Nn?ng(n,e):n instanceof xn?rg(n,e):t}function tg(n,e){return n instanceof Er?function(r){return Pc(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class wr extends la{}class Nn extends la{constructor(e){super(),this.elements=e}}function ng(n,e){const t=ig(e);for(const r of n.elements)t.some(i=>pt(i,r))||t.push(r);return{arrayValue:{values:t}}}class xn extends la{constructor(e){super(),this.elements=e}}function rg(n,e){let t=ig(e);for(const r of n.elements)t=t.filter(i=>!pt(i,r));return{arrayValue:{values:t}}}class Er extends la{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Zh(n){return ee(n.integerValue||n.doubleValue)}function ig(n){return Wi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Is{constructor(e,t){this.field=e,this.transform=t}}function UR(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Nn&&i instanceof Nn||r instanceof xn&&i instanceof xn?yr(r.elements,i.elements,pt):r instanceof Er&&i instanceof Er?pt(r.Ie,i.Ie):r instanceof wr&&i instanceof wr}(n.transform,e.transform)}class BR{constructor(e,t){this.version=e,this.transformResults=t}}class Y{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Y}static exists(e){return new Y(void 0,e)}static updateTime(e){return new Y(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Js(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class ha{}function sg(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Br(n.key,Y.none()):new Ur(n.key,n.data,Y.none());{const t=n.data,r=we.empty();let i=new $(Q.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new Ct(n.key,r,new Ue(i.toArray()),Y.none())}}function qR(n,e,t){n instanceof Ur?function(i,s,o){const a=i.value.clone(),c=td(i.fieldTransforms,s,o.transformResults);a.setAll(c),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof Ct?function(i,s,o){if(!Js(i.precondition,s))return void s.convertToUnknownDocument(o.version);const a=td(i.fieldTransforms,s,o.transformResults),c=s.data;c.setAll(og(i)),c.setAll(a),s.convertToFoundDocument(o.version,c).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function Ii(n,e,t,r){return n instanceof Ur?function(s,o,a,c){if(!Js(s.precondition,o))return a;const u=s.value.clone(),l=nd(s.fieldTransforms,c,o);return u.setAll(l),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null}(n,e,t,r):n instanceof Ct?function(s,o,a,c){if(!Js(s.precondition,o))return a;const u=nd(s.fieldTransforms,c,o),l=o.data;return l.setAll(og(s)),l.setAll(u),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(s,o,a){return Js(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function $R(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=tg(r.transform,i||null);s!=null&&(t===null&&(t=we.empty()),t.set(r.field,s))}return t||null}function ed(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&yr(r,i,(s,o)=>UR(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Ur extends ha{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Ct extends ha{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function og(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function td(n,e,t){const r=new Map;b(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,FR(o,a,t[i]))}return r}function nd(n,e,t){const r=new Map;for(const i of n){const s=i.transform,o=t.data.field(i.field);r.set(i.field,MR(s,o,e))}return r}class Br extends ha{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Xu extends ha{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Zu{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&qR(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Ii(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Ii(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Jm();return this.mutations.forEach(i=>{const s=e.get(i.key),o=s.overlayedDocument;let a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;const c=sg(o,a);c!==null&&r.set(i.key,c),o.isValidDocument()||o.convertToNoDocument(S.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),V())}isEqual(e){return this.batchId===e.batchId&&yr(this.mutations,e.mutations,(t,r)=>ed(t,r))&&yr(this.baseMutations,e.baseMutations,(t,r)=>ed(t,r))}}class el{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){b(e.mutations.length===r.length);let i=function(){return xR}();const s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new el(e,t,r,i)}}class tl{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class jR{constructor(e,t){this.count=e,this.unchangedNames=t}}var ce,M;function ag(n){switch(n){default:return R();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function cg(n){if(n===void 0)return oe("GRPC error has no .code"),m.UNKNOWN;switch(n){case ce.OK:return m.OK;case ce.CANCELLED:return m.CANCELLED;case ce.UNKNOWN:return m.UNKNOWN;case ce.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case ce.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case ce.INTERNAL:return m.INTERNAL;case ce.UNAVAILABLE:return m.UNAVAILABLE;case ce.UNAUTHENTICATED:return m.UNAUTHENTICATED;case ce.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case ce.NOT_FOUND:return m.NOT_FOUND;case ce.ALREADY_EXISTS:return m.ALREADY_EXISTS;case ce.PERMISSION_DENIED:return m.PERMISSION_DENIED;case ce.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case ce.ABORTED:return m.ABORTED;case ce.OUT_OF_RANGE:return m.OUT_OF_RANGE;case ce.UNIMPLEMENTED:return m.UNIMPLEMENTED;case ce.DATA_LOSS:return m.DATA_LOSS;default:return R()}}(M=ce||(ce={}))[M.OK=0]="OK",M[M.CANCELLED=1]="CANCELLED",M[M.UNKNOWN=2]="UNKNOWN",M[M.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",M[M.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",M[M.NOT_FOUND=5]="NOT_FOUND",M[M.ALREADY_EXISTS=6]="ALREADY_EXISTS",M[M.PERMISSION_DENIED=7]="PERMISSION_DENIED",M[M.UNAUTHENTICATED=16]="UNAUTHENTICATED",M[M.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",M[M.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",M[M.ABORTED=10]="ABORTED",M[M.OUT_OF_RANGE=11]="OUT_OF_RANGE",M[M.UNIMPLEMENTED=12]="UNIMPLEMENTED",M[M.INTERNAL=13]="INTERNAL",M[M.UNAVAILABLE=14]="UNAVAILABLE",M[M.DATA_LOSS=15]="DATA_LOSS";function ug(){return new TextEncoder}const zR=new hr([4294967295,4294967295],0);function rd(n){const e=ug().encode(n),t=new FA;return t.update(e),new Uint8Array(t.digest())}function id(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new hr([t,r],0),new hr([i,s],0)]}class nl{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new li(`Invalid padding: ${t}`);if(r<0)throw new li(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new li(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new li(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=hr.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(hr.fromNumber(r)));return i.compare(zR)===1&&(i=new hr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;const t=rd(e),[r,i]=id(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new nl(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;const t=rd(e),[r,i]=id(t);for(let s=0;s<this.hashCount;s++){const o=this.de(r,i,s);this.Re(o)}}Re(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class li extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ws{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,Es.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new ws(S.min(),i,new z(k),Be(),V())}}class Es{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Es(r,t,V(),V(),V())}}class Xs{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}}class lg{constructor(e,t){this.targetId=e,this.fe=t}}class hg{constructor(e,t,r=he.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class sd{constructor(){this.ge=0,this.pe=ad(),this.ye=he.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=V(),t=V(),r=V();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:R()}}),new Es(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=ad()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,b(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class WR{constructor(e){this.Le=e,this.ke=new Map,this.qe=Be(),this.Qe=od(),this.Ke=new z(k)}$e(e){for(const t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(const t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{const r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Be(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:R()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){const t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){const s=i.target;if(vo(s))if(r===0){const o=new v(s.path);this.We(t,o,K.newNoDocument(o,S.min()))}else b(r===1);else{const o=this.Ze(t);if(o!==r){const a=this.Xe(e),c=a?this.et(a,e,o):1;if(c!==0){this.He(t);const u=c===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,u)}}}}}Xe(e){const t=e.fe.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t;let o,a;try{o=Ht(r).toUint8Array()}catch(c){if(c instanceof Om)return Je("Decoding the base64 bloom filter in existence filter failed ("+c.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw c}try{a=new nl(o,i,s)}catch(c){return Je(c instanceof li?"BloomFilter error: ":"Applying bloom filter failed: ",c),null}return a.Te===0?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){const r=this.Le.getRemoteKeysForTarget(t);let i=0;return r.forEach(s=>{const o=this.Le.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),i++)}),i}it(e){const t=new Map;this.ke.forEach((s,o)=>{const a=this.Ye(o);if(a){if(s.current&&vo(a.target)){const c=new v(a.target.path);this.qe.get(c)!==null||this.st(o,c)||this.We(o,c,K.newNoDocument(c,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=V();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(c=>{const u=this.Ye(c);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));const i=new ws(e,t,this.Ke,this.qe,r);return this.qe=Be(),this.Qe=od(),this.Ke=new z(k),i}Ue(e,t){if(!this.je(e))return;const r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;const i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){const t=this.ze(e).ve();return this.Le.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new sd,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new $(k),this.Qe=this.Qe.insert(e,t)),t}je(e){const t=this.Ye(e)!==null;return t||_("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){const t=this.ke.get(e);return t&&t.be?null:this.Le._t(e)}He(e){this.ke.set(e,new sd),this.Le.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Le.getRemoteKeysForTarget(e).has(t)}}function od(){return new z(v.comparator)}function ad(){return new z(v.comparator)}const GR=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),KR=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),HR=(()=>({and:"AND",or:"OR"}))();class QR{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Nc(n,e){return n.useProto3Json||gs(e)?e:{value:e}}function Tr(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function dg(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function YR(n,e){return Tr(n,e.toTimestamp())}function ae(n){return b(!!n),S.fromTimestamp(function(t){const r=Kt(t);return new J(r.seconds,r.nanos)}(n))}function rl(n,e){return function(r){return new F(["projects",r.projectId,"databases",r.database])}(n).child("documents").child(e).canonicalString()}function fg(n){const e=F.fromString(n);return b(Eg(e)),e}function Ki(n,e){return rl(n.databaseId,e.path)}function lt(n,e){const t=fg(e);if(t.get(1)!==n.databaseId.projectId)throw new g(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new g(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new v(mg(t))}function xc(n,e){return rl(n.databaseId,e)}function pg(n){const e=fg(n);return e.length===4?F.emptyPath():mg(e)}function Hi(n){return new F(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function mg(n){return b(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function cd(n,e,t){return{name:Ki(n,e),fields:t.value.mapValue.fields}}function gg(n,e,t){const r=lt(n,e.name),i=ae(e.updateTime),s=e.createTime?ae(e.createTime):S.min(),o=new we({mapValue:{fields:e.fields}}),a=K.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function JR(n,e){return"found"in e?function(r,i){b(!!i.found),i.found.name,i.found.updateTime;const s=lt(r,i.found.name),o=ae(i.found.updateTime),a=i.found.createTime?ae(i.found.createTime):S.min(),c=new we({mapValue:{fields:i.found.fields}});return K.newFoundDocument(s,o,a,c)}(n,e):"missing"in e?function(r,i){b(!!i.missing),b(!!i.readTime);const s=lt(r,i.missing),o=ae(i.readTime);return K.newNoDocument(s,o)}(n,e):R()}function XR(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:R()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(u,l){return u.useProto3Json?(b(l===void 0||typeof l=="string"),he.fromBase64String(l||"")):(b(l===void 0||l instanceof Uint8Array),he.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(u){const l=u.code===void 0?m.UNKNOWN:cg(u.code);return new g(l,u.message||"")}(o);t=new hg(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=lt(n,r.document.name),s=ae(r.document.updateTime),o=r.document.createTime?ae(r.document.createTime):S.min(),a=new we({mapValue:{fields:r.document.fields}}),c=K.newFoundDocument(i,s,o,a),u=r.targetIds||[],l=r.removedTargetIds||[];t=new Xs(u,l,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=lt(n,r.document),s=r.readTime?ae(r.readTime):S.min(),o=K.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Xs([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=lt(n,r.document),s=r.removedTargetIds||[];t=new Xs([],s,i,null)}else{if(!("filter"in e))return R();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,o=new jR(i,s),a=r.targetId;t=new lg(a,o)}}return t}function Qi(n,e){let t;if(e instanceof Ur)t={update:cd(n,e.key,e.value)};else if(e instanceof Br)t={delete:Ki(n,e.key)};else if(e instanceof Ct)t={update:cd(n,e.key,e.data),updateMask:ib(e.fieldMask)};else{if(!(e instanceof Xu))return R();t={verify:Ki(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){const a=o.transform;if(a instanceof wr)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Nn)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof xn)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Er)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw R()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:YR(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:R()}(n,e.precondition)),t}function Oc(n,e){const t=e.currentDocument?function(s){return s.updateTime!==void 0?Y.updateTime(ae(s.updateTime)):s.exists!==void 0?Y.exists(s.exists):Y.none()}(e.currentDocument):Y.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let c=null;if("setToServerValue"in a)b(a.setToServerValue==="REQUEST_TIME"),c=new wr;else if("appendMissingElements"in a){const l=a.appendMissingElements.values||[];c=new Nn(l)}else if("removeAllFromArray"in a){const l=a.removeAllFromArray.values||[];c=new xn(l)}else"increment"in a?c=new Er(o,a.increment):R();const u=Q.fromServerFormat(a.fieldPath);return new Is(u,c)}(n,i)):[];if(e.update){e.update.name;const i=lt(n,e.update.name),s=new we({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(c){const u=c.fieldPaths||[];return new Ue(u.map(l=>Q.fromServerFormat(l)))}(e.updateMask);return new Ct(i,s,o,t,r)}return new Ur(i,s,t,r)}if(e.delete){const i=lt(n,e.delete);return new Br(i,t)}if(e.verify){const i=lt(n,e.verify);return new Xu(i,t)}return R()}function ZR(n,e){return n&&n.length>0?(b(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?ae(i.updateTime):ae(s);return o.isEqual(S.min())&&(o=ae(s)),new BR(o,i.transformResults||[])}(t,e))):[]}function _g(n,e){return{documents:[xc(n,e.path)]}}function yg(n,e){const t={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(t.parent=xc(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=xc(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(c){if(c.length!==0)return wg(B.create(c,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(c){if(c.length!==0)return c.map(u=>function(h){return{field:nr(h.field),direction:tb(h.dir)}}(u))}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const o=Nc(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),t}function vg(n){let e=pg(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){b(r===1);const l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){const d=Ig(h);return d instanceof B&&Qu(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(w){return new Gi(rr(w.field),function(I){switch(I){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(w.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,gs(d)?null:d}(t.limit));let c=null;t.startAt&&(c=function(h){const d=!!h.before,f=h.values||[];return new Jt(f,d)}(t.startAt));let u=null;return t.endAt&&(u=function(h){const d=!h.before,f=h.values||[];return new Jt(f,d)}(t.endAt)),Wm(e,i,o,s,a,"F",c,u)}function eb(n,e){const t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return R()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function Ig(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=rr(t.unaryFilter.field);return O.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=rr(t.unaryFilter.field);return O.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=rr(t.unaryFilter.field);return O.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=rr(t.unaryFilter.field);return O.create(o,"!=",{nullValue:"NULL_VALUE"});default:return R()}}(n):n.fieldFilter!==void 0?function(t){return O.create(rr(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return R()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return B.create(t.compositeFilter.filters.map(r=>Ig(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return R()}}(t.compositeFilter.op))}(n):R()}function tb(n){return GR[n]}function nb(n){return KR[n]}function rb(n){return HR[n]}function nr(n){return{fieldPath:n.canonicalString()}}function rr(n){return Q.fromServerFormat(n.fieldPath)}function wg(n){return n instanceof O?function(t){if(t.op==="=="){if(Wh(t.value))return{unaryFilter:{field:nr(t.field),op:"IS_NAN"}};if(zh(t.value))return{unaryFilter:{field:nr(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Wh(t.value))return{unaryFilter:{field:nr(t.field),op:"IS_NOT_NAN"}};if(zh(t.value))return{unaryFilter:{field:nr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:nr(t.field),op:nb(t.op),value:t.value}}}(n):n instanceof B?function(t){const r=t.getFilters().map(i=>wg(i));return r.length===1?r[0]:{compositeFilter:{op:rb(t.op),filters:r}}}(n):R()}function ib(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Eg(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class vt{constructor(e,t,r,i,s=S.min(),o=S.min(),a=he.EMPTY_BYTE_STRING,c=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=c}withSequenceNumber(e){return new vt(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new vt(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new vt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new vt(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Tg{constructor(e){this.ut=e}}function sb(n,e){let t;if(e.document)t=gg(n.ut,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=v.fromSegments(e.noDocument.path),i=Ln(e.noDocument.readTime);t=K.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return R();{const r=v.fromSegments(e.unknownDocument.path),i=Ln(e.unknownDocument.version);t=K.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){const s=new J(i[0],i[1]);return S.fromTimestamp(s)}(e.readTime)),t}function ud(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Eo(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Ki(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Tr(s,o.version.toTimestamp()),createTime:Tr(s,o.createTime.toTimestamp())}}(n.ut,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:On(e.version)};else{if(!e.isUnknownDocument())return R();r.unknownDocument={path:t.path.toArray(),version:On(e.version)}}return r}function Eo(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function On(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ln(n){const e=new J(n.seconds,n.nanoseconds);return S.fromTimestamp(e)}function pn(n,e){const t=(e.baseMutations||[]).map(s=>Oc(n.ut,s));for(let s=0;s<e.mutations.length-1;++s){const o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(s=>Oc(n.ut,s)),i=J.fromMillis(e.localWriteTimeMs);return new Zu(e.batchId,i,t,r)}function hi(n){const e=Ln(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ln(n.lastLimboFreeSnapshotVersion):S.min();let r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return b(s.documents.length===1),Oe(Fr(pg(s.documents[0])))}(n.query):function(s){return Oe(vg(s))}(n.query),new vt(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,he.fromBase64String(n.resumeToken))}function Ag(n,e){const t=On(e.snapshotVersion),r=On(e.lastLimboFreeSnapshotVersion);let i;i=vo(e.target)?_g(n.ut,e.target):yg(n.ut,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Vn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function il(n){const e=vg({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?wo(e,e.limit,"L"):e}function Ya(n,e){return new tl(e.largestBatchId,Oc(n.ut,e.overlayMutation))}function ld(n,e){const t=e.path.lastSegment();return[n,xe(e.path.popLast()),t]}function hd(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:On(r.readTime),documentKey:xe(r.documentKey.path),largestBatchId:r.largestBatchId}}class ob{getBundleMetadata(e,t){return dd(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Ln(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return dd(e).put(function(i){return{bundleId:i.id,createTime:On(ae(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return fd(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:il(s.bundledQuery),readTime:Ln(s.readTime)}}(r)})}saveNamedQuery(e,t){return fd(e).put(function(i){return{name:i.name,readTime:On(ae(i.readTime)),bundledQuery:i.bundledQuery}}(t))}}function dd(n){return _e(n,"bundles")}function fd(n){return _e(n,"namedQueries")}class da{constructor(e,t){this.serializer=e,this.userId=t}static ct(e,t){const r=t.uid||"";return new da(e,r)}getOverlay(e,t){return Xr(e).get(ld(this.userId,t)).next(r=>r?Ya(this.serializer,r):null)}getOverlays(e,t){const r=at();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,o)=>{const a=new tl(t,o);i.push(this.lt(e,a))}),p.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(o=>i.add(xe(o.getCollectionPath())));const s=[];return i.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Xr(e).H("collectionPathOverlayIndex",a))}),p.waitFor(s)}getOverlaysForCollection(e,t,r){const i=at(),s=xe(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Xr(e).W("collectionPathOverlayIndex",o).next(a=>{for(const c of a){const u=Ya(this.serializer,c);i.set(u.getKey(),u)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=at();let o;const a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Xr(e).Y({index:"collectionGroupOverlayIndex",range:a},(c,u,l)=>{const h=Ya(this.serializer,u);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}lt(e,t){return Xr(e).put(function(i,s,o){const[a,c,u]=ld(s,o.mutation.key);return{userId:s,collectionPath:c,documentId:u,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Qi(i.ut,o.mutation)}}(this.serializer,this.userId,t))}}function Xr(n){return _e(n,"documentOverlays")}class mn{constructor(){}ht(e,t){this.Pt(e,t),t.It()}Pt(e,t){if("nullValue"in e)this.Tt(t,5);else if("booleanValue"in e)this.Tt(t,10),t.Et(e.booleanValue?1:0);else if("integerValue"in e)this.Tt(t,15),t.Et(ee(e.integerValue));else if("doubleValue"in e){const r=ee(e.doubleValue);isNaN(r)?this.Tt(t,13):(this.Tt(t,15),$i(r)?t.Et(0):t.Et(r))}else if("timestampValue"in e){const r=e.timestampValue;this.Tt(t,20),typeof r=="string"?t.dt(r):(t.dt(`${r.seconds||""}`),t.Et(r.nanos||0))}else if("stringValue"in e)this.At(e.stringValue,t),this.Rt(t);else if("bytesValue"in e)this.Tt(t,30),t.Vt(Ht(e.bytesValue)),this.Rt(t);else if("referenceValue"in e)this.ft(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Tt(t,45),t.Et(r.latitude||0),t.Et(r.longitude||0)}else"mapValue"in e?Lm(e)?this.Tt(t,Number.MAX_SAFE_INTEGER):(this.gt(e.mapValue,t),this.Rt(t)):"arrayValue"in e?(this.yt(e.arrayValue,t),this.Rt(t)):R()}At(e,t){this.Tt(t,25),this.wt(e,t)}wt(e,t){t.dt(e)}gt(e,t){const r=e.fields||{};this.Tt(t,55);for(const i of Object.keys(r))this.At(i,t),this.Pt(r[i],t)}yt(e,t){const r=e.values||[];this.Tt(t,50);for(const i of r)this.Pt(i,t)}ft(e,t){this.Tt(t,37),v.fromName(e).path.forEach(r=>{this.Tt(t,60),this.wt(r,t)})}Tt(e,t){e.Et(t)}Rt(e){e.Et(2)}}mn.St=new mn;function ab(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function pd(n){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const o=ab(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}class cb{constructor(){this.buffer=new Uint8Array(1024),this.position=0}bt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Dt(r.value),r=t.next();this.Ct()}vt(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ft(r.value),r=t.next();this.Mt()}xt(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Dt(r);else if(r<2048)this.Dt(960|r>>>6),this.Dt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Dt(480|r>>>12),this.Dt(128|63&r>>>6),this.Dt(128|63&r);else{const i=t.codePointAt(0);this.Dt(240|i>>>18),this.Dt(128|63&i>>>12),this.Dt(128|63&i>>>6),this.Dt(128|63&i)}}this.Ct()}Ot(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=t.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Nt(e){const t=this.Bt(e),r=pd(t);this.Lt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}kt(e){const t=this.Bt(e),r=pd(t);this.Lt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}qt(){this.Qt(255),this.Qt(255)}Kt(){this.$t(255),this.$t(255)}reset(){this.position=0}seed(e){this.Lt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Ut(){return this.buffer.slice(0,this.position)}Bt(e){const t=function(s){const o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Dt(e){const t=255&e;t===0?(this.Qt(0),this.Qt(255)):t===255?(this.Qt(255),this.Qt(0)):this.Qt(t)}Ft(e){const t=255&e;t===0?(this.$t(0),this.$t(255)):t===255?(this.$t(255),this.$t(0)):this.$t(e)}Ct(){this.Qt(0),this.Qt(1)}Mt(){this.$t(0),this.$t(1)}Qt(e){this.Lt(1),this.buffer[this.position++]=e}$t(e){this.Lt(1),this.buffer[this.position++]=~e}Lt(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class ub{constructor(e){this.Wt=e}Vt(e){this.Wt.bt(e)}dt(e){this.Wt.xt(e)}Et(e){this.Wt.Nt(e)}It(){this.Wt.qt()}}class lb{constructor(e){this.Wt=e}Vt(e){this.Wt.vt(e)}dt(e){this.Wt.Ot(e)}Et(e){this.Wt.kt(e)}It(){this.Wt.Kt()}}class Zr{constructor(){this.Wt=new cb,this.Gt=new ub(this.Wt),this.zt=new lb(this.Wt)}seed(e){this.Wt.seed(e)}jt(e){return e===0?this.Gt:this.zt}Ut(){return this.Wt.Ut()}reset(){this.Wt.reset()}}class gn{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ht(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new gn(this.indexId,this.documentKey,this.arrayValue,r)}}function Nt(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=md(n.arrayValue,e.arrayValue),t!==0?t:(t=md(n.directionalValue,e.directionalValue),t!==0?t:v.comparator(n.documentKey,e.documentKey)))}function md(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}class gd{constructor(e){this.Jt=new $((t,r)=>Q.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Yt=e.orderBy,this.Zt=[];for(const t of e.filters){const r=t;r.isInequality()?this.Jt=this.Jt.add(r):this.Zt.push(r)}}get Xt(){return this.Jt.size>1}en(e){if(b(e.collectionGroup===this.collectionId),this.Xt)return!1;const t=Rc(e);if(t!==void 0&&!this.tn(t))return!1;const r=dn(e);let i=new Set,s=0,o=0;for(;s<r.length&&this.tn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Jt.size>0){const a=this.Jt.getIterator().getNext();if(!i.has(a.field.canonicalString())){const c=r[s];if(!this.nn(a,c)||!this.rn(this.Yt[o++],c))return!1}++s}for(;s<r.length;++s){const a=r[s];if(o>=this.Yt.length||!this.rn(this.Yt[o++],a))return!1}return!0}sn(){if(this.Xt)return null;let e=new $(Q.comparator);const t=[];for(const r of this.Zt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Ks(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Ks(r.field,0))}for(const r of this.Yt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Ks(r.field,r.dir==="asc"?0:1)));return new yo(yo.UNKNOWN_ID,this.collectionId,t,qi.empty())}tn(e){for(const t of this.Zt)if(this.nn(t,e))return!0;return!1}nn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}rn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}function Rg(n){var e,t;if(b(n instanceof O||n instanceof B),n instanceof O){if(n instanceof zm){const i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>O.create(n.field,"==",s)))||[];return B.create(i,"or")}return n}const r=n.filters.map(i=>Rg(i));return B.create(r,n.op)}function hb(n){if(n.getFilters().length===0)return[];const e=Fc(Rg(n));return b(bg(e)),Lc(e)||Mc(e)?[e]:e.getFilters()}function Lc(n){return n instanceof O}function Mc(n){return n instanceof B&&Qu(n)}function bg(n){return Lc(n)||Mc(n)||function(t){if(t instanceof B&&Cc(t)){for(const r of t.getFilters())if(!Lc(r)&&!Mc(r))return!1;return!0}return!1}(n)}function Fc(n){if(b(n instanceof O||n instanceof B),n instanceof O)return n;if(n.filters.length===1)return Fc(n.filters[0]);const e=n.filters.map(r=>Fc(r));let t=B.create(e,n.op);return t=To(t),bg(t)?t:(b(t instanceof B),b(Ir(t)),b(t.filters.length>1),t.filters.reduce((r,i)=>sl(r,i)))}function sl(n,e){let t;return b(n instanceof O||n instanceof B),b(e instanceof O||e instanceof B),t=n instanceof O?e instanceof O?function(i,s){return B.create([i,s],"and")}(n,e):_d(n,e):e instanceof O?_d(e,n):function(i,s){if(b(i.filters.length>0&&s.filters.length>0),Ir(i)&&Ir(s))return qm(i,s.getFilters());const o=Cc(i)?i:s,a=Cc(i)?s:i,c=o.filters.map(u=>sl(u,a));return B.create(c,"or")}(n,e),To(t)}function _d(n,e){if(Ir(e))return qm(e,n.getFilters());{const t=e.filters.map(r=>sl(n,r));return B.create(t,"or")}}function To(n){if(b(n instanceof O||n instanceof B),n instanceof O)return n;const e=n.getFilters();if(e.length===1)return To(e[0]);if(Um(n))return n;const t=e.map(i=>To(i)),r=[];return t.forEach(i=>{i instanceof O?r.push(i):i instanceof B&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:B.create(r,n.op)}class db{constructor(){this.on=new ol}addToCollectionParentIndex(e,t){return this.on.add(t),p.resolve()}getCollectionParents(e,t){return p.resolve(this.on.getEntries(t))}addFieldIndex(e,t){return p.resolve()}deleteFieldIndex(e,t){return p.resolve()}deleteAllFieldIndexes(e){return p.resolve()}createTargetIndexes(e,t){return p.resolve()}getDocumentsMatchingTarget(e,t){return p.resolve(null)}getIndexType(e,t){return p.resolve(0)}getFieldIndexes(e,t){return p.resolve([])}getNextCollectionGroupToUpdate(e){return p.resolve(null)}getMinOffset(e,t){return p.resolve(ze.min())}getMinOffsetFromCollectionGroup(e,t){return p.resolve(ze.min())}updateCollectionGroup(e,t,r){return p.resolve()}updateIndexEntries(e,t){return p.resolve()}}class ol{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new $(F.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new $(F.comparator)).toArray()}}const Us=new Uint8Array(0);class fb{constructor(e,t){this.user=e,this.databaseId=t,this._n=new ol,this.an=new cn(r=>Vn(r),(r,i)=>_s(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this._n.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this._n.add(t)});const s={collectionId:r,parent:xe(i)};return yd(e).put(s)}return p.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Am(t),""],!1,!0);return yd(e).W(i).next(s=>{for(const o of s){if(o.collectionId!==t)break;r.push(ot(o.parent))}return r})}addFieldIndex(e,t){const r=ei(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(c=>[c.fieldPath.canonicalString(),c.kind])}}(t);delete i.indexId;const s=r.add(i);if(t.indexState){const o=Xn(e);return s.next(a=>{o.put(hd(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=ei(e),i=Xn(e),s=Jn(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const t=ei(e),r=Jn(e),i=Xn(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return p.forEach(this.un(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){const s=new gd(r).sn();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){const r=Jn(e);let i=!0;const s=new Map;return p.forEach(this.un(t),o=>this.cn(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=V();const a=[];return p.forEach(s,(c,u)=>{_("IndexedDbIndexManager",`Using index ${function(N){return`id=${N.indexId}|cg=${N.collectionGroup}|f=${N.fields.map(W=>`${W.fieldPath}:${W.kind}`).join(",")}`}(c)} to execute ${Vn(t)}`);const l=function(N,W){const H=Rc(W);if(H===void 0)return null;for(const j of Io(N,H.fieldPath))switch(j.op){case"array-contains-any":return j.value.arrayValue.values||[];case"array-contains":return[j.value]}return null}(u,c),h=function(N,W){const H=new Map;for(const j of dn(W))for(const le of Io(N,j.fieldPath))switch(le.op){case"==":case"in":H.set(j.fieldPath.canonicalString(),le.value);break;case"not-in":case"!=":return H.set(j.fieldPath.canonicalString(),le.value),Array.from(H.values())}return null}(u,c),d=function(N,W){const H=[];let j=!0;for(const le of dn(W)){const Dt=le.kind===0?Yh(N,le.fieldPath,N.startAt):Jh(N,le.fieldPath,N.startAt);H.push(Dt.value),j&&(j=Dt.inclusive)}return new Jt(H,j)}(u,c),f=function(N,W){const H=[];let j=!0;for(const le of dn(W)){const Dt=le.kind===0?Jh(N,le.fieldPath,N.endAt):Yh(N,le.fieldPath,N.endAt);H.push(Dt.value),j&&(j=Dt.inclusive)}return new Jt(H,j)}(u,c),w=this.ln(c,u,d),E=this.ln(c,u,f),I=this.hn(c,u,h),D=this.Pn(c.indexId,l,w,d.inclusive,E,f.inclusive,I);return p.forEach(D,L=>r.j(L,t.limit).next(N=>{N.forEach(W=>{const H=v.fromSegments(W.documentKey);o.has(H)||(o=o.add(H),a.push(H))})}))}).next(()=>a)}return p.resolve(null)})}un(e){let t=this.an.get(e);return t||(e.filters.length===0?t=[e]:t=hb(B.create(e.filters,"and")).map(r=>Dc(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.an.set(e,t),t)}Pn(e,t,r,i,s,o,a){const c=(t!=null?t.length:1)*Math.max(r.length,s.length),u=c/(t!=null?t.length:1),l=[];for(let h=0;h<c;++h){const d=t?this.In(t[h/u]):Us,f=this.Tn(e,d,r[h%u],i),w=this.En(e,d,s[h%u],o),E=a.map(I=>this.Tn(e,d,I,!0));l.push(...this.createRange(f,w,E))}return l}Tn(e,t,r,i){const s=new gn(e,v.empty(),t,r);return i?s:s.Ht()}En(e,t,r,i){const s=new gn(e,v.empty(),t,r);return i?s.Ht():s}cn(e,t){const r=new gd(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(const a of s)r.en(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2;const i=this.un(t);return p.forEach(i,s=>this.cn(e,s).next(o=>{o?r!==0&&o.fields.length<function(c){let u=new $(Q.comparator),l=!1;for(const h of c.filters)for(const d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:u=u.add(d.field));for(const h of c.orderBy)h.field.isKeyField()||(u=u.add(h.field));return u.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}dn(e,t){const r=new Zr;for(const i of dn(e)){const s=t.data.field(i.fieldPath);if(s==null)return null;const o=r.jt(i.kind);mn.St.ht(s,o)}return r.Ut()}In(e){const t=new Zr;return mn.St.ht(e,t.jt(0)),t.Ut()}An(e,t){const r=new Zr;return mn.St.ht(Dn(this.databaseId,t),r.jt(function(s){const o=dn(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Ut()}hn(e,t,r){if(r===null)return[];let i=[];i.push(new Zr);let s=0;for(const o of dn(e)){const a=r[s++];for(const c of i)if(this.Rn(t,o.fieldPath)&&Wi(a))i=this.Vn(i,o,a);else{const u=c.jt(o.kind);mn.St.ht(a,u)}}return this.mn(i)}ln(e,t,r){return this.hn(e,t,r.position)}mn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Ut();return t}Vn(e,t,r){const i=[...e],s=[];for(const o of r.arrayValue.values||[])for(const a of i){const c=new Zr;c.seed(a.Ut()),mn.St.ht(o,c.jt(t.kind)),s.push(c)}return s}Rn(e,t){return!!e.filters.find(r=>r instanceof O&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){const r=ei(e),i=Xn(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const o=[];return p.forEach(s,a=>i.get([a.indexId,this.uid]).next(c=>{o.push(function(l,h){const d=h?new qi(h.sequenceNumber,new ze(Ln(h.readTime),new v(ot(h.documentKey)),h.largestBatchId)):qi.empty(),f=l.fields.map(([w,E])=>new Ks(Q.fromServerFormat(w),E));return new yo(l.indexId,l.collectionGroup,f,d)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:k(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=ei(e),s=Xn(e);return this.fn(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>p.forEach(a,c=>s.put(hd(c.indexId,this.user,o,r)))))}updateIndexEntries(e,t){const r=new Map;return p.forEach(t,(i,s)=>{const o=r.get(i.collectionGroup);return(o?p.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),p.forEach(a,c=>this.gn(e,i,c).next(u=>{const l=this.pn(s,c);return u.isEqual(l)?p.resolve():this.yn(e,s,c,u,l)}))))})}wn(e,t,r,i){return Jn(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.An(r,t.key),documentKey:t.key.path.toArray()})}Sn(e,t,r,i){return Jn(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.An(r,t.key),t.key.path.toArray()])}gn(e,t,r){const i=Jn(e);let s=new $(Nt);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.An(r,t)])},(o,a)=>{s=s.add(new gn(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}pn(e,t){let r=new $(Nt);const i=this.dn(t,e);if(i==null)return r;const s=Rc(t);if(s!=null){const o=e.data.field(s.fieldPath);if(Wi(o))for(const a of o.arrayValue.values||[])r=r.add(new gn(t.indexId,e.key,this.In(a),i))}else r=r.add(new gn(t.indexId,e.key,Us,i));return r}yn(e,t,r,i,s){_("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(c,u,l,h,d){const f=c.getIterator(),w=u.getIterator();let E=Yn(f),I=Yn(w);for(;E||I;){let D=!1,L=!1;if(E&&I){const N=l(E,I);N<0?L=!0:N>0&&(D=!0)}else E!=null?L=!0:D=!0;D?(h(I),I=Yn(w)):L?(d(E),E=Yn(f)):(E=Yn(f),I=Yn(w))}}(i,s,Nt,a=>{o.push(this.wn(e,t,r,a))},a=>{o.push(this.Sn(e,t,r,a))}),p.waitFor(o)}fn(e){let t=1;return Xn(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Nt(o,a)).filter((o,a,c)=>!a||Nt(o,c[a-1])!==0);const i=[];i.push(e);for(const o of r){const a=Nt(o,e),c=Nt(o,t);if(a===0)i[0]=e.Ht();else if(a>0&&c<0)i.push(o),i.push(o.Ht());else if(c>0)break}i.push(t);const s=[];for(let o=0;o<i.length;o+=2){if(this.bn(i[o],i[o+1]))return[];const a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Us,[]],c=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Us,[]];s.push(IDBKeyRange.bound(a,c))}return s}bn(e,t){return Nt(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(vd)}getMinOffset(e,t){return p.mapArray(this.un(t),r=>this.cn(e,r).next(i=>i||R())).next(vd)}}function yd(n){return _e(n,"collectionParents")}function Jn(n){return _e(n,"indexEntries")}function ei(n){return _e(n,"indexConfiguration")}function Xn(n){return _e(n,"indexState")}function vd(n){b(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;Gu(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new ze(e.readTime,e.documentKey,t)}const Id={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Me{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Me(e,Me.DEFAULT_COLLECTION_PERCENTILE,Me.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Sg(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=r.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(c.next(()=>{b(a===1)}));const u=[];for(const l of t.mutations){const h=km(e,l.key.path,t.batchId);s.push(i.delete(h)),u.push(l.key)}return p.waitFor(s).next(()=>u)}function Ao(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw R();e=n.noDocument}return JSON.stringify(e).length}Me.DEFAULT_COLLECTION_PERCENTILE=10,Me.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Me.DEFAULT=new Me(41943040,Me.DEFAULT_COLLECTION_PERCENTILE,Me.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Me.DISABLED=new Me(-1,0,0);class fa{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Dn={}}static ct(e,t,r,i){b(e.uid!=="");const s=e.isAuthenticated()?e.uid:"";return new fa(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return xt(e).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=ir(e),o=xt(e);return o.add({}).next(a=>{b(typeof a=="number");const c=new Zu(a,t,r,i),u=function(f,w,E){const I=E.baseMutations.map(L=>Qi(f.ut,L)),D=E.mutations.map(L=>Qi(f.ut,L));return{userId:w,batchId:E.batchId,localWriteTimeMs:E.localWriteTime.toMillis(),baseMutations:I,mutations:D}}(this.serializer,this.userId,c),l=[];let h=new $((d,f)=>k(d.canonicalString(),f.canonicalString()));for(const d of i){const f=km(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(u)),l.push(s.put(f,tR))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Dn[a]=c.keys()}),p.waitFor(l).next(()=>c)})}lookupMutationBatch(e,t){return xt(e).get(t).next(r=>r?(b(r.userId===this.userId),pn(this.serializer,r)):null)}Cn(e,t){return this.Dn[t]?p.resolve(this.Dn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.Dn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return xt(e).Y({index:"userMutationsIndex",range:i},(o,a,c)=>{a.userId===this.userId&&(b(a.batchId>=r),s=pn(this.serializer,a)),c.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return xt(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return xt(e).W("userMutationsIndex",t).next(r=>r.map(i=>pn(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=Hs(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return ir(e).Y({range:i},(o,a,c)=>{const[u,l,h]=o,d=ot(l);if(u===this.userId&&t.path.isEqual(d))return xt(e).get(h).next(f=>{if(!f)throw R();b(f.userId===this.userId),s.push(pn(this.serializer,f))});c.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new $(k);const i=[];return t.forEach(s=>{const o=Hs(this.userId,s.path),a=IDBKeyRange.lowerBound(o),c=ir(e).Y({range:a},(u,l,h)=>{const[d,f,w]=u,E=ot(f);d===this.userId&&s.path.isEqual(E)?r=r.add(w):h.done()});i.push(c)}),p.waitFor(i).next(()=>this.vn(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=Hs(this.userId,r),o=IDBKeyRange.lowerBound(s);let a=new $(k);return ir(e).Y({range:o},(c,u,l)=>{const[h,d,f]=c,w=ot(d);h===this.userId&&r.isPrefixOf(w)?w.length===i&&(a=a.add(f)):l.done()}).next(()=>this.vn(e,a))}vn(e,t){const r=[],i=[];return t.forEach(s=>{i.push(xt(e).get(s).next(o=>{if(o===null)throw R();b(o.userId===this.userId),r.push(pn(this.serializer,o))}))}),p.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return Sg(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Fn(t.batchId)}),p.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Fn(e){delete this.Dn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return p.resolve();const r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return ir(e).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){const c=ot(s[1]);i.push(c)}else a.done()}).next(()=>{b(i.length===0)})})}containsKey(e,t){return Pg(e,this.userId,t)}Mn(e){return Cg(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function Pg(n,e,t){const r=Hs(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let o=!1;return ir(n).Y({range:s,J:!0},(a,c,u)=>{const[l,h,d]=a;l===e&&h===i&&(o=!0),u.done()}).next(()=>o)}function xt(n){return _e(n,"mutations")}function ir(n){return _e(n,"documentMutations")}function Cg(n){return _e(n,"mutationQueues")}class Mn{constructor(e){this.xn=e}next(){return this.xn+=2,this.xn}static On(){return new Mn(0)}static Nn(){return new Mn(-1)}}class pb{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{const r=new Mn(t.highestTargetId);return t.highestTargetId=r.next(),this.Ln(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>S.fromTimestamp(new J(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Ln(e,i)))}addTargetData(e,t){return this.kn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.qn(t,r),this.Ln(e,r))))}updateTargetData(e,t){return this.kn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Zn(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(b(r.targetCount>0),r.targetCount-=1,this.Ln(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return Zn(e).Y((o,a)=>{const c=hi(a);c.sequenceNumber<=t&&r.get(c.targetId)===null&&(i++,s.push(this.removeTargetData(e,c)))}).next(()=>p.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Zn(e).Y((r,i)=>{const s=hi(i);t(s)})}Bn(e){return wd(e).get("targetGlobalKey").next(t=>(b(t!==null),t))}Ln(e,t){return wd(e).put("targetGlobalKey",t)}kn(e,t){return Zn(e).put(Ag(this.serializer,t))}qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=Vn(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return Zn(e).Y({range:i,index:"queryTargetsIndex"},(o,a,c)=>{const u=hi(a);_s(t,u.target)&&(s=u,c.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Lt(e);return t.forEach(o=>{const a=xe(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),p.waitFor(i)}removeMatchingKeys(e,t,r){const i=Lt(e);return p.forEach(t,s=>{const o=xe(s.path);return p.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Lt(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Lt(e);let s=V();return i.Y({range:r,J:!0},(o,a,c)=>{const u=ot(o[1]),l=new v(u);s=s.add(l)}).next(()=>s)}containsKey(e,t){const r=xe(t.path),i=IDBKeyRange.bound([r],[Am(r)],!1,!0);let s=0;return Lt(e).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],c,u)=>{o!==0&&(s++,u.done())}).next(()=>s>0)}_t(e,t){return Zn(e).get(t).next(r=>r?hi(r):null)}}function Zn(n){return _e(n,"targets")}function wd(n){return _e(n,"targetGlobal")}function Lt(n){return _e(n,"targetDocuments")}function Ed([n,e],[t,r]){const i=k(n,t);return i===0?k(e,r):i}class mb{constructor(e){this.Qn=e,this.buffer=new $(Ed),this.Kn=0}$n(){return++this.Kn}Un(e){const t=[e,this.$n()];if(this.buffer.size<this.Qn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();Ed(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class gb{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Wn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Gn(6e4)}stop(){this.Wn&&(this.Wn.cancel(),this.Wn=null)}get started(){return this.Wn!==null}Gn(e){_("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Wn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Wn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){an(t)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await on(t)}await this.Gn(3e5)})}}class _b{constructor(e,t){this.zn=e,this.params=t}calculateTargetCount(e,t){return this.zn.jn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return p.resolve(Fe._e);const r=new mb(t);return this.zn.forEachTarget(e,i=>r.Un(i.sequenceNumber)).next(()=>this.zn.Hn(e,i=>r.Un(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.zn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.zn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(_("LruGarbageCollector","Garbage collection skipped; disabled"),p.resolve(Id)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Id):this.Jn(e,t))}getCacheSize(e){return this.zn.getCacheSize(e)}Jn(e,t){let r,i,s,o,a,c,u;const l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,c=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(u=Date.now(),er()<=x.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(c-a)+`ms
	Removed ${h} documents in `+(u-c)+`ms
Total Duration: ${u-l}ms`),p.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}}function yb(n,e){return new _b(n,e)}class vb{constructor(e,t){this.db=e,this.garbageCollector=yb(this,t)}jn(e){const t=this.Yn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Yn(e){let t=0;return this.Hn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Hn(e,t){return this.Zn(e,(r,i)=>t(i))}addReference(e,t,r){return Bs(e,r)}removeReference(e,t,r){return Bs(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Bs(e,t)}Xn(e,t){return function(i,s){let o=!1;return Cg(i).Z(a=>Pg(i,a,s).next(c=>(c&&(o=!0),p.resolve(!c)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Zn(e,(o,a)=>{if(a<=t){const c=this.Xn(e,o).next(u=>{if(!u)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,S.min()),Lt(e).delete(function(h){return[0,xe(h.path)]}(o))))});i.push(c)}}).next(()=>p.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Bs(e,t)}Zn(e,t){const r=Lt(e);let i,s=Fe._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:u})=>{o===0?(s!==Fe._e&&t(new v(ot(i)),s),s=u,i=c):s=Fe._e}).next(()=>{s!==Fe._e&&t(new v(ot(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Bs(n,e){return Lt(n).put(function(r,i){return{targetId:0,path:xe(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}class kg{constructor(){this.changes=new cn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,K.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?p.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ib{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ln(e).put(r)}removeEntry(e,t,r){return ln(e).delete(function(s,o){const a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Eo(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.er(e,r)))}getEntry(e,t){let r=K.newInvalidDocument(t);return ln(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ti(t))},(i,s)=>{r=this.tr(t,s)}).next(()=>r)}nr(e,t){let r={size:0,document:K.newInvalidDocument(t)};return ln(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ti(t))},(i,s)=>{r={document:this.tr(t,s),size:Ao(s)}}).next(()=>r)}getEntries(e,t){let r=Be();return this.rr(e,t,(i,s)=>{const o=this.tr(i,s);r=r.insert(i,o)}).next(()=>r)}ir(e,t){let r=Be(),i=new z(v.comparator);return this.rr(e,t,(s,o)=>{const a=this.tr(s,o);r=r.insert(s,a),i=i.insert(s,Ao(o))}).next(()=>({documents:r,sr:i}))}rr(e,t,r){if(t.isEmpty())return p.resolve();let i=new $(Rd);t.forEach(c=>i=i.add(c));const s=IDBKeyRange.bound(ti(i.first()),ti(i.last())),o=i.getIterator();let a=o.getNext();return ln(e).Y({index:"documentKeyIndex",range:s},(c,u,l)=>{const h=v.fromSegments([...u.prefixPath,u.collectionGroup,u.documentId]);for(;a&&Rd(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,u),a=o.hasNext()?o.getNext():null),a?l.U(ti(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){const o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Eo(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],c=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ln(e).W(IDBKeyRange.bound(a,c,!0)).next(u=>{s==null||s.incrementDocumentReadCount(u.length);let l=Be();for(const h of u){const d=this.tr(v.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(vs(t,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=Be();const o=Ad(t,r),a=Ad(t,ze.max());return ln(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,u,l)=>{const h=this.tr(v.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new wb(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Td(e).get("remoteDocumentGlobalKey").next(t=>(b(!!t),t))}er(e,t){return Td(e).put("remoteDocumentGlobalKey",t)}tr(e,t){if(t){const r=sb(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(S.min())))return r}return K.newInvalidDocument(e)}}function Dg(n){return new Ib(n)}class wb extends kg{constructor(e,t){super(),this._r=e,this.trackRemovals=t,this.ar=new cn(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new $((s,o)=>k(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{const a=this.ar.get(s);if(t.push(this._r.removeEntry(e,s,a.readTime)),o.isValidDocument()){const c=ud(this._r.serializer,o);i=i.add(s.path.popLast());const u=Ao(c);r+=u-a.size,t.push(this._r.addEntry(e,s,c))}else if(r-=a.size,this.trackRemovals){const c=ud(this._r.serializer,o.convertToNoDocument(S.min()));t.push(this._r.addEntry(e,s,c))}}),i.forEach(s=>{t.push(this._r.indexManager.addToCollectionParentIndex(e,s))}),t.push(this._r.updateMetadata(e,r)),p.waitFor(t)}getFromCache(e,t){return this._r.nr(e,t).next(r=>(this.ar.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this._r.ir(e,t).next(({documents:r,sr:i})=>(i.forEach((s,o)=>{this.ar.set(s,{size:o,readTime:r.get(s).readTime})}),r))}}function Td(n){return _e(n,"remoteDocumentGlobal")}function ln(n){return _e(n,"remoteDocumentsV14")}function ti(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Ad(n,e){const t=e.documentKey.path.toArray();return[n,Eo(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function Rd(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=k(t[s],r[s]),i)return i;return i=k(t.length,r.length),i||(i=k(t[t.length-2],r[r.length-2]),i||k(t[t.length-1],r[r.length-1]))}class Eb{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Vg{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&Ii(r.mutation,i,Ue.empty(),J.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,V()).next(()=>r))}getLocalViewOfDocuments(e,t,r=V()){const i=at();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=ui();return s.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const r=at();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,V()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Be();const o=vi(),a=function(){return vi()}();return t.forEach((c,u)=>{const l=r.get(u.key);i.has(u.key)&&(l===void 0||l.mutation instanceof Ct)?s=s.insert(u.key,u):l!==void 0?(o.set(u.key,l.mutation.getFieldMask()),Ii(l.mutation,u,l.mutation.getFieldMask(),J.now())):o.set(u.key,Ue.empty())}),this.recalculateAndSaveOverlays(e,s).next(c=>(c.forEach((u,l)=>o.set(u,l)),t.forEach((u,l)=>{var h;return a.set(u,new Eb(l,(h=o.get(u))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){const r=vi();let i=new z((o,a)=>o-a),s=V();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const u=t.get(c);if(u===null)return;let l=r.get(c)||Ue.empty();l=a.applyToLocalView(u,l),r.set(c,l);const h=(i.get(a.batchId)||V()).add(c);i=i.insert(a.batchId,h)})}).next(()=>{const o=[],a=i.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),u=c.key,l=c.value,h=Jm();l.forEach(d=>{if(!s.has(d)){const f=sg(t.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,u,h))}return p.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return v.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Yu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):p.resolve(at());let a=-1,c=s;return o.next(u=>p.forEach(u,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?p.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{c=c.insert(l,d)}))).next(()=>this.populateOverlays(e,u,s)).next(()=>this.computeViews(e,c,u,V())).next(l=>({batchId:a,changes:Ym(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new v(t)).next(r=>{let i=ui();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){const s=t.collectionGroup;let o=ui();return this.indexManager.getCollectionParents(e,s).next(a=>p.forEach(a,c=>{const u=function(h,d){return new Pt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,c.child(s));return this.getDocumentsMatchingCollectionQuery(e,u,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((c,u)=>{const l=u.getKey();o.get(l)===null&&(o=o.insert(l,K.newInvalidDocument(l)))});let a=ui();return o.forEach((c,u)=>{const l=s.get(c);l!==void 0&&Ii(l.mutation,u,Ue.empty(),J.now()),vs(t,u)&&(a=a.insert(c,u))}),a})}}class Tb{constructor(e){this.serializer=e,this.ur=new Map,this.cr=new Map}getBundleMetadata(e,t){return p.resolve(this.ur.get(t))}saveBundleMetadata(e,t){return this.ur.set(t.id,function(i){return{id:i.id,version:i.version,createTime:ae(i.createTime)}}(t)),p.resolve()}getNamedQuery(e,t){return p.resolve(this.cr.get(t))}saveNamedQuery(e,t){return this.cr.set(t.name,function(i){return{name:i.name,query:il(i.bundledQuery),readTime:ae(i.readTime)}}(t)),p.resolve()}}class Ab{constructor(){this.overlays=new z(v.comparator),this.lr=new Map}getOverlay(e,t){return p.resolve(this.overlays.get(t))}getOverlays(e,t){const r=at();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.lt(e,t,s)}),p.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.lr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.lr.delete(r)),p.resolve()}getOverlaysForCollection(e,t,r){const i=at(),s=t.length+1,o=new v(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return p.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new z((u,l)=>u-l);const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let l=s.get(u.largestBatchId);l===null&&(l=at(),s=s.insert(u.largestBatchId,l)),l.set(u.getKey(),u)}}const a=at(),c=s.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((u,l)=>a.set(u,l)),!(a.size()>=i)););return p.resolve(a)}lt(e,t,r){const i=this.overlays.get(r.key);if(i!==null){const o=this.lr.get(i.largestBatchId).delete(r.key);this.lr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new tl(t,r));let s=this.lr.get(t);s===void 0&&(s=V(),this.lr.set(t,s)),this.lr.set(t,s.add(r.key))}}class al{constructor(){this.hr=new $(de.Pr),this.Ir=new $(de.Tr)}isEmpty(){return this.hr.isEmpty()}addReference(e,t){const r=new de(e,t);this.hr=this.hr.add(r),this.Ir=this.Ir.add(r)}Er(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.dr(new de(e,t))}Ar(e,t){e.forEach(r=>this.removeReference(r,t))}Rr(e){const t=new v(new F([])),r=new de(t,e),i=new de(t,e+1),s=[];return this.Ir.forEachInRange([r,i],o=>{this.dr(o),s.push(o.key)}),s}Vr(){this.hr.forEach(e=>this.dr(e))}dr(e){this.hr=this.hr.delete(e),this.Ir=this.Ir.delete(e)}mr(e){const t=new v(new F([])),r=new de(t,e),i=new de(t,e+1);let s=V();return this.Ir.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){const t=new de(e,0),r=this.hr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class de{constructor(e,t){this.key=e,this.gr=t}static Pr(e,t){return v.comparator(e.key,t.key)||k(e.gr,t.gr)}static Tr(e,t){return k(e.gr,t.gr)||v.comparator(e.key,t.key)}}class Rb{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.pr=1,this.yr=new $(de.Pr)}checkEmpty(e){return p.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){const s=this.pr;this.pr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Zu(s,t,r,i);this.mutationQueue.push(o);for(const a of i)this.yr=this.yr.add(new de(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return p.resolve(o)}lookupMutationBatch(e,t){return p.resolve(this.wr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=this.Sr(r),s=i<0?0:i;return p.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return p.resolve(this.mutationQueue.length===0?-1:this.pr-1)}getAllMutationBatches(e){return p.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new de(t,0),i=new de(t,Number.POSITIVE_INFINITY),s=[];return this.yr.forEachInRange([r,i],o=>{const a=this.wr(o.gr);s.push(a)}),p.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new $(k);return t.forEach(i=>{const s=new de(i,0),o=new de(i,Number.POSITIVE_INFINITY);this.yr.forEachInRange([s,o],a=>{r=r.add(a.gr)})}),p.resolve(this.br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;v.isDocumentKey(s)||(s=s.child(""));const o=new de(new v(s),0);let a=new $(k);return this.yr.forEachWhile(c=>{const u=c.key.path;return!!r.isPrefixOf(u)&&(u.length===i&&(a=a.add(c.gr)),!0)},o),p.resolve(this.br(a))}br(e){const t=[];return e.forEach(r=>{const i=this.wr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){b(this.Dr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.yr;return p.forEach(t.mutations,i=>{const s=new de(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.yr=r})}Fn(e){}containsKey(e,t){const r=new de(t,0),i=this.yr.firstAfterOrEqual(r);return p.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,p.resolve()}Dr(e,t){return this.Sr(e)}Sr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}wr(e){const t=this.Sr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class bb{constructor(e){this.Cr=e,this.docs=function(){return new z(v.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.Cr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return p.resolve(r?r.document.mutableCopy():K.newInvalidDocument(t))}getEntries(e,t){let r=Be();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():K.newInvalidDocument(i))}),p.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Be();const o=t.path,a=new v(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:u,value:{document:l}}=c.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Gu(bm(l),r)<=0||(i.has(l.key)||vs(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return p.resolve(s)}getAllFromCollectionGroup(e,t,r,i){R()}vr(e,t){return p.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Sb(this)}getSize(e){return p.resolve(this.size)}}class Sb extends kg{constructor(e){super(),this._r=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this._r.addEntry(e,i)):this._r.removeEntry(r)}),p.waitFor(t)}getFromCache(e,t){return this._r.getEntry(e,t)}getAllFromCache(e,t){return this._r.getEntries(e,t)}}class Pb{constructor(e){this.persistence=e,this.Fr=new cn(t=>Vn(t),_s),this.lastRemoteSnapshotVersion=S.min(),this.highestTargetId=0,this.Mr=0,this.Or=new al,this.targetCount=0,this.Nr=Mn.On()}forEachTarget(e,t){return this.Fr.forEach((r,i)=>t(i)),p.resolve()}getLastRemoteSnapshotVersion(e){return p.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return p.resolve(this.Mr)}allocateTargetId(e){return this.highestTargetId=this.Nr.next(),p.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Mr&&(this.Mr=t),p.resolve()}kn(e){this.Fr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Nr=new Mn(t),this.highestTargetId=t),e.sequenceNumber>this.Mr&&(this.Mr=e.sequenceNumber)}addTargetData(e,t){return this.kn(t),this.targetCount+=1,p.resolve()}updateTargetData(e,t){return this.kn(t),p.resolve()}removeTargetData(e,t){return this.Fr.delete(t.target),this.Or.Rr(t.targetId),this.targetCount-=1,p.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Fr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Fr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),p.waitFor(s).next(()=>i)}getTargetCount(e){return p.resolve(this.targetCount)}getTargetData(e,t){const r=this.Fr.get(t)||null;return p.resolve(r)}addMatchingKeys(e,t,r){return this.Or.Er(t,r),p.resolve()}removeMatchingKeys(e,t,r){this.Or.Ar(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),p.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Or.Rr(t),p.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Or.mr(t);return p.resolve(r)}containsKey(e,t){return p.resolve(this.Or.containsKey(t))}}class Ng{constructor(e,t){this.Br={},this.overlays={},this.Lr=new Fe(0),this.kr=!1,this.kr=!0,this.referenceDelegate=e(this),this.qr=new Pb(this),this.indexManager=new db,this.remoteDocumentCache=function(i){return new bb(i)}(r=>this.referenceDelegate.Qr(r)),this.serializer=new Tg(t),this.Kr=new Tb(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.kr=!1,Promise.resolve()}get started(){return this.kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ab,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new Rb(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Kr}runTransaction(e,t,r){_("MemoryPersistence","Starting transaction:",e);const i=new Cb(this.Lr.next());return this.referenceDelegate.$r(),r(i).next(s=>this.referenceDelegate.Ur(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Wr(e,t){return p.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}}class Cb extends Pm{constructor(e){super(),this.currentSequenceNumber=e}}class pa{constructor(e){this.persistence=e,this.Gr=new al,this.zr=null}static jr(e){return new pa(e)}get Hr(){if(this.zr)return this.zr;throw R()}addReference(e,t,r){return this.Gr.addReference(r,t),this.Hr.delete(r.toString()),p.resolve()}removeReference(e,t,r){return this.Gr.removeReference(r,t),this.Hr.add(r.toString()),p.resolve()}markPotentiallyOrphaned(e,t){return this.Hr.add(t.toString()),p.resolve()}removeTarget(e,t){this.Gr.Rr(t.targetId).forEach(i=>this.Hr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Hr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}$r(){this.zr=new Set}Ur(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return p.forEach(this.Hr,r=>{const i=v.fromPath(r);return this.Jr(e,i).next(s=>{s||t.removeEntry(i,S.min())})}).next(()=>(this.zr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Jr(e,t).next(r=>{r?this.Hr.delete(t.toString()):this.Hr.add(t.toString())})}Qr(e){return 0}Jr(e,t){return p.or([()=>p.resolve(this.Gr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Wr(e,t)])}}class kb{constructor(e){this.serializer=e}N(e,t,r,i){const s=new ca("createOrUpgrade",t);r<1&&i>=1&&(function(c){c.createObjectStore("owner")}(e),function(c){c.createObjectStore("mutationQueues",{keyPath:"userId"}),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Bh,{unique:!0}),c.createObjectStore("documentMutations")}(e),bd(e),function(c){c.createObjectStore("remoteDocuments")}(e));let o=p.resolve();return r<3&&i>=3&&(r!==0&&(function(c){c.deleteObjectStore("targetDocuments"),c.deleteObjectStore("targets"),c.deleteObjectStore("targetGlobal")}(e),bd(e)),o=o.next(()=>function(c){const u=c.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:S.min().toTimestamp(),targetCount:0};return u.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(c,u){return u.store("mutations").W().next(l=>{c.deleteObjectStore("mutations"),c.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Bh,{unique:!0});const h=u.store("mutations"),d=l.map(f=>h.put(f));return p.waitFor(d)})}(e,s))),o=o.next(()=>{(function(c){c.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Zr(s))),r<6&&i>=6&&(o=o.next(()=>(function(c){c.createObjectStore("remoteDocumentGlobal")}(e),this.Xr(s)))),r<7&&i>=7&&(o=o.next(()=>this.ei(s))),r<8&&i>=8&&(o=o.next(()=>this.ti(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(c){c.objectStoreNames.contains("remoteDocumentChanges")&&c.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ni(s))),r<11&&i>=11&&(o=o.next(()=>{(function(c){c.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(c){c.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(c){const u=c.createObjectStore("documentOverlays",{keyPath:fR});u.createIndex("collectionPathOverlayIndex",pR,{unique:!1}),u.createIndex("collectionGroupOverlayIndex",mR,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(c){const u=c.createObjectStore("remoteDocumentsV14",{keyPath:nR});u.createIndex("documentKeyIndex",rR),u.createIndex("collectionGroupIndex",iR)}(e)).next(()=>this.ri(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.ii(e,s))),r<15&&i>=15&&(o=o.next(()=>function(c){c.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),c.createObjectStore("indexState",{keyPath:uR}).createIndex("sequenceNumberIndex",lR,{unique:!1}),c.createObjectStore("indexEntries",{keyPath:hR}).createIndex("documentKeyIndex",dR,{unique:!1})}(e))),o}Xr(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=Ao(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Zr(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>p.forEach(i,s=>{const o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>p.forEach(a,c=>{b(c.userId===s.userId);const u=pn(this.serializer,c);return Sg(e,s.userId,u).next(()=>{})}))}))}ei(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Y((o,a)=>{const c=new F(o),u=function(h){return[0,xe(h)]}(c);s.push(t.get(u).next(l=>l?p.resolve():(h=>t.put({targetId:0,path:xe(h),sequenceNumber:i.highestListenSequenceNumber}))(c)))}).next(()=>p.waitFor(s))})}ti(e,t){e.createObjectStore("collectionParents",{keyPath:cR});const r=t.store("collectionParents"),i=new ol,s=o=>{if(i.add(o)){const a=o.lastSegment(),c=o.popLast();return r.put({collectionId:a,parent:xe(c)})}};return t.store("remoteDocuments").Y({J:!0},(o,a)=>{const c=new F(o);return s(c.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([o,a,c],u)=>{const l=ot(a);return s(l.popLast())}))}ni(e){const t=e.store("targets");return t.Y((r,i)=>{const s=hi(i),o=Ag(this.serializer,s);return t.put(o)})}ri(e,t){const r=t.store("remoteDocuments"),i=[];return r.Y((s,o)=>{const a=t.store("remoteDocumentsV14"),c=function(h){return h.document?new v(F.fromString(h.document.name).popFirst(5)):h.noDocument?v.fromSegments(h.noDocument.path):h.unknownDocument?v.fromSegments(h.unknownDocument.path):R()}(o).path.toArray(),u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(u))}).next(()=>p.waitFor(i))}ii(e,t){const r=t.store("mutations"),i=Dg(this.serializer),s=new Ng(pa.jr,this.serializer.ut);return r.W().next(o=>{const a=new Map;return o.forEach(c=>{var u;let l=(u=a.get(c.userId))!==null&&u!==void 0?u:V();pn(this.serializer,c).keys().forEach(h=>l=l.add(h)),a.set(c.userId,l)}),p.forEach(a,(c,u)=>{const l=new fe(u),h=da.ct(this.serializer,l),d=s.getIndexManager(l),f=fa.ct(l,this.serializer,d,s.referenceDelegate);return new Vg(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new bc(t,Fe._e),c).next()})})}}function bd(n){n.createObjectStore("targetDocuments",{keyPath:oR}).createIndex("documentTargetsIndex",aR,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",sR,{unique:!0}),n.createObjectStore("targetGlobal")}const Ja="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class cl{constructor(e,t,r,i,s,o,a,c,u,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.si=s,this.window=o,this.document=a,this.oi=u,this._i=l,this.ai=h,this.Lr=null,this.kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ui=null,this.inForeground=!1,this.ci=null,this.li=null,this.hi=Number.NEGATIVE_INFINITY,this.Pi=d=>Promise.resolve(),!cl.D())throw new g(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new vb(this,i),this.Ii=t+"main",this.serializer=new Tg(c),this.Ti=new He(this.Ii,this.ai,new kb(this.serializer)),this.qr=new pb(this.referenceDelegate,this.serializer),this.remoteDocumentCache=Dg(this.serializer),this.Kr=new ob,this.window&&this.window.localStorage?this.Ei=this.window.localStorage:(this.Ei=null,l===!1&&oe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.di().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new g(m.FAILED_PRECONDITION,Ja);return this.Ai(),this.Ri(),this.Vi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.qr.getHighestSequenceNumber(e))}).then(e=>{this.Lr=new Fe(e,this.oi)}).then(()=>{this.kr=!0}).catch(e=>(this.Ti&&this.Ti.close(),Promise.reject(e)))}mi(e){return this.Pi=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ti.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.si.enqueueAndForget(async()=>{this.started&&await this.di()}))}di(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>qs(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)))})}).next(()=>this.gi(e)).next(t=>this.isPrimary&&!t?this.pi(e).next(()=>!1):!!t&&this.yi(e).next(()=>!0))).catch(e=>{if(an(e))return _("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.si.enqueueRetryable(()=>this.Pi(e)),this.isPrimary=e})}fi(e){return ni(e).get("owner").next(t=>p.resolve(this.wi(t)))}Si(e){return qs(e).delete(this.clientId)}async bi(){if(this.isPrimary&&!this.Di(this.hi,18e5)){this.hi=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const r=_e(t,"clientMetadata");return r.W().next(i=>{const s=this.Ci(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return p.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.Ei)for(const t of e)this.Ei.removeItem(this.vi(t.clientId))}}Vi(){this.li=this.si.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.di().then(()=>this.bi()).then(()=>this.Vi()))}wi(e){return!!e&&e.ownerId===this.clientId}gi(e){return this._i?p.resolve(!0):ni(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)){if(this.wi(t)&&this.networkEnabled)return!0;if(!this.wi(t)){if(!t.allowTabSynchronization)throw new g(m.FAILED_PRECONDITION,Ja);return!1}}return!(!this.networkEnabled||!this.inForeground)||qs(e).W().next(r=>this.Ci(r,5e3).find(i=>{if(this.clientId!==i.clientId){const s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&_("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.kr=!1,this.Mi(),this.li&&(this.li.cancel(),this.li=null),this.xi(),this.Oi(),await this.Ti.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new bc(e,Fe._e);return this.pi(t).next(()=>this.Si(t))}),this.Ti.close(),this.Ni()}Ci(e,t){return e.filter(r=>this.Di(r.updateTimeMs,t)&&!this.Fi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>qs(e).W().next(t=>this.Ci(t,18e5).map(r=>r.clientId)))}get started(){return this.kr}getMutationQueue(e,t){return fa.ct(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new fb(e,this.serializer.ut.databaseId)}getDocumentOverlayCache(e){return da.ct(this.serializer,e)}getBundleCache(){return this.Kr}runTransaction(e,t,r){_("IndexedDbPersistence","Starting transaction:",e);const i=t==="readonly"?"readonly":"readwrite",s=function(c){return c===15?_R:c===14?Nm:c===13?Vm:c===12?gR:c===11?Dm:void R()}(this.ai);let o;return this.Ti.runTransaction(e,i,s,a=>(o=new bc(a,this.Lr?this.Lr.next():Fe._e),t==="readwrite-primary"?this.fi(o).next(c=>!!c||this.gi(o)).next(c=>{if(!c)throw oe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.si.enqueueRetryable(()=>this.Pi(!1)),new g(m.FAILED_PRECONDITION,Sm);return r(o)}).next(c=>this.yi(o).next(()=>c)):this.Li(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}Li(e){return ni(e).get("owner").next(t=>{if(t!==null&&this.Di(t.leaseTimestampMs,5e3)&&!this.Fi(t.ownerId)&&!this.wi(t)&&!(this._i||this.allowTabSynchronization&&t.allowTabSynchronization))throw new g(m.FAILED_PRECONDITION,Ja)})}yi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ni(e).put("owner",t)}static D(){return He.D()}pi(e){const t=ni(e);return t.get("owner").next(r=>this.wi(r)?(_("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):p.resolve())}Di(e,t){const r=Date.now();return!(e<r-t)&&(!(e>r)||(oe(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ai(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ci=()=>{this.si.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.di()))},this.document.addEventListener("visibilitychange",this.ci),this.inForeground=this.document.visibilityState==="visible")}xi(){this.ci&&(this.document.removeEventListener("visibilitychange",this.ci),this.ci=null)}Ri(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ui=()=>{this.Mi();const t=/(?:Version|Mobile)\/1[456]/;ey()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.si.enterRestrictedMode(!0),this.si.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ui))}Oi(){this.ui&&(this.window.removeEventListener("pagehide",this.ui),this.ui=null)}Fi(e){var t;try{const r=((t=this.Ei)===null||t===void 0?void 0:t.getItem(this.vi(e)))!==null;return _("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return oe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Mi(){if(this.Ei)try{this.Ei.setItem(this.vi(this.clientId),String(Date.now()))}catch(e){oe("Failed to set zombie client id.",e)}}Ni(){if(this.Ei)try{this.Ei.removeItem(this.vi(this.clientId))}catch{}}vi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ni(n){return _e(n,"owner")}function qs(n){return _e(n,"clientMetadata")}function ul(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class ll{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.ki=r,this.qi=i}static Qi(e,t){let r=V(),i=V();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new ll(e,t.fromCache,r,i)}}class Db{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class xg{constructor(){this.Ki=!1,this.$i=!1,this.Ui=100,this.Wi=8}initialize(e,t){this.Gi=e,this.indexManager=t,this.Ki=!0}getDocumentsMatchingQuery(e,t,r,i){const s={result:null};return this.zi(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.ji(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;const o=new Db;return this.Hi(e,t,o).next(a=>{if(s.result=a,this.$i)return this.Ji(e,t,o,a.size)})}).next(()=>s.result)}Ji(e,t,r,i){return r.documentReadCount<this.Ui?(er()<=x.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",tr(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Ui,"documents"),p.resolve()):(er()<=x.DEBUG&&_("QueryEngine","Query:",tr(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Wi*i?(er()<=x.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",tr(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Oe(t))):p.resolve())}zi(e,t){if(Xh(t))return p.resolve(null);let r=Oe(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=wo(t,null,"F"),r=Oe(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const o=V(...s);return this.Gi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(c=>{const u=this.Yi(t,a);return this.Zi(t,u,o,c.readTime)?this.zi(e,wo(t,null,"F")):this.Xi(e,u,t,c)}))})))}ji(e,t,r,i){return Xh(t)||i.isEqual(S.min())?p.resolve(null):this.Gi.getDocuments(e,r).next(s=>{const o=this.Yi(t,s);return this.Zi(t,o,r,i)?p.resolve(null):(er()<=x.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),tr(t)),this.Xi(e,o,t,Rm(i,-1)).next(a=>a))})}Yi(e,t){let r=new $(Hm(e));return t.forEach((i,s)=>{vs(e,s)&&(r=r.add(s))}),r}Zi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Hi(e,t,r){return er()<=x.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",tr(t)),this.Gi.getDocumentsMatchingQuery(e,t,ze.min(),r)}Xi(e,t,r,i){return this.Gi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}}class Vb{constructor(e,t,r,i){this.persistence=e,this.es=t,this.serializer=i,this.ts=new z(k),this.ns=new cn(s=>Vn(s),_s),this.rs=new Map,this.ss=e.getRemoteDocumentCache(),this.qr=e.getTargetCache(),this.Kr=e.getBundleCache(),this.os(r)}os(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Vg(this.ss,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ss.setIndexManager(this.indexManager),this.es.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ts))}}function Og(n,e,t,r){return new Vb(n,e,t,r)}async function Lg(n,e){const t=T(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.os(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const o=[],a=[];let c=V();for(const u of i){o.push(u.batchId);for(const l of u.mutations)c=c.add(l.key)}for(const u of s){a.push(u.batchId);for(const l of u.mutations)c=c.add(l.key)}return t.localDocuments.getDocuments(r,c).next(u=>({_s:u,removedBatchIds:o,addedBatchIds:a}))})})}function Nb(n,e){const t=T(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.ss.newChangeBuffer({trackRemovals:!0});return function(a,c,u,l){const h=u.batch,d=h.keys();let f=p.resolve();return d.forEach(w=>{f=f.next(()=>l.getEntry(c,w)).next(E=>{const I=u.docVersions.get(w);b(I!==null),E.version.compareTo(I)<0&&(h.applyToRemoteDocument(E,u),E.isValidDocument()&&(E.setReadTime(u.commitVersion),l.addEntry(E)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(c,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let c=V();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(c=c.add(a.batch.mutations[u].key));return c}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Mg(n){const e=T(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.qr.getLastRemoteSnapshotVersion(t))}function xb(n,e){const t=T(n),r=e.snapshotVersion;let i=t.ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const o=t.ss.newChangeBuffer({trackRemovals:!0});i=t.ts;const a=[];e.targetChanges.forEach((l,h)=>{const d=i.get(h);if(!d)return;a.push(t.qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(he.EMPTY_BYTE_STRING,S.min()).withLastLimboFreeSnapshotVersion(S.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(h,f),function(E,I,D){return E.resumeToken.approximateByteSize()===0||I.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=3e8?!0:D.addedDocuments.size+D.modifiedDocuments.size+D.removedDocuments.size>0}(d,f,l)&&a.push(t.qr.updateTargetData(s,f))});let c=Be(),u=V();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(Fg(s,o,e.documentUpdates).next(l=>{c=l.us,u=l.cs})),!r.isEqual(S.min())){const l=t.qr.getLastRemoteSnapshotVersion(s).next(h=>t.qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return p.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,c,u)).next(()=>c)}).then(s=>(t.ts=i,s))}function Fg(n,e,t){let r=V(),i=V();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Be();return t.forEach((a,c)=>{const u=s.get(a);c.isFoundDocument()!==u.isFoundDocument()&&(i=i.add(a)),c.isNoDocument()&&c.version.isEqual(S.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!u.isValidDocument()||c.version.compareTo(u.version)>0||c.version.compareTo(u.version)===0&&u.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):_("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",c.version)}),{us:o,cs:i}})}function Ob(n,e){const t=T(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ar(n,e){const t=T(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.qr.getTargetData(r,e).next(s=>s?(i=s,p.resolve(i)):t.qr.allocateTargetId(r).next(o=>(i=new vt(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.qr.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.ts.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ts=t.ts.insert(r.targetId,r),t.ns.set(e,r.targetId)),r})}async function Rr(n,e,t){const r=T(n),i=r.ts.get(e),s=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i))}catch(o){if(!an(o))throw o;_("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ts=r.ts.remove(e),r.ns.delete(i.target)}function Ro(n,e,t){const r=T(n);let i=S.min(),s=V();return r.persistence.runTransaction("Execute query","readwrite",o=>function(c,u,l){const h=T(c),d=h.ns.get(l);return d!==void 0?p.resolve(h.ts.get(d)):h.qr.getTargetData(u,l)}(r,o,Oe(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.qr.getMatchingKeysForTargetId(o,a.targetId).next(c=>{s=c})}).next(()=>r.es.getDocumentsMatchingQuery(o,e,t?i:S.min(),t?s:V())).next(a=>(qg(r,Km(e),a),{documents:a,ls:s})))}function Ug(n,e){const t=T(n),r=T(t.qr),i=t.ts.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(o=>o?o.target:null))}function Bg(n,e){const t=T(n),r=t.rs.get(e)||S.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.ss.getAllFromCollectionGroup(i,e,Rm(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(qg(t,e,i),i))}function qg(n,e,t){let r=n.rs.get(e)||S.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.rs.set(e,r)}async function Lb(n,e,t,r){const i=T(n);let s=V(),o=Be();for(const u of t){const l=e.hs(u.metadata.name);u.document&&(s=s.add(l));const h=e.Ps(u);h.setReadTime(e.Is(u.metadata.readTime)),o=o.insert(l,h)}const a=i.ss.newChangeBuffer({trackRemovals:!0}),c=await Ar(i,function(l){return Oe(Fr(F.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",u=>Fg(u,a,o).next(l=>(a.apply(u),l)).next(l=>i.qr.removeMatchingKeysForTargetId(u,c.targetId).next(()=>i.qr.addMatchingKeys(u,s,c.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(u,l.us,l.cs)).next(()=>l.us)))}async function Mb(n,e,t=V()){const r=await Ar(n,Oe(il(e.bundledQuery))),i=T(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const o=ae(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Kr.saveNamedQuery(s,e);const a=r.withResumeToken(he.EMPTY_BYTE_STRING,o);return i.ts=i.ts.insert(a.targetId,a),i.qr.updateTargetData(s,a).next(()=>i.qr.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.qr.addMatchingKeys(s,t,r.targetId)).next(()=>i.Kr.saveNamedQuery(s,e))})}function Sd(n,e){return`firestore_clients_${n}_${e}`}function Pd(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Xa(n,e){return`firestore_targets_${n}_${e}`}class bo{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Ts(e,t,r){const i=JSON.parse(r);let s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new g(i.error.code,i.error.message))),o?new bo(e,t,i.state,s):(oe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class wi{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Ts(e,t){const r=JSON.parse(t);let i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new g(r.error.code,r.error.message))),s?new wi(e,r.state,i):(oe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}Es(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class So{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Ts(e,t){const r=JSON.parse(t);let i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Ju();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=Cm(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new So(e,s):(oe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class hl{constructor(e,t){this.clientId=e,this.onlineState=t}static Ts(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new hl(t.clientId,t.onlineState):(oe("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Uc{constructor(){this.activeTargetIds=Ju()}ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}As(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Es(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Za{constructor(e,t,r,i,s){this.window=e,this.si=t,this.persistenceKey=r,this.Rs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Vs=this.fs.bind(this),this.gs=new z(k),this.started=!1,this.ps=[];const o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ys=Sd(this.persistenceKey,this.Rs),this.ws=function(c){return`firestore_sequence_number_${c}`}(this.persistenceKey),this.gs=this.gs.insert(this.Rs,new Uc),this.Ss=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.bs=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Ds=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.Cs=function(c){return`firestore_online_state_${c}`}(this.persistenceKey),this.vs=function(c){return`firestore_bundle_loaded_v2_${c}`}(this.persistenceKey),this.window.addEventListener("storage",this.Vs)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Bi();for(const r of e){if(r===this.Rs)continue;const i=this.getItem(Sd(this.persistenceKey,r));if(i){const s=So.Ts(r,i);s&&(this.gs=this.gs.insert(s.clientId,s))}}this.Fs();const t=this.storage.getItem(this.Cs);if(t){const r=this.Ms(t);r&&this.xs(r)}for(const r of this.ps)this.fs(r);this.ps=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.ws,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Os(this.gs)}isActiveQueryTarget(e){let t=!1;return this.gs.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ns(e,"pending")}updateMutationState(e,t,r){this.Ns(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(Xa(this.persistenceKey,e));if(r){const i=wi.Ts(e,r);i&&(t=i.state)}}return this.Ls.ds(e),this.Fs(),t}removeLocalQueryTarget(e){this.Ls.As(e),this.Fs()}isLocalQueryTarget(e){return this.Ls.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Xa(this.persistenceKey,e))}updateQueryState(e,t,r){this.ks(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.qs(e)}notifyBundleLoaded(e){this.Qs(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.Vs),this.removeItem(this.ys),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return _("SharedClientState","READ",e,t),t}setItem(e,t){_("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){_("SharedClientState","REMOVE",e),this.storage.removeItem(e)}fs(e){const t=e;if(t.storageArea===this.storage){if(_("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ys)return void oe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.si.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.Ss.test(t.key)){if(t.newValue==null){const r=this.Ks(t.key);return this.$s(r,null)}{const r=this.Us(t.key,t.newValue);if(r)return this.$s(r.clientId,r)}}else if(this.bs.test(t.key)){if(t.newValue!==null){const r=this.Ws(t.key,t.newValue);if(r)return this.Gs(r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){const r=this.zs(t.key,t.newValue);if(r)return this.js(r)}}else if(t.key===this.Cs){if(t.newValue!==null){const r=this.Ms(t.newValue);if(r)return this.xs(r)}}else if(t.key===this.ws){const r=function(s){let o=Fe._e;if(s!=null)try{const a=JSON.parse(s);b(typeof a=="number"),o=a}catch(a){oe("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==Fe._e&&this.sequenceNumberHandler(r)}else if(t.key===this.vs){const r=this.Hs(t.newValue);await Promise.all(r.map(i=>this.syncEngine.Js(i)))}}}else this.ps.push(t)})}}get Ls(){return this.gs.get(this.Rs)}Fs(){this.setItem(this.ys,this.Ls.Es())}Ns(e,t,r){const i=new bo(this.currentUser,e,t,r),s=Pd(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Es())}Bs(e){const t=Pd(this.persistenceKey,this.currentUser,e);this.removeItem(t)}qs(e){const t={clientId:this.Rs,onlineState:e};this.storage.setItem(this.Cs,JSON.stringify(t))}ks(e,t,r){const i=Xa(this.persistenceKey,e),s=new wi(e,t,r);this.setItem(i,s.Es())}Qs(e){const t=JSON.stringify(Array.from(e));this.setItem(this.vs,t)}Ks(e){const t=this.Ss.exec(e);return t?t[1]:null}Us(e,t){const r=this.Ks(e);return So.Ts(r,t)}Ws(e,t){const r=this.bs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return bo.Ts(new fe(s),i,t)}zs(e,t){const r=this.Ds.exec(e),i=Number(r[1]);return wi.Ts(i,t)}Ms(e){return hl.Ts(e)}Hs(e){return JSON.parse(e)}async Gs(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Ys(e.batchId,e.state,e.error);_("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}js(e){return this.syncEngine.Zs(e.targetId,e.state,e.error)}$s(e,t){const r=t?this.gs.insert(e,t):this.gs.remove(e),i=this.Os(this.gs),s=this.Os(r),o=[],a=[];return s.forEach(c=>{i.has(c)||o.push(c)}),i.forEach(c=>{s.has(c)||a.push(c)}),this.syncEngine.Xs(o,a).then(()=>{this.gs=r})}xs(e){this.gs.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Os(e){let t=Ju();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class $g{constructor(){this.eo=new Uc,this.no={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.eo.ds(e),this.no[e]||"not-current"}updateQueryState(e,t,r){this.no[e]=t}removeLocalQueryTarget(e){this.eo.As(e)}isLocalQueryTarget(e){return this.eo.activeTargetIds.has(e)}clearQueryState(e){delete this.no[e]}getAllActiveQueryTargets(){return this.eo.activeTargetIds}isActiveQueryTarget(e){return this.eo.activeTargetIds.has(e)}start(){return this.eo=new Uc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Fb{ro(e){}shutdown(){}}class Cd{constructor(){this.io=()=>this.so(),this.oo=()=>this._o(),this.ao=[],this.uo()}ro(e){this.ao.push(e)}shutdown(){window.removeEventListener("online",this.io),window.removeEventListener("offline",this.oo)}uo(){window.addEventListener("online",this.io),window.addEventListener("offline",this.oo)}so(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ao)e(0)}_o(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ao)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let $s=null;function ec(){return $s===null?$s=function(){return 268435456+Math.round(2147483648*Math.random())}():$s++,"0x"+$s.toString(16)}const Ub={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Bb{constructor(e){this.co=e.co,this.lo=e.lo}ho(e){this.Po=e}Io(e){this.To=e}onMessage(e){this.Eo=e}close(){this.lo()}send(e){this.co(e)}Ao(){this.Po()}Ro(e){this.To(e)}Vo(e){this.Eo(e)}}const Re="WebChannelConnection";class qb extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.mo=r+"://"+t.host,this.fo=`projects/${i}/databases/${s}`,this.po=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get yo(){return!1}wo(t,r,i,s,o){const a=ec(),c=this.So(t,r);_("RestConnection",`Sending RPC '${t}' ${a}:`,c,i);const u={"google-cloud-resource-prefix":this.fo,"x-goog-request-params":this.po};return this.bo(u,s,o),this.Do(t,c,u,i).then(l=>(_("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw Je("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",c,"request:",i),l})}Co(t,r,i,s,o,a){return this.wo(t,r,i,s,o)}bo(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Mr}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}So(t,r){const i=Ub[t];return`${this.mo}/v1/${r}:${i}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Do(e,t,r,i){const s=ec();return new Promise((o,a)=>{const c=new MA;c.setWithCredentials(!0),c.listenOnce(OA.COMPLETE,()=>{try{switch(c.getLastErrorCode()){case Qa.NO_ERROR:const l=c.getResponseJson();_(Re,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case Qa.TIMEOUT:_(Re,`RPC '${e}' ${s} timed out`),a(new g(m.DEADLINE_EXCEEDED,"Request time out"));break;case Qa.HTTP_ERROR:const h=c.getStatus();if(_(Re,`RPC '${e}' ${s} failed with status:`,h,"response text:",c.getResponseText()),h>0){let d=c.getResponseJson();Array.isArray(d)&&(d=d[0]);const f=d==null?void 0:d.error;if(f&&f.status&&f.message){const w=function(I){const D=I.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(D)>=0?D:m.UNKNOWN}(f.status);a(new g(w,f.message))}else a(new g(m.UNKNOWN,"Server responded with status "+c.getStatus()))}else a(new g(m.UNAVAILABLE,"Connection failed."));break;default:R()}}finally{_(Re,`RPC '${e}' ${s} completed.`)}});const u=JSON.stringify(i);_(Re,`RPC '${e}' ${s} sending request:`,i),c.send(t,"POST",u,r,15)})}vo(e,t,r){const i=ec(),s=[this.mo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=NA(),a=xA(),c={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(c.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(c.useFetchStreams=!0),this.bo(c.initMessageHeaders,t,r),c.encodeInitMessageHeaders=!0;const l=s.join("");_(Re,`Creating RPC '${e}' stream ${i}: ${l}`,c);const h=o.createWebChannel(l,c);let d=!1,f=!1;const w=new Bb({co:I=>{f?_(Re,`Not sending because RPC '${e}' stream ${i} is closed:`,I):(d||(_(Re,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),_(Re,`RPC '${e}' stream ${i} sending:`,I),h.send(I))},lo:()=>h.close()}),E=(I,D,L)=>{I.listen(D,N=>{try{L(N)}catch(W){setTimeout(()=>{throw W},0)}})};return E(h,Ms.EventType.OPEN,()=>{f||_(Re,`RPC '${e}' stream ${i} transport opened.`)}),E(h,Ms.EventType.CLOSE,()=>{f||(f=!0,_(Re,`RPC '${e}' stream ${i} transport closed`),w.Ro())}),E(h,Ms.EventType.ERROR,I=>{f||(f=!0,Je(Re,`RPC '${e}' stream ${i} transport errored:`,I),w.Ro(new g(m.UNAVAILABLE,"The operation could not be completed")))}),E(h,Ms.EventType.MESSAGE,I=>{var D;if(!f){const L=I.data[0];b(!!L);const N=L,W=N.error||((D=N[0])===null||D===void 0?void 0:D.error);if(W){_(Re,`RPC '${e}' stream ${i} received error:`,W);const H=W.status;let j=function(Gr){const Ds=ce[Gr];if(Ds!==void 0)return cg(Ds)}(H),le=W.message;j===void 0&&(j=m.INTERNAL,le="Unknown error status: "+H+" with message "+W.message),f=!0,w.Ro(new g(j,le)),h.close()}else _(Re,`RPC '${e}' stream ${i} received:`,L),w.Vo(L)}}),E(a,LA.STAT_EVENT,I=>{I.stat===Lh.PROXY?_(Re,`RPC '${e}' stream ${i} detected buffering proxy`):I.stat===Lh.NOPROXY&&_(Re,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{w.Ao()},0),w}}function jg(){return typeof window<"u"?window:null}function Zs(){return typeof document<"u"?document:null}function Ts(n){return new QR(n,!0)}class dl{constructor(e,t,r=1e3,i=1.5,s=6e4){this.si=e,this.timerId=t,this.Fo=r,this.Mo=i,this.xo=s,this.Oo=0,this.No=null,this.Bo=Date.now(),this.reset()}reset(){this.Oo=0}Lo(){this.Oo=this.xo}ko(e){this.cancel();const t=Math.floor(this.Oo+this.qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&_("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Oo} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.No=this.si.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.Oo*=this.Mo,this.Oo<this.Fo&&(this.Oo=this.Fo),this.Oo>this.xo&&(this.Oo=this.xo)}Qo(){this.No!==null&&(this.No.skipDelay(),this.No=null)}cancel(){this.No!==null&&(this.No.cancel(),this.No=null)}qo(){return(Math.random()-.5)*this.Oo}}class zg{constructor(e,t,r,i,s,o,a,c){this.si=e,this.Ko=r,this.$o=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.Uo=0,this.Wo=null,this.Go=null,this.stream=null,this.zo=new dl(e,t)}jo(){return this.state===1||this.state===5||this.Ho()}Ho(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Jo()}async stop(){this.jo()&&await this.close(0)}Yo(){this.state=0,this.zo.reset()}Zo(){this.Ho()&&this.Wo===null&&(this.Wo=this.si.enqueueAfterDelay(this.Ko,6e4,()=>this.Xo()))}e_(e){this.t_(),this.stream.send(e)}async Xo(){if(this.Ho())return this.close(0)}t_(){this.Wo&&(this.Wo.cancel(),this.Wo=null)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}async close(e,t){this.t_(),this.n_(),this.zo.cancel(),this.Uo++,e!==4?this.zo.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(oe(t.toString()),oe("Using maximum backoff delay to prevent overloading the backend."),this.zo.Lo()):t&&t.code===m.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.r_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Io(t)}r_(){}auth(){this.state=1;const e=this.i_(this.Uo),t=this.Uo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Uo===t&&this.s_(r,i)},r=>{e(()=>{const i=new g(m.UNKNOWN,"Fetching auth token failed: "+r.message);return this.o_(i)})})}s_(e,t){const r=this.i_(this.Uo);this.stream=this.__(e,t),this.stream.ho(()=>{r(()=>(this.state=2,this.Go=this.si.enqueueAfterDelay(this.$o,1e4,()=>(this.Ho()&&(this.state=3),Promise.resolve())),this.listener.ho()))}),this.stream.Io(i=>{r(()=>this.o_(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Jo(){this.state=5,this.zo.ko(async()=>{this.state=0,this.start()})}o_(e){return _("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}i_(e){return t=>{this.si.enqueueAndForget(()=>this.Uo===e?t():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $b extends zg{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}__(e,t){return this.connection.vo("Listen",e,t)}onMessage(e){this.zo.reset();const t=XR(this.serializer,e),r=function(s){if(!("targetChange"in s))return S.min();const o=s.targetChange;return o.targetIds&&o.targetIds.length?S.min():o.readTime?ae(o.readTime):S.min()}(e);return this.listener.a_(t,r)}u_(e){const t={};t.database=Hi(this.serializer),t.addTarget=function(s,o){let a;const c=o.target;if(a=vo(c)?{documents:_g(s,c)}:{query:yg(s,c)},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=dg(s,o.resumeToken);const u=Nc(s,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(S.min())>0){a.readTime=Tr(s,o.snapshotVersion.toTimestamp());const u=Nc(s,o.expectedCount);u!==null&&(a.expectedCount=u)}return a}(this.serializer,e);const r=eb(this.serializer,e);r&&(t.labels=r),this.e_(t)}c_(e){const t={};t.database=Hi(this.serializer),t.removeTarget=e,this.e_(t)}}class jb extends zg{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.l_=!1}get h_(){return this.l_}start(){this.l_=!1,this.lastStreamToken=void 0,super.start()}r_(){this.l_&&this.P_([])}__(e,t){return this.connection.vo("Write",e,t)}onMessage(e){if(b(!!e.streamToken),this.lastStreamToken=e.streamToken,this.l_){this.zo.reset();const t=ZR(e.writeResults,e.commitTime),r=ae(e.commitTime);return this.listener.I_(r,t)}return b(!e.writeResults||e.writeResults.length===0),this.l_=!0,this.listener.T_()}E_(){const e={};e.database=Hi(this.serializer),this.e_(e)}P_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>Qi(this.serializer,r))};this.e_(t)}}class zb extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.d_=!1}A_(){if(this.d_)throw new g(m.FAILED_PRECONDITION,"The client has already been terminated.")}wo(e,t,r){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.wo(e,t,r,i,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new g(m.UNKNOWN,i.toString())})}Co(e,t,r,i){return this.A_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Co(e,t,r,s,o,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new g(m.UNKNOWN,s.toString())})}terminate(){this.d_=!0}}class Wb{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.V_=0,this.m_=null,this.f_=!0}g_(){this.V_===0&&(this.p_("Unknown"),this.m_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.m_=null,this.y_("Backend didn't respond within 10 seconds."),this.p_("Offline"),Promise.resolve())))}w_(e){this.state==="Online"?this.p_("Unknown"):(this.V_++,this.V_>=1&&(this.S_(),this.y_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.p_("Offline")))}set(e){this.S_(),this.V_=0,e==="Online"&&(this.f_=!1),this.p_(e)}p_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}y_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.f_?(oe(t),this.f_=!1):_("OnlineStateTracker",t)}S_(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}}class Gb{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.b_=[],this.D_=new Map,this.C_=new Set,this.v_=[],this.F_=s,this.F_.ro(o=>{r.enqueueAndForget(async()=>{un(this)&&(_("RemoteStore","Restarting streams for network reachability change."),await async function(c){const u=T(c);u.C_.add(4),await qr(u),u.M_.set("Unknown"),u.C_.delete(4),await As(u)}(this))})}),this.M_=new Wb(r,i)}}async function As(n){if(un(n))for(const e of n.v_)await e(!0)}async function qr(n){for(const e of n.v_)await e(!1)}function ma(n,e){const t=T(n);t.D_.has(e.targetId)||(t.D_.set(e.targetId,e),ml(t)?pl(t):jr(t).Ho()&&fl(t,e))}function Yi(n,e){const t=T(n),r=jr(t);t.D_.delete(e),r.Ho()&&Wg(t,e),t.D_.size===0&&(r.Ho()?r.Zo():un(t)&&t.M_.set("Unknown"))}function fl(n,e){if(n.x_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(S.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}jr(n).u_(e)}function Wg(n,e){n.x_.Oe(e),jr(n).c_(e)}function pl(n){n.x_=new WR({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.D_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),jr(n).start(),n.M_.g_()}function ml(n){return un(n)&&!jr(n).jo()&&n.D_.size>0}function un(n){return T(n).C_.size===0}function Gg(n){n.x_=void 0}async function Kb(n){n.D_.forEach((e,t)=>{fl(n,e)})}async function Hb(n,e){Gg(n),ml(n)?(n.M_.w_(e),pl(n)):n.M_.set("Unknown")}async function Qb(n,e,t){if(n.M_.set("Online"),e instanceof hg&&e.state===2&&e.cause)try{await async function(i,s){const o=s.cause;for(const a of s.targetIds)i.D_.has(a)&&(await i.remoteSyncer.rejectListen(a,o),i.D_.delete(a),i.x_.removeTarget(a))}(n,e)}catch(r){_("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Po(n,r)}else if(e instanceof Xs?n.x_.$e(e):e instanceof lg?n.x_.Je(e):n.x_.Ge(e),!t.isEqual(S.min()))try{const r=await Mg(n.localStore);t.compareTo(r)>=0&&await function(s,o){const a=s.x_.it(o);return a.targetChanges.forEach((c,u)=>{if(c.resumeToken.approximateByteSize()>0){const l=s.D_.get(u);l&&s.D_.set(u,l.withResumeToken(c.resumeToken,o))}}),a.targetMismatches.forEach((c,u)=>{const l=s.D_.get(c);if(!l)return;s.D_.set(c,l.withResumeToken(he.EMPTY_BYTE_STRING,l.snapshotVersion)),Wg(s,c);const h=new vt(l.target,c,u,l.sequenceNumber);fl(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t)}catch(r){_("RemoteStore","Failed to raise snapshot:",r),await Po(n,r)}}async function Po(n,e,t){if(!an(e))throw e;n.C_.add(1),await qr(n),n.M_.set("Offline"),t||(t=()=>Mg(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{_("RemoteStore","Retrying IndexedDB access"),await t(),n.C_.delete(1),await As(n)})}function Kg(n,e){return e().catch(t=>Po(n,t,e))}async function $r(n){const e=T(n),t=Xt(e);let r=e.b_.length>0?e.b_[e.b_.length-1].batchId:-1;for(;Yb(e);)try{const i=await Ob(e.localStore,r);if(i===null){e.b_.length===0&&t.Zo();break}r=i.batchId,Jb(e,i)}catch(i){await Po(e,i)}Hg(e)&&Qg(e)}function Yb(n){return un(n)&&n.b_.length<10}function Jb(n,e){n.b_.push(e);const t=Xt(n);t.Ho()&&t.h_&&t.P_(e.mutations)}function Hg(n){return un(n)&&!Xt(n).jo()&&n.b_.length>0}function Qg(n){Xt(n).start()}async function Xb(n){Xt(n).E_()}async function Zb(n){const e=Xt(n);for(const t of n.b_)e.P_(t.mutations)}async function eS(n,e,t){const r=n.b_.shift(),i=el.from(r,e,t);await Kg(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),await $r(n)}async function tS(n,e){e&&Xt(n).h_&&await async function(r,i){if(function(o){return ag(o)&&o!==m.ABORTED}(i.code)){const s=r.b_.shift();Xt(r).Yo(),await Kg(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await $r(r)}}(n,e),Hg(n)&&Qg(n)}async function kd(n,e){const t=T(n);t.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");const r=un(t);t.C_.add(3),await qr(t),r&&t.M_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.C_.delete(3),await As(t)}async function Bc(n,e){const t=T(n);e?(t.C_.delete(2),await As(t)):e||(t.C_.add(2),await qr(t),t.M_.set("Unknown"))}function jr(n){return n.O_||(n.O_=function(t,r,i){const s=T(t);return s.A_(),new $b(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:Kb.bind(null,n),Io:Hb.bind(null,n),a_:Qb.bind(null,n)}),n.v_.push(async e=>{e?(n.O_.Yo(),ml(n)?pl(n):n.M_.set("Unknown")):(await n.O_.stop(),Gg(n))})),n.O_}function Xt(n){return n.N_||(n.N_=function(t,r,i){const s=T(t);return s.A_(),new jb(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{ho:Xb.bind(null,n),Io:tS.bind(null,n),T_:Zb.bind(null,n),I_:eS.bind(null,n)}),n.v_.push(async e=>{e?(n.N_.Yo(),await $r(n)):(await n.N_.stop(),n.b_.length>0&&(_("RemoteStore",`Stopping write stream with ${n.b_.length} pending writes`),n.b_=[]))})),n.N_}class gl{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new pe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){const o=Date.now()+r,a=new gl(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new g(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function zr(n,e){if(oe("AsyncQueue",`${e}: ${n}`),an(n))return new g(m.UNAVAILABLE,`${e}: ${n}`);throw n}class fr{constructor(e){this.comparator=e?(t,r)=>e(t,r)||v.comparator(t.key,r.key):(t,r)=>v.comparator(t.key,r.key),this.keyedMap=ui(),this.sortedSet=new z(this.comparator)}static emptySet(e){return new fr(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof fr)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new fr;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Dd{constructor(){this.B_=new z(v.comparator)}track(e){const t=e.doc.key,r=this.B_.get(t);r?e.type!==0&&r.type===3?this.B_=this.B_.insert(t,e):e.type===3&&r.type!==1?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.B_=this.B_.remove(t):e.type===1&&r.type===2?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):R():this.B_=this.B_.insert(t,e)}L_(){const e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}}class br{constructor(e,t,r,i,s,o,a,c,u){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=u}static fromInitialDocuments(e,t,r,i,s){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new br(e,t,fr.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ys(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class nS{constructor(){this.k_=void 0,this.listeners=[]}}class rS{constructor(){this.queries=new cn(e=>Gm(e),ys),this.onlineState="Unknown",this.q_=new Set}}async function _l(n,e){const t=T(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new nS),i)try{s.k_=await t.onListen(r)}catch(o){const a=zr(o,`Initialization of query '${tr(e.query)}' failed`);return void e.onError(a)}t.queries.set(r,s),s.listeners.push(e),e.Q_(t.onlineState),s.k_&&e.K_(s.k_)&&vl(t)}async function yl(n,e){const t=T(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=s.listeners.length===0)}if(i)return t.queries.delete(r),t.onUnlisten(r)}function iS(n,e){const t=T(n);let r=!1;for(const i of e){const s=i.query,o=t.queries.get(s);if(o){for(const a of o.listeners)a.K_(i)&&(r=!0);o.k_=i}}r&&vl(t)}function sS(n,e,t){const r=T(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function vl(n){n.q_.forEach(e=>{e.next()})}class Il{constructor(e,t,r){this.query=e,this.U_=t,this.W_=!1,this.G_=null,this.onlineState="Unknown",this.options=r||{}}K_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new br(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.W_?this.z_(e)&&(this.U_.next(e),t=!0):this.j_(e,this.onlineState)&&(this.H_(e),t=!0),this.G_=e,t}onError(e){this.U_.error(e)}Q_(e){this.onlineState=e;let t=!1;return this.G_&&!this.W_&&this.j_(this.G_,e)&&(this.H_(this.G_),t=!0),t}j_(e,t){if(!e.fromCache)return!0;const r=t!=="Offline";return(!this.options.J_||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}z_(e){if(e.docChanges.length>0)return!0;const t=this.G_&&this.G_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}H_(e){e=br.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.W_=!0,this.U_.next(e)}}class oS{constructor(e,t){this.Y_=e,this.byteLength=t}Z_(){return"metadata"in this.Y_}}class Vd{constructor(e){this.serializer=e}hs(e){return lt(this.serializer,e)}Ps(e){return e.metadata.exists?gg(this.serializer,e.document,!1):K.newNoDocument(this.hs(e.metadata.name),this.Is(e.metadata.readTime))}Is(e){return ae(e)}}class aS{constructor(e,t,r){this.X_=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Yg(e)}ea(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.Y_.namedQuery)this.queries.push(e.Y_.namedQuery);else if(e.Y_.documentMetadata){this.documents.push({metadata:e.Y_.documentMetadata}),e.Y_.documentMetadata.exists||++t;const r=F.fromString(e.Y_.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.Y_.document&&(this.documents[this.documents.length-1].document=e.Y_.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}ta(e){const t=new Map,r=new Vd(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.hs(i.metadata.name);for(const o of i.metadata.queries){const a=(t.get(o)||V()).add(s);t.set(o,a)}}return t}async complete(){const e=await Lb(this.localStore,new Vd(this.serializer),this.documents,this.X_.id),t=this.ta(this.documents);for(const r of this.queries)await Mb(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,na:this.collectionGroups,ra:e}}}function Yg(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Jg{constructor(e){this.key=e}}class Xg{constructor(e){this.key=e}}class Zg{constructor(e,t){this.query=e,this.ia=t,this.sa=null,this.hasCachedResults=!1,this.current=!1,this.oa=V(),this.mutatedKeys=V(),this._a=Hm(e),this.aa=new fr(this._a)}get ua(){return this.ia}ca(e,t){const r=t?t.la:new Dd,i=t?t.aa:this.aa;let s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1;const c=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,u=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{const d=i.get(l),f=vs(this.query,h)?h:null,w=!!d&&this.mutatedKeys.has(d.key),E=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let I=!1;d&&f?d.data.isEqual(f.data)?w!==E&&(r.track({type:3,doc:f}),I=!0):this.ha(d,f)||(r.track({type:2,doc:f}),I=!0,(c&&this._a(f,c)>0||u&&this._a(f,u)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),I=!0):d&&!f&&(r.track({type:1,doc:d}),I=!0,(c||u)&&(a=!0)),I&&(f?(o=o.add(f),s=E?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{aa:o,la:r,Zi:a,mutatedKeys:s}}ha(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){const s=this.aa;this.aa=e.aa,this.mutatedKeys=e.mutatedKeys;const o=e.la.L_();o.sort((l,h)=>function(f,w){const E=I=>{switch(I){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return R()}};return E(f)-E(w)}(l.type,h.type)||this._a(l.doc,h.doc)),this.Pa(r),i=i!=null&&i;const a=t&&!i?this.Ia():[],c=this.oa.size===0&&this.current&&!i?1:0,u=c!==this.sa;return this.sa=c,o.length!==0||u?{snapshot:new br(this.query,e.aa,s,o,e.mutatedKeys,c===0,u,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ta:a}:{Ta:a}}Q_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({aa:this.aa,la:new Dd,mutatedKeys:this.mutatedKeys,Zi:!1},!1)):{Ta:[]}}Ea(e){return!this.ia.has(e)&&!!this.aa.has(e)&&!this.aa.get(e).hasLocalMutations}Pa(e){e&&(e.addedDocuments.forEach(t=>this.ia=this.ia.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ia=this.ia.delete(t)),this.current=e.current)}Ia(){if(!this.current)return[];const e=this.oa;this.oa=V(),this.aa.forEach(r=>{this.Ea(r.key)&&(this.oa=this.oa.add(r.key))});const t=[];return e.forEach(r=>{this.oa.has(r)||t.push(new Xg(r))}),this.oa.forEach(r=>{e.has(r)||t.push(new Jg(r))}),t}da(e){this.ia=e.ls,this.oa=V();const t=this.ca(e.documents);return this.applyChanges(t,!0)}Aa(){return br.fromInitialDocuments(this.query,this.aa,this.mutatedKeys,this.sa===0,this.hasCachedResults)}}class cS{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class uS{constructor(e){this.key=e,this.Ra=!1}}class lS{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.Va={},this.ma=new cn(a=>Gm(a),ys),this.fa=new Map,this.ga=new Set,this.pa=new z(v.comparator),this.ya=new Map,this.wa=new al,this.Sa={},this.ba=new Map,this.Da=Mn.Nn(),this.onlineState="Unknown",this.Ca=void 0}get isPrimaryClient(){return this.Ca===!0}}async function hS(n,e){const t=Rl(n);let r,i;const s=t.ma.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.Aa();else{const o=await Ar(t.localStore,Oe(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=await wl(t,e,r,a==="current",o.resumeToken),t.isPrimaryClient&&ma(t.remoteStore,o)}return i}async function wl(n,e,t,r,i){n.va=(h,d,f)=>async function(E,I,D,L){let N=I.view.ca(D);N.Zi&&(N=await Ro(E.localStore,I.query,!1).then(({documents:le})=>I.view.ca(le,N)));const W=L&&L.targetChanges.get(I.targetId),H=L&&L.targetMismatches.get(I.targetId)!=null,j=I.view.applyChanges(N,E.isPrimaryClient,W,H);return qc(E,I.targetId,j.Ta),j.snapshot}(n,h,d,f);const s=await Ro(n.localStore,e,!0),o=new Zg(e,s.ls),a=o.ca(s.documents),c=Es.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),u=o.applyChanges(a,n.isPrimaryClient,c);qc(n,t,u.Ta);const l=new cS(e,t,o);return n.ma.set(e,l),n.fa.has(t)?n.fa.get(t).push(e):n.fa.set(t,[e]),u.snapshot}async function dS(n,e){const t=T(n),r=t.ma.get(e),i=t.fa.get(r.targetId);if(i.length>1)return t.fa.set(r.targetId,i.filter(s=>!ys(s,e))),void t.ma.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||await Rr(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Yi(t.remoteStore,r.targetId),Sr(t,r.targetId)}).catch(on)):(Sr(t,r.targetId),await Rr(t.localStore,r.targetId,!0))}async function fS(n,e,t){const r=bl(n);try{const i=await function(o,a){const c=T(o),u=J.now(),l=a.reduce((f,w)=>f.add(w.key),V());let h,d;return c.persistence.runTransaction("Locally write mutations","readwrite",f=>{let w=Be(),E=V();return c.ss.getEntries(f,l).next(I=>{w=I,w.forEach((D,L)=>{L.isValidDocument()||(E=E.add(D))})}).next(()=>c.localDocuments.getOverlayedDocuments(f,w)).next(I=>{h=I;const D=[];for(const L of a){const N=$R(L,h.get(L.key).overlayedDocument);N!=null&&D.push(new Ct(L.key,N,Mm(N.value.mapValue),Y.exists(!0)))}return c.mutationQueue.addMutationBatch(f,u,D,a)}).next(I=>{d=I;const D=I.applyToLocalDocumentSet(h,E);return c.documentOverlayCache.saveOverlays(f,I.batchId,D)})}).then(()=>({batchId:d.batchId,changes:Ym(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,c){let u=o.Sa[o.currentUser.toKey()];u||(u=new z(k)),u=u.insert(a,c),o.Sa[o.currentUser.toKey()]=u}(r,i.batchId,t),await kt(r,i.changes),await $r(r.remoteStore)}catch(i){const s=zr(i,"Failed to persist write");t.reject(s)}}async function e_(n,e){const t=T(n);try{const r=await xb(t.localStore,e);e.targetChanges.forEach((i,s)=>{const o=t.ya.get(s);o&&(b(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.Ra=!0:i.modifiedDocuments.size>0?b(o.Ra):i.removedDocuments.size>0&&(b(o.Ra),o.Ra=!1))}),await kt(t,r,e)}catch(r){await on(r)}}function Nd(n,e,t){const r=T(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const i=[];r.ma.forEach((s,o)=>{const a=o.view.Q_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){const c=T(o);c.onlineState=a;let u=!1;c.queries.forEach((l,h)=>{for(const d of h.listeners)d.Q_(a)&&(u=!0)}),u&&vl(c)}(r.eventManager,e),i.length&&r.Va.a_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function pS(n,e,t){const r=T(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.ya.get(e),s=i&&i.key;if(s){let o=new z(v.comparator);o=o.insert(s,K.newNoDocument(s,S.min()));const a=V().add(s),c=new ws(S.min(),new Map,new z(k),o,a);await e_(r,c),r.pa=r.pa.remove(s),r.ya.delete(e),Al(r)}else await Rr(r.localStore,e,!1).then(()=>Sr(r,e,t)).catch(on)}async function mS(n,e){const t=T(n),r=e.batch.batchId;try{const i=await Nb(t.localStore,e);Tl(t,r,null),El(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await kt(t,i)}catch(i){await on(i)}}async function gS(n,e,t){const r=T(n);try{const i=await function(o,a){const c=T(o);return c.persistence.runTransaction("Reject batch","readwrite-primary",u=>{let l;return c.mutationQueue.lookupMutationBatch(u,a).next(h=>(b(h!==null),l=h.keys(),c.mutationQueue.removeMutationBatch(u,h))).next(()=>c.mutationQueue.performConsistencyCheck(u)).next(()=>c.documentOverlayCache.removeOverlaysForBatchId(u,l,a)).next(()=>c.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,l)).next(()=>c.localDocuments.getDocuments(u,l))})}(r.localStore,e);Tl(r,e,t),El(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await kt(r,i)}catch(i){await on(i)}}async function _S(n,e){const t=T(n);un(t.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(o){const a=T(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",c=>a.mutationQueue.getHighestUnacknowledgedBatchId(c))}(t.localStore);if(r===-1)return void e.resolve();const i=t.ba.get(r)||[];i.push(e),t.ba.set(r,i)}catch(r){const i=zr(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}function El(n,e){(n.ba.get(e)||[]).forEach(t=>{t.resolve()}),n.ba.delete(e)}function Tl(n,e,t){const r=T(n);let i=r.Sa[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Sa[r.currentUser.toKey()]=i}}function Sr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.fa.get(e))n.ma.delete(r),t&&n.Va.Fa(r,t);n.fa.delete(e),n.isPrimaryClient&&n.wa.Rr(e).forEach(r=>{n.wa.containsKey(r)||t_(n,r)})}function t_(n,e){n.ga.delete(e.path.canonicalString());const t=n.pa.get(e);t!==null&&(Yi(n.remoteStore,t),n.pa=n.pa.remove(e),n.ya.delete(t),Al(n))}function qc(n,e,t){for(const r of t)r instanceof Jg?(n.wa.addReference(r.key,e),yS(n,r)):r instanceof Xg?(_("SyncEngine","Document no longer in limbo: "+r.key),n.wa.removeReference(r.key,e),n.wa.containsKey(r.key)||t_(n,r.key)):R()}function yS(n,e){const t=e.key,r=t.path.canonicalString();n.pa.get(t)||n.ga.has(r)||(_("SyncEngine","New document in limbo: "+t),n.ga.add(r),Al(n))}function Al(n){for(;n.ga.size>0&&n.pa.size<n.maxConcurrentLimboResolutions;){const e=n.ga.values().next().value;n.ga.delete(e);const t=new v(F.fromString(e)),r=n.Da.next();n.ya.set(r,new uS(t)),n.pa=n.pa.insert(t,r),ma(n.remoteStore,new vt(Oe(Fr(t.path)),r,"TargetPurposeLimboResolution",Fe._e))}}async function kt(n,e,t){const r=T(n),i=[],s=[],o=[];r.ma.isEmpty()||(r.ma.forEach((a,c)=>{o.push(r.va(c,e,t).then(u=>{if((u||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(c.targetId,u!=null&&u.fromCache?"not-current":"current"),u){i.push(u);const l=ll.Qi(c.targetId,u);s.push(l)}}))}),await Promise.all(o),r.Va.a_(i),await async function(c,u){const l=T(c);try{await l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>p.forEach(u,d=>p.forEach(d.ki,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>p.forEach(d.qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!an(h))throw h;_("LocalStore","Failed to update sequence numbers: "+h)}for(const h of u){const d=h.targetId;if(!h.fromCache){const f=l.ts.get(d),w=f.snapshotVersion,E=f.withLastLimboFreeSnapshotVersion(w);l.ts=l.ts.insert(d,E)}}}(r.localStore,s))}async function vS(n,e){const t=T(n);if(!t.currentUser.isEqual(e)){_("SyncEngine","User change. New user:",e.toKey());const r=await Lg(t.localStore,e);t.currentUser=e,function(s,o){s.ba.forEach(a=>{a.forEach(c=>{c.reject(new g(m.CANCELLED,o))})}),s.ba.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await kt(t,r._s)}}function IS(n,e){const t=T(n),r=t.ya.get(e);if(r&&r.Ra)return V().add(r.key);{let i=V();const s=t.fa.get(e);if(!s)return i;for(const o of s){const a=t.ma.get(o);i=i.unionWith(a.view.ua)}return i}}async function wS(n,e){const t=T(n),r=await Ro(t.localStore,e.query,!0),i=e.view.da(r);return t.isPrimaryClient&&qc(t,e.targetId,i.Ta),i}async function ES(n,e){const t=T(n);return Bg(t.localStore,e).then(r=>kt(t,r))}async function TS(n,e,t,r){const i=T(n),s=await function(a,c){const u=T(a),l=T(u.mutationQueue);return u.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.Cn(h,c).next(d=>d?u.localDocuments.getDocuments(h,d):p.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?await $r(i.remoteStore):t==="acknowledged"||t==="rejected"?(Tl(i,e,r||null),El(i,e),function(a,c){T(T(a).mutationQueue).Fn(c)}(i.localStore,e)):R(),await kt(i,s)):_("SyncEngine","Cannot apply mutation batch with id: "+e)}async function AS(n,e){const t=T(n);if(Rl(t),bl(t),e===!0&&t.Ca!==!0){const r=t.sharedClientState.getAllActiveQueryTargets(),i=await xd(t,r.toArray());t.Ca=!0,await Bc(t.remoteStore,!0);for(const s of i)ma(t.remoteStore,s)}else if(e===!1&&t.Ca!==!1){const r=[];let i=Promise.resolve();t.fa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Sr(t,o),Rr(t.localStore,o,!0))),Yi(t.remoteStore,o)}),await i,await xd(t,r),function(o){const a=T(o);a.ya.forEach((c,u)=>{Yi(a.remoteStore,u)}),a.wa.Vr(),a.ya=new Map,a.pa=new z(v.comparator)}(t),t.Ca=!1,await Bc(t.remoteStore,!1)}}async function xd(n,e,t){const r=T(n),i=[],s=[];for(const o of e){let a;const c=r.fa.get(o);if(c&&c.length!==0){a=await Ar(r.localStore,Oe(c[0]));for(const u of c){const l=r.ma.get(u),h=await wS(r,l);h.snapshot&&s.push(h.snapshot)}}else{const u=await Ug(r.localStore,o);a=await Ar(r.localStore,u),await wl(r,n_(u),o,!1,a.resumeToken)}i.push(a)}return r.Va.a_(s),i}function n_(n){return Wm(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function RS(n){return function(t){return T(T(t).persistence).Bi()}(T(n).localStore)}async function bS(n,e,t,r){const i=T(n);if(i.Ca)return void _("SyncEngine","Ignoring unexpected query state notification.");const s=i.fa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const o=await Bg(i.localStore,Km(s[0])),a=ws.createSynthesizedRemoteEventForCurrentChange(e,t==="current",he.EMPTY_BYTE_STRING);await kt(i,o,a);break}case"rejected":await Rr(i.localStore,e,!0),Sr(i,e,r);break;default:R()}}async function SS(n,e,t){const r=Rl(n);if(r.Ca){for(const i of e){if(r.fa.has(i)){_("SyncEngine","Adding an already active target "+i);continue}const s=await Ug(r.localStore,i),o=await Ar(r.localStore,s);await wl(r,n_(s),o.targetId,!1,o.resumeToken),ma(r.remoteStore,o)}for(const i of t)r.fa.has(i)&&await Rr(r.localStore,i,!1).then(()=>{Yi(r.remoteStore,i),Sr(r,i)}).catch(on)}}function Rl(n){const e=T(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=e_.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=IS.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=pS.bind(null,e),e.Va.a_=iS.bind(null,e.eventManager),e.Va.Fa=sS.bind(null,e.eventManager),e}function bl(n){const e=T(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=mS.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=gS.bind(null,e),e}function PS(n,e,t){const r=T(n);(async function(s,o,a){try{const c=await o.getMetadata();if(await function(f,w){const E=T(f),I=ae(w.createTime);return E.persistence.runTransaction("hasNewerBundle","readonly",D=>E.Kr.getBundleMetadata(D,w.id)).then(D=>!!D&&D.createTime.compareTo(I)>=0)}(s.localStore,c))return await o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(c)),Promise.resolve(new Set);a._updateProgress(Yg(c));const u=new aS(c,s.localStore,o.serializer);let l=await o.Ma();for(;l;){const d=await u.ea(l);d&&a._updateProgress(d),l=await o.Ma()}const h=await u.complete();return await kt(s,h.ra,void 0),await function(f,w){const E=T(f);return E.persistence.runTransaction("Save bundle","readwrite",I=>E.Kr.saveBundleMetadata(I,w))}(s.localStore,c),a._completeWith(h.progress),Promise.resolve(h.na)}catch(c){return Je("SyncEngine",`Loading bundle failed with ${c}`),a._failWith(c),Promise.resolve(new Set)}})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}class $c{constructor(){this.synchronizeTabs=!1}async initialize(e){this.serializer=Ts(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),await this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Og(this.persistence,new xg,e.initialUser,this.serializer)}createPersistence(e){return new Ng(pa.jr,this.serializer)}createSharedClientState(e){return new $g}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class r_ extends $c{constructor(e,t,r){super(),this.xa=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.xa.initialize(this,e),await bl(this.xa.syncEngine),await $r(this.xa.remoteStore),await this.persistence.mi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}createLocalStore(e){return Og(this.persistence,new xg,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){const r=this.persistence.referenceDelegate.garbageCollector;return new gb(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){const r=new ZA(t,this.persistence);return new XA(e.asyncQueue,r)}createPersistence(e){const t=ul(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?Me.withCacheSize(this.cacheSizeBytes):Me.DEFAULT;return new cl(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,jg(),Zs(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new $g}}class CS extends r_{constructor(e,t){super(e,t,!1),this.xa=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.xa.syncEngine;this.sharedClientState instanceof Za&&(this.sharedClientState.syncEngine={Ys:TS.bind(null,t),Zs:bS.bind(null,t),Xs:SS.bind(null,t),Bi:RS.bind(null,t),Js:ES.bind(null,t)},await this.sharedClientState.start()),await this.persistence.mi(async r=>{await AS(this.xa.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}createSharedClientState(e){const t=jg();if(!Za.D(t))throw new g(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=ul(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Za(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class Sl{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Nd(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=vS.bind(null,this.syncEngine),await Bc(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new rS}()}createDatastore(e){const t=Ts(e.databaseInfo.databaseId),r=function(s){return new qb(s)}(e.databaseInfo);return function(s,o,a,c){return new zb(s,o,a,c)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new Gb(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Nd(this.syncEngine,t,0),function(){return Cd.D()?new Cd:new Fb}())}createSyncEngine(e,t){return function(i,s,o,a,c,u,l){const h=new lS(i,s,o,a,c,u);return l&&(h.Ca=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(t){const r=T(t);_("RemoteStore","RemoteStore shutting down."),r.C_.add(5),await qr(r),r.F_.shutdown(),r.M_.set("Unknown")}(this.remoteStore)}}function Od(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}class ga{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Oa(this.observer.next,e)}error(e){this.observer.error?this.Oa(this.observer.error,e):oe("Uncaught Error in snapshot listener:",e.toString())}Na(){this.muted=!0}Oa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class kS{constructor(e,t){this.Ba=e,this.serializer=t,this.metadata=new pe,this.buffer=new Uint8Array,this.La=function(){return new TextDecoder("utf-8")}(),this.ka().then(r=>{r&&r.Z_()?this.metadata.resolve(r.Y_.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.Y_)}`))},r=>this.metadata.reject(r))}close(){return this.Ba.cancel()}async getMetadata(){return this.metadata.promise}async Ma(){return await this.getMetadata(),this.ka()}async ka(){const e=await this.qa();if(e===null)return null;const t=this.La.decode(e),r=Number(t);isNaN(r)&&this.Qa(`length string (${t}) is not valid number`);const i=await this.Ka(r);return new oS(JSON.parse(i),e.length+r)}$a(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async qa(){for(;this.$a()<0&&!await this.Ua(););if(this.buffer.length===0)return null;const e=this.$a();e<0&&this.Qa("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Ka(e){for(;this.buffer.length<e;)await this.Ua()&&this.Qa("Reached the end of bundle when more is expected.");const t=this.La.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Qa(e){throw this.Ba.cancel(),new Error(`Invalid bundle format: ${e}`)}async Ua(){const e=await this.Ba.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}class DS{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new g(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(i,s){const o=T(i),a=Hi(o.serializer)+"/documents",c={documents:s.map(d=>Ki(o.serializer,d))},u=await o.Co("BatchGetDocuments",a,c,s.length),l=new Map;u.forEach(d=>{const f=JR(o.serializer,d);l.set(f.key.toString(),f)});const h=[];return s.forEach(d=>{const f=l.get(d.toString());b(!!f),h.push(f)}),h}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Br(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const i=v.fromPath(r);this.mutations.push(new Xu(i,this.precondition(i)))}),await async function(r,i){const s=T(r),o=Hi(s.serializer)+"/documents",a={writes:i.map(c=>Qi(s.serializer,c))};await s.wo("Commit",o,a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw R();t=S.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new g(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(S.min())?Y.exists(!1):Y.updateTime(t):Y.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(S.min()))throw new g(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Y.updateTime(t)}return Y.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class VS{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Wa=r.maxAttempts,this.zo=new dl(this.asyncQueue,"transaction_retry")}run(){this.Wa-=1,this.Ga()}Ga(){this.zo.ko(async()=>{const e=new DS(this.datastore),t=this.za(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.ja(i)}))}).catch(r=>{this.ja(r)})})}za(e){try{const t=this.updateFunction(e);return!gs(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}ja(e){this.Wa>0&&this.Ha(e)?(this.Wa-=1,this.asyncQueue.enqueueAndForget(()=>(this.Ga(),Promise.resolve()))):this.deferred.reject(e)}Ha(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!ag(t)}return!1}}class NS{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=fe.UNAUTHENTICATED,this.clientId=Tm.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,async s=>{_("FirestoreClient","Received user=",s.uid),await this.authCredentialListener(s),this.user=s}),this.appCheckCredentials.start(r,s=>(_("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new g(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new pe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=zr(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function eo(n,e){n.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");const t=await n.getConfiguration();await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async i=>{r.isEqual(i)||(await Lg(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function jc(n,e){n.asyncQueue.verifyOperationInProgress();const t=await Pl(n);_("FirestoreClient","Initializing OnlineComponentProvider");const r=await n.getConfiguration();await e.initialize(t,r),n.setCredentialChangeListener(i=>kd(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>kd(e.remoteStore,s)),n._onlineComponents=e}function i_(n){return n.name==="FirebaseError"?n.code===m.FAILED_PRECONDITION||n.code===m.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}async function Pl(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){_("FirestoreClient","Using user provided OfflineComponentProvider");try{await eo(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!i_(t))throw t;Je("Error using user provided cache. Falling back to memory cache: "+t),await eo(n,new $c)}}else _("FirestoreClient","Using default OfflineComponentProvider"),await eo(n,new $c);return n._offlineComponents}async function _a(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(_("FirestoreClient","Using user provided OnlineComponentProvider"),await jc(n,n._uninitializedComponentsProvider._online)):(_("FirestoreClient","Using default OnlineComponentProvider"),await jc(n,new Sl))),n._onlineComponents}function s_(n){return Pl(n).then(e=>e.persistence)}function Cl(n){return Pl(n).then(e=>e.localStore)}function o_(n){return _a(n).then(e=>e.remoteStore)}function kl(n){return _a(n).then(e=>e.syncEngine)}function xS(n){return _a(n).then(e=>e.datastore)}async function Pr(n){const e=await _a(n),t=e.eventManager;return t.onListen=hS.bind(null,e.syncEngine),t.onUnlisten=dS.bind(null,e.syncEngine),t}function OS(n){return n.asyncQueue.enqueue(async()=>{const e=await s_(n),t=await o_(n);return e.setNetworkEnabled(!0),function(i){const s=T(i);return s.C_.delete(0),As(s)}(t)})}function LS(n){return n.asyncQueue.enqueue(async()=>{const e=await s_(n),t=await o_(n);return e.setNetworkEnabled(!1),async function(i){const s=T(i);s.C_.add(0),await qr(s),s.M_.set("Offline")}(t)})}function MS(n,e){const t=new pe;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,o){try{const a=await function(u,l){const h=T(u);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new g(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){const c=zr(a,`Failed to get document '${s} from cache`);o.reject(c)}}(await Cl(n),e,t)),t.promise}function a_(n,e,t={}){const r=new pe;return n.asyncQueue.enqueueAndForget(async()=>function(s,o,a,c,u){const l=new ga({next:d=>{o.enqueueAndForget(()=>yl(s,h));const f=d.docs.has(a);!f&&d.fromCache?u.reject(new g(m.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&c&&c.source==="server"?u.reject(new g(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new Il(Fr(a.path),l,{includeMetadataChanges:!0,J_:!0});return _l(s,h)}(await Pr(n),n.asyncQueue,e,t,r)),r.promise}function FS(n,e){const t=new pe;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,o){try{const a=await Ro(i,s,!0),c=new Zg(s,a.ls),u=c.ca(a.documents),l=c.applyChanges(u,!1);o.resolve(l.snapshot)}catch(a){const c=zr(a,`Failed to execute query '${s} against cache`);o.reject(c)}}(await Cl(n),e,t)),t.promise}function c_(n,e,t={}){const r=new pe;return n.asyncQueue.enqueueAndForget(async()=>function(s,o,a,c,u){const l=new ga({next:d=>{o.enqueueAndForget(()=>yl(s,h)),d.fromCache&&c.source==="server"?u.reject(new g(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):u.resolve(d)},error:d=>u.reject(d)}),h=new Il(a,l,{includeMetadataChanges:!0,J_:!0});return _l(s,h)}(await Pr(n),n.asyncQueue,e,t,r)),r.promise}function US(n,e){const t=new ga(e);return n.asyncQueue.enqueueAndForget(async()=>function(i,s){T(i).q_.add(s),s.next()}(await Pr(n),t)),()=>{t.Na(),n.asyncQueue.enqueueAndForget(async()=>function(i,s){T(i).q_.delete(s)}(await Pr(n),t))}}function BS(n,e,t,r){const i=function(o,a){let c;return c=typeof o=="string"?ug().encode(o):o,function(l,h){return new kS(l,h)}(function(l,h){if(l instanceof Uint8Array)return Od(l,h);if(l instanceof ArrayBuffer)return Od(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(c),a)}(t,Ts(e));n.asyncQueue.enqueueAndForget(async()=>{PS(await kl(n),i,r)})}function qS(n,e){return n.asyncQueue.enqueue(async()=>function(r,i){const s=T(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.Kr.getNamedQuery(o,i))}(await Cl(n),e))}function u_(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}const Ld=new Map;function Dl(n,e,t){if(!t)throw new g(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function l_(n,e,t,r){if(e===!0&&r===!0)throw new g(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Md(n){if(!v.isDocumentKey(n))throw new g(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Fd(n){if(v.isDocumentKey(n))throw new g(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function ya(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":R()}function U(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new g(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=ya(n);throw new g(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function h_(n,e){if(e<=0)throw new g(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}class Ud{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new g(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new g(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}l_("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=u_((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new g(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new g(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new g(m.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Rs{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ud({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new g(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new g(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ud(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new qA;switch(r.type){case"firstParty":return new WA(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new g(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=Ld.get(t);r&&(_("ComponentProvider","Removing Datastore"),Ld.delete(t),r.terminate())}(this),Promise.resolve()}}function $S(n,e,t,r={}){var i;const s=(n=U(n,Rs))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&Je("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,c;if(typeof r.mockUserToken=="string")a=r.mockUserToken,c=fe.MOCK_USER;else{a=J_(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);const u=r.mockUserToken.sub||r.mockUserToken.user_id;if(!u)throw new g(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");c=new fe(u)}n._authCredentials=new $A(new Em(a,c))}}let Ce=class{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Ce(this.firestore,e,this._query)}},X=class{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Et(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new X(this.firestore,e,this._key)}},Et=class extends Ce{constructor(e,t,r){super(e,t,Fr(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new X(this.firestore,null,new v(e))}withConverter(e){return new Et(this.firestore,e,this._path)}};function d_(n,e,...t){if(n=P(n),Dl("collection","path",e),n instanceof Rs){const r=F.fromString(e,...t);return Fd(r),new Et(n,null,r)}{if(!(n instanceof X||n instanceof Et))throw new g(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(F.fromString(e,...t));return Fd(r),new Et(n.firestore,null,r)}}function jS(n,e){if(n=U(n,Rs),Dl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new g(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ce(n,null,function(r){return new Pt(F.emptyPath(),r)}(e))}function Ji(n,e,...t){if(n=P(n),arguments.length===1&&(e=Tm.newId()),Dl("doc","path",e),n instanceof Rs){const r=F.fromString(e,...t);return Md(r),new X(n,null,new v(r))}{if(!(n instanceof X||n instanceof Et))throw new g(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(F.fromString(e,...t));return Md(r),new X(n.firestore,n instanceof Et?n.converter:null,new v(r))}}function f_(n,e){return n=P(n),e=P(e),(n instanceof X||n instanceof Et)&&(e instanceof X||e instanceof Et)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function p_(n,e){return n=P(n),e=P(e),n instanceof Ce&&e instanceof Ce&&n.firestore===e.firestore&&ys(n._query,e._query)&&n.converter===e.converter}class zS{constructor(){this.Ja=Promise.resolve(),this.Ya=[],this.Za=!1,this.Xa=[],this.eu=null,this.tu=!1,this.nu=!1,this.ru=[],this.zo=new dl(this,"async_queue_retry"),this.iu=()=>{const t=Zs();t&&_("AsyncQueue","Visibility state changed to "+t.visibilityState),this.zo.Qo()};const e=Zs();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.iu)}get isShuttingDown(){return this.Za}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.su(),this.ou(e)}enterRestrictedMode(e){if(!this.Za){this.Za=!0,this.nu=e||!1;const t=Zs();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.iu)}}enqueue(e){if(this.su(),this.Za)return new Promise(()=>{});const t=new pe;return this.ou(()=>this.Za&&this.nu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Ya.push(e),this._u()))}async _u(){if(this.Ya.length!==0){try{await this.Ya[0](),this.Ya.shift(),this.zo.reset()}catch(e){if(!an(e))throw e;_("AsyncQueue","Operation failed with retryable error: "+e)}this.Ya.length>0&&this.zo.ko(()=>this._u())}}ou(e){const t=this.Ja.then(()=>(this.tu=!0,e().catch(r=>{this.eu=r,this.tu=!1;const i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw oe("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.tu=!1,r))));return this.Ja=t,t}enqueueAfterDelay(e,t,r){this.su(),this.ru.indexOf(e)>-1&&(t=0);const i=gl.createAndSchedule(this,e,t,r,s=>this.au(s));return this.Xa.push(i),i}su(){this.eu&&R()}verifyOperationInProgress(){}async uu(){let e;do e=this.Ja,await e;while(e!==this.Ja)}cu(e){for(const t of this.Xa)if(t.timerId===e)return!0;return!1}lu(e){return this.uu().then(()=>{this.Xa.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Xa)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.uu()})}hu(e){this.ru.push(e)}au(e){const t=this.Xa.indexOf(e);this.Xa.splice(t,1)}}function zc(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const i=t;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}class WS{constructor(){this._progressObserver={},this._taskCompletionResolver=new pe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}const GS=-1;let re=class extends Rs{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new zS}(),this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||m_(this),this._firestoreClient.terminate()}};function ye(n){return n._firestoreClient||m_(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function m_(n){var e,t,r;const i=n._freezeSettings(),s=function(a,c,u,l){return new IR(a,c,u,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,u_(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new NS(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function KS(n,e){__(n=U(n,re));const t=ye(n);if(t._uninitializedComponentsProvider)throw new g(m.FAILED_PRECONDITION,"SDK cache is already specified.");Je("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const r=n._freezeSettings(),i=new Sl;return g_(t,i,new r_(i,r.cacheSizeBytes,e==null?void 0:e.forceOwnership))}function HS(n){__(n=U(n,re));const e=ye(n);if(e._uninitializedComponentsProvider)throw new g(m.FAILED_PRECONDITION,"SDK cache is already specified.");Je("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const t=n._freezeSettings(),r=new Sl;return g_(e,r,new CS(r,t.cacheSizeBytes))}function g_(n,e,t){const r=new pe;return n.asyncQueue.enqueue(async()=>{try{await eo(n,t),await jc(n,e),r.resolve()}catch(i){const s=i;if(!i_(s))throw s;Je("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}}).then(()=>r.promise)}function QS(n){if(n._initialized&&!n._terminated)throw new g(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new pe;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!He.D())return Promise.resolve();const i=r+"main";await He.delete(i)}(ul(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function YS(n){return function(t){const r=new pe;return t.asyncQueue.enqueueAndForget(async()=>_S(await kl(t),r)),r.promise}(ye(n=U(n,re)))}function JS(n){return OS(ye(n=U(n,re)))}function XS(n){return LS(ye(n=U(n,re)))}function ZS(n,e){const t=ye(n=U(n,re)),r=new WS;return BS(t,n._databaseId,e,r),r}function eP(n,e){return qS(ye(n=U(n,re)),e).then(t=>t?new Ce(n,null,t.query):null)}function __(n){if(n._initialized||n._terminated)throw new g(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class mt{constructor(e){this._byteString=e}static fromBase64String(e){try{return new mt(he.fromBase64String(e))}catch(t){throw new g(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new mt(he.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}let Zt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new g(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Q(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};let zn=class{constructor(e){this._methodName=e}};class va{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new g(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new g(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return k(this._lat,e._lat)||k(this._long,e._long)}}const tP=/^__.*__$/;class nP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Ct(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ur(e,this.data,t,this.fieldTransforms)}}class y_{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Ct(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function v_(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw R()}}class Ia{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Pu(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Iu(){return this.settings.Iu}Tu(e){return new Ia(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Eu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Au(e),i}Ru(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.Tu({path:r,du:!1});return i.Pu(),i}Vu(e){return this.Tu({path:void 0,du:!0})}mu(e){return Co(e,this.settings.methodName,this.settings.fu||!1,this.path,this.settings.gu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Pu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Au(this.path.get(e))}Au(e){if(e.length===0)throw this.mu("Document fields must not be empty");if(v_(this.Iu)&&tP.test(e))throw this.mu('Document fields cannot begin and end with "__"')}}class rP{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Ts(e)}pu(e,t,r,i=!1){return new Ia({Iu:e,methodName:t,gu:r,path:Q.emptyPath(),du:!1,fu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Wn(n){const e=n._freezeSettings(),t=Ts(n._databaseId);return new rP(n._databaseId,!!e.ignoreUndefinedProperties,t)}function wa(n,e,t,r,i,s={}){const o=n.pu(s.merge||s.mergeFields?2:0,e,t,i);Ol("Data must be an object, but it was:",o,r);const a=E_(r,o);let c,u;if(s.merge)c=new Ue(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const l=[];for(const h of s.mergeFields){const d=Wc(e,h,t);if(!o.contains(d))throw new g(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);A_(l,d)||l.push(d)}c=new Ue(l),u=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,u=o.fieldTransforms;return new nP(new we(a),c,u)}class bs extends zn{_toFieldTransform(e){if(e.Iu!==2)throw e.Iu===1?e.mu(`${this._methodName}() can only appear at the top level of your update data`):e.mu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof bs}}function I_(n,e,t){return new Ia({Iu:3,gu:e.settings.gu,methodName:n._methodName,du:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class Vl extends zn{_toFieldTransform(e){return new Is(e.path,new wr)}isEqual(e){return e instanceof Vl}}class iP extends zn{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=I_(this,e,!0),r=this.yu.map(s=>Gn(s,t)),i=new Nn(r);return new Is(e.path,i)}isEqual(e){return this===e}}class sP extends zn{constructor(e,t){super(e),this.yu=t}_toFieldTransform(e){const t=I_(this,e,!0),r=this.yu.map(s=>Gn(s,t)),i=new xn(r);return new Is(e.path,i)}isEqual(e){return this===e}}class oP extends zn{constructor(e,t){super(e),this.wu=t}_toFieldTransform(e){const t=new Er(e.serializer,eg(e.serializer,this.wu));return new Is(e.path,t)}isEqual(e){return this===e}}function Nl(n,e,t,r){const i=n.pu(1,e,t);Ol("Data must be an object, but it was:",i,r);const s=[],o=we.empty();jn(r,(c,u)=>{const l=Ll(e,c,t);u=P(u);const h=i.Ru(l);if(u instanceof bs)s.push(l);else{const d=Gn(u,h);d!=null&&(s.push(l),o.set(l,d))}});const a=new Ue(s);return new y_(o,a,i.fieldTransforms)}function xl(n,e,t,r,i,s){const o=n.pu(1,e,t),a=[Wc(e,r,t)],c=[i];if(s.length%2!=0)throw new g(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Wc(e,s[d])),c.push(s[d+1]);const u=[],l=we.empty();for(let d=a.length-1;d>=0;--d)if(!A_(u,a[d])){const f=a[d];let w=c[d];w=P(w);const E=o.Ru(f);if(w instanceof bs)u.push(f);else{const I=Gn(w,E);I!=null&&(u.push(f),l.set(f,I))}}const h=new Ue(u);return new y_(l,h,o.fieldTransforms)}function w_(n,e,t,r=!1){return Gn(t,n.pu(r?4:3,e))}function Gn(n,e){if(T_(n=P(n)))return Ol("Unsupported field value:",e,n),E_(n,e);if(n instanceof zn)return function(r,i){if(!v_(i.Iu))throw i.mu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.mu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.du&&e.Iu!==4)throw e.mu("Nested arrays are not supported");return function(r,i){const s=[];let o=0;for(const a of r){let c=Gn(a,i.Vu(o));c==null&&(c={nullValue:"NULL_VALUE"}),s.push(c),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=P(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return eg(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=J.fromDate(r);return{timestampValue:Tr(i.serializer,s)}}if(r instanceof J){const s=new J(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Tr(i.serializer,s)}}if(r instanceof va)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof mt)return{bytesValue:dg(i.serializer,r._byteString)};if(r instanceof X){const s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.mu(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:rl(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.mu(`Unsupported field value: ${ya(r)}`)}(n,e)}function E_(n,e){const t={};return xm(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):jn(n,(r,i)=>{const s=Gn(i,e.Eu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function T_(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof J||n instanceof va||n instanceof mt||n instanceof X||n instanceof zn)}function Ol(n,e,t){if(!T_(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const r=ya(t);throw r==="an object"?e.mu(n+" a custom object"):e.mu(n+" "+r)}}function Wc(n,e,t){if((e=P(e))instanceof Zt)return e._internalPath;if(typeof e=="string")return Ll(n,e);throw Co("Field path arguments must be of type string or ",n,!1,void 0,t)}const aP=new RegExp("[~\\*/\\[\\]]");function Ll(n,e,t){if(e.search(aP)>=0)throw Co(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Zt(...e.split("."))._internalPath}catch{throw Co(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Co(n,e,t,r,i){const s=r&&!r.isEmpty(),o=i!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new g(m.INVALID_ARGUMENT,a+n+c)}function A_(n,e){return n.some(t=>t.isEqual(e))}class Xi{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new X(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new cP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ea("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class cP extends Xi{data(){return super.data()}}function Ea(n,e){return typeof e=="string"?Ll(n,e):e instanceof Zt?e._internalPath:e._delegate._internalPath}function R_(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new g(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ml{}class Ss extends Ml{}function Ot(n,e,...t){let r=[];e instanceof Ml&&r.push(e),r=r.concat(t),function(s){const o=s.filter(c=>c instanceof Fl).length,a=s.filter(c=>c instanceof Ta).length;if(o>1||o>0&&a>0)throw new g(m.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Ta extends Ss{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ta(e,t,r)}_apply(e){const t=this._parse(e);return S_(e._query,t),new Ce(e.firestore,e.converter,Vc(e._query,t))}_parse(e){const t=Wn(e.firestore);return function(s,o,a,c,u,l,h){let d;if(u.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new g(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){qd(h,l);const f=[];for(const w of h)f.push(Bd(c,s,w));d={arrayValue:{values:f}}}else d=Bd(c,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||qd(h,l),d=w_(a,o,h,l==="in"||l==="not-in");return O.create(u,l,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function uP(n,e,t){const r=e,i=Ea("where",n);return Ta._create(i,r,t)}class Fl extends Ml{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Fl(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:B.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i;const a=s.getFlattenedFilters();for(const c of a)S_(o,c),o=Vc(o,c)}(e._query,t),new Ce(e.firestore,e.converter,Vc(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ul extends Ss{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ul(e,t)}_apply(e){const t=function(i,s,o){if(i.startAt!==null)throw new g(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new g(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Gi(s,o)}(e._query,this._field,this._direction);return new Ce(e.firestore,e.converter,function(i,s){const o=i.explicitOrderBy.concat([s]);return new Pt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function lP(n,e="asc"){const t=e,r=Ea("orderBy",n);return Ul._create(r,t)}class Aa extends Ss{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Aa(e,t,r)}_apply(e){return new Ce(e.firestore,e.converter,wo(e._query,this._limit,this._limitType))}}function hP(n){return h_("limit",n),Aa._create("limit",n,"F")}function dP(n){return h_("limitToLast",n),Aa._create("limitToLast",n,"L")}class Ra extends Ss{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ra(e,t,r)}_apply(e){const t=b_(e,this.type,this._docOrFields,this._inclusive);return new Ce(e.firestore,e.converter,function(i,s){return new Pt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}}function fP(...n){return Ra._create("startAt",n,!0)}function pP(...n){return Ra._create("startAfter",n,!1)}class ba extends Ss{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ba(e,t,r)}_apply(e){const t=b_(e,this.type,this._docOrFields,this._inclusive);return new Ce(e.firestore,e.converter,function(i,s){return new Pt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}}function mP(...n){return ba._create("endBefore",n,!1)}function gP(...n){return ba._create("endAt",n,!0)}function b_(n,e,t,r){if(t[0]=P(t[0]),t[0]instanceof Xi)return function(s,o,a,c,u){if(!c)throw new g(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);const l=[];for(const h of dr(s))if(h.field.isKeyField())l.push(Dn(o,c.key));else{const d=c.data.field(h.field);if(ua(d))throw new g(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){const f=h.field.canonicalString();throw new g(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new Jt(l,u)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Wn(n.firestore);return function(o,a,c,u,l,h){const d=o.explicitOrderBy;if(l.length>d.length)throw new g(m.INVALID_ARGUMENT,`Too many arguments provided to ${u}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const f=[];for(let w=0;w<l.length;w++){const E=l[w];if(d[w].field.isKeyField()){if(typeof E!="string")throw new g(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${u}(), but got a ${typeof E}`);if(!Yu(o)&&E.indexOf("/")!==-1)throw new g(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${u}() must be a plain document ID, but '${E}' contains a slash.`);const I=o.path.child(F.fromString(E));if(!v.isDocumentKey(I))throw new g(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${u}() must result in a valid document path, but '${I}' is not because it contains an odd number of segments.`);const D=new v(I);f.push(Dn(a,D))}else{const I=w_(c,u,E);f.push(I)}}return new Jt(f,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Bd(n,e,t){if(typeof(t=P(t))=="string"){if(t==="")throw new g(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Yu(e)&&t.indexOf("/")!==-1)throw new g(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(F.fromString(t));if(!v.isDocumentKey(r))throw new g(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Dn(n,new v(r))}if(t instanceof X)return Dn(n,t._key);throw new g(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ya(t)}.`)}function qd(n,e){if(!Array.isArray(n)||n.length===0)throw new g(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function S_(n,e){const t=function(i,s){for(const o of i)for(const a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new g(m.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new g(m.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}class Bl{convertValue(e,t="none"){switch(kn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ee(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ht(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw R()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return jn(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new va(ee(e.latitude),ee(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Hu(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(ji(e));default:return null}}convertTimestamp(e){const t=Kt(e);return new J(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=F.fromString(e);b(Eg(r));const i=new Qt(r.get(1),r.get(3)),s=new v(r.popFirst(5));return i.isEqual(t)||oe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Sa(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class _P extends Bl{constructor(e){super(),this.firestore=e}convertBytes(e){return new mt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new X(this.firestore,null,t)}}class wn{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}let Rt=class extends Xi{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Ei(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ea("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Ei=class extends Rt{data(e={}){return super.data(e)}},en=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new wn(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ei(this._firestore,this._userDataWriter,r.key,r,new wn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new g(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{const c=new Ei(i._firestore,i._userDataWriter,a.doc.key,a.doc,new wn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:c,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{const c=new Ei(i._firestore,i._userDataWriter,a.doc.key,a.doc,new wn(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);let u=-1,l=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:yP(a.type),doc:c,oldIndex:u,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function yP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return R()}}function P_(n,e){return n instanceof Rt&&e instanceof Rt?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof en&&e instanceof en&&n._firestore===e._firestore&&p_(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function C_(n){n=U(n,X);const e=U(n.firestore,re);return a_(ye(e),n._key).then(t=>ql(e,n,t))}class Kn extends Bl{constructor(e){super(),this.firestore=e}convertBytes(e){return new mt(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new X(this.firestore,null,t)}}function vP(n){n=U(n,X);const e=U(n.firestore,re),t=ye(e),r=new Kn(e);return MS(t,n._key).then(i=>new Rt(e,r,n._key,i,new wn(i!==null&&i.hasLocalMutations,!0),n.converter))}function IP(n){n=U(n,X);const e=U(n.firestore,re);return a_(ye(e),n._key,{source:"server"}).then(t=>ql(e,n,t))}function wP(n){n=U(n,Ce);const e=U(n.firestore,re),t=ye(e),r=new Kn(e);return R_(n._query),c_(t,n._query).then(i=>new en(e,r,n,i))}function EP(n){n=U(n,Ce);const e=U(n.firestore,re),t=ye(e),r=new Kn(e);return FS(t,n._query).then(i=>new en(e,r,n,i))}function TP(n){n=U(n,Ce);const e=U(n.firestore,re),t=ye(e),r=new Kn(e);return c_(t,n._query,{source:"server"}).then(i=>new en(e,r,n,i))}function $d(n,e,t){n=U(n,X);const r=U(n.firestore,re),i=Sa(n.converter,e,t);return Ps(r,[wa(Wn(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Y.none())])}function jd(n,e,t,...r){n=U(n,X);const i=U(n.firestore,re),s=Wn(i);let o;return o=typeof(e=P(e))=="string"||e instanceof Zt?xl(s,"updateDoc",n._key,e,t,r):Nl(s,"updateDoc",n._key,e),Ps(i,[o.toMutation(n._key,Y.exists(!0))])}function AP(n){return Ps(U(n.firestore,re),[new Br(n._key,Y.none())])}function RP(n,e){const t=U(n.firestore,re),r=Ji(n),i=Sa(n.converter,e);return Ps(t,[wa(Wn(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Y.exists(!1))]).then(()=>r)}function k_(n,...e){var t,r,i;n=P(n);let s={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||zc(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges};if(zc(e[o])){const h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let c,u,l;if(n instanceof X)u=U(n.firestore,re),l=Fr(n._key.path),c={next:h=>{e[o]&&e[o](ql(u,n,h))},error:e[o+1],complete:e[o+2]};else{const h=U(n,Ce);u=U(h.firestore,re),l=h._query;const d=new Kn(u);c={next:f=>{e[o]&&e[o](new en(u,d,h,f))},error:e[o+1],complete:e[o+2]},R_(n._query)}return function(d,f,w,E){const I=new ga(E),D=new Il(f,I,w);return d.asyncQueue.enqueueAndForget(async()=>_l(await Pr(d),D)),()=>{I.Na(),d.asyncQueue.enqueueAndForget(async()=>yl(await Pr(d),D))}}(ye(u),l,a,c)}function bP(n,e){return US(ye(n=U(n,re)),zc(e)?e:{next:e})}function Ps(n,e){return function(r,i){const s=new pe;return r.asyncQueue.enqueueAndForget(async()=>fS(await kl(r),i,s)),s.promise}(ye(n),e)}function ql(n,e,t){const r=t.docs.get(e._key),i=new Kn(n);return new Rt(n,i,e._key,r,new wn(t.hasPendingWrites,t.fromCache),e.converter)}const SP={maxAttempts:5};let PP=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Wn(e)}set(e,t,r){this._verifyNotCommitted();const i=Mt(e,this._firestore),s=Sa(i.converter,t,r),o=wa(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Y.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Mt(e,this._firestore);let o;return o=typeof(t=P(t))=="string"||t instanceof Zt?xl(this._dataReader,"WriteBatch.update",s._key,t,r,i):Nl(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Y.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Mt(e,this._firestore);return this._mutations=this._mutations.concat(new Br(t._key,Y.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new g(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function Mt(n,e){if((n=P(n)).firestore!==e)throw new g(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}let CP=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Wn(t)}get(t){const r=Mt(t,this._firestore),i=new _P(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return R();const o=s[0];if(o.isFoundDocument())return new Xi(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Xi(this._firestore,i,r._key,null,r.converter);throw R()})}set(t,r,i){const s=Mt(t,this._firestore),o=Sa(s.converter,r,i),a=wa(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){const o=Mt(t,this._firestore);let a;return a=typeof(r=P(r))=="string"||r instanceof Zt?xl(this._dataReader,"Transaction.update",o._key,r,i,s):Nl(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){const r=Mt(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Mt(e,this._firestore),r=new Kn(this._firestore);return super.get(e).then(i=>new Rt(this._firestore,r,t._key,i._document,new wn(!1,!1),t.converter))}};function kP(n,e,t){n=U(n,re);const r=Object.assign(Object.assign({},SP),t);return function(s){if(s.maxAttempts<1)throw new g(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){const c=new pe;return s.asyncQueue.enqueueAndForget(async()=>{const u=await xS(s);new VS(s.asyncQueue,u,a,o,c).run()}),c.promise}(ye(n),i=>e(new CP(n,i)),r)}function DP(){return new bs("deleteField")}function VP(){return new Vl("serverTimestamp")}function NP(...n){return new iP("arrayUnion",n)}function xP(...n){return new sP("arrayRemove",n)}function OP(n){return new oP("increment",n)}(function(e,t=!0){(function(i){Mr=i})(tn),zt(new dt("firestore",(r,{instanceIdentifier:i,options:s})=>{const o=r.getProvider("app").getImmediate(),a=new re(new jA(r.getProvider("auth-internal")),new KA(r.getProvider("app-check-internal")),function(u,l){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new g(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Qt(u.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),ct(Mh,"4.4.0",e),ct(Mh,"4.4.0","esm2017")})();const LP="@firebase/firestore-compat",MP="0.3.23";function $l(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new g("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function zd(){if(typeof Uint8Array>"u")throw new g("unimplemented","Uint8Arrays are not available in this environment.")}function Wd(){if(!yR())throw new g("unimplemented","Blobs are unavailable in Firestore in this environment.")}class Zi{constructor(e){this._delegate=e}static fromBase64String(e){return Wd(),new Zi(mt.fromBase64String(e))}static fromUint8Array(e){return zd(),new Zi(mt.fromUint8Array(e))}toBase64(){return Wd(),this._delegate.toBase64()}toUint8Array(){return zd(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Gc(n){return FP(n,["next","error","complete"])}function FP(n,e){if(typeof n!="object"||n===null)return!1;const t=n;for(const r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}class UP{enableIndexedDbPersistence(e,t){return KS(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return HS(e._delegate)}clearIndexedDbPersistence(e){return QS(e._delegate)}}class D_{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Qt||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Je("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){$S(this._delegate,e,t,r)}enableNetwork(){return JS(this._delegate)}disableNetwork(){return XS(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,l_("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return YS(this._delegate)}onSnapshotsInSync(e){return bP(this._delegate,e)}get app(){if(!this._appCompat)throw new g("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Cr(this,d_(this._delegate,e))}catch(t){throw De(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ge(this,Ji(this._delegate,e))}catch(t){throw De(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ke(this,jS(this._delegate,e))}catch(t){throw De(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return kP(this._delegate,t=>e(new V_(this,t)))}batch(){return ye(this._delegate),new N_(new PP(this._delegate,e=>Ps(this._delegate,e)))}loadBundle(e){return ZS(this._delegate,e)}namedQuery(e){return eP(this._delegate,e).then(t=>t?new ke(this,t):null)}}class Pa extends Bl{constructor(e){super(),this.firestore=e}convertBytes(e){return new Zi(new mt(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Ge.forKey(t,this.firestore,null)}}function BP(n){UA(n)}class V_{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Pa(e)}get(e){const t=En(e);return this._delegate.get(t).then(r=>new es(this._firestore,new Rt(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=En(e);return r?($l("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=En(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=En(e);return this._delegate.delete(t),this}}class N_{constructor(e){this._delegate=e}set(e,t,r){const i=En(e);return r?($l("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=En(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=En(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Fn{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Ei(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ts(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Fn.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new Fn(e,new Pa(e),t),i.set(t,s)),s}}Fn.INSTANCES=new WeakMap;class Ge{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Pa(e)}static forPath(e,t,r){if(e.length%2!==0)throw new g("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Ge(t,new X(t._delegate,r,new v(e)))}static forKey(e,t,r){return new Ge(t,new X(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Cr(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Cr(this.firestore,d_(this._delegate,e))}catch(t){throw De(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=P(e),e instanceof X?f_(this._delegate,e):!1}set(e,t){t=$l("DocumentReference.set",t);try{return t?$d(this._delegate,e,t):$d(this._delegate,e)}catch(r){throw De(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?jd(this._delegate,e):jd(this._delegate,e,t,...r)}catch(i){throw De(i,"updateDoc()","DocumentReference.update()")}}delete(){return AP(this._delegate)}onSnapshot(...e){const t=x_(e),r=O_(e,i=>new es(this.firestore,new Rt(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return k_(this._delegate,t,r)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=vP(this._delegate):(e==null?void 0:e.source)==="server"?t=IP(this._delegate):t=C_(this._delegate),t.then(r=>new es(this.firestore,new Rt(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Ge(this.firestore,e?this._delegate.withConverter(Fn.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function De(n,e,t){return n.message=n.message.replace(e,t),n}function x_(n){for(const e of n)if(typeof e=="object"&&!Gc(e))return e;return{}}function O_(n,e){var t,r;let i;return Gc(n[0])?i=n[0]:Gc(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}class es{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ge(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return P_(this._delegate,e._delegate)}}class ts extends es{data(e){const t=this._delegate.data(e);return this._delegate._converter||BA(t!==void 0),t}}class ke{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Pa(e)}where(e,t,r){try{return new ke(this.firestore,Ot(this._delegate,uP(e,t,r)))}catch(i){throw De(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ke(this.firestore,Ot(this._delegate,lP(e,t)))}catch(r){throw De(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ke(this.firestore,Ot(this._delegate,hP(e)))}catch(t){throw De(t,"limit()","Query.limit()")}}limitToLast(e){try{return new ke(this.firestore,Ot(this._delegate,dP(e)))}catch(t){throw De(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ke(this.firestore,Ot(this._delegate,fP(...e)))}catch(t){throw De(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ke(this.firestore,Ot(this._delegate,pP(...e)))}catch(t){throw De(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ke(this.firestore,Ot(this._delegate,mP(...e)))}catch(t){throw De(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ke(this.firestore,Ot(this._delegate,gP(...e)))}catch(t){throw De(t,"endAt()","Query.endAt()")}}isEqual(e){return p_(this._delegate,e._delegate)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=EP(this._delegate):(e==null?void 0:e.source)==="server"?t=TP(this._delegate):t=wP(this._delegate),t.then(r=>new Kc(this.firestore,new en(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=x_(e),r=O_(e,i=>new Kc(this.firestore,new en(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return k_(this._delegate,t,r)}withConverter(e){return new ke(this.firestore,e?this._delegate.withConverter(Fn.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class qP{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ts(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Kc{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ke(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ts(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new qP(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new ts(this._firestore,r))})}isEqual(e){return P_(this._delegate,e._delegate)}}class Cr extends ke{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Ge(this.firestore,e):null}doc(e){try{return e===void 0?new Ge(this.firestore,Ji(this._delegate)):new Ge(this.firestore,Ji(this._delegate,e))}catch(t){throw De(t,"doc()","CollectionReference.doc()")}}add(e){return RP(this._delegate,e).then(t=>new Ge(this.firestore,t))}isEqual(e){return f_(this._delegate,e._delegate)}withConverter(e){return new Cr(this.firestore,e?this._delegate.withConverter(Fn.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function En(n){return U(n,X)}class jl{constructor(...e){this._delegate=new Zt(...e)}static documentId(){return new jl(Q.keyField().canonicalString())}isEqual(e){return e=P(e),e instanceof Zt?this._delegate._internalPath.isEqual(e._internalPath):!1}}class _n{constructor(e){this._delegate=e}static serverTimestamp(){const e=VP();return e._methodName="FieldValue.serverTimestamp",new _n(e)}static delete(){const e=DP();return e._methodName="FieldValue.delete",new _n(e)}static arrayUnion(...e){const t=NP(...e);return t._methodName="FieldValue.arrayUnion",new _n(t)}static arrayRemove(...e){const t=xP(...e);return t._methodName="FieldValue.arrayRemove",new _n(t)}static increment(e){const t=OP(e);return t._methodName="FieldValue.increment",new _n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const $P={Firestore:D_,GeoPoint:va,Timestamp:J,Blob:Zi,Transaction:V_,WriteBatch:N_,DocumentReference:Ge,DocumentSnapshot:es,Query:ke,QueryDocumentSnapshot:ts,QuerySnapshot:Kc,CollectionReference:Cr,FieldPath:jl,FieldValue:_n,setLogLevel:BP,CACHE_SIZE_UNLIMITED:GS};function jP(n,e){n.INTERNAL.registerComponent(new dt("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},$P)))}function zP(n){jP(n,(e,t)=>new D_(e,t,new UP)),n.registerVersion(LP,MP)}zP(Wt);const WP={apiKey:"AIzaSyCfFGZC07caKFCARPJmMU-qsuAW8jLIu3E",authDomain:"project-fitness-07.firebaseapp.com",projectId:"project-fitness-07",storageBucket:"project-fitness-07.appspot.com",messagingSenderId:"607206642972",appId:"1:607206642972:web:ea1d5c525a976b668cd6d9"},Un=Wt.initializeApp(WP);async function GP({email:n,password:e,name:t}){await Un.auth().createUserWithEmailAndPassword(n,e),await(await Un.auth().currentUser).updateProfile({displayName:t})}async function KP({email:n,password:e}){try{await Un.auth().signInWithEmailAndPassword(n,e)}catch(t){console.log(t.message)}}async function HP(){await Un.auth().signOut()}const ri={fs:Wt.firestore(),getCurrentUserID:async function(){return new Promise((n,e)=>{Un.auth().onAuthStateChanged(t=>{t?n(t.uid):e("User not authenticated")})})},addData:async function(n,e){const t=await this.getCurrentUserID();this.fs.collection("users").doc(t).set({[n]:e},{merge:!0}).then(()=>!0).catch(r=>(console.error("Error writing document: ",r),!1))},removeData:async function(n){const e=await this.getCurrentUserID();this.fs.collection("users").doc(e).update({[n]:Wt.firestore.FieldValue.delete()},{merge:!0}).then(()=>!0).catch(t=>(console.error("Error writing document: ",t),!1))},getData:async function(){const n=await this.getCurrentUserID(),e=Ji(this.fs,"users",n),t=await C_(e);if(t.exists())return t.data();console.error("No such document")}},ns=document.querySelector(".user-icon"),ko=document.querySelector(".authModal__backdrop"),L_=document.querySelector(".authModal__button-close"),Ca=document.querySelector(".authForm"),Gd=document.querySelector(".action__text"),di=document.querySelector(".action__button"),Kd=document.querySelector(".authForm__fieldset.username"),Hd=document.querySelector(".authForm__title"),Do=document.querySelector(".header__username"),Qd=document.querySelector(".header_main_nav"),Vo=document.querySelector(".button-logout");let to=!0;const Cs=()=>{ko.classList.remove("open"),L_.removeEventListener("click",Cs),ns.addEventListener("click",zl),document.body.style.overflow="visible"},zl=()=>{ko.classList.add("open"),L_.addEventListener("click",Cs),ns.removeEventListener("click",zl),document.body.style.overflow="hidden"},Hc=()=>{Ca.reset()},QP=async n=>{var r;n.preventDefault();const e=[...Ca.elements].reduce((i,s)=>(s.name&&(i[s.name]=s.value),i),{});to&&await GP(e),await KP(e),Hc();const t=(r=await Un.auth().currentUser)==null?void 0:r.displayName;Do.textContent=t,Cs()},YP=()=>{to?(di.textContent="Registration",Kd.classList.add("hidden"),di.setAttribute("data-action","log_in"),Hd.textContent="Log in",Gd.textContent="Don't have an account?",Hc(),to=!1):(di.textContent="Log in",di.setAttribute("data-action","reg"),Kd.classList.remove("hidden"),Hd.textContent="Registration",Gd.textContent="Already have an account?",Hc(),to=!0),Ca.elements.name.toggleAttribute("required")},JP=async()=>{await Un.auth().onAuthStateChanged(n=>{n?(Do.textContent=n.displayName,Do.classList.remove("hidden"),ns.classList.add("hidden"),Qd.classList.add("visible"),Vo.classList.add("visible")):(ns.classList.remove("hidden"),Vo.classList.remove("visible"),Qd.classList.remove("visible"))})},XP=async()=>{await HP(),Vo.classList.add("hidden"),Do.classList.add("hidden")};ns.addEventListener("click",zl);Ca.addEventListener("submit",QP);di.addEventListener("click",YP);Vo.addEventListener("click",XP);document.addEventListener("keydown",n=>{n.key==="Escape"&&Cs()});ko.addEventListener("click",n=>{n.target===ko&&Cs()});JP();function ZP(){const n=document.querySelector(".hero__hashtags-wrap"),e=document.createElement("ul");e.classList.add("hashtags__list");const t=["Sport","Healthy","Workout","Diet"].map(r=>`
  <li class='hashtags__item'>#${r}</li>
`).join("");e.innerHTML=t,n.insertAdjacentElement("beforeend",e)}window.addEventListener("load",ZP);const ka=document.querySelector(".js-cards"),pr="/project-fitness-07/";function e0(n){const e=n.map(({filter:t,name:r,imgURL:i})=>`
        <a class="exercise-cards__gallery-link js-card" data-card-name="${r}" href="">
            <div class="exercise-cards__gallery-card">
                <div class="exercise-cards__gradient"></div>
                <img class="exercise-cards__gallery-image"  src="${i}" alt="${t+"-"+r}" loading="lazy" />
                <div class="exercise-cards__gallery-info">
                    <h3 class="exercise-cards__head3-name">${r}</h3>
                    <p class="exercise-cards__parag-filter">${t}</p>
                </div>
            </div>
        </a>
        `).join("");ka.insertAdjacentHTML("beforeend",e)}function t0(n){const e=n.map(({_id:t,bodyPart:r,name:i,target:s,burnedCalories:o,time:a,rating:c})=>`
        <a class="workout-cards__gallery-link js-workout-card" data-id="${t}"  href="">
            <div class="workout-cards__gallery-card" >
                <div class="workout-cards__first-line-wrapper">
                    <p class="workout-cards__parag-workout">Workout</p>
                    <p class="workout-cards__parag-rating">${Math.round(c*10)/10}</p>
                    <svg class="workout-cards__icon-star">
                        <use href="${pr}images/icons-sprite.svg#icon-star"></use>
                    </svg>
                    <p class="workout-cards__parag-start">Start</p>
                    <svg class="workout-cards__icon-arrow-up">
                        <use href="${pr}images/icons-sprite.svg#icon-arrow-up"></use>
                    </svg>
                </div>
                <div class="workout-cards__second-line-wrapper">
                    <div class="workout-cards__wrapper-icon-running-stick">
                        <svg class="workout-cards__icon-running-stick">
                            <use href="${pr}images/icons-sprite.svg#icon-running-stick"></use>
                        </svg>
                    </div>
                    <h3 class="workout-cards__head3-name">${i}</h3>
                </div>
                <div class="workout-cards__third-line-wrapper">
                    <p class="workout-cards__parag-burned-calories">Burned calories:</p>
                    <p class="workout-cards__parag-burned-calories-result">${o} / ${a} min<p>
                    <p class="workout-cards__parag-body-part">Body part:</p>
                    <p class="workout-cards__parag-body-part-result">${r}<p>
                    <p class="workout-cards__parag-target">Target:</p>
                    <p class="workout-cards__parag-target-result">${s}<p>
                </div>
            </div>
        </a>
        `).join("");ka.insertAdjacentHTML("beforeend",e)}function n0(n){const e=n.map(({_id:t,bodyPart:r,name:i,target:s,burnedCalories:o,time:a})=>`
        <a class="favori-cards__gallery-link" href="">
            <div class="favorite-cards__gallery-card" data-id="${t}">
                <div class="favorite-cards__first-line-wrapper">
                    <p class="favorite-cards__parag-workout">favorite</p>
                    <svg class="favorite-cards__icon-trash">
                        <use href="${pr}images/icons-sprite.svg#icon-trash"></use>
                    </svg>
                    <p class="favorite-cards__parag-start">Start</p>
                    <svg class="favorite-cards__icon-arrow-up">
                        <use href="${pr}images/icons-sprite.svg#icon-arrow-up"></use>
                    </svg>
                </div>
                <div class="favorite-cards__second-line-wrapper">
                    <svg class="favorite-cards__icon-running-stick">
                        <use href="${pr}images/icons-sprite.svg#icon-running-stick"></use>
                    </svg>
                    <h3 class="favorite-cards__head3-name">${i}</h3>
                </div>
                <div class="favorite-cards__third-line-wrapper">
                    <p class="favorite-cards__parag-burned-calories">
                    Burned calories: <span class="favorite-cards__span-text">${o} / ${a} min<span></p>
                    <p class="favorite-cards__parag-body-part">
                    Body part: <span class="favorite-cards__span-text">${r} min<span></p>
                    <p class="favorite-cards__parag-target">
                    Target: <span class="favorite-cards__span-text">${s} min<span></p>
                </div>
            </div>
        </a>
        `).join("");ka.insertAdjacentHTML("beforeend",e)}function Yd(){ka.innerHTML=""}function r0(){return Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)}function i0(n,e){if(e>=768)return n!=3?10:12;if(e<768)return n==1?10:n==2?8:9}function M_(n){const e={filter:"Body%20parts",bodypart:"",keyword:"",muscles:"",equipment:""};for(const t in n)if(n.hasOwnProperty(t)&&n[t]!==e[t])return!0;return!1}function s0(n,e,t,r,i){return M_(r)?(t.bodyPart=r.bodypart,t.keyword=r.keyword,t.muscles=r.muscles,t.equipment=r.equipment,i=No(n,e,t).fetchFilteredExercises()):i=No(n,e,t).fetchExercise(),i}function o0(n,e,t,r,i){return M_(r)&&(t.filter=r.filter),i=No(n,e,t).fetchMuscles(),i}function No(n,e,t){const r=r0(),i=i0(e,r);return t.pageCounter=n,t.limit=i,t}function Jd(n){return n.then(e=>e).catch(e=>{throw console.error("Error in getData:",e),e})}function a0(n){const e=document.querySelector(".filters__list .active");if(e){const t=e.id;n.filter=t.includes("-")?(t.charAt(0).toUpperCase()+t.slice(1)).replace("-","%20"):t.charAt(0).toUpperCase()+t.slice(1)}else console.error("No child elements found in filters.")}const F_=document.querySelector(".exercise-cards__wrapper");function c0(){F_.classList.add("workout-cards__wrapper")}function u0(){F_.classList.remove("workout-cards__wrapper")}const Qc=document.querySelector(".js-pages");function Xd(n,e){const t=[];if(e>1){for(let i=n-3;i<=n+3;i++)if(i>0&&i<=e){const s=i===n?"exercise-cards__wrapper-page exercise-cards__current-page":"exercise-cards__wrapper-page js-pages";t.push(`
                    <div class="${s}">
                        <a class="exercise-cards__page js-page" data-page="${i}" href="">
                            ${i}
                        </a>
                    </div>
                `)}Qc.innerHTML="";for(const i of t)Qc.insertAdjacentHTML("beforeend",i)}}function Zd(){Qc.innerHTML=""}function l0(n){n.preventDefault();const{target:e}=n;return e.classList.contains("js-cards")?void 0:e.closest(".js-card").dataset.cardName}function h0(n){n.preventDefault();const{target:e}=n;return e.classList.contains("js-page")?e.closest(".js-page").dataset.page:void 0}function d0(n){n.preventDefault();const{target:e}=n;if(e.classList.contains("js-cards"))return;const t=e.closest(".js-workout-card");return console.log(t),t.dataset.id}window.addEventListener("resize",ks);let gt={filter:"Muscles",bodypart:"",keyword:"",muscles:"",equipment:""};const be={currentPage:1,endPoint:3},ht={cardsLinks:null,pageLinks:null,workoutLinks:null};async function ks(){document.querySelector(".exercise-cards__section").offsetHeight;const e=new rf;let t,r;a0(gt);try{switch(be.endPoint){case 1:n0(t);break;case 2:c0(),r=s0(be.currentPage,be.endPoint,e,gt,r),t=await Jd(r),Yd(),Zd(),t0(t),Xd(be.currentPage,e.maxPages),ef(be.endPoint),m0();break;case 3:u0(),r=o0(be.currentPage,be.endPoint,e,gt,r),t=await Jd(r),Yd(),Zd(),e0(t),Xd(be.currentPage,e.maxPages),f0(),ef(be.endPoint);break}}catch(i){console.log("Error: ",i)}}function f0(){ht.cardsLinks=document.querySelector(".js-cards"),ht.cardsLinks?ht.cardsLinks.addEventListener("click",U_):console.error("Element with class 'js-cards' not found.")}function U_(n){const e=l0(n);e!=null&&(gt.filter==="Muscles"?(be.endPoint=2,gt.muscles=e):gt.filter==="Body%20parts"?(be.endPoint=2,gt.bodypart=e):gt.filter==="Equipment"&&(be.endPoint=2,gt.equipment=e)),ht.cardsLinks.removeEventListener("click",U_),be.currentPage=1,ks()}function ef(){ht.pageLinks=document.querySelector(".js-pages"),ht.pageLinks?ht.pageLinks.addEventListener("click",p0):console.error("Element with class 'js-pages' not found.")}function p0(n){const e=h0(n);be.currentPage!=e&&e!=null&&(be.currentPage=+e,ks())}function m0(){ht.workoutLinks=document.querySelector(".js-cards"),ht.workoutLinks?ht.workoutLinks.addEventListener("click",g0):console.error("Element with class 'js-cards' not found for workout.")}function g0(n){d0(n)}const _0=document.querySelector(".search__input"),Wl=document.querySelector(".filters__list"),y0=new rf;v0();async function v0(){const n=await y0.fetchFilters(),t=[...new Set(n.map(({filter:r})=>r))].map((r,i)=>{const s=r.toLowerCase().split(" ").join("-");return i===0?`<li id=${s} class="filters__item active">${r}</li>`:`<li id=${s} class="filters__item">${r}</li>`}).join("");Wl.insertAdjacentHTML("afterbegin",t),ks()}function I0(n){const e=n.target.value.toLowerCase().trim();console.log(e)}function w0(n){const e=n.target;n.target.id,[...Wl.children].forEach(t=>{t.classList.remove("active")}),e.classList.add("active"),be.currentPage=1,ks()}_0.addEventListener("input",I0);Wl.addEventListener("click",w0);const E0=n=>typeof n!="string"?n:n.split(" ").filter(e=>e).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),tf=n=>typeof n!="string"?n:n.charAt(0).toUpperCase()+n.slice(1),T0=n=>typeof n!="string"?n:n.replace(/([a-z])([A-Z])/g,"$1 $2").toLowerCase(),A0=n=>{const e=getComputedStyle(document.documentElement).getPropertyValue("--rating-color-inactive"),t=getComputedStyle(document.documentElement).getPropertyValue("--rating-color-active");return`
<!-- DEFINE SVGs -->
<svg height="0" width="0">
  <defs>
    <!-- DEFINE ONE STAR -->
    <symbol viewBox="0 0 32 32" id="iconstar">
      <path
        d="M13.826 3.262c.684-2.106 3.663-2.106 4.348 0l1.932 5.945a2.285 2.285 0 0 0 2.174 1.579h6.251c2.214 0 3.135 2.833 1.344 4.135l-5.057 3.674a2.286 2.286 0 0 0-.83 2.556l1.931 5.945c.684 2.106-1.726 3.857-3.517 2.555l-5.057-3.674a2.286 2.286 0 0 0-2.687 0l-5.057 3.674c-1.791 1.302-4.202-.45-3.517-2.555l1.932-5.945a2.287 2.287 0 0 0-.83-2.556l-5.057-3.674c-1.791-1.302-.871-4.135 1.344-4.135h6.251c.99 0 1.868-.638 2.174-1.579l1.932-5.945z" />
    </symbol>
    <!-- DEFINE PATTERN FOR EMPTY STARS -->
    <pattern id="stars-empty" patternUnits="userSpaceOnUse" width="24" height="24">
      <use x="0" y="0" xlink:href="#iconstar" fill="${e}" height="24" width="24"/>
    </pattern>
    <!-- DEFINE PATTERN FOR FULL STARS -->
    <pattern id="stars-full" patternUnits="userSpaceOnUse" width="24" height="24">
      <use x="0" y="0" xlink:href="#iconstar" fill="${t}" height="24" width="24"/>
    </pattern>
  </defs>
</svg>

<!-- INSERT STARS -->
<svg height="24" viewBox="0 0 120 24" width="120">
  <rect fill="url(#stars-empty)" x="0" y="0" height="24" width="120"/>
  <rect fill="url(#stars-full)" x="0" y="0" height="24" width="${n}%"/>
</svg>
`},no={add:function(n,e){return new Promise((t,r)=>{try{ri.addData(n,e),t(!0)}catch{r(!1)}})},get:function(){return new Promise(async(n,e)=>{try{const t=await ri.getData();n(Object.values(t))}catch{e([])}})},idIsFavorite:async function(n){try{return(await this.get()).some(t=>t._id===n)}catch{return!1}},getObjectById:async function(n){try{const t=(await this.get()).find(r=>r._id===n)||null;return t?{...t,isFavorite:!0}:null}catch{return null}},addAndGet:async function(n,e){return new Promise(async(t,r)=>{try{await ri.addData(n,e),setTimeout(async()=>{const i=await ri.getData();t(Object.values(i))},200)}catch{r([])}})},remove:async function(n){return new Promise((e,t)=>{try{ri.removeData(n),e(!0)}catch{t(!1)}})}},R0=async function(n){const{_id:e}=n;try{if(await no.idIsFavorite(e)){const r=await no.remove(e);return console.log(`Object with _id ${e} removed from favorites.`),!1}else{const r=await no.add(e,n);return console.log(`Object with _id ${e} added to favorites.`),r}}catch(t){return console.error(t),!1}},b0="/project-fitness-07/",S0=n=>{const e="js-toggle-favorit",t=document.getElementById(e);t.addEventListener("click",async r=>{const i=await R0(n);console.log(i);const s=i?"Remove from favorites":"Add to favorites",o=i?"icon-trash":"icon-heart";t.innerHTML=`<span>${s}</span>
       <svg class="btn-icon">
            <use href="${b0}images/icons-sprite.svg#${o}" />
          </svg>`})},xo=document.querySelector(".js-backdrop"),Wr=document.querySelector(".modalExercise"),B_=Wr.querySelector(".x-button"),nf=Wr.querySelector(".modalExercise__img-wrapper"),ii=Wr.querySelector(".exercise-content"),js=Wr.querySelector(".button-box"),P0="/project-fitness-07/",C0=5,k0=n=>{const{gifUrl:e,name:t,rating:r,_id:i,isFavorite:s,description:o}=n,a=D0(n);nf.innerHTML="",nf.insertAdjacentHTML("afterbegin",x0(e,t)),ii.innerHTML="",ii.insertAdjacentHTML("beforeend",V0(t)),ii.insertAdjacentHTML("beforeend",N0(r)),ii.insertAdjacentHTML("beforeend",O0(a)),ii.insertAdjacentHTML("beforeend",L0(o)),js.innerHTML="",s?js.insertAdjacentHTML("beforeend",F0()):js.insertAdjacentHTML("beforeend",M0()),js.insertAdjacentHTML("beforeend",U0())},D0=n=>({bodyPart:n.bodyPart,equipment:n.equipment,rating:n.rating,burnedCalories:n.burnedCalories,time:n.time,popular:n.popularity}),V0=n=>`
    <h3 class="title">${E0(n)}</h3>
  `,N0=n=>{const e=[],t=Math.round(n*10)/10;e.push(`<li class="rating__item value">${t}</li>`);const r=Math.round(n/C0*100);return e.push(`<li ${A0(r)}</li>`),`<ul class="rating">${e.join("")}</ul>`},x0=(n,e)=>`
    <img src="${n}" alt="${e}"/>
  `,O0=({burnedCalories:n,time:e,...t})=>{const r=[];for(const[i,s]of Object.entries(t)){const o=T0(i),a=tf(o),c=tf(s);r.push(`
      <li class="exercise_details-item">
        <p class="detail-name">${a}</p>
        <p class="detail-value">${c}</p>
      </li>
    `)}return r.push(`
      <li class="exercise_details-item">
        <p class="detail-name">Burned Calories</p>
        <p class="detail-value">${n}/${e} min</p>
      </li>
  `),`<ul class="exercise_details">${r.join("")}</ul>`},L0=n=>`
    <p class="exercise_description">${n}</p>

  `,M0=()=>Gl({text:"Add to favorites",iconId:"icon-heart"}),F0=()=>Gl({text:"Remove from favorites",iconId:"icon-trash"}),U0=()=>Gl({text:"Give a rating",className:"ghost"}),Gl=({text:n,iconId:e,className:t=""})=>{let r;return e&&(r=`
      <svg class="btn-icon">
        <use href=${P0}images/icons-sprite.svg#${e} />
      </svg>
    `),`
    <button id="js-toggle-favorit" type="button" class="js-favorites button ${t}">
      <span class="text">${n}</span>
      ${e?r:""}
    </button>
  `},Da=()=>{xo.classList.remove("open"),Wr.classList.remove("open"),B_.removeEventListener("click",Da),document.body.style.overflow="visible"},B0=n=>{k0(n),xo.classList.add("open"),Wr.classList.add("open"),B_.addEventListener("click",Da),document.body.style.overflow="hidden"};document.addEventListener("keydown",n=>{n.key==="Escape"&&Da()});xo.addEventListener("click",n=>{n.target===xo&&Da()});const q0=document.querySelector(".header__user"),$0=`
  <button class="button" type="button" data-modal="modal-exercise">
    Show exercise
  </button>`;q0.insertAdjacentHTML("beforeend",$0);const j0=document.querySelector("[data-modal]"),tc={_id:"64f389465ae26083f39b17a2",bodyPart:"waist",equipment:"body weight",gifUrl:"https://ftp.goit.study/img/power-pulse/gifs/0001.gif",name:"3/4 sit-up",target:"abs",description:"This refers to your core muscles, which include the rectus abdominis, obliques, and transverse abdominis. They're essential for maintaining posture, stability, and generating force in many movements. Exercises that target the abs include crunches, leg raises, and planks.",rating:3.61,burnedCalories:220,time:3,popularity:8322,isFavorite:!1},z0=async function(){const{_id:n}=tc,e=await no.idIsFavorite(n);console.log(e,n),B0({...tc,isFavorite:e}),S0(tc)};j0.addEventListener("click",n=>{z0()});
